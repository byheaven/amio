"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[174],{"5174":function(t,i,r){r.r(i),r.d(i,{"default":function(){return Mt}});var a=r(885),o=r(7294),h=r(3970),l=r(4536),c=r(5893),u=function VirtualJoystick(t){var i=t.onChange,r=t.onEnd,l=(0,o.useState)({"x":0,"y":0}),u=(0,a.Z)(l,2),d=u[0],_=u[1],g=(0,o.useRef)({"x":0,"y":0}),p=(0,o.useRef)(!1),m=(0,o.useCallback)(function(t,r){var a=g.current,o=t-a.x,h=r-a.y,l=Math.sqrt(o*o+h*h),c=l>44?44/l:1,u=o*c,d=h*c;_({"x":u,"y":d}),i({"x":u/44,"z":-d/44})},[i]),T=(0,o.useCallback)(function(t){var i;t.cancelable&&t.preventDefault(),t.stopPropagation();var r=null===(i=t.touches)||void 0===i?void 0:i[0];if(r){var a=t.currentTarget.getBoundingClientRect();g.current={"x":a.left+a.width/2,"y":a.top+a.height/2},p.current=!0,m(r.clientX,r.clientY)}},[m]),y=(0,o.useCallback)(function(t){var i;if(p.current){t.cancelable&&t.preventDefault(),t.stopPropagation();var r=null===(i=t.touches)||void 0===i?void 0:i[0];r&&m(r.clientX,r.clientY)}},[m]),M=(0,o.useCallback)(function(t){t&&(t.cancelable&&t.preventDefault(),t.stopPropagation()),p.current=!1,_({"x":0,"y":0}),i({"x":0,"z":0}),r()},[i,r]);return(0,c.jsx)(h.G7,{"className":"virtual-joystick","onTouchStart":T,"onTouchMove":y,"onTouchEnd":M,"onTouchCancel":M,"children":(0,c.jsx)(h.G7,{"className":"virtual-joystick__base","children":(0,c.jsx)(h.G7,{"className":"virtual-joystick__knob","style":{"transform":"translate(".concat(d.x,"px, ").concat(d.y,"px)")}})})})},d=r(5671),_=r(3144),g=r(4942),p=r(4073),m=r(1069),T=r(8137),y=r(8173),M=r(8658),b=r(8139),x=r(5412),E=r(5953),R=r(9069),A=r(8113);class _InternalNodeDataInfo{"constructor"(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new b.y$,this._onClonedObservable=new b.y$}}class Node{static"AddNodeConstructor"(t,i){this._NodeConstructors[t]=i}static"Construct"(t,i,r,a){const o=this._NodeConstructors[t];return o?o(i,r,a):null}set"accessibilityTag"(t){this._accessibilityTag=t,this.onAccessibilityTagChangedObservable.notifyObservers(t)}get"accessibilityTag"(){return this._accessibilityTag}get"doNotSerialize"(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set"doNotSerialize"(t){this._nodeDataStorage._doNotSerialize=t}"isDisposed"(){return this._nodeDataStorage._isDisposed}set"parent"(t){if(this._parentNode===t)return;const i=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const i=this._parentNode._children.indexOf(this);-1!==i&&this._parentNode._children.splice(i,1),t||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=t,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),i||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get"parent"(){return this._parentNode}"_serializeAsParent"(t){t.parentId=this.uniqueId}"_addToSceneRootNodes"(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}"_removeFromSceneRootNodes"(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const t=this._scene.rootNodes,i=t.length-1;t[this._nodeDataStorage._sceneRootNodesIndex]=t[i],t[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get"animationPropertiesOverride"(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set"animationPropertiesOverride"(t){this._animationPropertiesOverride=t}"getClassName"(){return"Node"}set"onDispose"(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}get"onEnabledStateChangedObservable"(){return this._nodeDataStorage._onEnabledStateChangedObservable}get"onClonedObservable"(){return this._nodeDataStorage._onClonedObservable}"constructor"(t,i=null,r=!0){this._isDirty=!1,this._nodeDataStorage=new _InternalNodeDataInfo,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new b.y$,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=x.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new b.y$,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=i||E.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),r&&this._addToSceneRootNodes()}"getScene"(){return this._scene}"getEngine"(){return this._scene.getEngine()}"addBehavior"(t,i=!1){return-1!==this._behaviors.indexOf(t)||(t.init(),this._scene.isLoading&&!i?this._scene.onDataLoadedObservable.addOnce(()=>{t.attach(this)}):t.attach(this),this._behaviors.push(t)),this}"removeBehavior"(t){const i=this._behaviors.indexOf(t);return-1===i||(this._behaviors[i].detach(),this._behaviors.splice(i,1)),this}get"behaviors"(){return this._behaviors}"getBehaviorByName"(t){for(const i of this._behaviors)if(i.name===t)return i;return null}"getWorldMatrix"(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}"_getWorldMatrixDeterminant"(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get"worldMatrixFromCache"(){return this._worldMatrix}"_initCache"(){this._cache={}}"updateCache"(t){!t&&this.isSynchronized()||this._updateCache()}"_getActionManagerForTrigger"(t,i=!0){return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}"_updateCache"(t){}"_isSynchronized"(){return!0}"_markSyncedWithParent"(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}"isSynchronizedWithParent"(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}"isSynchronized"(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}"isReady"(t=!1){return this._nodeDataStorage._isReady}"markAsDirty"(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}"isEnabled"(t=!0){return!1===t?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}"_syncParentEnabledState"(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(t=>{t._syncParentEnabledState()})}"setEnabled"(t){this._nodeDataStorage._isEnabled!==t&&(this._nodeDataStorage._isEnabled=t,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(t))}"isDescendantOf"(t){return!!this.parent&&(this.parent===t||this.parent.isDescendantOf(t))}"_getDescendants"(t,i=!1,r){if(this._children)for(let a=0;a<this._children.length;a++){const o=this._children[a];r&&!r(o)||t.push(o),i||o._getDescendants(t,!1,r)}}"getDescendants"(t,i){const r=[];return this._getDescendants(r,t,i),r}"getChildMeshes"(t,i){const r=[];return this._getDescendants(r,t,t=>(!i||i(t))&&void 0!==t.cullingStrategy),r}"getChildren"(t,i=!0){return this.getDescendants(i,t)}"_setReady"(t){t!==this._nodeDataStorage._isReady&&(t?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}"getAnimationByName"(t){for(let i=0;i<this.animations.length;i++){const r=this.animations[i];if(r.name===t)return r}return null}"createAnimationRange"(t,i,r){if(!this._ranges[t]){this._ranges[t]=Node._AnimationRangeFactory(t,i,r);for(let a=0,o=this.animations.length;a<o;a++)this.animations[a]&&this.animations[a].createRange(t,i,r)}}"deleteAnimationRange"(t,i=!0){for(let r=0,a=this.animations.length;r<a;r++)this.animations[r]&&this.animations[r].deleteRange(t,i);this._ranges[t]=null}"getAnimationRange"(t){return this._ranges[t]||null}"clone"(t,i,r){const a=A.p.Clone(()=>new Node(t,this.getScene()),this);if(i&&(a.parent=i),!r){const i=this.getDescendants(!0);for(let r=0;r<i.length;r++){const o=i[r];o.clone(t+"."+o.name,a)}}return a}"getAnimationRanges"(){const t=[];let i;for(i in this._ranges)t.push(this._ranges[i]);return t}"beginAnimation"(t,i,r,a){const o=this.getAnimationRange(t);return o?this._scene.beginAnimation(this,o.from,o.to,i,r,a):null}"serializeAnimationRanges"(){const t=[];for(const i in this._ranges){const r=this._ranges[i];if(!r)continue;const a={};a.name=i,a.from=r.from,a.to=r.to,t.push(a)}return t}"computeWorldMatrix"(t){return this._worldMatrix||(this._worldMatrix=x.y3.Identity()),this._worldMatrix}"dispose"(t,i=!1){if(this._nodeDataStorage._isDisposed=!0,!t){const r=this.getDescendants(!0);for(const a of r)a.dispose(t,i)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const t of this._behaviors)t.detach();this._behaviors.length=0,this.metadata=null}static"ParseAnimationRanges"(t,i,r){if(i.ranges)for(let r=0;r<i.ranges.length;r++){const a=i.ranges[r];t.createAnimationRange(a.name,a.from,a.to)}}"getHierarchyBoundingVectors"(t=!0,i=null){let r,a;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const o=this;if(o.getBoundingInfo&&o.subMeshes){const t=o.getBoundingInfo();r=t.boundingBox.minimumWorld.clone(),a=t.boundingBox.maximumWorld.clone()}else r=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new x.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(t){const t=this.getDescendants(!1);for(const o of t){const t=o;if(t.computeWorldMatrix(!0),i&&!i(t))continue;if(!t.getBoundingInfo||0===t.getTotalVertices())continue;const h=t.getBoundingInfo().boundingBox,l=h.minimumWorld,c=h.maximumWorld;x.P.CheckExtends(l,r,a),x.P.CheckExtends(c,r,a)}}return{"min":r,"max":a}}}Node._AnimationRangeFactory=(t,i,r)=>{throw(0,R.S)("AnimationRange")},Node._NodeConstructors={},(0,m.gn)([(0,T.qC)()],Node.prototype,"name",void 0),(0,m.gn)([(0,T.qC)()],Node.prototype,"id",void 0),(0,m.gn)([(0,T.qC)()],Node.prototype,"uniqueId",void 0),(0,m.gn)([(0,T.qC)()],Node.prototype,"state",void 0),(0,m.gn)([(0,T.qC)()],Node.prototype,"metadata",void 0);var C=r(658),v=r(646),P=r(470),S=r(8952);class Camera extends Node{get"position"(){return this._position}set"position"(t){this._position=t}set"upVector"(t){this._upVector=t}get"upVector"(){return this._upVector}get"screenArea"(){let t=0,i=0;if(this.mode===Camera.PERSPECTIVE_CAMERA)this.fovMode===Camera.FOVMODE_VERTICAL_FIXED?(i=2*this.minZ*Math.tan(this.fov/2),t=this.getEngine().getAspectRatio(this)*i):(t=2*this.minZ*Math.tan(this.fov/2),i=t/this.getEngine().getAspectRatio(this));else{const r=this.getEngine().getRenderWidth()/2,a=this.getEngine().getRenderHeight()/2;t=(this.orthoRight??r)-(this.orthoLeft??-r),i=(this.orthoTop??a)-(this.orthoBottom??-a)}return t*i}set"orthoLeft"(t){this._orthoLeft=t;for(const i of this._rigCameras)i.orthoLeft=t}get"orthoLeft"(){return this._orthoLeft}set"orthoRight"(t){this._orthoRight=t;for(const i of this._rigCameras)i.orthoRight=t}get"orthoRight"(){return this._orthoRight}set"orthoBottom"(t){this._orthoBottom=t;for(const i of this._rigCameras)i.orthoBottom=t}get"orthoBottom"(){return this._orthoBottom}set"orthoTop"(t){this._orthoTop=t;for(const i of this._rigCameras)i.orthoTop=t}get"orthoTop"(){return this._orthoTop}set"mode"(t){this._mode=t;for(const i of this._rigCameras)i.mode=t}get"mode"(){return this._mode}get"hasMoved"(){return this._hasMoved}"constructor"(t,i,r,a=!0){super(t,r,!1),this._position=x.P.Zero(),this._upVector=x.P.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=Camera.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new P.l(0,0,1,1),this.layerMask=268435455,this.fovMode=Camera.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=Camera.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new b.y$,this.onProjectionMatrixChangedObservable=new b.y$,this.onAfterCheckInputsObservable=new b.y$,this.onRestoreStateObservable=new b.y$,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new x.y3,this._postProcesses=new Array,this._activeMeshes=new y.t(256),this._globalPosition=x.P.Zero(),this._computedViewMatrix=x.y3.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=x.y3.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=x._f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),a&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=i,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${t}`)}"storeState"(){return this._stateStored=!0,this._storedFov=this.fov,this}"hasStateStored"(){return!!this._stateStored}"_restoreStateValues"(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}"restoreState"(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}"getClassName"(){return"Camera"}"toString"(t){let i="Name: "+this.name;if(i+=", type: "+this.getClassName(),this.animations)for(let r=0;r<this.animations.length;r++)i+=", animation[0]: "+this.animations[r].toString(t);return i}"applyVerticalCorrection"(){const t=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-t.x:t.x}get"globalPosition"(){return this._globalPosition}"getActiveMeshes"(){return this._activeMeshes}"isActiveMesh"(t){return-1!==this._activeMeshes.indexOf(t)}"isReady"(t=!1){if(t)for(const t of this._postProcesses)if(t&&!t.isReady())return!1;return super.isReady(t)}"_initCache"(){super._initCache(),this._cache.position=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}"_updateCache"(t){t||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}"_isSynchronized"(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}"_isSynchronizedViewMatrix"(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}"_isSynchronizedProjectionMatrix"(){let t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;const i=this.getEngine();return this.mode===Camera.PERSPECTIVE_CAMERA?t=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(t=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight(),this.oblique&&(t=t&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),t}"attachControl"(t,i){}"detachControl"(t){}"update"(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==Camera.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}"_checkInputs"(){this.onAfterCheckInputsObservable.notifyObservers(this)}get"rigCameras"(){return this._rigCameras}get"rigPostProcess"(){return this._rigPostProcess}"_getFirstPostProcess"(){for(let t=0;t<this._postProcesses.length;t++)if(null!==this._postProcesses[t])return this._postProcesses[t];return null}"_cascadePostProcessesToRigCams"(){const t=this._getFirstPostProcess();t&&t.markTextureDirty();for(let t=0,i=this._rigCameras.length;t<i;t++){const i=this._rigCameras[t],r=i._rigPostProcess;if(r){"pass"===r.getEffectName()&&(i.isIntermediate=0===this._postProcesses.length),i._postProcesses=this._postProcesses.slice(0).concat(r),r.markTextureDirty()}else i._postProcesses=this._postProcesses.slice(0)}}"attachPostProcess"(t,i=null){return!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(C.Y.Error("You're trying to reuse a post process not defined as reusable."),0):(null==i||i<0?this._postProcesses.push(t):null===this._postProcesses[i]?this._postProcesses[i]=t:this._postProcesses.splice(i,0,t),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(t))}"detachPostProcess"(t){const i=this._postProcesses.indexOf(t);-1!==i&&(this._postProcesses[i]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}"getWorldMatrix"(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}"_getViewMatrix"(){return x.y3.Identity()}"getViewMatrix"(t){return!t&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}"freezeProjectionMatrix"(t){this._doNotComputeProjectionMatrix=!0,void 0!==t&&(this._projectionMatrix=t)}"unfreezeProjectionMatrix"(){this._doNotComputeProjectionMatrix=!1}"getProjectionMatrix"(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const i=this.getEngine(),r=this.getScene(),a=i.useReverseDepthBuffer;if(this.mode===Camera.PERSPECTIVE_CAMERA){let t;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=i.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),t=r.useRightHandedSystem?x.y3.PerspectiveFovRHToRef:x.y3.PerspectiveFovLHToRef,t(this.fov,i.getAspectRatio(this),a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===Camera.FOVMODE_VERTICAL_FIXED,i.isNDCHalfZRange,this.projectionPlaneTilt,a)}else{const t=i.getRenderWidth()/2,o=i.getRenderHeight()/2;r.useRightHandedSystem?this.oblique?x.y3.ObliqueOffCenterRHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-o,this.orthoTop??o,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,i.isNDCHalfZRange):x.y3.OrthoOffCenterRHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-o,this.orthoTop??o,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,i.isNDCHalfZRange):this.oblique?x.y3.ObliqueOffCenterLHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-o,this.orthoTop??o,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,i.isNDCHalfZRange):x.y3.OrthoOffCenterLHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-o,this.orthoTop??o,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,i.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=this.oblique?.angle,this._cache.obliqueLength=this.oblique?.length,this._cache.obliqueOffset=this.oblique?.offset,this._cache.renderWidth=i.getRenderWidth(),this._cache.renderHeight=i.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}"getTransformationMatrix"(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}"_computeObliqueDistance"(t){return(this.radius||(this.target?x.P.Distance(this.position,this.target):this.position.length()))+t}"_updateFrustumPlanes"(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?S.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=S.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}"isInFrustum"(t,i=!1){if(this._updateFrustumPlanes(),i&&this.rigCameras.length>0){let i=!1;return this.rigCameras.forEach(r=>{r._updateFrustumPlanes(),i=i||t.isInFrustum(r._frustumPlanes)}),i}return t.isInFrustum(this._frustumPlanes)}"isCompletelyInFrustum"(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)}"getForwardRay"(t=100,i,r){throw(0,R.S)("Ray")}"getForwardRayToRef"(t,i=100,r,a){throw(0,R.S)("Ray")}"dispose"(t,i=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const t=this._rigCameras.pop();t&&t.dispose()}if(this._parentContainer){const t=this._parentContainer.cameras.indexOf(this);t>-1&&this._parentContainer.cameras.splice(t,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==Camera.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let t=this._postProcesses.length;for(;--t>=0;){const i=this._postProcesses[t];i&&i.dispose(this)}}let r=this.customRenderTargets.length;for(;--r>=0;)this.customRenderTargets[r].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(t,i)}get"isLeftCamera"(){return this._isLeftCamera}get"isRightCamera"(){return this._isRightCamera}get"leftCamera"(){return this._rigCameras.length<1?null:this._rigCameras[0]}get"rightCamera"(){return this._rigCameras.length<2?null:this._rigCameras[1]}"getLeftTarget"(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}"getRightTarget"(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}"setCameraRigMode"(t,i){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){const t=this._rigCameras.pop();t&&t.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=M.w1.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==Camera.RIG_MODE_NONE){const t=this.createRigCamera(this.name+"_L",0);t&&(t._isLeftCamera=!0);const i=this.createRigCamera(this.name+"_R",1);i&&(i._isRightCamera=!0),t&&i&&(this._rigCameras.push(t),this._rigCameras.push(i))}this._setRigMode(i),this._cascadePostProcessesToRigCams(),this.update()}}"_setRigMode"(t){}"_getVRProjectionMatrix"(){return x.y3.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}"setCameraRigParameter"(t,i){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=i,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=M.w1.ToRadians(i/.0637))}"createRigCamera"(t,i){return null}"_updateRigCameras"(){for(let t=0;t<this._rigCameras.length;t++)this._rigCameras[t].minZ=this.minZ,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.copyFrom(this.upVector);this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}"_setupInputs"(){}"serialize"(){const t=A.p.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(t),this.inputs&&this.inputs.serialize(t),A.p.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}"clone"(t,i=null){const r=A.p.Clone(Camera.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return r.name=t,r.parent=i,this.onClonedObservable.notifyObservers(r),r}"getDirection"(t){const i=x.P.Zero();return this.getDirectionToRef(t,i),i}get"absoluteRotation"(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}"getDirectionToRef"(t,i){x.P.TransformNormalToRef(t,this.getWorldMatrix(),i)}static"GetConstructorFromName"(t,i,r,a=0,o=!0){const h=Node.Construct(t,i,r,{"interaxial_distance":a,"isStereoscopicSideBySide":o});return h||(()=>Camera._CreateDefaultParsedCamera(i,r))}"computeWorldMatrix"(){return this.getWorldMatrix()}static"Parse"(t,i){const r=t.type,a=Camera.GetConstructorFromName(r,t.name,i,t.interaxial_distance,t.isStereoscopicSideBySide),o=A.p.Parse(a,t,i);if(void 0!==t.parentId&&(o._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(o._waitingParentInstanceIndex=t.parentInstanceIndex),o.inputs&&(o.inputs.parse(t),o._setupInputs()),t.upVector&&(o.upVector=x.P.FromArray(t.upVector)),o.setPosition&&(o.position.copyFromFloats(0,0,0),o.setPosition(x.P.FromArray(t.position))),t.target&&o.setTarget&&o.setTarget(x.P.FromArray(t.target)),t.cameraRigMode){const i=t.interaxial_distance?{"interaxialDistance":t.interaxial_distance}:{};o.setCameraRigMode(t.cameraRigMode,i)}if(t.animations){for(let i=0;i<t.animations.length;i++){const r=t.animations[i],a=(0,v.qw)("BABYLON.Animation");a&&o.animations.push(a.Parse(r))}Node.ParseAnimationRanges(o,t,i)}return t.autoAnimate&&i.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&o.setEnabled(t.isEnabled),o}"_calculateHandednessMultiplier"(){let t=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),t}}Camera._CreateDefaultParsedCamera=(t,i)=>{throw(0,R.S)("UniversalCamera")},Camera.PERSPECTIVE_CAMERA=0,Camera.ORTHOGRAPHIC_CAMERA=1,Camera.FOVMODE_VERTICAL_FIXED=0,Camera.FOVMODE_HORIZONTAL_FIXED=1,Camera.RIG_MODE_NONE=0,Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Camera.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Camera.RIG_MODE_VR=20,Camera.RIG_MODE_CUSTOM=22,Camera.ForceAttachControlToAlwaysPreventDefault=!1,(0,m.gn)([(0,T.hd)("position")],Camera.prototype,"_position",void 0),(0,m.gn)([(0,T.hd)("upVector")],Camera.prototype,"_upVector",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"orthoLeft",null),(0,m.gn)([(0,T.qC)()],Camera.prototype,"orthoRight",null),(0,m.gn)([(0,T.qC)()],Camera.prototype,"orthoBottom",null),(0,m.gn)([(0,T.qC)()],Camera.prototype,"orthoTop",null),(0,m.gn)([(0,T.qC)()],Camera.prototype,"fov",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"projectionPlaneTilt",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"minZ",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"maxZ",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"inertia",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"mode",null),(0,m.gn)([(0,T.qC)()],Camera.prototype,"layerMask",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"fovMode",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"cameraRigMode",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"interaxialDistance",void 0),(0,m.gn)([(0,T.qC)()],Camera.prototype,"isStereoscopicSideBySide",void 0);var I=r(4551),D=r(2554);class IntersectionInfo{"constructor"(t,i,r){this.bu=t,this.bv=i,this.distance=r,this.faceId=0,this.subMeshId=0}}var O=r(318),w=r(2467);const B={"internalPickerForMesh":void 0};class Ray{"constructor"(t,i,r=Number.MAX_VALUE,a=I.kn){this.origin=t,this.direction=i,this.length=r,this.epsilon=a}"clone"(){return new Ray(this.origin.clone(),this.direction.clone(),this.length)}"intersectsBoxMinMax"(t,i,r=0){const a=Ray._TmpVector3[0].copyFromFloats(t.x-r,t.y-r,t.z-r),o=Ray._TmpVector3[1].copyFromFloats(i.x+r,i.y+r,i.z+r);let h,l,c,u,d=0,_=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<a.x||this.origin.x>o.x)return!1}else if(h=1/this.direction.x,l=(a.x-this.origin.x)*h,c=(o.x-this.origin.x)*h,c===-1/0&&(c=1/0),l>c&&(u=l,l=c,c=u),d=Math.max(l,d),_=Math.min(c,_),d>_)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<a.y||this.origin.y>o.y)return!1}else if(h=1/this.direction.y,l=(a.y-this.origin.y)*h,c=(o.y-this.origin.y)*h,c===-1/0&&(c=1/0),l>c&&(u=l,l=c,c=u),d=Math.max(l,d),_=Math.min(c,_),d>_)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<a.z||this.origin.z>o.z)return!1}else if(h=1/this.direction.z,l=(a.z-this.origin.z)*h,c=(o.z-this.origin.z)*h,c===-1/0&&(c=1/0),l>c&&(u=l,l=c,c=u),d=Math.max(l,d),_=Math.min(c,_),d>_)return!1;return!0}"intersectsBox"(t,i=0){return this.intersectsBoxMinMax(t.minimum,t.maximum,i)}"intersectsSphere"(t,i=0){const r=t.center.x-this.origin.x,a=t.center.y-this.origin.y,o=t.center.z-this.origin.z,h=r*r+a*a+o*o,l=t.radius+i,c=l*l;if(h<=c)return!0;const u=r*this.direction.x+a*this.direction.y+o*this.direction.z;if(u<0)return!1;return h-u*u<=c}"intersectsTriangle"(t,i,r){const a=Ray._TmpVector3[0],o=Ray._TmpVector3[1],h=Ray._TmpVector3[2],l=Ray._TmpVector3[3],c=Ray._TmpVector3[4];i.subtractToRef(t,a),r.subtractToRef(t,o),x.P.CrossToRef(this.direction,o,h);const u=x.P.Dot(a,h);if(0===u)return null;const d=1/u;this.origin.subtractToRef(t,l);const _=x.P.Dot(l,h)*d;if(_<-this.epsilon||_>1+this.epsilon)return null;x.P.CrossToRef(l,a,c);const g=x.P.Dot(this.direction,c)*d;if(g<-this.epsilon||_+g>1+this.epsilon)return null;const p=x.P.Dot(o,c)*d;return p>this.length?null:new IntersectionInfo(1-_-g,_,p)}"intersectsPlane"(t){let i;const r=x.P.Dot(t.normal,this.direction);if(Math.abs(r)<9.99999997475243e-7)return null;{const a=x.P.Dot(t.normal,this.origin);return i=(-t.d-a)/r,i<0?i<-9.99999997475243e-7?null:0:i}}"intersectsAxis"(t,i=0){switch(t){case"y":{const t=(this.origin.y-i)/this.direction.y;return t>0?null:new x.P(this.origin.x+this.direction.x*-t,i,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-i)/this.direction.x;return t>0?null:new x.P(i,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-i)/this.direction.z;return t>0?null:new x.P(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,i)}default:return null}}"intersectsMesh"(t,i,r,a=!1,o,h=!1){const l=x.jp.Matrix[0];return t.getWorldMatrix().invertToRef(l),this._tmpRay?Ray.TransformToRef(this,l,this._tmpRay):this._tmpRay=Ray.Transform(this,l),t.intersects(this._tmpRay,i,r,a,o,h)}"intersectsMeshes"(t,i,r){r?r.length=0:r=[];for(let a=0;a<t.length;a++){const o=this.intersectsMesh(t[a],i);o.hit&&r.push(o)}return r.sort(this._comparePickingInfo),r}"_comparePickingInfo"(t,i){return t.distance<i.distance?-1:t.distance>i.distance?1:0}"intersectionSegment"(t,i,r){const a=this.origin,o=x.jp.Vector3[0],h=x.jp.Vector3[1],l=x.jp.Vector3[2],c=x.jp.Vector3[3];i.subtractToRef(t,o),this.direction.scaleToRef(Ray._Rayl,l),a.addToRef(l,h),t.subtractToRef(a,c);const u=x.P.Dot(o,o),d=x.P.Dot(o,l),_=x.P.Dot(l,l),g=x.P.Dot(o,c),p=x.P.Dot(l,c),m=u*_-d*d;let T,y,M=m,b=m;m<Ray._Smallnum?(T=0,M=1,y=p,b=_):(T=d*p-_*g,y=u*p-d*g,T<0?(T=0,y=p,b=_):T>M&&(T=M,y=p+d,b=_)),y<0?(y=0,-g<0?T=0:-g>u?T=M:(T=-g,M=u)):y>b&&(y=b,-g+d<0?T=0:-g+d>u?T=M:(T=-g+d,M=u));const E=Math.abs(T)<Ray._Smallnum?0:T/M,R=Math.abs(y)<Ray._Smallnum?0:y/b,A=x.jp.Vector3[4];l.scaleToRef(R,A);const C=x.jp.Vector3[5];o.scaleToRef(E,C),C.addInPlace(c);const v=x.jp.Vector3[6];C.subtractToRef(A,v);return R>0&&R<=this.length&&v.lengthSquared()<r*r?C.length():-1}"update"(t,i,r,a,o,h,l,c=!1){if(c){Ray._RayDistant||(Ray._RayDistant=Ray.Zero()),Ray._RayDistant.unprojectRayToRef(t,i,r,a,x.y3.IdentityReadOnly,h,l);const c=x.jp.Matrix[0];o.invertToRef(c),Ray.TransformToRef(Ray._RayDistant,c,this)}else this.unprojectRayToRef(t,i,r,a,o,h,l);return this}static"Zero"(){return new Ray(x.P.Zero(),x.P.Zero())}static"CreateNew"(t,i,r,a,o,h,l){return Ray.Zero().update(t,i,r,a,o,h,l)}static"CreateNewFromTo"(t,i,r=x.y3.IdentityReadOnly){const a=new Ray(new x.P(0,0,0),new x.P(0,0,0));return Ray.CreateFromToToRef(t,i,a,r)}static"CreateFromToToRef"(t,i,r,a=x.y3.IdentityReadOnly){r.origin.copyFrom(t);const o=i.subtractToRef(t,r.direction),h=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return r.length=h,r.direction.normalize(),Ray.TransformToRef(r,a,r)}static"Transform"(t,i){const r=new Ray(new x.P(0,0,0),new x.P(0,0,0));return Ray.TransformToRef(t,i,r),r}static"TransformToRef"(t,i,r){x.P.TransformCoordinatesToRef(t.origin,i,r.origin),x.P.TransformNormalToRef(t.direction,i,r.direction),r.length=t.length,r.epsilon=t.epsilon;const a=r.direction,o=a.length();if(0!==o&&1!==o){const t=1/o;a.x*=t,a.y*=t,a.z*=t,r.length*=o}return r}"unprojectRayToRef"(t,i,r,a,o,h,l){const c=x.jp.Matrix[0];o.multiplyToRef(h,c),c.multiplyToRef(l,c),c.invert();const u=E.l.LastCreatedEngine,d=x.jp.Vector3[0];d.x=t/r*2-1,d.y=-(i/a*2-1),d.z=u?.useReverseDepthBuffer?1:u?.isNDCHalfZRange?0:-1;const _=x.jp.Vector3[1].copyFromFloats(d.x,d.y,1-1e-8),g=x.jp.Vector3[2],p=x.jp.Vector3[3];x.P._UnprojectFromInvertedMatrixToRef(d,c,g),x.P._UnprojectFromInvertedMatrixToRef(_,c,p),this.origin.copyFrom(g),p.subtractToRef(g,this.direction),this.direction.normalize()}}function CreatePickingRay(t,i,r,a,o,h=!1){const l=Ray.Zero();return CreatePickingRayToRef(t,i,r,a,l,o,h),l}function CreatePickingRayToRef(t,i,r,a,o,h,l=!1,c=!1){const u=t.getEngine();if(!h&&!(h=t.activeCamera))return t;const d=h.viewport,_=u.getRenderHeight(),{"x":g,"y":p,"width":m,"height":T}=d.toGlobal(u.getRenderWidth(),_),y=1/u.getHardwareScalingLevel();return i=i*y-g,r=r*y-(_-p-T),o.update(i,r,m,T,a||x.y3.IdentityReadOnly,l?x.y3.IdentityReadOnly:h.getViewMatrix(),h.getProjectionMatrix(),c),t}function CreatePickingRayInCameraSpaceToRef(t,i,r,a,o){if(!O.p)return t;const h=t.getEngine();if(!o&&!(o=t.activeCamera))throw new Error("Active camera not set");const l=o.viewport,c=h.getRenderHeight(),{"x":u,"y":d,"width":_,"height":g}=l.toGlobal(h.getRenderWidth(),c),p=x.y3.Identity(),m=1/h.getHardwareScalingLevel();return i=i*m-u,r=r*m-(c-d-g),a.update(i,r,_,g,p,p,o.getProjectionMatrix()),t}function InternalPickForMesh(t,i,r,a,o,h,l,c){const u=i(a,r.enableDistantPicking),d=r.intersects(u,o,l,h,a,c);return d&&d.hit?!o&&null!=t&&d.distance>=t.distance?null:d:null}function InternalPick(t,i,r,a,o,h){let l=null;const c=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),u=t.cameraToUseForPointers||t.activeCamera,d=B.internalPickerForMesh||InternalPickForMesh;for(let _=0;_<t.meshes.length;_++){const g=t.meshes[_];if(r){if(!r(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.isPickable)continue;const p=c&&g.isWorldMatrixCameraDependent(),m=g.computeWorldMatrix(p,u);if(g.hasThinInstances&&g.thinInstanceEnablePicking){const t=d(l,i,g,m,!0,!0,h);if(t){if(o)return t;const c=x.jp.Matrix[1],u=g.thinInstanceGetWorldMatrices();for(let t=0;t<u.length;t++){if(r&&!r(g,t))continue;u[t].multiplyToRef(m,c);const _=d(l,i,g,c,a,o,h,!0);if(_&&(l=_,l.thinInstanceIndex=t,a))return l}}}else{const t=d(l,i,g,m,a,o,h);if(t&&(l=t,a))return l}}return l||new O.p}function InternalMultiPick(t,i,r,a){if(!O.p)return null;const o=[],h=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),l=t.cameraToUseForPointers||t.activeCamera,c=B.internalPickerForMesh||InternalPickForMesh;for(let u=0;u<t.meshes.length;u++){const d=t.meshes[u];if(r){if(!r(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.isPickable)continue;const _=h&&d.isWorldMatrixCameraDependent(),g=d.computeWorldMatrix(_,l);if(d.hasThinInstances&&d.thinInstanceEnablePicking){if(c(null,i,d,g,!0,!0,a)){const t=x.jp.Matrix[1],h=d.thinInstanceGetWorldMatrices();for(let l=0;l<h.length;l++){if(r&&!r(d,l))continue;h[l].multiplyToRef(g,t);const u=c(null,i,d,t,!1,!1,a,!0);u&&(u.thinInstanceIndex=l,o.push(u))}}}else{const t=c(null,i,d,g,!1,!1,a);t&&o.push(t)}}return o}function GetForwardRayToRef(t,i,r=100,a,o){a||(a=t.getWorldMatrix()),i.length=r,o?i.origin.copyFrom(o):i.origin.copyFrom(t.position);const h=x.jp.Vector3[2];h.set(0,0,t._scene.useRightHandedSystem?-1:1);const l=x.jp.Vector3[3];return x.P.TransformNormalToRef(h,a,l),x.P.NormalizeToRef(l,i.direction),i}Ray._TmpVector3=(0,D.$G)(6,x.P.Zero),Ray._RayDistant=Ray.Zero(),Ray._Smallnum=1e-8,Ray._Rayl=1e9,function AddRayExtensions(t,i){i&&(i.prototype.getForwardRay=function(t=100,i,r){return GetForwardRayToRef(this,new Ray(x.P.Zero(),x.P.Zero(),t),t,i,r)},i.prototype.getForwardRayToRef=function(t,i=100,r,a){return GetForwardRayToRef(this,t,i,r,a)}),t&&(w.r._IsPickingAvailable=!0,t.prototype.createPickingRay=function(t,i,r,a,o=!1){return CreatePickingRay(this,t,i,r,a,o)})}(p.x,Camera),p.x.prototype.createPickingRayToRef=function(t,i,r,a,o,h=!1,l=!1){return CreatePickingRayToRef(this,t,i,r,a,o,h,l)},p.x.prototype.createPickingRayInCameraSpace=function(t,i,r){return function CreatePickingRayInCameraSpace(t,i,r,a){const o=Ray.Zero();return CreatePickingRayInCameraSpaceToRef(t,i,r,o,a),o}(this,t,i,r)},p.x.prototype.createPickingRayInCameraSpaceToRef=function(t,i,r,a){return CreatePickingRayInCameraSpaceToRef(this,t,i,r,a)},p.x.prototype.pickWithBoundingInfo=function(t,i,r,a,o){return function PickWithBoundingInfo(t,i,r,a,o,h){if(!O.p)return null;const l=InternalPick(t,a=>(t._tempPickingRay||(t._tempPickingRay=Ray.Zero()),CreatePickingRayToRef(t,i,r,a,t._tempPickingRay,h||null),t._tempPickingRay),a,o,!0);return l&&(l.ray=CreatePickingRay(t,i,r,x.y3.Identity(),h||null)),l}(this,t,i,r,a,o)},p.x.prototype.pick=function(t,i,r,a,o,h,l=!1){return function Pick(t,i,r,a,o,h,l,c=!1){const u=InternalPick(t,(a,o)=>(t._tempPickingRay||(t._tempPickingRay=Ray.Zero()),CreatePickingRayToRef(t,i,r,a,t._tempPickingRay,h||null,!1,o),t._tempPickingRay),a,o,!1,l);return u&&(u.ray=CreatePickingRay(t,i,r,x.y3.Identity(),h||null)),u}(this,t,i,r,a,o,h,l)},p.x.prototype.pickWithRay=function(t,i,r,a){return function PickWithRay(t,i,r,a,o){const h=InternalPick(t,r=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=x.y3.Identity()),r.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=Ray.Zero()),Ray.TransformToRef(i,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform),r,a,!1,o);return h&&(h.ray=i),h}(this,t,i,r,a)},p.x.prototype.multiPick=function(t,i,r,a,o){return function MultiPick(t,i,r,a,o,h){return InternalMultiPick(t,a=>CreatePickingRay(t,i,r,a,o||null),a,h)}(this,t,i,r,a,o)},p.x.prototype.multiPickWithRay=function(t,i,r){return function MultiPickWithRay(t,i,r,a){return InternalMultiPick(t,r=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=x.y3.Identity()),r.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=Ray.Zero()),Ray.TransformToRef(i,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform),r,a)}(this,t,i,r)};var L=r(6504);const N=function(){const t={"root":0,"found":!1};return function(i,r,a,o){t.root=0,t.found=!1;const h=r*r-4*i*a;if(h<0)return t;const l=Math.sqrt(h);let c=(-r-l)/(2*i),u=(-r+l)/(2*i);if(c>u){const t=u;u=c,c=t}return c>0&&c<o?(t.root=c,t.found=!0,t):u>0&&u<o?(t.root=u,t.found=!0,t):t}}();class Collider{"constructor"(){this._collisionPoint=x.P.Zero(),this._planeIntersectionPoint=x.P.Zero(),this._tempVector=x.P.Zero(),this._tempVector2=x.P.Zero(),this._tempVector3=x.P.Zero(),this._tempVector4=x.P.Zero(),this._edge=x.P.Zero(),this._baseToVertex=x.P.Zero(),this._destinationPoint=x.P.Zero(),this._slidePlaneNormal=x.P.Zero(),this._displacementVector=x.P.Zero(),this._radius=x.P.One(),this._retry=0,this._basePointWorld=x.P.Zero(),this._velocityWorld=x.P.Zero(),this._normalizedVelocity=x.P.Zero(),this._collisionMask=-1}get"collisionMask"(){return this._collisionMask}set"collisionMask"(t){this._collisionMask=isNaN(t)?-1:t}get"slidePlaneNormal"(){return this._slidePlaneNormal}"_initialize"(t,i,r){this._velocity=i,this._velocitySquaredLength=this._velocity.lengthSquared();const a=Math.sqrt(this._velocitySquaredLength);0===a||1===a?this._normalizedVelocity.copyFromFloats(i._x,i._y,i._z):i.scaleToRef(1/a,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),i.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=r,this.collisionFound=!1}"_checkPointInTriangle"(t,i,r,a,o){i.subtractToRef(t,this._tempVector),r.subtractToRef(t,this._tempVector2),x.P.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);let h=x.P.Dot(this._tempVector4,o);return!(h<0)&&(a.subtractToRef(t,this._tempVector3),x.P.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),h=x.P.Dot(this._tempVector4,o),!(h<0)&&(x.P.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),h=x.P.Dot(this._tempVector4,o),h>=0))}"_canDoCollision"(t,i,r,a){const o=x.P.Distance(this._basePointWorld,t),h=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(o>this._velocityWorldLength+h+i)&&!!((t,i,r,a)=>!(t.x>r.x+a||r.x-a>i.x||t.y>r.y+a||r.y-a>i.y||t.z>r.z+a||r.z-a>i.z))(r,a,this._basePointWorld,this._velocityWorldLength+h)}"_testTriangle"(t,i,r,a,o,h,l){let c,u=!1;i||(i=[]),i[t]||(i[t]=new L.J(0,0,0,0),i[t].copyFromPoints(r,a,o));const d=i[t];if(!h&&!d.isFrontFacingTo(this._normalizedVelocity,0))return;const _=d.signedDistanceTo(this._basePoint),g=x.P.Dot(d.normal,this._velocity);if(Collider.DoubleSidedCheck&&g>1e-4)return;if(0==g){if(Math.abs(_)>=1)return;u=!0,c=0}else{c=(-1-_)/g;let t=(1-_)/g;if(c>t){const i=t;t=c,c=i}if(c>1||t<0)return;c<0&&(c=0),c>1&&(c=1)}this._collisionPoint.copyFromFloats(0,0,0);let p=!1,m=1;if(u||(this._basePoint.subtractToRef(d.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(c,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,r,a,o,d.normal)&&(p=!0,m=c,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!p){let t=this._velocitySquaredLength;this._basePoint.subtractToRef(r,this._tempVector);let i=2*x.P.Dot(this._velocity,this._tempVector),h=this._tempVector.lengthSquared()-1,l=N(t,i,h,m);l.found&&(m=l.root,p=!0,this._collisionPoint.copyFrom(r)),this._basePoint.subtractToRef(a,this._tempVector),i=2*x.P.Dot(this._velocity,this._tempVector),h=this._tempVector.lengthSquared()-1,l=N(t,i,h,m),l.found&&(m=l.root,p=!0,this._collisionPoint.copyFrom(a)),this._basePoint.subtractToRef(o,this._tempVector),i=2*x.P.Dot(this._velocity,this._tempVector),h=this._tempVector.lengthSquared()-1,l=N(t,i,h,m),l.found&&(m=l.root,p=!0,this._collisionPoint.copyFrom(o)),a.subtractToRef(r,this._edge),r.subtractToRef(this._basePoint,this._baseToVertex);let c=this._edge.lengthSquared(),u=x.P.Dot(this._edge,this._velocity),d=x.P.Dot(this._edge,this._baseToVertex);if(t=c*-this._velocitySquaredLength+u*u,i=2*(c*x.P.Dot(this._velocity,this._baseToVertex)-u*d),h=c*(1-this._baseToVertex.lengthSquared())+d*d,l=N(t,i,h,m),l.found){const t=(u*l.root-d)/c;t>=0&&t<=1&&(m=l.root,p=!0,this._edge.scaleInPlace(t),r.addToRef(this._edge,this._collisionPoint))}if(o.subtractToRef(a,this._edge),a.subtractToRef(this._basePoint,this._baseToVertex),c=this._edge.lengthSquared(),u=x.P.Dot(this._edge,this._velocity),d=x.P.Dot(this._edge,this._baseToVertex),t=c*-this._velocitySquaredLength+u*u,i=2*(c*x.P.Dot(this._velocity,this._baseToVertex)-u*d),h=c*(1-this._baseToVertex.lengthSquared())+d*d,l=N(t,i,h,m),l.found){const t=(u*l.root-d)/c;t>=0&&t<=1&&(m=l.root,p=!0,this._edge.scaleInPlace(t),a.addToRef(this._edge,this._collisionPoint))}if(r.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),c=this._edge.lengthSquared(),u=x.P.Dot(this._edge,this._velocity),d=x.P.Dot(this._edge,this._baseToVertex),t=c*-this._velocitySquaredLength+u*u,i=2*(c*x.P.Dot(this._velocity,this._baseToVertex)-u*d),h=c*(1-this._baseToVertex.lengthSquared())+d*d,l=N(t,i,h,m),l.found){const t=(u*l.root-d)/c;t>=0&&t<=1&&(m=l.root,p=!0,this._edge.scaleInPlace(t),o.addToRef(this._edge,this._collisionPoint))}}if(p){const t=m*m*this._velocitySquaredLength;(!this.collisionFound||t<this._nearestDistanceSquared)&&(l.collisionResponse&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistanceSquared=t,this._nearestDistance=Math.sqrt(t),this.collisionFound=!0),this.collidedMesh=l)}}"_collide"(t,i,r,a,o,h,l,c,u,d=!1){if(d)if(r&&0!==r.length)for(let h=a;h<o-2;h+=1){const a=r[h],o=r[h+1],d=r[h+2];if(4294967295===d){h+=2;continue}const _=i[a],g=i[o],p=i[d];_&&g&&p&&((u?1:0)^h%2?this._testTriangle(h,t,_,g,p,l,c):this._testTriangle(h,t,g,_,p,l,c))}else for(let r=0;r<i.length-2;r+=1){const a=i[r],o=i[r+1],h=i[r+2];a&&o&&h&&((u?1:0)^r%2?this._testTriangle(r,t,a,o,h,l,c):this._testTriangle(r,t,o,a,h,l,c))}else if(r&&0!==r.length)for(let d=a;d<o;d+=3){const a=i[r[d]-h],o=i[r[d+1]-h],_=i[r[d+2]-h];u?this._testTriangle(d,t,a,o,_,l,c):this._testTriangle(d,t,_,o,a,l,c)}else for(let r=0;r<i.length;r+=3){const a=i[r],o=i[r+1],h=i[r+2];u?this._testTriangle(r,t,a,o,h,l,c):this._testTriangle(r,t,h,o,a,l,c)}}"_getResponse"(t,i){t.addToRef(i,this._destinationPoint),i.scaleInPlace(this._nearestDistance/i.length()),this._basePoint.addToRef(i,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(L.J.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,i)}}Collider.DoubleSidedCheck=!1;var U=r(9204);class DefaultCollisionCoordinator{"constructor"(){this._scaledPosition=x.P.Zero(),this._scaledVelocity=x.P.Zero(),this._finalPosition=x.P.Zero()}"getNewPosition"(t,i,r,a,o,h,l){t.divideToRef(r._radius,this._scaledPosition),i.divideToRef(r._radius,this._scaledVelocity),r.collidedMesh=null,r._retry=0,r._initialVelocity=this._scaledVelocity,r._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,r,a,this._finalPosition,o),this._finalPosition.multiplyInPlace(r._radius),h(l,this._finalPosition,r.collidedMesh)}"createCollider"(){return new Collider}"init"(t){this._scene=t}"_collideWithWorld"(t,i,r,a,o,h=null){const l=10*U.a.CollisionsEpsilon;if(r._retry>=a)return void o.copyFrom(t);const c=h?h.collisionMask:r.collisionMask;r._initialize(t,i,l);const u=h&&h.surroundingMeshes||this._scene.meshes;for(let t=0;t<u.length;t++){const i=u[t];i.isEnabled()&&i.checkCollisions&&i.subMeshes&&i!==h&&0!==(c&i.collisionGroup)&&i._checkCollision(r)}r.collisionFound?(0===i.x&&0===i.y&&0===i.z||r._getResponse(t,i),i.length()<=l?o.copyFrom(t):(r._retry++,this._collideWithWorld(t,i,r,a,o,h))):t.addToRef(i,o)}}p.x.CollisionCoordinatorFactory=()=>new DefaultCollisionCoordinator;var k=r(6230),V=r(2922),G=r(2186);class PrePassConfiguration{"constructor"(){this.previousWorldMatrices={},this.previousBones={}}static"AddUniforms"(t){t.push("previousWorld","previousViewProjection","mPreviousBones")}static"AddSamplers"(t){}"bindForSubMesh"(t,i,r,a,o){if(i.prePassRenderer&&i.prePassRenderer.enabled&&i.prePassRenderer.currentRTisSceneRT&&(-1!==i.prePassRenderer.getIndex(2)||-1!==i.prePassRenderer.getIndex(11))){this.previousWorldMatrices[r.uniqueId]||(this.previousWorldMatrices[r.uniqueId]=a.clone()),this.previousViewProjection||(this.previousViewProjection=i.getTransformMatrix().clone(),this.currentViewProjection=i.getTransformMatrix().clone());const o=i.getEngine();this.currentViewProjection.updateFlag!==i.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=o.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(i.getTransformMatrix())):this._lastUpdateFrameId!==o.frameId&&(this._lastUpdateFrameId=o.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),t.setMatrix("previousWorld",this.previousWorldMatrices[r.uniqueId]),t.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[r.uniqueId]=a.clone()}}}var z=r(4662);class BoundingBox{"constructor"(t,i,r){this.vectors=(0,D.$G)(8,x.P.Zero),this.center=x.P.Zero(),this.centerWorld=x.P.Zero(),this.extendSize=x.P.Zero(),this.extendSizeWorld=x.P.Zero(),this.directions=(0,D.$G)(3,x.P.Zero),this.vectorsWorld=(0,D.$G)(8,x.P.Zero),this.minimumWorld=x.P.Zero(),this.maximumWorld=x.P.Zero(),this.minimum=x.P.Zero(),this.maximum=x.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,i,r)}"reConstruct"(t,i,r){const a=t.x,o=t.y,h=t.z,l=i.x,c=i.y,u=i.z,d=this.vectors;this.minimum.copyFromFloats(a,o,h),this.maximum.copyFromFloats(l,c,u),d[0].copyFromFloats(a,o,h),d[1].copyFromFloats(l,c,u),d[2].copyFromFloats(l,o,h),d[3].copyFromFloats(a,c,h),d[4].copyFromFloats(a,o,u),d[5].copyFromFloats(l,c,h),d[6].copyFromFloats(a,c,u),d[7].copyFromFloats(l,o,u),i.addToRef(t,this.center).scaleInPlace(.5),i.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=r||x.y3.IdentityReadOnly,this._update(this._worldMatrix)}"scale"(t){const i=BoundingBox._TmpVector3,r=this.maximum.subtractToRef(this.minimum,i[0]),a=r.length();r.normalizeFromLength(a);const o=a*t,h=r.scaleInPlace(.5*o),l=this.center.subtractToRef(h,i[1]),c=this.center.addToRef(h,i[2]);return this.reConstruct(l,c,this._worldMatrix),this}"getWorldMatrix"(){return this._worldMatrix}"_update"(t){const i=this.minimumWorld,r=this.maximumWorld,a=this.directions,o=this.vectorsWorld,h=this.vectors;if(t.isIdentity()){i.copyFrom(this.minimum),r.copyFrom(this.maximum);for(let t=0;t<8;++t)o[t].copyFrom(h[t]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{i.setAll(Number.MAX_VALUE),r.setAll(-Number.MAX_VALUE);for(let a=0;a<8;++a){const l=o[a];x.P.TransformCoordinatesToRef(h[a],t,l),i.minimizeInPlace(l),r.maximizeInPlace(l)}r.subtractToRef(i,this.extendSizeWorld).scaleInPlace(.5),r.addToRef(i,this.centerWorld).scaleInPlace(.5)}x.P.FromArrayToRef(t.m,0,a[0]),x.P.FromArrayToRef(t.m,4,a[1]),x.P.FromArrayToRef(t.m,8,a[2]),this._worldMatrix=t}"isInFrustum"(t){return BoundingBox.IsInFrustum(this.vectorsWorld,t)}"isCompletelyInFrustum"(t){return BoundingBox.IsCompletelyInFrustum(this.vectorsWorld,t)}"intersectsPoint"(t){const i=this.minimumWorld,r=this.maximumWorld,a=i.x,o=i.y,h=i.z,l=r.x,c=r.y,u=r.z,d=t.x,_=t.y,g=t.z,p=-I.kn;return!(l-d<p||p>d-a)&&(!(c-_<p||p>_-o)&&!(u-g<p||p>g-h))}"intersectsSphere"(t){return BoundingBox.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}"intersectsMinMax"(t,i){const r=this.minimumWorld,a=this.maximumWorld,o=r.x,h=r.y,l=r.z,c=a.x,u=a.y,d=a.z,_=t.x,g=t.y,p=t.z,m=i.x,T=i.y,y=i.z;return!(c<_||o>m)&&(!(u<g||h>T)&&!(d<p||l>y))}"dispose"(){this._drawWrapperFront?.dispose(),this._drawWrapperBack?.dispose()}static"Intersects"(t,i){return t.intersectsMinMax(i.minimumWorld,i.maximumWorld)}static"IntersectsSphere"(t,i,r,a){const o=BoundingBox._TmpVector3[0];x.P.ClampToRef(r,t,i,o);return x.P.DistanceSquared(r,o)<=a*a}static"IsCompletelyInFrustum"(t,i){for(let r=0;r<6;++r){const a=i[r];for(let i=0;i<8;++i)if(a.dotCoordinate(t[i])<0)return!1}return!0}static"IsInFrustum"(t,i){for(let r=0;r<6;++r){let a=!0;const o=i[r];for(let i=0;i<8;++i)if(o.dotCoordinate(t[i])>=0){a=!1;break}if(a)return!1}return!0}}BoundingBox._TmpVector3=(0,D.$G)(3,x.P.Zero);class BoundingSphere{"constructor"(t,i,r){this.center=x.P.Zero(),this.centerWorld=x.P.Zero(),this.minimum=x.P.Zero(),this.maximum=x.P.Zero(),this.reConstruct(t,i,r)}"reConstruct"(t,i,r){this.minimum.copyFrom(t),this.maximum.copyFrom(i);const a=x.P.Distance(t,i);i.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*a,this._update(r||x.y3.IdentityReadOnly)}"scale"(t){const i=this.radius*t,r=BoundingSphere._TmpVector3,a=r[0].setAll(i),o=this.center.subtractToRef(a,r[1]),h=this.center.addToRef(a,r[2]);return this.reConstruct(o,h,this._worldMatrix),this}"getWorldMatrix"(){return this._worldMatrix}"_update"(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{x.P.TransformCoordinatesToRef(this.center,t,this.centerWorld);const i=BoundingSphere._TmpVector3[0];x.P.TransformNormalFromFloatsToRef(1,1,1,t,i),this.radiusWorld=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))*this.radius}}"isInFrustum"(t){const i=this.centerWorld,r=this.radiusWorld;for(let a=0;a<6;a++)if(t[a].dotCoordinate(i)<=-r)return!1;return!0}"isCenterInFrustum"(t){const i=this.centerWorld;for(let r=0;r<6;r++)if(t[r].dotCoordinate(i)<0)return!1;return!0}"intersectsPoint"(t){const i=x.P.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<i)}static"Intersects"(t,i){const r=x.P.DistanceSquared(t.centerWorld,i.centerWorld),a=t.radiusWorld+i.radiusWorld;return!(a*a<r)}static"CreateFromCenterAndRadius"(t,i,r){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,i),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const a=new BoundingSphere(this._TmpVector3[0],this._TmpVector3[2]);return a._worldMatrix=r||x.y3.Identity(),a}}BoundingSphere._TmpVector3=(0,D.$G)(3,x.P.Zero);const W={"min":0,"max":0},H={"min":0,"max":0},computeBoxExtents=(t,i,r)=>{const a=x.P.Dot(i.centerWorld,t),o=Math.abs(x.P.Dot(i.directions[0],t))*i.extendSize.x+Math.abs(x.P.Dot(i.directions[1],t))*i.extendSize.y+Math.abs(x.P.Dot(i.directions[2],t))*i.extendSize.z;r.min=a-o,r.max=a+o},axisOverlap=(t,i,r)=>(computeBoxExtents(t,i,W),computeBoxExtents(t,r,H),!(W.min>H.max||H.min>W.max));class BoundingInfo{"constructor"(t,i,r){this._isLocked=!1,this.boundingBox=new BoundingBox(t,i,r),this.boundingSphere=new BoundingSphere(t,i,r)}"reConstruct"(t,i,r){this.boundingBox.reConstruct(t,i,r),this.boundingSphere.reConstruct(t,i,r)}get"minimum"(){return this.boundingBox.minimum}get"maximum"(){return this.boundingBox.maximum}get"isLocked"(){return this._isLocked}set"isLocked"(t){this._isLocked=t}"update"(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))}"centerOn"(t,i){const r=BoundingInfo._TmpVector3[0].copyFrom(t).subtractInPlace(i),a=BoundingInfo._TmpVector3[1].copyFrom(t).addInPlace(i);return this.boundingBox.reConstruct(r,a,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(r,a,this.boundingBox.getWorldMatrix()),this}"encapsulate"(t){const i=x.P.Minimize(this.minimum,t),r=x.P.Maximize(this.maximum,t);return this.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this}"encapsulateBoundingInfo"(t){const i=x.jp.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(i);const r=x.jp.Vector3[0];return x.P.TransformCoordinatesToRef(t.boundingBox.minimumWorld,i,r),this.encapsulate(r),x.P.TransformCoordinatesToRef(t.boundingBox.maximumWorld,i,r),this.encapsulate(r),this}"scale"(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this}"isInFrustum"(t,i=0){if((2===i||3===i)&&this.boundingSphere.isCenterInFrustum(t))return!0;if(!this.boundingSphere.isInFrustum(t))return!1;return!(1!==i&&3!==i)||this.boundingBox.isInFrustum(t)}get"diagonalLength"(){const t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,BoundingInfo._TmpVector3[0]).length()}"isCompletelyInFrustum"(t){return this.boundingBox.isCompletelyInFrustum(t)}"_checkCollision"(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}"intersectsPoint"(t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t))}"intersects"(t,i){if(!BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;const r=this.boundingBox,a=t.boundingBox;return!!axisOverlap(r.directions[0],r,a)&&(!!axisOverlap(r.directions[1],r,a)&&(!!axisOverlap(r.directions[2],r,a)&&(!!axisOverlap(a.directions[0],r,a)&&(!!axisOverlap(a.directions[1],r,a)&&(!!axisOverlap(a.directions[2],r,a)&&(!!axisOverlap(x.P.Cross(r.directions[0],a.directions[0]),r,a)&&(!!axisOverlap(x.P.Cross(r.directions[0],a.directions[1]),r,a)&&(!!axisOverlap(x.P.Cross(r.directions[0],a.directions[2]),r,a)&&(!!axisOverlap(x.P.Cross(r.directions[1],a.directions[0]),r,a)&&(!!axisOverlap(x.P.Cross(r.directions[1],a.directions[1]),r,a)&&(!!axisOverlap(x.P.Cross(r.directions[1],a.directions[2]),r,a)&&(!!axisOverlap(x.P.Cross(r.directions[2],a.directions[0]),r,a)&&(!!axisOverlap(x.P.Cross(r.directions[2],a.directions[1]),r,a)&&!!axisOverlap(x.P.Cross(r.directions[2],a.directions[2]),r,a))))))))))))))}}BoundingInfo._TmpVector3=(0,D.$G)(2,x.P.Zero);class MathHelpers{static"extractMinAndMaxIndexed"(t,i,r,a,o,h){for(let l=r;l<r+a;l++){const r=3*i[l],a=t[r],c=t[r+1],u=t[r+2];o.minimizeInPlaceFromFloats(a,c,u),h.maximizeInPlaceFromFloats(a,c,u)}}static"extractMinAndMax"(t,i,r,a,o,h){for(let l=i,c=i*a;l<i+r;l++,c+=a){const i=t[c],r=t[c+1],a=t[c+2];o.minimizeInPlaceFromFloats(i,r,a),h.maximizeInPlaceFromFloats(i,r,a)}}}function extractMinAndMax(t,i,r,a=null,o){const h=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new x.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return o||(o=3),MathHelpers.extractMinAndMax(t,i,r,o,h,l),a&&(h.x-=h.x*a.x+a.y,h.y-=h.y*a.x+a.y,h.z-=h.z*a.x+a.y,l.x+=l.x*a.x+a.y,l.y+=l.y*a.x+a.y,l.z+=l.z*a.x+a.y),{"minimum":h,"maximum":l}}(0,m.gn)([T.G6.filter((...[t,i])=>!Array.isArray(t)&&!Array.isArray(i))],MathHelpers,"extractMinAndMaxIndexed",null),(0,m.gn)([T.G6.filter((...[t])=>!Array.isArray(t))],MathHelpers,"extractMinAndMax",null);var X=r(7050);class SubMesh{get"materialDefines"(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:this._getDrawWrapper()?.defines}set"materialDefines"(t){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=t}"_getDrawWrapper"(t,i=!1){t=t??this._engine.currentRenderPassId;let r=this._drawWrappers[t];return!r&&i&&(this._drawWrappers[t]=r=new X.q(this._mesh.getScene().getEngine())),r}"_removeDrawWrapper"(t,i=!0,r=!1){i&&this._drawWrappers[t]?.dispose(r),this._drawWrappers[t]=void 0}get"effect"(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:this._getDrawWrapper()?.effect??null}get"_drawWrapper"(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get"_drawWrapperOverride"(){return this._mainDrawWrapperOverride}"_setMainDrawWrapperOverride"(t){this._mainDrawWrapperOverride=t}"setEffect"(t,i=null,r,a=!0){const o=this._drawWrapper;o.setEffect(t,i,a),void 0!==r&&(o.materialContext=r),t||(o.defines=null,o.materialContext=void 0)}"resetDrawCache"(t,i=!1){if(this._drawWrappers){if(void 0!==t)return void this._removeDrawWrapper(t,!0,i);for(const t of this._drawWrappers)t?.dispose(i)}this._drawWrappers=[]}static"AddToMesh"(t,i,r,a,o,h,l,c=!0){return new SubMesh(t,i,r,a,o,h,l,c)}"constructor"(t,i,r,a,o,h,l,c=!0,u=!0){this.materialIndex=t,this.verticesStart=i,this.verticesCount=r,this.indexStart=a,this.indexCount=o,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=h,this._renderingMesh=l||h,u&&h.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=h.subMeshes.length-1,c&&(this.refreshBoundingInfo(),h.computeWorldMatrix(!0))}get"IsGlobal"(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}"getBoundingInfo"(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}"setBoundingInfo"(t){return this._boundingInfo=t,this}"getMesh"(){return this._mesh}"getRenderingMesh"(){return this._renderingMesh}"getReplacementMesh"(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}"getEffectiveMesh"(){const t=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return t||this._renderingMesh}"getMaterial"(t=!0){const i=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!i)return t&&this._mesh.getScene()._hasDefaultMaterial?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(i)){const t=i.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this.resetDrawCache()),t}return i}"_isMultiMaterial"(t){return void 0!==t.getSubMaterial}"refreshBoundingInfo"(t=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(t||(t=this._renderingMesh.getVerticesData(G.o.PositionKind)),!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const i=this._renderingMesh.getIndices();let r;if(0===this.indexStart&&this.indexCount===i.length){const t=this._renderingMesh.getBoundingInfo();r={"minimum":t.minimum.clone(),"maximum":t.maximum.clone()}}else r=function extractMinAndMaxIndexed(t,i,r,a,o=null){const h=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new x.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return MathHelpers.extractMinAndMaxIndexed(t,i,r,a,h,l),o&&(h.x-=h.x*o.x+o.y,h.y-=h.y*o.x+o.y,h.z-=h.z*o.x+o.y,l.x+=l.x*o.x+o.y,l.y+=l.y*o.x+o.y,l.z+=l.z*o.x+o.y),{"minimum":h,"maximum":l}}(t,i,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(r.minimum,r.maximum):this._boundingInfo=new BoundingInfo(r.minimum,r.maximum),this}"_checkCollision"(t){return this.getBoundingInfo()._checkCollision(t)}"updateBoundingInfo"(t){let i=this.getBoundingInfo();return i||(this.refreshBoundingInfo(),i=this.getBoundingInfo()),i&&i.update(t),this}"isInFrustum"(t){const i=this.getBoundingInfo();return!!i&&i.isInFrustum(t,this._mesh.cullingStrategy)}"isCompletelyInFrustum"(t){const i=this.getBoundingInfo();return!!i&&i.isCompletelyInFrustum(t)}"render"(t){return this._renderingMesh.render(this,t,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}"_getLinesIndexBuffer"(t,i){if(!this._linesIndexBuffer){const r=6*Math.floor(this.indexCount/3),a=this.verticesStart+this.verticesCount>65535?new Uint32Array(r):new Uint16Array(r);let o=0;if(0===t.length)for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)a[o++]=t,a[o++]=t+1,a[o++]=t+1,a[o++]=t+2,a[o++]=t+2,a[o++]=t;else for(let i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)a[o++]=t[i],a[o++]=t[i+1],a[o++]=t[i+1],a[o++]=t[i+2],a[o++]=t[i+2],a[o++]=t[i];this._linesIndexBuffer=i.createIndexBuffer(a),this._linesIndexCount=a.length}return this._linesIndexBuffer}"canIntersects"(t){const i=this.getBoundingInfo();return!!i&&t.intersectsBox(i.boundingBox)}"intersects"(t,i,r,a,o){const h=this.getMaterial();if(!h)return null;let l=3,c=!1;switch(h.fillMode){case 3:case 5:case 6:case 8:return null;case 7:l=1,c=!0}return 4===h.fillMode?r.length?this._intersectLines(t,i,r,this._mesh.intersectionThreshold,a):this._intersectUnIndexedLines(t,i,r,this._mesh.intersectionThreshold,a):!r.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(t,i,r,a,o):this._intersectTriangles(t,i,r,l,c,a,o)}"_intersectLines"(t,i,r,a,o){let h=null;for(let l=this.indexStart;l<this.indexStart+this.indexCount;l+=2){const c=i[r[l]],u=i[r[l+1]],d=t.intersectionSegment(c,u,a);if(!(d<0)&&((o||!h||d<h.distance)&&(h=new IntersectionInfo(null,null,d),h.faceId=l/2,o)))break}return h}"_intersectUnIndexedLines"(t,i,r,a,o){let h=null;for(let r=this.verticesStart;r<this.verticesStart+this.verticesCount;r+=2){const l=i[r],c=i[r+1],u=t.intersectionSegment(l,c,a);if(!(u<0)&&((o||!h||u<h.distance)&&(h=new IntersectionInfo(null,null,u),h.faceId=r/2,o)))break}return h}"_intersectTriangles"(t,i,r,a,o,h,l){let c=null,u=-1;for(let d=this.indexStart;d<this.indexStart+this.indexCount-(3-a);d+=a){u++;const a=r[d],_=r[d+1],g=r[d+2];if(o&&4294967295===g){d+=2;continue}const p=i[a],m=i[_],T=i[g];if(!p||!m||!T)continue;if(l&&!l(p,m,T,t,a,_,g))continue;const y=t.intersectsTriangle(p,m,T);if(y){if(y.distance<0)continue;if((h||!c||y.distance<c.distance)&&(c=y,c.faceId=u,h))break}}return c}"_intersectUnIndexedTriangles"(t,i,r,a,o){let h=null;for(let r=this.verticesStart;r<this.verticesStart+this.verticesCount;r+=3){const l=i[r],c=i[r+1],u=i[r+2];if(o&&!o(l,c,u,t,-1,-1,-1))continue;const d=t.intersectsTriangle(l,c,u);if(d){if(d.distance<0)continue;if((a||!h||d.distance<h.distance)&&(h=d,h.faceId=r/3,a))break}}return h}"_rebuild"(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}"clone"(t,i){const r=new SubMesh(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,i,!1);if(!this.IsGlobal){const t=this.getBoundingInfo();if(!t)return r;r._boundingInfo=new BoundingInfo(t.minimum,t.maximum)}return r}"dispose"(t=!1){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const i=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(i,1),this.resetDrawCache(void 0,t)}"getClassName"(){return"SubMesh"}static"CreateFromIndices"(t,i,r,a,o,h=!0){let l=Number.MAX_VALUE,c=-Number.MAX_VALUE;const u=(o||a).getIndices();for(let t=i;t<i+r;t++){const i=u[t];i<l&&(l=i),i>c&&(c=i)}return new SubMesh(t,l,c-l+1,i,r,a,o,h)}}var K=r(760);class MaterialStencilState{"constructor"(){this.reset()}"reset"(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get"func"(){return this._func}set"func"(t){this._func=t}get"funcRef"(){return this._funcRef}set"funcRef"(t){this._funcRef=t}get"funcMask"(){return this._funcMask}set"funcMask"(t){this._funcMask=t}get"opStencilFail"(){return this._opStencilFail}set"opStencilFail"(t){this._opStencilFail=t}get"opDepthFail"(){return this._opDepthFail}set"opDepthFail"(t){this._opDepthFail=t}get"opStencilDepthPass"(){return this._opStencilDepthPass}set"opStencilDepthPass"(t){this._opStencilDepthPass=t}get"mask"(){return this._mask}set"mask"(t){this._mask=t}get"enabled"(){return this._enabled}set"enabled"(t){this._enabled=t}"getClassName"(){return"MaterialStencilState"}"copyTo"(t){A.p.Clone(()=>t,this)}"serialize"(){return A.p.Serialize(this)}"parse"(t,i,r){A.p.Parse(()=>this,t,i,r)}}(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"func",null),(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"funcRef",null),(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"funcMask",null),(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"opStencilFail",null),(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"opDepthFail",null),(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"opStencilDepthPass",null),(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"mask",null),(0,m.gn)([(0,T.qC)()],MaterialStencilState.prototype,"enabled",null);var q=r(183);function setClipPlane(t,i,r){r&&t.setFloat4(i,r.normal.x,r.normal.y,r.normal.z,r.d)}const Y=V.Wo.Black();function PrepareAttributesForMorphTargets(t,i,r,a=!0){const o=r.NUM_MORPH_INFLUENCERS;if(o>0&&E.l.LastCreatedEngine){const h=E.l.LastCreatedEngine.getCaps().maxVertexAttribs,l=i.morphTargetManager;if(l?.isUsingTextureForTargets)return;const c=l&&l.supportsPositions&&a,u=l&&l.supportsNormals&&r.NORMAL,d=l&&l.supportsTangents&&r.TANGENT,_=l&&l.supportsUVs&&r.UV1,g=l&&l.supportsUV2s&&r.UV2,p=l&&l.supportsColors&&r.COLOR;for(let r=0;r<o;r++)c&&t.push("position"+r),u&&t.push("normal"+r),d&&t.push("tangent"+r),_&&t.push("uv_"+r),g&&t.push("uv2_"+r),p&&t.push("color"+r),t.length>h&&C.Y.Error("Cannot add more vertex attributes for mesh "+i.name)}}function PrepareDefinesForMergedUV(t,i,r){i._needUVs=!0,i[r]=!0,t.optimizeUVAllocation&&t.getTextureMatrix().isIdentityAs3x2()?(i[r+"DIRECTUV"]=t.coordinatesIndex+1,i["MAINUV"+(t.coordinatesIndex+1)]=!0):i[r+"DIRECTUV"]=0}function BindTextureMatrix(t,i,r){const a=t.getTextureMatrix();i.updateMatrix(r+"Matrix",a)}function BindLight(t,i,r,a,o,h=!0){t._bindLight(i,r,a,o,h)}function PrepareDefinesForLight(t,i,r,a,o,h,l){switch(l.needNormals=!0,void 0===o["LIGHT"+a]&&(l.needRebuild=!0),o["LIGHT"+a]=!0,o["SPOTLIGHT"+a]=!1,o["HEMILIGHT"+a]=!1,o["POINTLIGHT"+a]=!1,o["DIRLIGHT"+a]=!1,o["AREALIGHT"+a]=!1,r.prepareLightSpecificDefines(o,a),o["LIGHT_FALLOFF_PHYSICAL"+a]=!1,o["LIGHT_FALLOFF_GLTF"+a]=!1,o["LIGHT_FALLOFF_STANDARD"+a]=!1,r.falloffType){case q.m.FALLOFF_GLTF:o["LIGHT_FALLOFF_GLTF"+a]=!0;break;case q.m.FALLOFF_PHYSICAL:o["LIGHT_FALLOFF_PHYSICAL"+a]=!0;break;case q.m.FALLOFF_STANDARD:o["LIGHT_FALLOFF_STANDARD"+a]=!0}if(h&&!r.specular.equalsFloats(0,0,0)&&(l.specularEnabled=!0),o["SHADOW"+a]=!1,o["SHADOWCSM"+a]=!1,o["SHADOWCSMDEBUG"+a]=!1,o["SHADOWCSMNUM_CASCADES"+a]=!1,o["SHADOWCSMUSESHADOWMAXZ"+a]=!1,o["SHADOWCSMNOBLEND"+a]=!1,o["SHADOWCSM_RIGHTHANDED"+a]=!1,o["SHADOWPCF"+a]=!1,o["SHADOWPCSS"+a]=!1,o["SHADOWPOISSON"+a]=!1,o["SHADOWESM"+a]=!1,o["SHADOWCLOSEESM"+a]=!1,o["SHADOWCUBE"+a]=!1,o["SHADOWLOWQUALITY"+a]=!1,o["SHADOWMEDIUMQUALITY"+a]=!1,i&&i.receiveShadows&&t.shadowsEnabled&&r.shadowEnabled){const i=r.getShadowGenerator(t.activeCamera)??r.getShadowGenerator();if(i){const t=i.getShadowMap();t&&t.renderList&&t.renderList.length>0&&(l.shadowEnabled=!0,i.prepareDefines(o,a))}}r.lightmapMode!=q.m.LIGHTMAP_DEFAULT?(l.lightmapMode=!0,o["LIGHTMAPEXCLUDED"+a]=!0,o["LIGHTMAPNOSPECULAR"+a]=r.lightmapMode==q.m.LIGHTMAP_SHADOWSONLY):(o["LIGHTMAPEXCLUDED"+a]=!1,o["LIGHTMAPNOSPECULAR"+a]=!1)}function PrepareUniformsAndSamplersForLight(t,i,r,a,o=null,h=!1,l=!1){o&&o.push("Light"+t),h||(i.push("vLightData"+t,"vLightDiffuse"+t,"vLightSpecular"+t,"vLightDirection"+t,"vLightWidth"+t,"vLightHeight"+t,"vLightFalloff"+t,"vLightGround"+t,"lightMatrix"+t,"shadowsInfo"+t,"depthValues"+t),r.push("shadowTexture"+t),r.push("depthTexture"+t),i.push("viewFrustumZ"+t,"cascadeBlendFactor"+t,"lightSizeUVCorrection"+t,"depthCorrection"+t,"penumbraDarkness"+t,"frustumLengths"+t),a&&(r.push("projectionLightTexture"+t),i.push("textureProjectionMatrix"+t)),l&&r.push("iesLightTexture"+t))}class material_Material{get"_supportGlowLayer"(){return!1}set"_glowModeEnabled"(t){}get"shaderLanguage"(){return this._shaderLanguage}get"canRenderToMRT"(){return!1}set"alpha"(t){if(this._alpha===t)return;const i=this._alpha;this._alpha=t,1!==i&&1!==t||this.markAsDirty(material_Material.MiscDirtyFlag+material_Material.PrePassDirtyFlag)}get"alpha"(){return this._alpha}set"backFaceCulling"(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(material_Material.TextureDirtyFlag))}get"backFaceCulling"(){return this._backFaceCulling}set"cullBackFaces"(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(material_Material.TextureDirtyFlag))}get"cullBackFaces"(){return this._cullBackFaces}get"blockDirtyMechanism"(){return this._blockDirtyMechanism}set"blockDirtyMechanism"(t){this._blockDirtyMechanism!==t&&(this._blockDirtyMechanism=t,t||this.markDirty())}"atomicMaterialsUpdate"(t){this.blockDirtyMechanism=!0;try{t(this)}finally{this.blockDirtyMechanism=!1}}get"hasRenderTargetTextures"(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set"onDispose"(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}get"onBindObservable"(){return this._onBindObservable||(this._onBindObservable=new b.y$),this._onBindObservable}set"onBind"(t){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(t)}get"onUnBindObservable"(){return this._onUnBindObservable||(this._onUnBindObservable=new b.y$),this._onUnBindObservable}get"onEffectCreatedObservable"(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new b.y$),this._onEffectCreatedObservable}set"alphaMode"(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(material_Material.TextureDirtyFlag))}get"alphaMode"(){return this._alphaMode}set"needDepthPrePass"(t){this._needDepthPrePass!==t&&(this._needDepthPrePass=t,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get"needDepthPrePass"(){return this._needDepthPrePass}get"isPrePassCapable"(){return!1}set"fogEnabled"(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(material_Material.MiscDirtyFlag))}get"fogEnabled"(){return this._fogEnabled}get"wireframe"(){switch(this._fillMode){case material_Material.WireFrameFillMode:case material_Material.LineListDrawMode:case material_Material.LineLoopDrawMode:case material_Material.LineStripDrawMode:return!0}return this._scene.forceWireframe}set"wireframe"(t){this.fillMode=t?material_Material.WireFrameFillMode:material_Material.TriangleFillMode}get"pointsCloud"(){switch(this._fillMode){case material_Material.PointFillMode:case material_Material.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set"pointsCloud"(t){this.fillMode=t?material_Material.PointFillMode:material_Material.TriangleFillMode}get"fillMode"(){return this._fillMode}set"fillMode"(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(material_Material.MiscDirtyFlag))}get"useLogarithmicDepth"(){return this._useLogarithmicDepth}set"useLogarithmicDepth"(t){const i=this.getScene().getEngine().getCaps().fragmentDepthSupported;t&&!i&&C.Y.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=t&&i,this._markAllSubMeshesAsMiscDirty()}"_getDrawWrapper"(){return this._drawWrapper}"_setDrawWrapper"(t){this._drawWrapper=t}"constructor"(t,i,r,a=!1){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new b.y$,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new MaterialStencilState,this._useUBO=!1,this._fillMode=material_Material.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=t;const o=i||E.l.LastCreatedScene;o&&(this._scene=o,this._dirtyCallbacks={},this._forceGLSL=a,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||M.w1.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new X.q(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new K.M(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,this._createUniformBuffer(),r||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),material_Material.OnEventObservable.notifyObservers(this,1))}"_createUniformBuffer"(){const t=this.getScene().getEngine();this._uniformBuffer?.dispose(),t.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new K.M(t,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new K.M(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}"toString"(t){return"Name: "+this.name}"getClassName"(){return"Material"}get"_isMaterial"(){return!0}get"isFrozen"(){return this.checkReadyOnlyOnce}"freeze"(){this.markDirty(),this.checkReadyOnlyOnce=!0}"unfreeze"(){this.markDirty(),this.checkReadyOnlyOnce=!1}"isReady"(t,i){return!0}"isReadyForSubMesh"(t,i,r){const a=i.materialDefines;return!!a&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}"getEffect"(){return this._drawWrapper.effect}"getScene"(){return this._scene}"_getEffectiveOrientation"(t){return null!==this.sideOrientation?this.sideOrientation:t.sideOrientation}get"transparencyMode"(){return this._transparencyMode}set"transparencyMode"(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._markAllSubMeshesAsTexturesAndMiscDirty())}get"_hasTransparencyMode"(){return null!=this._transparencyMode}get"_transparencyModeIsBlend"(){return this._transparencyMode===material_Material.MATERIAL_ALPHABLEND||this._transparencyMode===material_Material.MATERIAL_ALPHATESTANDBLEND}get"_transparencyModeIsTest"(){return this._transparencyMode===material_Material.MATERIAL_ALPHATEST||this._transparencyMode===material_Material.MATERIAL_ALPHATESTANDBLEND}get"_disableAlphaBlending"(){return this._transparencyMode===material_Material.MATERIAL_OPAQUE||this._transparencyMode===material_Material.MATERIAL_ALPHATEST}"needAlphaBlending"(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}"needAlphaBlendingForMesh"(t){return this._hasTransparencyMode?this._transparencyModeIsBlend:t.visibility<1||!this._disableAlphaBlending&&(t.hasVertexAlpha||this.needAlphaBlending())}"needAlphaTesting"(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}"needAlphaTestingForMesh"(t){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()}"getAlphaTestTexture"(){return null}"markDirty"(t=!1){const i=this.getScene().meshes;for(const r of i)if(r.subMeshes)for(const i of r.subMeshes)if(i.getMaterial()===this)for(const r of i._drawWrappers)r&&this._materialContext===r.materialContext&&(r._wasPreviouslyReady=!1,r._wasPreviouslyUsingInstances=null,r._forceRebindOnNextCall=t);t&&this.markAsDirty(material_Material.AllDirtyFlag)}"_preBind"(t,i=null){const r=this._scene.getEngine(),a=(null==i?this.sideOrientation:i)===material_Material.ClockWiseSideOrientation;return r.enableEffect(t||this._getDrawWrapper()),r.setState(this.backFaceCulling,this.zOffset,!1,a,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),a}"bind"(t,i){}"buildUniformLayout"(){const t=this._uniformBuffer;this._eventInfo.ubo=t,this._callbackPluginEventGeneric(8,this._eventInfo),t.create(),this._uniformBufferLayoutBuilt=!0}"bindForSubMesh"(t,i,r){const a=r._drawWrapper;this._eventInfo.subMesh=r,this._callbackPluginEventBindForSubMesh(this._eventInfo),a._forceRebindOnNextCall=!1}"bindOnlyWorldMatrix"(t){}"bindView"(t){this._useUBO?this._needToBindSceneUbo=!0:t.setMatrix("view",this.getScene().getViewMatrix())}"bindViewProjection"(t){this._useUBO?this._needToBindSceneUbo=!0:(t.setMatrix("viewProjection",this.getScene().getTransformMatrix()),t.setMatrix("projection",this.getScene().getProjectionMatrix()))}"bindEyePosition"(t,i){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(t,i)}"_afterBind"(t,i=null,r){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&i&&(this._needToBindSceneUbo=!1,function BindSceneUniformBuffer(t,i){i.bindToEffect(t,"Scene")}(i,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=t?t.visibility:1,this._onBindObservable&&t&&this._onBindObservable.notifyObservers(t),this.disableDepthWrite){const t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}if(this.disableColorWrite){const t=this._scene.getEngine();this._cachedColorWriteState=t.getColorWrite(),t.setColorWrite(!1)}if(0!==this.depthFunction){const t=this._scene.getEngine();this._cachedDepthFunctionState=t.getDepthFunction()||0,t.setDepthFunction(this.depthFunction)}}"unbind"(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}"getAnimatables"(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}"getActiveTextures"(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}"hasTexture"(t){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=t,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}"clone"(t){return null}"_clonePlugins"(t,i){const r={};if(this._serializePlugins(r),material_Material._ParsePlugins(r,t,this._scene,i),this.pluginManager)for(const i of this.pluginManager._plugins){const r=t.pluginManager.getPlugin(i.name);r&&i.copyTo(r)}}"getBindedMeshes"(){if(this.meshMap){const t=[];for(const i in this.meshMap){const r=this.meshMap[i];r&&t.push(r)}return t}return this._scene.meshes.filter(t=>t.material===this)}"forceCompilation"(t,i,r,a){const o={"clipPlane":!1,"useInstances":!1,...r},h=this.getScene(),l=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const checkReady=()=>{if(!this._scene||!this._scene.getEngine())return;const r=h.clipPlane;if(o.clipPlane&&(h.clipPlane=new L.J(0,0,0,1)),this._storeEffectOnSubMeshes){let r=!0,h=null;if(t.subMeshes){const i=new SubMesh(0,0,0,0,0,t,void 0,!1,!1);i.materialDefines&&(i.materialDefines._renderId=-1),this.isReadyForSubMesh(t,i,o.useInstances)||(i.effect&&i.effect.getCompilationError()&&i.effect.allFallbacksProcessed()?h=i.effect.getCompilationError():(r=!1,setTimeout(checkReady,16)))}r&&(this.allowShaderHotSwapping=l,h&&a&&a(h),i&&i(this))}else this.isReady()?(this.allowShaderHotSwapping=l,i&&i(this)):setTimeout(checkReady,16);o.clipPlane&&(h.clipPlane=r)};checkReady()}"forceCompilationAsync"(t,i){return new Promise((r,a)=>{this.forceCompilation(t,()=>{r()},i,t=>{a(t)})})}"markAsDirty"(t){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(material_Material._DirtyCallbackArray.length=0,t&material_Material.ImageProcessingDirtyFlag&&material_Material._DirtyCallbackArray.push(material_Material._ImageProcessingDirtyCallBack),t&material_Material.TextureDirtyFlag&&material_Material._DirtyCallbackArray.push(material_Material._TextureDirtyCallBack),t&material_Material.LightDirtyFlag&&material_Material._DirtyCallbackArray.push(material_Material._LightsDirtyCallBack),t&material_Material.FresnelDirtyFlag&&material_Material._DirtyCallbackArray.push(material_Material._FresnelDirtyCallBack),t&material_Material.AttributesDirtyFlag&&material_Material._DirtyCallbackArray.push(material_Material._AttributeDirtyCallBack),t&material_Material.MiscDirtyFlag&&material_Material._DirtyCallbackArray.push(material_Material._MiscDirtyCallBack),t&material_Material.PrePassDirtyFlag&&material_Material._DirtyCallbackArray.push(material_Material._PrePassDirtyCallBack),material_Material._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(material_Material._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}"resetDrawCache"(){const t=this.getScene().meshes;for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)t.getMaterial()===this&&t.resetDrawCache()}"_markAllSubMeshesAsDirty"(t){const i=this.getScene();if(i.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const r=i.meshes;for(const a of r)if(a.subMeshes)for(const r of a.subMeshes){if((r.getMaterial()||(i._hasDefaultMaterial?i.defaultMaterial:null))===this)for(const i of r._drawWrappers)i&&i.defines&&i.defines.markAllAsDirty&&this._materialContext===i.materialContext&&t(i.defines)}}"_markScenePrePassDirty"(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.getScene().enablePrePassRenderer();t&&t.markAsDirty()}"_markAllSubMeshesAsAllDirty"(){this._markAllSubMeshesAsDirty(material_Material._AllDirtyCallBack)}"_markAllSubMeshesAsImageProcessingDirty"(){this._markAllSubMeshesAsDirty(material_Material._ImageProcessingDirtyCallBack)}"_markAllSubMeshesAsTexturesDirty"(){this._markAllSubMeshesAsDirty(material_Material._TextureDirtyCallBack)}"_markAllSubMeshesAsFresnelDirty"(){this._markAllSubMeshesAsDirty(material_Material._FresnelDirtyCallBack)}"_markAllSubMeshesAsFresnelAndMiscDirty"(){this._markAllSubMeshesAsDirty(material_Material._FresnelAndMiscDirtyCallBack)}"_markAllSubMeshesAsLightsDirty"(){this._markAllSubMeshesAsDirty(material_Material._LightsDirtyCallBack)}"_markAllSubMeshesAsAttributesDirty"(){this._markAllSubMeshesAsDirty(material_Material._AttributeDirtyCallBack)}"_markAllSubMeshesAsMiscDirty"(){this._markAllSubMeshesAsDirty(material_Material._MiscDirtyCallBack)}"_markAllSubMeshesAsPrePassDirty"(){this._markAllSubMeshesAsDirty(material_Material._PrePassDirtyCallBack)}"_markAllSubMeshesAsTexturesAndMiscDirty"(){this._markAllSubMeshesAsDirty(material_Material._TextureAndMiscDirtyCallBack)}"_checkScenePerformancePriority"(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const t=this._scene.onScenePerformancePriorityChangedObservable.addOnce(()=>{this.checkReadyOnlyOnce=!1});this.onDisposeObservable.add(()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(t)})}}"setPrePassRenderer"(t){return!1}"dispose"(t,i,r){const a=this.getScene();if(a.stopAnimation(this),a.freeProcessedMaterials(),a.removeMaterial(this),this._eventInfo.forceDisposeTextures=i,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const t=this._parentContainer.materials.indexOf(this);t>-1&&this._parentContainer.materials.splice(t,1),this._parentContainer=null}if(!0!==r)if(this.meshMap)for(const t in this.meshMap){const i=this.meshMap[t];this._disposeMeshResources(i)}else{const t=a.meshes;for(const i of t)this._disposeMeshResources(i)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}"_disposeMeshResources"(t){if(!t)return;const i=t.geometry,r=t._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(t.subMeshes&&r)for(const a of t.subMeshes){const t=a._drawWrappers;for(let o=0;o<t.length;o++){const h=t[o]?.effect;if(!h)continue;r[o]===this&&(i?._releaseVertexArrayObject(h),a._removeDrawWrapper(o,!0,!0))}}}else i?._releaseVertexArrayObject(this._drawWrapper.effect);t.material!==this||t.sourceMesh||(t.material=null)}"serialize"(){const t=A.p.Serialize(this);return t.stencil=this.stencil.serialize(),t.uniqueId=this.uniqueId,this._serializePlugins(t),t}"_serializePlugins"(t){if(t.plugins={},this.pluginManager)for(const i of this.pluginManager._plugins)i.doNotSerialize||(t.plugins[i.getClassName()]=i.serialize())}static"Parse"(t,i,r){if(t.customType){if("BABYLON.PBRMaterial"===t.customType&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return C.Y.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else t.customType="BABYLON.StandardMaterial";const a=M.w1.Instantiate(t.customType).Parse(t,i,r);return a._loadedUniqueId=t.uniqueId,a}static"_ParsePlugins"(t,i,r,a){if(t.plugins)for(const o in t.plugins){const h=t.plugins[o];let l=i.pluginManager?.getPlugin(h.name);if(!l){const t=M.w1.Instantiate("BABYLON."+o);t&&(l=new t(i))}l?.parse(h,r,a)}}}material_Material.TriangleFillMode=0,material_Material.WireFrameFillMode=1,material_Material.PointFillMode=2,material_Material.PointListDrawMode=3,material_Material.LineListDrawMode=4,material_Material.LineLoopDrawMode=5,material_Material.LineStripDrawMode=6,material_Material.TriangleStripDrawMode=7,material_Material.TriangleFanDrawMode=8,material_Material.ClockWiseSideOrientation=0,material_Material.CounterClockWiseSideOrientation=1,material_Material.ImageProcessingDirtyFlag=64,material_Material.TextureDirtyFlag=1,material_Material.LightDirtyFlag=2,material_Material.FresnelDirtyFlag=4,material_Material.AttributesDirtyFlag=8,material_Material.MiscDirtyFlag=16,material_Material.PrePassDirtyFlag=32,material_Material.AllDirtyFlag=127,material_Material.MATERIAL_OPAQUE=0,material_Material.MATERIAL_ALPHATEST=1,material_Material.MATERIAL_ALPHABLEND=2,material_Material.MATERIAL_ALPHATESTANDBLEND=3,material_Material.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,material_Material.MATERIAL_NORMALBLENDMETHOD_RNM=1,material_Material.OnEventObservable=new b.y$,material_Material._AllDirtyCallBack=t=>t.markAllAsDirty(),material_Material._ImageProcessingDirtyCallBack=t=>t.markAsImageProcessingDirty(),material_Material._TextureDirtyCallBack=t=>t.markAsTexturesDirty(),material_Material._FresnelDirtyCallBack=t=>t.markAsFresnelDirty(),material_Material._MiscDirtyCallBack=t=>t.markAsMiscDirty(),material_Material._PrePassDirtyCallBack=t=>t.markAsPrePassDirty(),material_Material._LightsDirtyCallBack=t=>t.markAsLightDirty(),material_Material._AttributeDirtyCallBack=t=>t.markAsAttributesDirty(),material_Material._FresnelAndMiscDirtyCallBack=t=>{material_Material._FresnelDirtyCallBack(t),material_Material._MiscDirtyCallBack(t)},material_Material._TextureAndMiscDirtyCallBack=t=>{material_Material._TextureDirtyCallBack(t),material_Material._MiscDirtyCallBack(t)},material_Material._DirtyCallbackArray=[],material_Material._RunDirtyCallBacks=t=>{for(const i of material_Material._DirtyCallbackArray)i(t)},(0,m.gn)([(0,T.qC)()],material_Material.prototype,"id",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"uniqueId",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"name",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"metadata",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"checkReadyOnEveryCall",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"checkReadyOnlyOnce",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"state",void 0),(0,m.gn)([(0,T.qC)("alpha")],material_Material.prototype,"_alpha",void 0),(0,m.gn)([(0,T.qC)("backFaceCulling")],material_Material.prototype,"_backFaceCulling",void 0),(0,m.gn)([(0,T.qC)("cullBackFaces")],material_Material.prototype,"_cullBackFaces",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"sideOrientation",void 0),(0,m.gn)([(0,T.qC)("alphaMode")],material_Material.prototype,"_alphaMode",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"_needDepthPrePass",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"disableDepthWrite",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"disableColorWrite",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"forceDepthWrite",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"depthFunction",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"separateCullingPass",void 0),(0,m.gn)([(0,T.qC)("fogEnabled")],material_Material.prototype,"_fogEnabled",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"pointSize",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"zOffset",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"zOffsetUnits",void 0),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"pointsCloud",null),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"fillMode",null),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"useLogarithmicDepth",null),(0,m.gn)([(0,T.qC)()],material_Material.prototype,"transparencyMode",null);class MaterialDefines{"constructor"(t){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=t,t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&this._setDefaultValue(i)}get"isDirty"(){return this._isDirty}"markAsProcessed"(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}"markAsUnprocessed"(){this._isDirty=!0}"markAllAsDirty"(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}"markAsImageProcessingDirty"(){this._areImageProcessingDirty=!0,this._isDirty=!0}"markAsLightDirty"(t=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||t,this._isDirty=!0}"markAsAttributesDirty"(){this._areAttributesDirty=!0,this._isDirty=!0}"markAsTexturesDirty"(){this._areTexturesDirty=!0,this._isDirty=!0}"markAsFresnelDirty"(){this._areFresnelDirty=!0,this._isDirty=!0}"markAsMiscDirty"(){this._areMiscDirty=!0,this._isDirty=!0}"markAsPrePassDirty"(){this._arePrePassDirty=!0,this._isDirty=!0}"rebuild"(){this._keys.length=0;for(const t of Object.keys(this))"_"!==t[0]&&this._keys.push(t);if(this._externalProperties)for(const t in this._externalProperties)-1===this._keys.indexOf(t)&&this._keys.push(t)}"isEqual"(t){if(this._keys.length!==t._keys.length)return!1;for(let i=0;i<this._keys.length;i++){const r=this._keys[i];if(this[r]!==t[r])return!1}return!0}"cloneTo"(t){this._keys.length!==t._keys.length&&(t._keys=this._keys.slice(0));for(let i=0;i<this._keys.length;i++){const r=this._keys[i];t[r]=this[r]}}"reset"(){this._keys.forEach(t=>this._setDefaultValue(t))}"_setDefaultValue"(t){const i=this._externalProperties?.[t]?.type??typeof this[t],r=this._externalProperties?.[t]?.default;switch(i){case"number":this[t]=r??0;break;case"string":this[t]=r??"";break;default:this[t]=r??!1}}"toString"(){let t="";for(let i=0;i<this._keys.length;i++){const r=this._keys[i],a=this[r];switch(typeof a){case"number":case"string":t+="#define "+r+" "+a+"\n";break;default:a&&(t+="#define "+r+"\n")}}return t}}class PushMaterial extends material_Material{"constructor"(t,i,r=!0,a=!1){super(t,i,void 0,a),this._normalMatrix=new x.y3,this._storeEffectOnSubMeshes=r}"getEffect"(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}"isReady"(t,i){return!!t&&(!this._storeEffectOnSubMeshes||(!t.subMeshes||0===t.subMeshes.length||this.isReadyForSubMesh(t,t.subMeshes[0],i)))}"_isReadyForSubMesh"(t){const i=t.materialDefines;return!(this.checkReadyOnEveryCall||!t.effect||!i||i._renderId!==this.getScene().getRenderId())}"bindOnlyWorldMatrix"(t){this._activeEffect.setMatrix("world",t)}"bindOnlyNormalMatrix"(t){this._activeEffect.setMatrix("normalMatrix",t)}"bind"(t,i){i&&this.bindForSubMesh(t,i,i.subMeshes[0])}"_afterBind"(t,i=null,r){super._afterBind(t,i,r),this.getScene()._cachedEffect=i,r?r._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}"_mustRebind"(t,i,r,a=1){return r._drawWrapper._forceRebindOnNextCall||t.isCachedMaterialInvalid(this,i,a)}"dispose"(t,i,r){this._activeEffect=void 0,super.dispose(t,i,r)}}var j=r(5187);class MaterialFlags{static get"DiffuseTextureEnabled"(){return this._DiffuseTextureEnabled}static set"DiffuseTextureEnabled"(t){this._DiffuseTextureEnabled!==t&&(this._DiffuseTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"BaseWeightTextureEnabled"(){return this._BaseWeightTextureEnabled}static set"BaseWeightTextureEnabled"(t){this._BaseWeightTextureEnabled!==t&&(this._BaseWeightTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"DetailTextureEnabled"(){return this._DetailTextureEnabled}static set"DetailTextureEnabled"(t){this._DetailTextureEnabled!==t&&(this._DetailTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"DecalMapEnabled"(){return this._DecalMapEnabled}static set"DecalMapEnabled"(t){this._DecalMapEnabled!==t&&(this._DecalMapEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"AmbientTextureEnabled"(){return this._AmbientTextureEnabled}static set"AmbientTextureEnabled"(t){this._AmbientTextureEnabled!==t&&(this._AmbientTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"OpacityTextureEnabled"(){return this._OpacityTextureEnabled}static set"OpacityTextureEnabled"(t){this._OpacityTextureEnabled!==t&&(this._OpacityTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"ReflectionTextureEnabled"(){return this._ReflectionTextureEnabled}static set"ReflectionTextureEnabled"(t){this._ReflectionTextureEnabled!==t&&(this._ReflectionTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"EmissiveTextureEnabled"(){return this._EmissiveTextureEnabled}static set"EmissiveTextureEnabled"(t){this._EmissiveTextureEnabled!==t&&(this._EmissiveTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"SpecularTextureEnabled"(){return this._SpecularTextureEnabled}static set"SpecularTextureEnabled"(t){this._SpecularTextureEnabled!==t&&(this._SpecularTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"BumpTextureEnabled"(){return this._BumpTextureEnabled}static set"BumpTextureEnabled"(t){this._BumpTextureEnabled!==t&&(this._BumpTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"LightmapTextureEnabled"(){return this._LightmapTextureEnabled}static set"LightmapTextureEnabled"(t){this._LightmapTextureEnabled!==t&&(this._LightmapTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"RefractionTextureEnabled"(){return this._RefractionTextureEnabled}static set"RefractionTextureEnabled"(t){this._RefractionTextureEnabled!==t&&(this._RefractionTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"ColorGradingTextureEnabled"(){return this._ColorGradingTextureEnabled}static set"ColorGradingTextureEnabled"(t){this._ColorGradingTextureEnabled!==t&&(this._ColorGradingTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"FresnelEnabled"(){return this._FresnelEnabled}static set"FresnelEnabled"(t){this._FresnelEnabled!==t&&(this._FresnelEnabled=t,U.a.MarkAllMaterialsAsDirty(4))}static get"ClearCoatTextureEnabled"(){return this._ClearCoatTextureEnabled}static set"ClearCoatTextureEnabled"(t){this._ClearCoatTextureEnabled!==t&&(this._ClearCoatTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"ClearCoatBumpTextureEnabled"(){return this._ClearCoatBumpTextureEnabled}static set"ClearCoatBumpTextureEnabled"(t){this._ClearCoatBumpTextureEnabled!==t&&(this._ClearCoatBumpTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"ClearCoatTintTextureEnabled"(){return this._ClearCoatTintTextureEnabled}static set"ClearCoatTintTextureEnabled"(t){this._ClearCoatTintTextureEnabled!==t&&(this._ClearCoatTintTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"SheenTextureEnabled"(){return this._SheenTextureEnabled}static set"SheenTextureEnabled"(t){this._SheenTextureEnabled!==t&&(this._SheenTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"AnisotropicTextureEnabled"(){return this._AnisotropicTextureEnabled}static set"AnisotropicTextureEnabled"(t){this._AnisotropicTextureEnabled!==t&&(this._AnisotropicTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"ThicknessTextureEnabled"(){return this._ThicknessTextureEnabled}static set"ThicknessTextureEnabled"(t){this._ThicknessTextureEnabled!==t&&(this._ThicknessTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"RefractionIntensityTextureEnabled"(){return this._ThicknessTextureEnabled}static set"RefractionIntensityTextureEnabled"(t){this._RefractionIntensityTextureEnabled!==t&&(this._RefractionIntensityTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"TranslucencyIntensityTextureEnabled"(){return this._TranslucencyIntensityTextureEnabled}static set"TranslucencyIntensityTextureEnabled"(t){this._TranslucencyIntensityTextureEnabled!==t&&(this._TranslucencyIntensityTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"TranslucencyColorTextureEnabled"(){return this._TranslucencyColorTextureEnabled}static set"TranslucencyColorTextureEnabled"(t){this._TranslucencyColorTextureEnabled!==t&&(this._TranslucencyColorTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}static get"IridescenceTextureEnabled"(){return this._IridescenceTextureEnabled}static set"IridescenceTextureEnabled"(t){this._IridescenceTextureEnabled!==t&&(this._IridescenceTextureEnabled=t,U.a.MarkAllMaterialsAsDirty(1))}}MaterialFlags._DiffuseTextureEnabled=!0,MaterialFlags._BaseWeightTextureEnabled=!0,MaterialFlags._DetailTextureEnabled=!0,MaterialFlags._DecalMapEnabled=!0,MaterialFlags._AmbientTextureEnabled=!0,MaterialFlags._OpacityTextureEnabled=!0,MaterialFlags._ReflectionTextureEnabled=!0,MaterialFlags._EmissiveTextureEnabled=!0,MaterialFlags._SpecularTextureEnabled=!0,MaterialFlags._BumpTextureEnabled=!0,MaterialFlags._LightmapTextureEnabled=!0,MaterialFlags._RefractionTextureEnabled=!0,MaterialFlags._ColorGradingTextureEnabled=!0,MaterialFlags._FresnelEnabled=!0,MaterialFlags._ClearCoatTextureEnabled=!0,MaterialFlags._ClearCoatBumpTextureEnabled=!0,MaterialFlags._ClearCoatTintTextureEnabled=!0,MaterialFlags._SheenTextureEnabled=!0,MaterialFlags._AnisotropicTextureEnabled=!0,MaterialFlags._ThicknessTextureEnabled=!0,MaterialFlags._RefractionIntensityTextureEnabled=!0,MaterialFlags._TranslucencyIntensityTextureEnabled=!0,MaterialFlags._TranslucencyColorTextureEnabled=!0,MaterialFlags._IridescenceTextureEnabled=!0;class EffectFallbacks{"constructor"(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}"unBindMesh"(){this._mesh=null}"addFallback"(t,i){this._defines[t]||(t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t),this._defines[t]=new Array),this._defines[t].push(i)}"addCPUSkinningFallback"(t,i){this._mesh=i,t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t)}get"hasMoreFallbacks"(){return this._currentRank<=this._maxRank}"reduce"(t,i){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,t=t.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),i._bonesComputationForcedToCPU=!0;const r=this._mesh.getScene();for(let t=0;t<r.meshes.length;t++){const a=r.meshes[t];if(a.material){if(a.computeBonesUsingShaders&&0!==a.numBoneInfluencers)if(a.material.getEffect()===i)a.computeBonesUsingShaders=!1;else if(a.subMeshes)for(const t of a.subMeshes){if(t.effect===i){a.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&a.computeBonesUsingShaders&&a.numBoneInfluencers>0&&(a.computeBonesUsingShaders=!1)}}else{const i=this._defines[this._currentRank];if(i)for(let r=0;r<i.length;r++)t=t.replace("#define "+i[r],"");this._currentRank++}return t}}var Z=r(3525),Q=r(1206);const $=new RegExp("^([gimus]+)!");class MaterialPluginManager{"constructor"(t){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=t,this._scene=t.getScene(),this._engine=this._scene.getEngine()}"_addPlugin"(t){for(let i=0;i<this._plugins.length;++i)if(this._plugins[i].name===t.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!t.isCompatible(this._material.shaderLanguage))throw`The plugin "${t.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const i=t.getClassName();MaterialPluginManager._MaterialPluginClassToMainDefine[i]||(MaterialPluginManager._MaterialPluginClassToMainDefine[i]="MATERIALPLUGIN_"+ ++MaterialPluginManager._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(t,i)=>this._handlePluginEvent(t,i),this._plugins.push(t),this._plugins.sort((t,i)=>t.priority-i.priority),this._codeInjectionPoints={};const r={};r[MaterialPluginManager._MaterialPluginClassToMainDefine[i]]={"type":"boolean","default":!0};for(const t of this._plugins)t.collectDefines(r),this._collectPointNames("vertex",t.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",t.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=r,!0}"_activatePlugin"(t){-1===this._activePlugins.indexOf(t)&&(this._activePlugins.push(t),this._activePlugins.sort((t,i)=>t.priority-i.priority),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),t.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(t),this._activePluginsForExtraEvents.sort((t,i)=>t.priority-i.priority),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}"getPlugin"(t){for(let i=0;i<this._plugins.length;++i)if(this._plugins[i].name===t)return this._plugins[i];return null}"_handlePluginEventIsReadyForSubMesh"(t){let i=!0;for(const r of this._activePlugins)i=i&&r.isReadyForSubMesh(t.defines,this._scene,this._engine,t.subMesh);t.isReadyForSubMesh=i}"_handlePluginEventPrepareDefinesBeforeAttributes"(t){for(const i of this._activePlugins)i.prepareDefinesBeforeAttributes(t.defines,this._scene,t.mesh)}"_handlePluginEventPrepareDefines"(t){for(const i of this._activePlugins)i.prepareDefines(t.defines,this._scene,t.mesh)}"_handlePluginEventHardBindForSubMesh"(t){for(const i of this._activePluginsForExtraEvents)i.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,t.subMesh)}"_handlePluginEventBindForSubMesh"(t){for(const i of this._activePlugins)i.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,t.subMesh)}"_handlePluginEventHasRenderTargetTextures"(t){let i=!1;for(const t of this._activePluginsForExtraEvents)if(i=t.hasRenderTargetTextures(),i)break;t.hasRenderTargetTextures=i}"_handlePluginEventFillRenderTargetTextures"(t){for(const i of this._activePluginsForExtraEvents)i.fillRenderTargetTextures(t.renderTargets)}"_handlePluginEvent"(t,i){switch(t){case 512:{const t=i;for(const i of this._activePlugins)i.getActiveTextures(t.activeTextures);break}case 256:{const t=i;for(const i of this._activePlugins)i.getAnimatables(t.animatables);break}case 1024:{const t=i;let r=!1;for(const i of this._activePlugins)if(r=i.hasTexture(t.texture),r)break;t.hasTexture=r;break}case 2:{const t=i;for(const i of this._plugins)i.dispose(t.forceDisposeTextures);break}case 4:i.defineNames=this._defineNamesFromPlugins;break;case 128:{const t=i;for(const i of this._activePlugins)t.fallbackRank=i.addFallbacks(t.defines,t.fallbacks,t.fallbackRank),i.getAttributes(t.attributes,this._scene,t.mesh);this._uniformList.length>0&&t.uniforms.push(...this._uniformList),this._samplerList.length>0&&t.samplers.push(...this._samplerList),this._uboList.length>0&&t.uniformBuffersNames.push(...this._uboList),t.customCode=this._injectCustomCode(t,t.customCode);break}case 8:{const t=i;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const r=1===this._material.shaderLanguage;for(const i of this._plugins){const a=i.getUniforms(this._material.shaderLanguage);if(a){if(a.ubo)for(const i of a.ubo){if(i.size&&i.type){const a=i.arraySize??0;if(t.ubo.addUniform(i.name,i.size,a),r){let t;switch(i.type){case"mat4":t="mat4x4f";break;case"float":t="f32";break;default:t=`${i.type}f`}this._uboDeclaration+=`uniform ${i.name}: ${t}${a>0?`[${a}]`:""};\n`}else this._uboDeclaration+=`${i.type} ${i.name}${a>0?`[${a}]`:""};\n`}this._uniformList.push(i.name)}a.vertex&&(this._vertexDeclaration+=a.vertex+"\n"),a.fragment&&(this._fragmentDeclaration+=a.fragment+"\n")}i.getSamplers(this._samplerList),i.getUniformBuffersNames(this._uboList)}break}}}"_collectPointNames"(t,i){if(i)for(const r in i)this._codeInjectionPoints[t]||(this._codeInjectionPoints[t]={}),this._codeInjectionPoints[t][r]=!0}"_injectCustomCode"(t,i){return(r,a)=>{i&&(a=i(r,a)),this._uboDeclaration&&(a=a.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(a=a.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(a=a.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const o=this._codeInjectionPoints?.[r];if(!o)return a;let h=null;for(let i in o){let o="";for(const a of this._activePlugins){let l=a.getCustomCode(r,this._material.shaderLanguage)?.[i];if(l){if(a.resolveIncludes){if(null===h){const i=0;h={"defines":[],"indexParameters":t.indexParameters,"isFragment":!1,"shouldUseHighPrecisionShader":this._engine._shouldUseHighPrecisionShader,"processor":void 0,"supportsUniformBuffers":this._engine.supportsUniformBuffers,"shadersRepository":Q.v.GetShadersRepository(i),"includesShadersStore":Q.v.GetIncludesShadersStore(i),"version":void 0,"platformName":this._engine.shaderPlatformName,"processingContext":void 0,"isNDCHalfZRange":this._engine.isNDCHalfZRange,"useReverseDepthBuffer":this._engine.useReverseDepthBuffer,"processCodeAfterIncludes":void 0}}h.isFragment="fragment"===r,(0,Z.xd)(l,h,t=>l=t)}o+=l+"\n"}}if(o.length>0)if("!"===i.charAt(0)){i=i.substring(1);let t="g";if("!"===i.charAt(0))t="",i=i.substring(1);else{const r=$.exec(i);r&&r.length>=2&&(t=r[1],i=i.substring(t.length+1))}t.indexOf("g")<0&&(t+="g");const r=a,h=new RegExp(i,t);let l=h.exec(r);for(;null!==l;){let t=o;for(let i=0;i<l.length;++i)t=t.replace("$"+i,l[i]);a=a.replace(l[0],t),l=h.exec(r)}}else{const t="#define "+i;a=a.replace(t,"\n"+o+"\n"+t)}}return a}}}MaterialPluginManager._MaterialPluginClassToMainDefine={},MaterialPluginManager._MaterialPluginCounter=0,E.l.OnEnginesDisposedObservable.add(()=>{UnregisterAllMaterialPlugins()});const J=[];let ee=!1,te=null;function UnregisterAllMaterialPlugins(){J.length=0,ee=!1,material_Material.OnEventObservable.remove(te),te=null}class MaterialPluginBase{"isCompatible"(t){return 0===t}"_enable"(t){t&&this._pluginManager._activatePlugin(this)}"constructor"(t,i,r,a,o=!0,h=!1,l=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=t,this.name=i,this.priority=r,this.resolveIncludes=l,t.pluginManager||(t.pluginManager=new MaterialPluginManager(t),t.onDisposeObservable.add(()=>{t.pluginManager=void 0})),this._pluginDefineNames=a,this._pluginManager=t.pluginManager,o&&this._pluginManager._addPlugin(this),h&&this._enable(!0),this.markAllDefinesAsDirty=t._dirtyCallbacks[127]}"getClassName"(){return"MaterialPluginBase"}"isReadyForSubMesh"(t,i,r,a){return!0}"hardBindForSubMesh"(t,i,r,a){}"bindForSubMesh"(t,i,r,a){}"dispose"(t){}"getCustomCode"(t,i=0){return null}"collectDefines"(t){if(this._pluginDefineNames)for(const i of Object.keys(this._pluginDefineNames)){if("_"===i[0])continue;const r=typeof this._pluginDefineNames[i];t[i]={"type":"number"===r?"number":"string"===r?"string":"boolean"===r?"boolean":"object","default":this._pluginDefineNames[i]}}}"prepareDefinesBeforeAttributes"(t,i,r){}"prepareDefines"(t,i,r){}"hasTexture"(t){return!1}"hasRenderTargetTextures"(){return!1}"fillRenderTargetTextures"(t){}"getActiveTextures"(t){}"getAnimatables"(t){}"addFallbacks"(t,i,r){return r}"getSamplers"(t){}"getAttributes"(t,i,r){}"getUniformBuffersNames"(t){}"getUniforms"(t=0){return{}}"copyTo"(t){A.p.Clone(()=>t,this)}"serialize"(){return A.p.Serialize(this)}"parse"(t,i,r){A.p.Parse(()=>this,t,i,r)}}(0,m.gn)([(0,T.qC)()],MaterialPluginBase.prototype,"name",void 0),(0,m.gn)([(0,T.qC)()],MaterialPluginBase.prototype,"priority",void 0),(0,m.gn)([(0,T.qC)()],MaterialPluginBase.prototype,"resolveIncludes",void 0),(0,m.gn)([(0,T.qC)()],MaterialPluginBase.prototype,"registerForExtraEvents",void 0),(0,v.H7)("BABYLON.MaterialPluginBase",MaterialPluginBase);class MaterialDetailMapDefines extends MaterialDefines{"constructor"(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class DetailMapConfiguration extends MaterialPluginBase{"_markAllSubMeshesAsTexturesDirty"(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}"isCompatible"(){return!0}"constructor"(t,i=!0){super(t,"DetailMap",140,new MaterialDetailMapDefines,i),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=material_Material.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}"isReadyForSubMesh"(t,i,r){return!this._isEnabled||!(t._areTexturesDirty&&i.texturesEnabled&&r.getCaps().standardDerivatives&&this._texture&&MaterialFlags.DetailTextureEnabled&&!this._texture.isReady())}"prepareDefines"(t,i){if(this._isEnabled){t.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const r=i.getEngine();t._areTexturesDirty&&(r.getCaps().standardDerivatives&&this._texture&&MaterialFlags.DetailTextureEnabled&&this._isEnabled?(PrepareDefinesForMergedUV(this._texture,t,"DETAIL"),t.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):t.DETAIL=!1)}else t.DETAIL=!1}"bindForSubMesh"(t,i){if(!this._isEnabled)return;const r=this._material.isFrozen;t.useUbo&&r&&t.isSync||this._texture&&MaterialFlags.DetailTextureEnabled&&(t.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),BindTextureMatrix(this._texture,t,"detail")),i.texturesEnabled&&this._texture&&MaterialFlags.DetailTextureEnabled&&t.setTexture("detailSampler",this._texture)}"hasTexture"(t){return this._texture===t}"getActiveTextures"(t){this._texture&&t.push(this._texture)}"getAnimatables"(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture)}"dispose"(t){t&&this._texture?.dispose()}"getClassName"(){return"DetailMapConfiguration"}"getSamplers"(t){t.push("detailSampler")}"getUniforms"(){return{"ubo":[{"name":"vDetailInfos","size":4,"type":"vec4"},{"name":"detailMatrix","size":16,"type":"mat4"}]}}}var ie;(0,m.gn)([(0,T.oU)("detailTexture"),(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"texture",void 0),(0,m.gn)([(0,T.qC)()],DetailMapConfiguration.prototype,"diffuseBlendLevel",void 0),(0,m.gn)([(0,T.qC)()],DetailMapConfiguration.prototype,"roughnessBlendLevel",void 0),(0,m.gn)([(0,T.qC)()],DetailMapConfiguration.prototype,"bumpLevel",void 0),(0,m.gn)([(0,T.qC)(),(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"normalBlendMethod",void 0),(0,m.gn)([(0,T.qC)(),(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"isEnabled",void 0),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.MaxViewZ=2]="MaxViewZ"}(ie||(ie={}));class MaterialHelperGeometryRendering{static"CreateConfiguration"(t){return MaterialHelperGeometryRendering._Configurations[t]={"defines":{},"previousWorldMatrices":{},"previousViewProjection":x.y3.Zero(),"currentViewProjection":x.y3.Zero(),"previousBones":{},"lastUpdateFrameId":-1,"excludedSkinnedMesh":[],"reverseCulling":!1},MaterialHelperGeometryRendering._Configurations[t]}static"DeleteConfiguration"(t){delete MaterialHelperGeometryRendering._Configurations[t]}static"GetConfiguration"(t){return MaterialHelperGeometryRendering._Configurations[t]}static"AddUniformsAndSamplers"(t,i){t.push("previousWorld","previousViewProjection","mPreviousBones")}static"MarkAsDirty"(t,i){for(const r of i)if(r.subMeshes)for(const i of r.subMeshes)i._removeDrawWrapper(t)}static"PrepareDefines"(t,i,r){if(!r._arePrePassDirty)return;const a=MaterialHelperGeometryRendering._Configurations[t];if(!a)return;r.PREPASS=!0,r.PREPASS_COLOR=!1,r.PREPASS_COLOR_INDEX=-1;let o=0;for(let t=0;t<MaterialHelperGeometryRendering.GeometryTextureDescriptions.length;t++){const i=MaterialHelperGeometryRendering.GeometryTextureDescriptions[t],h=i.define,l=i.defineIndex,c=a.defines[l];void 0!==c?(r[h]=!0,r[l]=c,o++):(r[h]=!1,delete r[l])}r.SCENE_MRT_COUNT=o,r.BONES_VELOCITY_ENABLED=i.useBones&&i.computeBonesUsingShaders&&i.skeleton&&!i.skeleton.isUsingTextureForMatrices&&-1===a.excludedSkinnedMesh.indexOf(i)}static"Bind"(t,i,r,a,o){const h=MaterialHelperGeometryRendering._Configurations[t];if(!h)return;const l=r.getScene(),c=l.getEngine();if(h.reverseCulling&&c.setStateCullFaceType(l._mirroredCameraPosition?o.cullBackFaces:!o.cullBackFaces),(void 0!==h.defines.PREPASS_VELOCITY_INDEX||void 0!==h.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(h.previousWorldMatrices[r.uniqueId]||(h.previousWorldMatrices[r.uniqueId]=a.clone()),h.previousViewProjection||(h.previousViewProjection=l.getTransformMatrix().clone(),h.currentViewProjection=l.getTransformMatrix().clone()),h.currentViewProjection.updateFlag!==l.getTransformMatrix().updateFlag?(h.lastUpdateFrameId=c.frameId,h.previousViewProjection.copyFrom(h.currentViewProjection),h.currentViewProjection.copyFrom(l.getTransformMatrix())):h.lastUpdateFrameId!==c.frameId&&(h.lastUpdateFrameId=c.frameId,h.previousViewProjection.copyFrom(h.currentViewProjection)),i.setMatrix("previousWorld",h.previousWorldMatrices[r.uniqueId]),i.setMatrix("previousViewProjection",h.previousViewProjection),h.previousWorldMatrices[r.uniqueId]=a.clone(),r.useBones&&r.computeBonesUsingShaders&&r.skeleton)){const t=r.skeleton;if(!t.isUsingTextureForMatrices||-1===i.getUniformIndex("boneTextureWidth")){const a=t.getTransformMatrices(r);a&&(h.previousBones[r.uniqueId]||(h.previousBones[r.uniqueId]=a.slice()),i.setMatrices("mPreviousBones",h.previousBones[r.uniqueId]),h.previousBones[r.uniqueId].set(a))}}}}MaterialHelperGeometryRendering.GeometryTextureDescriptions=[{"type":0,"name":"Irradiance","clearType":0,"define":"PREPASS_IRRADIANCE","defineIndex":"PREPASS_IRRADIANCE_INDEX"},{"type":1,"name":"WorldPosition","clearType":0,"define":"PREPASS_POSITION","defineIndex":"PREPASS_POSITION_INDEX"},{"type":2,"name":"Velocity","clearType":0,"define":"PREPASS_VELOCITY","defineIndex":"PREPASS_VELOCITY_INDEX"},{"type":3,"name":"Reflectivity","clearType":0,"define":"PREPASS_REFLECTIVITY","defineIndex":"PREPASS_REFLECTIVITY_INDEX"},{"type":5,"name":"ViewDepth","clearType":2,"define":"PREPASS_DEPTH","defineIndex":"PREPASS_DEPTH_INDEX"},{"type":6,"name":"ViewNormal","clearType":0,"define":"PREPASS_NORMAL","defineIndex":"PREPASS_NORMAL_INDEX"},{"type":7,"name":"AlbedoSqrt","clearType":0,"define":"PREPASS_ALBEDO_SQRT","defineIndex":"PREPASS_ALBEDO_SQRT_INDEX"},{"type":8,"name":"WorldNormal","clearType":0,"define":"PREPASS_WORLD_NORMAL","defineIndex":"PREPASS_WORLD_NORMAL_INDEX"},{"type":9,"name":"LocalPosition","clearType":0,"define":"PREPASS_LOCAL_POSITION","defineIndex":"PREPASS_LOCAL_POSITION_INDEX"},{"type":10,"name":"ScreenDepth","clearType":1,"define":"PREPASS_SCREENSPACE_DEPTH","defineIndex":"PREPASS_SCREENSPACE_DEPTH_INDEX"},{"type":11,"name":"LinearVelocity","clearType":0,"define":"PREPASS_VELOCITY_LINEAR","defineIndex":"PREPASS_VELOCITY_LINEAR_INDEX"},{"type":12,"name":"Albedo","clearType":0,"define":"PREPASS_ALBEDO","defineIndex":"PREPASS_ALBEDO_INDEX"}],MaterialHelperGeometryRendering._Configurations={};const re={"effect":null,"subMesh":null};class StandardMaterialDefines extends MaterialDefines{"constructor"(t){super(t),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}"setReflectionMode"(t){const i=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const r of i)this[r]=r===t}}class StandardMaterial extends PushMaterial{get"imageProcessingConfiguration"(){return this._imageProcessingConfiguration}set"imageProcessingConfiguration"(t){this._attachImageProcessingConfiguration(t),this._markAllSubMeshesAsTexturesDirty()}"_attachImageProcessingConfiguration"(t){t!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=t||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(()=>{this._markAllSubMeshesAsImageProcessingDirty()})))}get"isPrePassCapable"(){return!this.disableDepthWrite}get"cameraColorCurvesEnabled"(){return this.imageProcessingConfiguration.colorCurvesEnabled}set"cameraColorCurvesEnabled"(t){this.imageProcessingConfiguration.colorCurvesEnabled=t}get"cameraColorGradingEnabled"(){return this.imageProcessingConfiguration.colorGradingEnabled}set"cameraColorGradingEnabled"(t){this.imageProcessingConfiguration.colorGradingEnabled=t}get"cameraToneMappingEnabled"(){return this._imageProcessingConfiguration.toneMappingEnabled}set"cameraToneMappingEnabled"(t){this._imageProcessingConfiguration.toneMappingEnabled=t}get"cameraExposure"(){return this._imageProcessingConfiguration.exposure}set"cameraExposure"(t){this._imageProcessingConfiguration.exposure=t}get"cameraContrast"(){return this._imageProcessingConfiguration.contrast}set"cameraContrast"(t){this._imageProcessingConfiguration.contrast=t}get"cameraColorGradingTexture"(){return this._imageProcessingConfiguration.colorGradingTexture}set"cameraColorGradingTexture"(t){this._imageProcessingConfiguration.colorGradingTexture=t}get"cameraColorCurves"(){return this._imageProcessingConfiguration.colorCurves}set"cameraColorCurves"(t){this._imageProcessingConfiguration.colorCurves=t}get"canRenderToMRT"(){return!0}"constructor"(t,i,r=!1){super(t,i,void 0,r||StandardMaterial.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new V.Wo(0,0,0),this.diffuseColor=new V.Wo(1,1,1),this.specularColor=new V.Wo(1,1,1),this.emissiveColor=new V.Wo(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new y.t(16),this._globalAmbientColor=new V.Wo(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new DetailMapConfiguration(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new PrePassConfiguration,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),StandardMaterial.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),StandardMaterial.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get"hasRenderTargetTextures"(){return!!(StandardMaterial.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(StandardMaterial.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}"getClassName"(){return"StandardMaterial"}"needAlphaBlending"(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}"needAlphaTesting"(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===material_Material.MATERIAL_ALPHATEST)}"_shouldUseAlphaFromDiffuseTexture"(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==material_Material.MATERIAL_OPAQUE}"_hasAlphaChannel"(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}"getAlphaTestTexture"(){return this._diffuseTexture}"isReadyForSubMesh"(t,i,a=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const o=i._drawWrapper;if(o.effect&&this.isFrozen&&o._wasPreviouslyReady&&o._wasPreviouslyUsingInstances===a)return!0;i.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),i.materialDefines=new StandardMaterialDefines(this._eventInfo.defineNames));const h=this.getScene(),l=i.materialDefines;if(this._isReadyForSubMesh(i))return!0;const c=h.getEngine();l._needNormals=function PrepareDefinesForLights(t,i,r,a,o=4,h=!1){if(!r._areLightsDirty)return r._needNormals;let l=0;const c={"needNormals":r._needNormals,"needRebuild":!1,"lightmapMode":!1,"shadowEnabled":!1,"specularEnabled":!1};if(t.lightsEnabled&&!h)for(const h of i.lightSources)if(PrepareDefinesForLight(t,i,h,l,r,a,c),l++,l===o)break;r.SPECULARTERM=c.specularEnabled,r.SHADOWS=c.shadowEnabled;for(let t=l;t<o;t++)void 0!==r["LIGHT"+t]&&(r["LIGHT"+t]=!1,r["HEMILIGHT"+t]=!1,r["POINTLIGHT"+t]=!1,r["DIRLIGHT"+t]=!1,r["SPOTLIGHT"+t]=!1,r["AREALIGHT"+t]=!1,r["SHADOW"+t]=!1,r["SHADOWCSM"+t]=!1,r["SHADOWCSMDEBUG"+t]=!1,r["SHADOWCSMNUM_CASCADES"+t]=!1,r["SHADOWCSMUSESHADOWMAXZ"+t]=!1,r["SHADOWCSMNOBLEND"+t]=!1,r["SHADOWCSM_RIGHTHANDED"+t]=!1,r["SHADOWPCF"+t]=!1,r["SHADOWPCSS"+t]=!1,r["SHADOWPOISSON"+t]=!1,r["SHADOWESM"+t]=!1,r["SHADOWCLOSEESM"+t]=!1,r["SHADOWCUBE"+t]=!1,r["SHADOWLOWQUALITY"+t]=!1,r["SHADOWMEDIUMQUALITY"+t]=!1);const u=t.getEngine().getCaps();return void 0===r.SHADOWFLOAT&&(c.needRebuild=!0),r.SHADOWFLOAT=c.shadowEnabled&&(u.textureFloatRender&&u.textureFloatLinearFiltering||u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=c.lightmapMode,c.needRebuild&&r.rebuild(),c.needNormals}(h,t,l,!0,this._maxSimultaneousLights,this._disableLighting),function PrepareDefinesForMultiview(t,i){if(t.activeCamera){const r=i.MULTIVIEW;i.MULTIVIEW=null!==t.activeCamera.outputRenderTarget&&t.activeCamera.outputRenderTarget.getViewCount()>1,i.MULTIVIEW!=r&&i.markAsUnprocessed()}}(h,l);const u=this.needAlphaBlendingForMesh(t)&&this.getScene().useOrderIndependentTransparency;if(function PrepareDefinesForPrePass(t,i,r){const a=i.PREPASS;if(!i._arePrePassDirty)return;const o=[{"type":1,"define":"PREPASS_POSITION","index":"PREPASS_POSITION_INDEX"},{"type":9,"define":"PREPASS_LOCAL_POSITION","index":"PREPASS_LOCAL_POSITION_INDEX"},{"type":2,"define":"PREPASS_VELOCITY","index":"PREPASS_VELOCITY_INDEX"},{"type":11,"define":"PREPASS_VELOCITY_LINEAR","index":"PREPASS_VELOCITY_LINEAR_INDEX"},{"type":3,"define":"PREPASS_REFLECTIVITY","index":"PREPASS_REFLECTIVITY_INDEX"},{"type":0,"define":"PREPASS_IRRADIANCE","index":"PREPASS_IRRADIANCE_INDEX"},{"type":7,"define":"PREPASS_ALBEDO_SQRT","index":"PREPASS_ALBEDO_SQRT_INDEX"},{"type":5,"define":"PREPASS_DEPTH","index":"PREPASS_DEPTH_INDEX"},{"type":10,"define":"PREPASS_SCREENSPACE_DEPTH","index":"PREPASS_SCREENSPACE_DEPTH_INDEX"},{"type":6,"define":"PREPASS_NORMAL","index":"PREPASS_NORMAL_INDEX"},{"type":8,"define":"PREPASS_WORLD_NORMAL","index":"PREPASS_WORLD_NORMAL_INDEX"}];if(t.prePassRenderer&&t.prePassRenderer.enabled&&r){i.PREPASS=!0,i.SCENE_MRT_COUNT=t.prePassRenderer.mrtCount,i.PREPASS_NORMAL_WORLDSPACE=t.prePassRenderer.generateNormalsInWorldSpace,i.PREPASS_COLOR=!0,i.PREPASS_COLOR_INDEX=0;for(let r=0;r<o.length;r++){const a=t.prePassRenderer.getIndex(o[r].type);-1!==a?(i[o[r].define]=!0,i[o[r].index]=a):i[o[r].define]=!1}}else{i.PREPASS=!1;for(let t=0;t<o.length;t++)i[o[t].define]=!1}i.PREPASS!=a&&(i.markAsUnprocessed(),i.markAsImageProcessingDirty())}(h,l,this.canRenderToMRT&&!u),function PrepareDefinesForOIT(t,i,r){const a=i.ORDER_INDEPENDENT_TRANSPARENCY,o=i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;i.ORDER_INDEPENDENT_TRANSPARENCY=t.useOrderIndependentTransparency&&r,i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!t.getEngine().getCaps().textureFloatLinearFiltering,a===i.ORDER_INDEPENDENT_TRANSPARENCY&&o===i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||i.markAsUnprocessed()}(h,l,u),MaterialHelperGeometryRendering.PrepareDefines(c.currentRenderPassId,t,l),l._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,l._needUVs=!1;for(let t=1;t<=6;++t)l["MAINUV"+t]=!1;if(h.texturesEnabled){if(l.DIFFUSEDIRECTUV=0,l.BUMPDIRECTUV=0,l.AMBIENTDIRECTUV=0,l.OPACITYDIRECTUV=0,l.EMISSIVEDIRECTUV=0,l.SPECULARDIRECTUV=0,l.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._diffuseTexture,l,"DIFFUSE")}else l.DIFFUSE=!1;if(this._ambientTexture&&StandardMaterial.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._ambientTexture,l,"AMBIENT")}else l.AMBIENT=!1;if(this._opacityTexture&&StandardMaterial.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._opacityTexture,l,"OPACITY"),l.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else l.OPACITY=!1;if(this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(l._needNormals=!0,l.REFLECTION=!0,l.ROUGHNESS=this._roughness>0,l.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,l.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===j.x.INVCUBIC_MODE,l.REFLECTIONMAP_3D=this._reflectionTexture.isCube,l.REFLECTIONMAP_OPPOSITEZ=l.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,l.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case j.x.EXPLICIT_MODE:l.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case j.x.PLANAR_MODE:l.setReflectionMode("REFLECTIONMAP_PLANAR");break;case j.x.PROJECTION_MODE:l.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case j.x.SKYBOX_MODE:l.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case j.x.SPHERICAL_MODE:l.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case j.x.EQUIRECTANGULAR_MODE:l.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case j.x.FIXED_EQUIRECTANGULAR_MODE:l.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case j.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:l.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case j.x.CUBIC_MODE:case j.x.INVCUBIC_MODE:default:l.setReflectionMode("REFLECTIONMAP_CUBIC")}l.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else l.REFLECTION=!1,l.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._emissiveTexture,l,"EMISSIVE")}else l.EMISSIVE=!1;if(this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._lightmapTexture,l,"LIGHTMAP"),l.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,l.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else l.LIGHTMAP=!1;if(this._specularTexture&&StandardMaterial.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._specularTexture,l,"SPECULAR"),l.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else l.SPECULAR=!1;if(h.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&StandardMaterial.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;PrepareDefinesForMergedUV(this._bumpTexture,l,"BUMP"),l.PARALLAX=this._useParallax,l.PARALLAX_RHS=h.useRightHandedSystem,l.PARALLAXOCCLUSION=this._useParallaxOcclusion,l.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else l.BUMP=!1,l.PARALLAX=!1,l.PARALLAX_RHS=!1,l.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&StandardMaterial.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;l._needUVs=!0,l.REFRACTION=!0,l.REFRACTIONMAP_3D=this._refractionTexture.isCube,l.RGBDREFRACTION=this._refractionTexture.isRGBD,l.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else l.REFRACTION=!1;l.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else l.DIFFUSE=!1,l.AMBIENT=!1,l.OPACITY=!1,l.REFLECTION=!1,l.EMISSIVE=!1,l.LIGHTMAP=!1,l.BUMP=!1,l.REFRACTION=!1;l.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),l.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,l.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,l.SPECULAROVERALPHA=this._useSpecularOverAlpha,l.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,l.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,l.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(t)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=l,this._eventInfo.subMesh=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(l._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(l),l.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,l.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(l._areFresnelDirty&&(StandardMaterial.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(l.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,l.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,l.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,l.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,l.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,l.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,l._needNormals=!0,l.FRESNEL=!0):l.FRESNEL=!1),l.AREALIGHTUSED)for(let i=0;i<t.lightSources.length;i++)if(!t.lightSources[i]._isReady())return!1;!function PrepareDefinesForMisc(t,i,r,a,o,h,l,c=!1){l._areMiscDirty&&(l.LOGARITHMICDEPTH=r,l.POINTSIZE=a,l.FOG=o&&function GetFogState(t,i){return i.fogEnabled&&t.applyFog&&0!==i.fogMode}(t,i),l.NONUNIFORMSCALING=t.nonUniformScaling,l.ALPHATEST=h,l.DECAL_AFTER_DETAIL=c)}(t,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(t),l,this._applyDecalMapAfterDetailMap),function PrepareDefinesForFrameBoundValues(t,i,r,a,o,h=null,l=!1){let c=function PrepareDefinesForCamera(t,i){let r=!1;if(t.activeCamera){const a=i.CAMERA_ORTHOGRAPHIC?1:0,o=i.CAMERA_PERSPECTIVE?1:0,h=1===t.activeCamera.mode?1:0,l=0===t.activeCamera.mode?1:0;(a^h||o^l)&&(i.CAMERA_ORTHOGRAPHIC=1===h,i.CAMERA_PERSPECTIVE=1===l,r=!0)}return r}(t,a);!1!==h&&(c=function prepareDefinesForClipPlanes(t,i,r){let a=!1;const o=!!(t.clipPlane??i.clipPlane),h=!!(t.clipPlane2??i.clipPlane2),l=!!(t.clipPlane3??i.clipPlane3),c=!!(t.clipPlane4??i.clipPlane4),u=!!(t.clipPlane5??i.clipPlane5),d=!!(t.clipPlane6??i.clipPlane6);return r.CLIPPLANE!==o&&(r.CLIPPLANE=o,a=!0),r.CLIPPLANE2!==h&&(r.CLIPPLANE2=h,a=!0),r.CLIPPLANE3!==l&&(r.CLIPPLANE3=l,a=!0),r.CLIPPLANE4!==c&&(r.CLIPPLANE4=c,a=!0),r.CLIPPLANE5!==u&&(r.CLIPPLANE5=u,a=!0),r.CLIPPLANE6!==d&&(r.CLIPPLANE6=d,a=!0),a}(r,t,a)),a.DEPTHPREPASS!==!i.getColorWrite()&&(a.DEPTHPREPASS=!a.DEPTHPREPASS,c=!0),a.INSTANCES!==o&&(a.INSTANCES=o,c=!0),a.THIN_INSTANCES!==l&&(a.THIN_INSTANCES=l,c=!0),c&&a.markAsUnprocessed()}(h,c,this,l,a,null,i.getRenderingMesh().hasThinInstances),this._eventInfo.defines=l,this._eventInfo.mesh=t,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),function PrepareDefinesForAttributes(t,i,r,a,o=!1,h=!0,l=!0){if(!i._areAttributesDirty&&i._needNormals===i._normals&&i._needUVs===i._uvs)return!1;i._normals=i._needNormals,i._uvs=i._needUVs,i.NORMAL=i._needNormals&&t.isVerticesDataPresent("normal"),i._needNormals&&t.isVerticesDataPresent("tangent")&&(i.TANGENT=!0);for(let r=1;r<=6;++r)i["UV"+r]=!!i._needUVs&&t.isVerticesDataPresent(`uv${1===r?"":r}`);if(r){const r=t.useVertexColors&&t.isVerticesDataPresent("color");i.VERTEXCOLOR=r,i.VERTEXALPHA=t.hasVertexAlpha&&r&&h}return t.isVerticesDataPresent("instanceColor")&&(t.hasInstances||t.hasThinInstances)&&(i.INSTANCESCOLOR=!0),a&&function PrepareDefinesForBones(t,i){if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){i.NUM_BONE_INFLUENCERS=t.numBoneInfluencers;const r=void 0!==i.BONETEXTURE;if(t.skeleton.isUsingTextureForMatrices&&r)i.BONETEXTURE=!0;else{i.BonesPerMesh=t.skeleton.bones.length+1,i.BONETEXTURE=!r&&void 0;const a=t.getScene().prePassRenderer;if(a&&a.enabled){const r=-1===a.excludedSkinnedMesh.indexOf(t);i.BONES_VELOCITY_ENABLED=r}}}else i.NUM_BONE_INFLUENCERS=0,i.BonesPerMesh=0,void 0!==i.BONETEXTURE&&(i.BONETEXTURE=!1)}(t,i),o&&function PrepareDefinesForMorphTargets(t,i){const r=t.morphTargetManager;r?(i.MORPHTARGETS_UV=r.supportsUVs&&i.UV1,i.MORPHTARGETS_UV2=r.supportsUV2s&&i.UV2,i.MORPHTARGETS_TANGENT=r.supportsTangents&&i.TANGENT,i.MORPHTARGETS_NORMAL=r.supportsNormals&&i.NORMAL,i.MORPHTARGETS_POSITION=r.supportsPositions,i.MORPHTARGETS_COLOR=r.supportsColors,i.MORPHTARGETTEXTURE_HASUVS=r.hasUVs,i.MORPHTARGETTEXTURE_HASUV2S=r.hasUV2s,i.MORPHTARGETTEXTURE_HASTANGENTS=r.hasTangents,i.MORPHTARGETTEXTURE_HASNORMALS=r.hasNormals,i.MORPHTARGETTEXTURE_HASPOSITIONS=r.hasPositions,i.MORPHTARGETTEXTURE_HASCOLORS=r.hasColors,i.NUM_MORPH_INFLUENCERS=r.numMaxInfluencers||r.numInfluencers,i.MORPHTARGETS=i.NUM_MORPH_INFLUENCERS>0,i.MORPHTARGETS_TEXTURE=r.isUsingTextureForTargets):(i.MORPHTARGETS_UV=!1,i.MORPHTARGETS_UV2=!1,i.MORPHTARGETS_TANGENT=!1,i.MORPHTARGETS_NORMAL=!1,i.MORPHTARGETS_POSITION=!1,i.MORPHTARGETS_COLOR=!1,i.MORPHTARGETTEXTURE_HASUVS=!1,i.MORPHTARGETTEXTURE_HASUV2S=!1,i.MORPHTARGETTEXTURE_HASTANGENTS=!1,i.MORPHTARGETTEXTURE_HASNORMALS=!1,i.MORPHTARGETTEXTURE_HASPOSITIONS=!1,i.MORPHTARGETTEXTURE_HAS_COLORS=!1,i.MORPHTARGETS=!1,i.NUM_MORPH_INFLUENCERS=0)}(t,i),l&&function PrepareDefinesForBakedVertexAnimation(t,i){const r=t.bakedVertexAnimationManager;i.BAKED_VERTEX_ANIMATION_TEXTURE=!(!r||!r.isEnabled)}(t,i),!0}(t,l,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let d=!1;if(l.isDirty){const a=l._areLightsDisposed;l.markAsProcessed();const o=new EffectFallbacks;l.REFLECTION&&o.addFallback(0,"REFLECTION"),l.SPECULAR&&o.addFallback(0,"SPECULAR"),l.BUMP&&o.addFallback(0,"BUMP"),l.PARALLAX&&o.addFallback(1,"PARALLAX"),l.PARALLAX_RHS&&o.addFallback(1,"PARALLAX_RHS"),l.PARALLAXOCCLUSION&&o.addFallback(0,"PARALLAXOCCLUSION"),l.SPECULAROVERALPHA&&o.addFallback(0,"SPECULAROVERALPHA"),l.FOG&&o.addFallback(1,"FOG"),l.POINTSIZE&&o.addFallback(0,"POINTSIZE"),l.LOGARITHMICDEPTH&&o.addFallback(0,"LOGARITHMICDEPTH"),function HandleFallbacksForShadows(t,i,r=4,a=0){let o=0;for(let h=0;h<r&&t["LIGHT"+h];h++)h>0&&(o=a+h,i.addFallback(o,"LIGHT"+h)),t.SHADOWS||(t["SHADOW"+h]&&i.addFallback(a,"SHADOW"+h),t["SHADOWPCF"+h]&&i.addFallback(a,"SHADOWPCF"+h),t["SHADOWPCSS"+h]&&i.addFallback(a,"SHADOWPCSS"+h),t["SHADOWPOISSON"+h]&&i.addFallback(a,"SHADOWPOISSON"+h),t["SHADOWESM"+h]&&i.addFallback(a,"SHADOWESM"+h),t["SHADOWCLOSEESM"+h]&&i.addFallback(a,"SHADOWCLOSEESM"+h));return o++}(l,o,this._maxSimultaneousLights),l.SPECULARTERM&&o.addFallback(0,"SPECULARTERM"),l.DIFFUSEFRESNEL&&o.addFallback(1,"DIFFUSEFRESNEL"),l.OPACITYFRESNEL&&o.addFallback(2,"OPACITYFRESNEL"),l.REFLECTIONFRESNEL&&o.addFallback(3,"REFLECTIONFRESNEL"),l.EMISSIVEFRESNEL&&o.addFallback(4,"EMISSIVEFRESNEL"),l.FRESNEL&&o.addFallback(4,"FRESNEL"),l.MULTIVIEW&&o.addFallback(0,"MULTIVIEW");const u=[G.o.PositionKind];l.NORMAL&&u.push(G.o.NormalKind),l.TANGENT&&u.push(G.o.TangentKind);for(let t=1;t<=6;++t)l["UV"+t]&&u.push(`uv${1===t?"":t}`);l.VERTEXCOLOR&&u.push(G.o.ColorKind),function PrepareAttributesForBones(t,i,r,a){r.NUM_BONE_INFLUENCERS>0&&(a.addCPUSkinningFallback(0,i),t.push("matricesIndices"),t.push("matricesWeights"),r.NUM_BONE_INFLUENCERS>4&&(t.push("matricesIndicesExtra"),t.push("matricesWeightsExtra")))}(u,t,l,o),function PrepareAttributesForInstances(t,i){(i.INSTANCES||i.THIN_INSTANCES)&&function PushAttributesForInstances(t,i=!1){t.push("world0"),t.push("world1"),t.push("world2"),t.push("world3"),i&&(t.push("previousWorld0"),t.push("previousWorld1"),t.push("previousWorld2"),t.push("previousWorld3"))}(t,!!i.PREPASS_VELOCITY),i.INSTANCESCOLOR&&t.push("instanceColor")}(u,l),PrepareAttributesForMorphTargets(u,t,l),function PrepareAttributesForBakedVertexAnimation(t,i,r){r.BAKED_VERTEX_ANIMATION_TEXTURE&&r.INSTANCES&&t.push("bakedVertexAnimationSettingsInstanced")}(u,0,l);let _="default";const g=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],p=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],m=["Material","Scene","Mesh"],T={"maxSimultaneousLights":this._maxSimultaneousLights,"maxSimultaneousMorphTargets":l.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=o,this._eventInfo.fallbackRank=0,this._eventInfo.defines=l,this._eventInfo.uniforms=g,this._eventInfo.attributes=u,this._eventInfo.samplers=p,this._eventInfo.uniformBuffersNames=m,this._eventInfo.customCode=void 0,this._eventInfo.mesh=t,this._eventInfo.indexParameters=T,this._callbackPluginEventGeneric(128,this._eventInfo),MaterialHelperGeometryRendering.AddUniformsAndSamplers(g,p),PrePassConfiguration.AddUniforms(g),PrePassConfiguration.AddSamplers(p),z.$&&(z.$.PrepareUniforms(g,l),z.$.PrepareSamplers(p,l)),function PrepareUniformsAndSamplersList(t,i,r,a=4){let o,h;if(t.uniformsNames){const l=t;o=l.uniformsNames,h=l.uniformBuffersNames,i=l.samplers,r=l.defines,a=l.maxSimultaneousLights||0}else o=t,i||(i=[]);for(let t=0;t<a&&r["LIGHT"+t];t++)PrepareUniformsAndSamplersForLight(t,o,i,r["PROJECTEDLIGHTTEXTURE"+t],h,!1,r["IESLIGHTTEXTURE"+t]);r.NUM_MORPH_INFLUENCERS&&(o.push("morphTargetInfluences"),o.push("morphTargetCount")),r.BAKED_VERTEX_ANIMATION_TEXTURE&&(o.push("bakedVertexAnimationSettings"),o.push("bakedVertexAnimationTextureSizeInverted"),o.push("bakedVertexAnimationTime"),i.push("bakedVertexAnimationTexture"))}({"uniformsNames":g,"uniformBuffersNames":m,"samplers":p,"defines":l,"maxSimultaneousLights":this._maxSimultaneousLights}),function addClipPlaneUniforms(t){-1===t.indexOf("vClipPlane")&&t.push("vClipPlane"),-1===t.indexOf("vClipPlane2")&&t.push("vClipPlane2"),-1===t.indexOf("vClipPlane3")&&t.push("vClipPlane3"),-1===t.indexOf("vClipPlane4")&&t.push("vClipPlane4"),-1===t.indexOf("vClipPlane5")&&t.push("vClipPlane5"),-1===t.indexOf("vClipPlane6")&&t.push("vClipPlane6")}(g);const y={};this.customShaderNameResolve&&(_=this.customShaderNameResolve(_,g,m,p,l,u,y));const M=l.toString(),b=i.effect;let x=h.getEngine().createEffect(_,{"attributes":u,"uniformsNames":g,"uniformBuffersNames":m,"samplers":p,"defines":M,"fallbacks":o,"onCompiled":this.onCompiled,"onError":this.onError,"indexParameters":T,"processFinalCode":y.processFinalCode,"processCodeAfterIncludes":this._eventInfo.customCode,"multiTarget":l.PREPASS,"shaderLanguage":this._shaderLanguage,"extraInitializationsAsync":this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([r.e(402).then(r.bind(r,8402)),r.e(469).then(r.bind(r,8469))]):await Promise.all([r.e(569).then(r.bind(r,1569)),r.e(374).then(r.bind(r,8374))]),this._shadersLoaded=!0}},c);if(this._eventInfo.customCode=void 0,x)if(this._onEffectCreatedObservable&&(re.effect=x,re.subMesh=i,this._onEffectCreatedObservable.notifyObservers(re)),this.allowShaderHotSwapping&&b&&!x.isReady()){if(x=b,l.markAsUnprocessed(),d=this.isFrozen,a)return l._areLightsDisposed=!0,!1}else h.resetCachedMaterial(),i.setEffect(x,l,this._materialContext)}return!(!i.effect||!i.effect.isReady())&&(l._renderId=h.getRenderId(),o._wasPreviouslyReady=!d,o._wasPreviouslyUsingInstances=a,this._checkScenePerformancePriority(),!0)}"buildUniformLayout"(){const t=this._uniformBuffer;t.addUniform("diffuseLeftColor",4),t.addUniform("diffuseRightColor",4),t.addUniform("opacityParts",4),t.addUniform("reflectionLeftColor",4),t.addUniform("reflectionRightColor",4),t.addUniform("refractionLeftColor",4),t.addUniform("refractionRightColor",4),t.addUniform("emissiveLeftColor",4),t.addUniform("emissiveRightColor",4),t.addUniform("vDiffuseInfos",2),t.addUniform("vAmbientInfos",2),t.addUniform("vOpacityInfos",2),t.addUniform("vReflectionInfos",2),t.addUniform("vReflectionPosition",3),t.addUniform("vReflectionSize",3),t.addUniform("vEmissiveInfos",2),t.addUniform("vLightmapInfos",2),t.addUniform("vSpecularInfos",2),t.addUniform("vBumpInfos",3),t.addUniform("diffuseMatrix",16),t.addUniform("ambientMatrix",16),t.addUniform("opacityMatrix",16),t.addUniform("reflectionMatrix",16),t.addUniform("emissiveMatrix",16),t.addUniform("lightmapMatrix",16),t.addUniform("specularMatrix",16),t.addUniform("bumpMatrix",16),t.addUniform("vTangentSpaceParams",2),t.addUniform("pointSize",1),t.addUniform("alphaCutOff",1),t.addUniform("refractionMatrix",16),t.addUniform("vRefractionInfos",4),t.addUniform("vRefractionPosition",3),t.addUniform("vRefractionSize",3),t.addUniform("vSpecularColor",4),t.addUniform("vEmissiveColor",3),t.addUniform("vDiffuseColor",4),t.addUniform("vAmbientColor",3),super.buildUniformLayout()}"bindForSubMesh"(t,i,r){const a=this.getScene(),o=r.materialDefines;if(!o)return;const h=r.effect;if(!h)return;this._activeEffect=h,i.getMeshUniformBuffer().bindToEffect(h,"Mesh"),i.transferToEffect(t),this._uniformBuffer.bindToEffect(h,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,i,t,this.isFrozen),MaterialHelperGeometryRendering.Bind(a.getEngine().currentRenderPassId,this._activeEffect,i,t,this),this._eventInfo.subMesh=r,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),o.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const l=this._mustRebind(a,h,r,i.visibility);!function BindBonesParameters(t,i,r){if(i&&t&&(t.computeBonesUsingShaders&&i._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){const a=t.skeleton;if(a.isUsingTextureForMatrices&&i.getUniformIndex("boneTextureWidth")>-1){const r=a.getTransformMatrixTexture(t);i.setTexture("boneSampler",r),i.setFloat("boneTextureWidth",4*(a.bones.length+1))}else{const o=a.getTransformMatrices(t);o&&(i.setMatrices("mBones",o),r&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(r.previousBones[t.uniqueId]||(r.previousBones[t.uniqueId]=o.slice()),i.setMatrices("mPreviousBones",r.previousBones[t.uniqueId]),function _CopyBonesTransformationMatrices(t,i){i.set(t)}(o,r.previousBones[t.uniqueId])))}}}(i,h);const c=this._uniformBuffer;if(l){if(this.bindViewProjection(h),!c.useUbo||!this.isFrozen||!c.isSync||r._drawWrapper._forceRebindOnNextCall){if(StandardMaterial.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(c.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),c.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&c.updateColor4("opacityParts",new V.Wo(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(c.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),c.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(c.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),c.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(c.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),c.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled&&(c.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),BindTextureMatrix(this._diffuseTexture,c,"diffuse")),this._ambientTexture&&StandardMaterial.AmbientTextureEnabled&&(c.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),BindTextureMatrix(this._ambientTexture,c,"ambient")),this._opacityTexture&&StandardMaterial.OpacityTextureEnabled&&(c.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),BindTextureMatrix(this._opacityTexture,c,"opacity")),this._hasAlphaChannel()&&c.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled){if(c.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),c.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const t=this._reflectionTexture;c.updateVector3("vReflectionPosition",t.boundingBoxPosition),c.updateVector3("vReflectionSize",t.boundingBoxSize)}}else c.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled&&(c.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),BindTextureMatrix(this._emissiveTexture,c,"emissive")),this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled&&(c.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),BindTextureMatrix(this._lightmapTexture,c,"lightmap")),this._specularTexture&&StandardMaterial.SpecularTextureEnabled&&(c.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),BindTextureMatrix(this._specularTexture,c,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&StandardMaterial.BumpTextureEnabled&&(c.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),BindTextureMatrix(this._bumpTexture,c,"bump"),a._mirroredCameraPosition?c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&StandardMaterial.RefractionTextureEnabled){let t=1;if(this._refractionTexture.isCube||(c.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(t=this._refractionTexture.depth)),c.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,t,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const t=this._refractionTexture;c.updateVector3("vRefractionPosition",t.boundingBoxPosition),c.updateVector3("vRefractionSize",t.boundingBoxSize)}}}this.pointsCloud&&c.updateFloat("pointSize",this.pointSize),c.updateColor4("vSpecularColor",this.specularColor,this.specularPower),c.updateColor3("vEmissiveColor",StandardMaterial.EmissiveTextureEnabled?this.emissiveColor:V.Wo.BlackReadOnly),c.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),c.updateColor3("vAmbientColor",this._globalAmbientColor)}a.texturesEnabled&&(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled&&h.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&StandardMaterial.AmbientTextureEnabled&&h.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&StandardMaterial.OpacityTextureEnabled&&h.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?h.setTexture("reflectionCubeSampler",this._reflectionTexture):h.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled&&h.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled&&h.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&StandardMaterial.SpecularTextureEnabled&&h.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&StandardMaterial.BumpTextureEnabled&&h.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&StandardMaterial.RefractionTextureEnabled&&(this._refractionTexture.isCube?h.setTexture("refractionCubeSampler",this._refractionTexture):h.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(i)&&this.getScene().depthPeelingRenderer.bind(h),this._eventInfo.subMesh=r,this._callbackPluginEventBindForSubMesh(this._eventInfo),function bindClipPlane(t,i,r){let a=i.clipPlane??r.clipPlane;setClipPlane(t,"vClipPlane",a),a=i.clipPlane2??r.clipPlane2,setClipPlane(t,"vClipPlane2",a),a=i.clipPlane3??r.clipPlane3,setClipPlane(t,"vClipPlane3",a),a=i.clipPlane4??r.clipPlane4,setClipPlane(t,"vClipPlane4",a),a=i.clipPlane5??r.clipPlane5,setClipPlane(t,"vClipPlane5",a),a=i.clipPlane6??r.clipPlane6,setClipPlane(t,"vClipPlane6",a)}(h,this,a),this.bindEyePosition(h)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!l&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&function BindLights(t,i,r,a,o=4){const h=Math.min(i.lightSources.length,o);for(let o=0;o<h;o++)BindLight(i.lightSources[o],o,t,r,"boolean"==typeof a?a:a.SPECULARTERM,i.receiveShadows)}(a,i,h,o,this._maxSimultaneousLights),(a.fogEnabled&&i.applyFog&&a.fogMode!==p.x.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||i.receiveShadows||o.PREPASS)&&this.bindView(h),function BindFogParameters(t,i,r,a=!1){r&&t.fogEnabled&&(!i||i.applyFog)&&0!==t.fogMode&&(r.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),a?(t.fogColor.toLinearSpaceToRef(Y,t.getEngine().useExactSrgbConversions),r.setColor3("vFogColor",Y)):r.setColor3("vFogColor",t.fogColor))}(a,i,h),o.NUM_MORPH_INFLUENCERS&&function BindMorphTargetParameters(t,i){const r=t.morphTargetManager;t&&r&&i.setFloatArray("morphTargetInfluences",r.influences)}(i,h),o.BAKED_VERTEX_ANIMATION_TEXTURE&&i.bakedVertexAnimationManager?.bind(h,o.INSTANCES),this.useLogarithmicDepth&&function BindLogDepth(t,i,r){if(!t||t.LOGARITHMICDEPTH||t.indexOf&&t.indexOf("LOGARITHMICDEPTH")>=0){const t=r.activeCamera;1===t.mode&&C.Y.Error("Logarithmic depth is not compatible with orthographic cameras!",20),i.setFloat("logarithmicDepthConstant",2/(Math.log(t.maxZ+1)/Math.LN2))}}(o,h,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(i,this._activeEffect,r),c.update()}"getAnimatables"(){const t=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&t.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&t.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&t.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&t.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&t.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&t.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&t.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&t.push(this._refractionTexture),t}"getActiveTextures"(){const t=super.getActiveTextures();return this._diffuseTexture&&t.push(this._diffuseTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._specularTexture&&t.push(this._specularTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this._refractionTexture&&t.push(this._refractionTexture),t}"hasTexture"(t){return!!super.hasTexture(t)||(this._diffuseTexture===t||(this._ambientTexture===t||(this._opacityTexture===t||(this._reflectionTexture===t||(this._emissiveTexture===t||(this._specularTexture===t||(this._bumpTexture===t||(this._lightmapTexture===t||this._refractionTexture===t))))))))}"dispose"(t,i){i&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(t,i)}"clone"(t,i=!0,r=""){const a=A.p.Clone(()=>new StandardMaterial(t,this.getScene()),this,{"cloneTexturesOnlyOnce":i});return a.name=t,a.id=t,this.stencil.copyTo(a.stencil),this._clonePlugins(a,r),a}static"Parse"(t,i,r){const a=A.p.Parse(()=>new StandardMaterial(t.name,i),t,i,r);return t.stencil&&a.stencil.parse(t.stencil,i,r),material_Material._ParsePlugins(t,a,i,r),a}static get"DiffuseTextureEnabled"(){return MaterialFlags.DiffuseTextureEnabled}static set"DiffuseTextureEnabled"(t){MaterialFlags.DiffuseTextureEnabled=t}static get"DetailTextureEnabled"(){return MaterialFlags.DetailTextureEnabled}static set"DetailTextureEnabled"(t){MaterialFlags.DetailTextureEnabled=t}static get"AmbientTextureEnabled"(){return MaterialFlags.AmbientTextureEnabled}static set"AmbientTextureEnabled"(t){MaterialFlags.AmbientTextureEnabled=t}static get"OpacityTextureEnabled"(){return MaterialFlags.OpacityTextureEnabled}static set"OpacityTextureEnabled"(t){MaterialFlags.OpacityTextureEnabled=t}static get"ReflectionTextureEnabled"(){return MaterialFlags.ReflectionTextureEnabled}static set"ReflectionTextureEnabled"(t){MaterialFlags.ReflectionTextureEnabled=t}static get"EmissiveTextureEnabled"(){return MaterialFlags.EmissiveTextureEnabled}static set"EmissiveTextureEnabled"(t){MaterialFlags.EmissiveTextureEnabled=t}static get"SpecularTextureEnabled"(){return MaterialFlags.SpecularTextureEnabled}static set"SpecularTextureEnabled"(t){MaterialFlags.SpecularTextureEnabled=t}static get"BumpTextureEnabled"(){return MaterialFlags.BumpTextureEnabled}static set"BumpTextureEnabled"(t){MaterialFlags.BumpTextureEnabled=t}static get"LightmapTextureEnabled"(){return MaterialFlags.LightmapTextureEnabled}static set"LightmapTextureEnabled"(t){MaterialFlags.LightmapTextureEnabled=t}static get"RefractionTextureEnabled"(){return MaterialFlags.RefractionTextureEnabled}static set"RefractionTextureEnabled"(t){MaterialFlags.RefractionTextureEnabled=t}static get"ColorGradingTextureEnabled"(){return MaterialFlags.ColorGradingTextureEnabled}static set"ColorGradingTextureEnabled"(t){MaterialFlags.ColorGradingTextureEnabled=t}static get"FresnelEnabled"(){return MaterialFlags.FresnelEnabled}static set"FresnelEnabled"(t){MaterialFlags.FresnelEnabled=t}}function inlineScheduler(t,i,r){try{const a=t.next();a.done?i(a):a.value?a.value.then(()=>{a.value=void 0,i(a)},r):i(a)}catch(t){r(t)}}function runCoroutine(t,i,r,a,o){const resume=()=>{let h;const onStep=t=>{t.done?r(t.value):void 0===h?h=!0:resume()};do{h=void 0,o&&o.aborted?a(new Error("Aborted")):i(t,onStep,a),void 0===h&&(h=!1)}while(h)};resume()}function runCoroutineSync(t,i){let r;return runCoroutine(t,inlineScheduler,t=>r=t,t=>{throw t},i),r}function runCoroutineAsync(t,i,r){return new Promise((a,o)=>{runCoroutine(t,i,a,o,r)})}StandardMaterial.ForceGLSL=!1,(0,m.gn)([(0,T.oU)("diffuseTexture")],StandardMaterial.prototype,"_diffuseTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"diffuseTexture",void 0),(0,m.gn)([(0,T.oU)("ambientTexture")],StandardMaterial.prototype,"_ambientTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"ambientTexture",void 0),(0,m.gn)([(0,T.oU)("opacityTexture")],StandardMaterial.prototype,"_opacityTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"opacityTexture",void 0),(0,m.gn)([(0,T.oU)("reflectionTexture")],StandardMaterial.prototype,"_reflectionTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"reflectionTexture",void 0),(0,m.gn)([(0,T.oU)("emissiveTexture")],StandardMaterial.prototype,"_emissiveTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"emissiveTexture",void 0),(0,m.gn)([(0,T.oU)("specularTexture")],StandardMaterial.prototype,"_specularTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"specularTexture",void 0),(0,m.gn)([(0,T.oU)("bumpTexture")],StandardMaterial.prototype,"_bumpTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"bumpTexture",void 0),(0,m.gn)([(0,T.oU)("lightmapTexture")],StandardMaterial.prototype,"_lightmapTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"lightmapTexture",void 0),(0,m.gn)([(0,T.oU)("refractionTexture")],StandardMaterial.prototype,"_refractionTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"refractionTexture",void 0),(0,m.gn)([(0,T.n9)("ambient")],StandardMaterial.prototype,"ambientColor",void 0),(0,m.gn)([(0,T.n9)("diffuse")],StandardMaterial.prototype,"diffuseColor",void 0),(0,m.gn)([(0,T.n9)("specular")],StandardMaterial.prototype,"specularColor",void 0),(0,m.gn)([(0,T.n9)("emissive")],StandardMaterial.prototype,"emissiveColor",void 0),(0,m.gn)([(0,T.qC)()],StandardMaterial.prototype,"specularPower",void 0),(0,m.gn)([(0,T.qC)("useAlphaFromDiffuseTexture")],StandardMaterial.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"useAlphaFromDiffuseTexture",void 0),(0,m.gn)([(0,T.qC)("useEmissiveAsIllumination")],StandardMaterial.prototype,"_useEmissiveAsIllumination",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useEmissiveAsIllumination",void 0),(0,m.gn)([(0,T.qC)("linkEmissiveWithDiffuse")],StandardMaterial.prototype,"_linkEmissiveWithDiffuse",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"linkEmissiveWithDiffuse",void 0),(0,m.gn)([(0,T.qC)("useSpecularOverAlpha")],StandardMaterial.prototype,"_useSpecularOverAlpha",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useSpecularOverAlpha",void 0),(0,m.gn)([(0,T.qC)("useReflectionOverAlpha")],StandardMaterial.prototype,"_useReflectionOverAlpha",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useReflectionOverAlpha",void 0),(0,m.gn)([(0,T.qC)("disableLighting")],StandardMaterial.prototype,"_disableLighting",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"disableLighting",void 0),(0,m.gn)([(0,T.qC)("useObjectSpaceNormalMap")],StandardMaterial.prototype,"_useObjectSpaceNormalMap",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useObjectSpaceNormalMap",void 0),(0,m.gn)([(0,T.qC)("useParallax")],StandardMaterial.prototype,"_useParallax",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallax",void 0),(0,m.gn)([(0,T.qC)("useParallaxOcclusion")],StandardMaterial.prototype,"_useParallaxOcclusion",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallaxOcclusion",void 0),(0,m.gn)([(0,T.qC)()],StandardMaterial.prototype,"parallaxScaleBias",void 0),(0,m.gn)([(0,T.qC)("roughness")],StandardMaterial.prototype,"_roughness",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"roughness",void 0),(0,m.gn)([(0,T.qC)()],StandardMaterial.prototype,"indexOfRefraction",void 0),(0,m.gn)([(0,T.qC)()],StandardMaterial.prototype,"invertRefractionY",void 0),(0,m.gn)([(0,T.qC)()],StandardMaterial.prototype,"alphaCutOff",void 0),(0,m.gn)([(0,T.qC)("useLightmapAsShadowmap")],StandardMaterial.prototype,"_useLightmapAsShadowmap",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useLightmapAsShadowmap",void 0),(0,m.gn)([(0,T.qQ)("diffuseFresnelParameters")],StandardMaterial.prototype,"_diffuseFresnelParameters",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"diffuseFresnelParameters",void 0),(0,m.gn)([(0,T.qQ)("opacityFresnelParameters")],StandardMaterial.prototype,"_opacityFresnelParameters",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsFresnelAndMiscDirty")],StandardMaterial.prototype,"opacityFresnelParameters",void 0),(0,m.gn)([(0,T.qQ)("reflectionFresnelParameters")],StandardMaterial.prototype,"_reflectionFresnelParameters",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"reflectionFresnelParameters",void 0),(0,m.gn)([(0,T.qQ)("refractionFresnelParameters")],StandardMaterial.prototype,"_refractionFresnelParameters",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"refractionFresnelParameters",void 0),(0,m.gn)([(0,T.qQ)("emissiveFresnelParameters")],StandardMaterial.prototype,"_emissiveFresnelParameters",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"emissiveFresnelParameters",void 0),(0,m.gn)([(0,T.qC)("useReflectionFresnelFromSpecular")],StandardMaterial.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"useReflectionFresnelFromSpecular",void 0),(0,m.gn)([(0,T.qC)("useGlossinessFromSpecularMapAlpha")],StandardMaterial.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,m.gn)([(0,T.qC)("maxSimultaneousLights")],StandardMaterial.prototype,"_maxSimultaneousLights",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"maxSimultaneousLights",void 0),(0,m.gn)([(0,T.qC)("invertNormalMapX")],StandardMaterial.prototype,"_invertNormalMapX",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapX",void 0),(0,m.gn)([(0,T.qC)("invertNormalMapY")],StandardMaterial.prototype,"_invertNormalMapY",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapY",void 0),(0,m.gn)([(0,T.qC)("twoSidedLighting")],StandardMaterial.prototype,"_twoSidedLighting",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"twoSidedLighting",void 0),(0,m.gn)([(0,T.qC)("applyDecalMapAfterDetailMap")],StandardMaterial.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,m.gn)([(0,T.wz)("_markAllSubMeshesAsMiscDirty")],StandardMaterial.prototype,"applyDecalMapAfterDetailMap",void 0),(0,v.H7)("BABYLON.StandardMaterial",StandardMaterial),p.x.DefaultMaterialFactory=t=>new StandardMaterial("default material",t);var se=r(9714);class VertexDataMaterialInfo{}class VertexData{"constructor"(){this.uniqueId=0,this.metadata={},this._applyTo=function makeSyncFunction(t,i){return(...r)=>runCoroutineSync(t(...r),i)}(this._applyToCoroutine.bind(this)),this.uniqueId=VertexData._UniqueIDGenerator,VertexData._UniqueIDGenerator++}"set"(t,i){switch(t.length||C.Y.Warn(`Setting vertex data kind '${i}' with an empty array`),i){case G.o.PositionKind:this.positions=t;break;case G.o.NormalKind:this.normals=t;break;case G.o.TangentKind:this.tangents=t;break;case G.o.UVKind:this.uvs=t;break;case G.o.UV2Kind:this.uvs2=t;break;case G.o.UV3Kind:this.uvs3=t;break;case G.o.UV4Kind:this.uvs4=t;break;case G.o.UV5Kind:this.uvs5=t;break;case G.o.UV6Kind:this.uvs6=t;break;case G.o.ColorKind:this.colors=t;break;case G.o.MatricesIndicesKind:this.matricesIndices=t;break;case G.o.MatricesWeightsKind:this.matricesWeights=t;break;case G.o.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case G.o.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}}"applyToMesh"(t,i){return this._applyTo(t,i,!1),this}"applyToGeometry"(t,i){return this._applyTo(t,i,!1),this}"updateMesh"(t){return this._update(t),this}"updateGeometry"(t){return this._update(t),this}*"_applyToCoroutine"(t,i=!1,r){if(this.positions&&(t.setVerticesData(G.o.PositionKind,this.positions,i),r&&(yield)),this.normals&&(t.setVerticesData(G.o.NormalKind,this.normals,i),r&&(yield)),this.tangents&&(t.setVerticesData(G.o.TangentKind,this.tangents,i),r&&(yield)),this.uvs&&(t.setVerticesData(G.o.UVKind,this.uvs,i),r&&(yield)),this.uvs2&&(t.setVerticesData(G.o.UV2Kind,this.uvs2,i),r&&(yield)),this.uvs3&&(t.setVerticesData(G.o.UV3Kind,this.uvs3,i),r&&(yield)),this.uvs4&&(t.setVerticesData(G.o.UV4Kind,this.uvs4,i),r&&(yield)),this.uvs5&&(t.setVerticesData(G.o.UV5Kind,this.uvs5,i),r&&(yield)),this.uvs6&&(t.setVerticesData(G.o.UV6Kind,this.uvs6,i),r&&(yield)),this.colors){const a=this.positions&&this.colors.length===this.positions.length?3:4;t.setVerticesData(G.o.ColorKind,this.colors,i,a),this.hasVertexAlpha&&void 0!==t.hasVertexAlpha&&(t.hasVertexAlpha=!0),r&&(yield)}if(this.matricesIndices&&(t.setVerticesData(G.o.MatricesIndicesKind,this.matricesIndices,i),r&&(yield)),this.matricesWeights&&(t.setVerticesData(G.o.MatricesWeightsKind,this.matricesWeights,i),r&&(yield)),this.matricesIndicesExtra&&(t.setVerticesData(G.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),r&&(yield)),this.matricesWeightsExtra&&(t.setVerticesData(G.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),r&&(yield)),this.indices?(t.setIndices(this.indices,null,i),r&&(yield)):t.setIndices([],null),t.subMeshes&&this.materialInfos&&this.materialInfos.length>1){const i=t;i.subMeshes=[];for(const t of this.materialInfos)new SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,i)}return this}"_update"(t,i,r){return this.positions&&t.updateVerticesData(G.o.PositionKind,this.positions,i,r),this.normals&&t.updateVerticesData(G.o.NormalKind,this.normals,i,r),this.tangents&&t.updateVerticesData(G.o.TangentKind,this.tangents,i,r),this.uvs&&t.updateVerticesData(G.o.UVKind,this.uvs,i,r),this.uvs2&&t.updateVerticesData(G.o.UV2Kind,this.uvs2,i,r),this.uvs3&&t.updateVerticesData(G.o.UV3Kind,this.uvs3,i,r),this.uvs4&&t.updateVerticesData(G.o.UV4Kind,this.uvs4,i,r),this.uvs5&&t.updateVerticesData(G.o.UV5Kind,this.uvs5,i,r),this.uvs6&&t.updateVerticesData(G.o.UV6Kind,this.uvs6,i,r),this.colors&&t.updateVerticesData(G.o.ColorKind,this.colors,i,r),this.matricesIndices&&t.updateVerticesData(G.o.MatricesIndicesKind,this.matricesIndices,i,r),this.matricesWeights&&t.updateVerticesData(G.o.MatricesWeightsKind,this.matricesWeights,i,r),this.matricesIndicesExtra&&t.updateVerticesData(G.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,r),this.matricesWeightsExtra&&t.updateVerticesData(G.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,r),this.indices&&t.setIndices(this.indices,null),this}static"_TransformVector3Coordinates"(t,i,r=0,a=t.length){const o=x.jp.Vector3[0],h=x.jp.Vector3[1];for(let l=r;l<r+a;l+=3)x.P.FromArrayToRef(t,l,o),x.P.TransformCoordinatesToRef(o,i,h),t[l]=h.x,t[l+1]=h.y,t[l+2]=h.z}static"_TransformVector3Normals"(t,i,r=0,a=t.length){const o=x.jp.Vector3[0],h=x.jp.Vector3[1];for(let l=r;l<r+a;l+=3)x.P.FromArrayToRef(t,l,o),x.P.TransformNormalToRef(o,i,h),t[l]=h.x,t[l+1]=h.y,t[l+2]=h.z}static"_TransformVector4Normals"(t,i,r=0,a=t.length){const o=x.jp.Vector4[0],h=x.jp.Vector4[1];for(let l=r;l<r+a;l+=4)x.Lt.FromArrayToRef(t,l,o),x.Lt.TransformNormalToRef(o,i,h),t[l]=h.x,t[l+1]=h.y,t[l+2]=h.z,t[l+3]=h.w}static"_FlipFaces"(t,i=0,r=t.length){for(let a=i;a<i+r;a+=3){const i=t[a+1];t[a+1]=t[a+2],t[a+2]=i}}"transform"(t){const i=t.determinant()<0;return this.positions&&VertexData._TransformVector3Coordinates(this.positions,t),this.normals&&VertexData._TransformVector3Normals(this.normals,t),this.tangents&&VertexData._TransformVector4Normals(this.tangents,t),i&&this.indices&&VertexData._FlipFaces(this.indices),this}"splitBasedOnMaterialID"(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const t=[];for(const i of this.materialInfos){const r=new VertexData;if(this.positions&&(r.positions=this.positions.slice(3*i.verticesStart,3*(i.verticesCount+i.verticesStart))),this.normals&&(r.normals=this.normals.slice(3*i.verticesStart,3*(i.verticesCount+i.verticesStart))),this.tangents&&(r.tangents=this.tangents.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.colors&&(r.colors=this.colors.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.uvs&&(r.uvs=this.uvs.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs2&&(r.uvs2=this.uvs2.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs3&&(r.uvs3=this.uvs3.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs4&&(r.uvs4=this.uvs4.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs5&&(r.uvs5=this.uvs5.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs6&&(r.uvs6=this.uvs6.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.matricesIndices&&(r.matricesIndices=this.matricesIndices.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesIndicesExtra&&(r.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesWeights&&(r.matricesWeights=this.matricesWeights.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesWeightsExtra&&(r.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.indices){r.indices=[];for(let t=i.indexStart;t<i.indexStart+i.indexCount;t++)r.indices.push(this.indices[t]-i.verticesStart)}const a=new VertexDataMaterialInfo;a.indexStart=0,a.indexCount=r.indices?r.indices.length:0,a.materialIndex=i.materialIndex,a.verticesStart=0,a.verticesCount=(r.positions?r.positions.length:0)/3,r.materialInfos=[a],t.push(r)}return t}"merge"(t,i=!1,r=!1,a=!1,o=!1){const h=Array.isArray(t)?t.map(t=>({"vertexData":t})):[{"vertexData":t}];return runCoroutineSync(this._mergeCoroutine(void 0,h,i,!1,r,a,o))}*"_mergeCoroutine"(t,i,r=!1,a,o,h=!1,l=!1){this._validate();let c=i.map(t=>t.vertexData),u=this;if(l)for(const t of c)t&&(t._validate(),!this.normals&&t.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&t.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&t.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&t.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&t.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&t.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&t.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&t.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&t.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&t.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&t.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&t.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&t.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(const t of c)if(t)if(l)this.normals&&!t.normals&&(t.normals=new Float32Array(t.positions.length)),this.tangents&&!t.tangents&&(t.tangents=new Float32Array(t.positions.length/3*4)),this.uvs&&!t.uvs&&(t.uvs=new Float32Array(t.positions.length/3*2)),this.uvs2&&!t.uvs2&&(t.uvs2=new Float32Array(t.positions.length/3*2)),this.uvs3&&!t.uvs3&&(t.uvs3=new Float32Array(t.positions.length/3*2)),this.uvs4&&!t.uvs4&&(t.uvs4=new Float32Array(t.positions.length/3*2)),this.uvs5&&!t.uvs5&&(t.uvs5=new Float32Array(t.positions.length/3*2)),this.uvs6&&!t.uvs6&&(t.uvs6=new Float32Array(t.positions.length/3*2)),this.colors&&!t.colors&&(t.colors=new Float32Array(t.positions.length/3*4),t.colors.fill(1)),this.matricesIndices&&!t.matricesIndices&&(t.matricesIndices=new Float32Array(t.positions.length/3*4)),this.matricesWeights&&!t.matricesWeights&&(t.matricesWeights=new Float32Array(t.positions.length/3*4)),this.matricesIndicesExtra&&!t.matricesIndicesExtra&&(t.matricesIndicesExtra=new Float32Array(t.positions.length/3*4)),this.matricesWeightsExtra&&!t.matricesWeightsExtra&&(t.matricesWeightsExtra=new Float32Array(t.positions.length/3*4));else if(t._validate(),!this.normals!=!t.normals||!this.tangents!=!t.tangents||!this.uvs!=!t.uvs||!this.uvs2!=!t.uvs2||!this.uvs3!=!t.uvs3||!this.uvs4!=!t.uvs4||!this.uvs5!=!t.uvs5||!this.uvs6!=!t.uvs6||!this.colors!=!t.colors||!this.matricesIndices!=!t.matricesIndices||!this.matricesWeights!=!t.matricesWeights||!this.matricesIndicesExtra!=!t.matricesIndicesExtra||!this.matricesWeightsExtra!=!t.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(h){let r=0,a=0,o=0;const h=[];let l=null;const d=[];for(const i of this.splitBasedOnMaterialID())d.push({"vertexData":i,"transform":t});for(const t of i)if(t.vertexData)for(const i of t.vertexData.splitBasedOnMaterialID())d.push({"vertexData":i,"transform":t.transform});d.sort((t,i)=>{const r=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0,a=i.vertexData.materialInfos?i.vertexData.materialInfos[0].materialIndex:0;return r>a?1:r===a?0:-1});for(const t of d){const i=t.vertexData;if(r=i.materialInfos?i.materialInfos[0].materialIndex:0,l&&l.materialIndex===r)l.indexCount+=i.indices.length,l.verticesCount+=i.positions.length/3;else{const t=new VertexDataMaterialInfo;t.materialIndex=r,t.indexStart=a,t.indexCount=i.indices.length,t.verticesStart=o,t.verticesCount=i.positions.length/3,h.push(t),l=t}a+=i.indices.length,o+=i.positions.length/3}const _=d.splice(0,1)[0];u=_.vertexData,t=_.transform,c=d.map(t=>t.vertexData),i=d,this.materialInfos=h}const d=c.reduce((t,i)=>t+(i.indices?.length??0),u.indices?.length??0);let _=o||c.some(t=>t.indices===u.indices)?u.indices?.slice():u.indices;if(d>0){let o=_?.length??0;if(_||(_=new Array(d)),_.length!==d){if(Array.isArray(_))_.length=d;else{const t=r||_ instanceof Uint32Array?new Uint32Array(d):new Uint16Array(d);t.set(_),_=t}t&&t.determinant()<0&&VertexData._FlipFaces(_,0,o)}let h=u.positions?u.positions.length/3:0;for(const{"vertexData":t,"transform":r}of i)if(t.indices){for(let i=0;i<t.indices.length;i++)_[o+i]=t.indices[i]+h;r&&r.determinant()<0&&VertexData._FlipFaces(_,o,t.indices.length),h+=t.positions.length/3,o+=t.indices.length,a&&(yield)}}return this.indices=_,this.positions=VertexData._MergeElement(G.o.PositionKind,u.positions,t,i.map(t=>[t.vertexData.positions,t.transform])),a&&(yield),u.normals&&(this.normals=VertexData._MergeElement(G.o.NormalKind,u.normals,t,i.map(t=>[t.vertexData.normals,t.transform])),a&&(yield)),u.tangents&&(this.tangents=VertexData._MergeElement(G.o.TangentKind,u.tangents,t,i.map(t=>[t.vertexData.tangents,t.transform])),a&&(yield)),u.uvs&&(this.uvs=VertexData._MergeElement(G.o.UVKind,u.uvs,t,i.map(t=>[t.vertexData.uvs,t.transform])),a&&(yield)),u.uvs2&&(this.uvs2=VertexData._MergeElement(G.o.UV2Kind,u.uvs2,t,i.map(t=>[t.vertexData.uvs2,t.transform])),a&&(yield)),u.uvs3&&(this.uvs3=VertexData._MergeElement(G.o.UV3Kind,u.uvs3,t,i.map(t=>[t.vertexData.uvs3,t.transform])),a&&(yield)),u.uvs4&&(this.uvs4=VertexData._MergeElement(G.o.UV4Kind,u.uvs4,t,i.map(t=>[t.vertexData.uvs4,t.transform])),a&&(yield)),u.uvs5&&(this.uvs5=VertexData._MergeElement(G.o.UV5Kind,u.uvs5,t,i.map(t=>[t.vertexData.uvs5,t.transform])),a&&(yield)),u.uvs6&&(this.uvs6=VertexData._MergeElement(G.o.UV6Kind,u.uvs6,t,i.map(t=>[t.vertexData.uvs6,t.transform])),a&&(yield)),u.colors&&(this.colors=VertexData._MergeElement(G.o.ColorKind,u.colors,t,i.map(t=>[t.vertexData.colors,t.transform])),(void 0!==u.hasVertexAlpha||i.some(t=>void 0!==t.vertexData.hasVertexAlpha))&&(this.hasVertexAlpha=u.hasVertexAlpha||i.some(t=>t.vertexData.hasVertexAlpha)),a&&(yield)),u.matricesIndices&&(this.matricesIndices=VertexData._MergeElement(G.o.MatricesIndicesKind,u.matricesIndices,t,i.map(t=>[t.vertexData.matricesIndices,t.transform])),a&&(yield)),u.matricesWeights&&(this.matricesWeights=VertexData._MergeElement(G.o.MatricesWeightsKind,u.matricesWeights,t,i.map(t=>[t.vertexData.matricesWeights,t.transform])),a&&(yield)),u.matricesIndicesExtra&&(this.matricesIndicesExtra=VertexData._MergeElement(G.o.MatricesIndicesExtraKind,u.matricesIndicesExtra,t,i.map(t=>[t.vertexData.matricesIndicesExtra,t.transform])),a&&(yield)),u.matricesWeightsExtra&&(this.matricesWeightsExtra=VertexData._MergeElement(G.o.MatricesWeightsExtraKind,u.matricesWeightsExtra,t,i.map(t=>[t.vertexData.matricesWeightsExtra,t.transform]))),this}static"_MergeElement"(t,i,r,a){const o=a.filter(t=>null!==t[0]&&void 0!==t[0]);if(!i&&0==o.length)return i;if(!i)return this._MergeElement(t,o[0][0],o[0][1],o.slice(1));const h=o.reduce((t,i)=>t+i[0].length,i.length),l=t===G.o.PositionKind?VertexData._TransformVector3Coordinates:t===G.o.NormalKind?VertexData._TransformVector3Normals:t===G.o.TangentKind?VertexData._TransformVector4Normals:()=>{};if(i instanceof Float32Array){const t=new Float32Array(h);t.set(i),r&&l(t,r,0,i.length);let a=i.length;for(const[i,r]of o)t.set(i,a),r&&l(t,r,a,i.length),a+=i.length;return t}{const t=new Array(h);for(let r=0;r<i.length;r++)t[r]=i[r];r&&l(t,r,0,i.length);let a=i.length;for(const[i,r]of o){for(let r=0;r<i.length;r++)t[a+r]=i[r];r&&l(t,r,a,i.length),a+=i.length}return t}}"_validate"(){if(!this.positions)throw new se.LH("Positions are required",se.SM.MeshInvalidPositionsError);const getElementCount=(t,i)=>{const r=G.o.DeduceStride(t);if(i.length%r!==0)throw new Error("The "+t+"s array count must be a multiple of "+r);return i.length/r},t=getElementCount(G.o.PositionKind,this.positions),validateElementCount=(i,r)=>{const a=getElementCount(i,r);if(a!==t)throw new Error("The "+i+"s element count ("+a+") does not match the positions count ("+t+")")};this.normals&&validateElementCount(G.o.NormalKind,this.normals),this.tangents&&validateElementCount(G.o.TangentKind,this.tangents),this.uvs&&validateElementCount(G.o.UVKind,this.uvs),this.uvs2&&validateElementCount(G.o.UV2Kind,this.uvs2),this.uvs3&&validateElementCount(G.o.UV3Kind,this.uvs3),this.uvs4&&validateElementCount(G.o.UV4Kind,this.uvs4),this.uvs5&&validateElementCount(G.o.UV5Kind,this.uvs5),this.uvs6&&validateElementCount(G.o.UV6Kind,this.uvs6),this.colors&&validateElementCount(G.o.ColorKind,this.colors),this.matricesIndices&&validateElementCount(G.o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&validateElementCount(G.o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&validateElementCount(G.o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&validateElementCount(G.o.MatricesWeightsExtraKind,this.matricesWeightsExtra)}"clone"(){const t=this.serialize();return VertexData.Parse(t)}"serialize"(){const t={};if(this.positions&&(t.positions=Array.from(this.positions)),this.normals&&(t.normals=Array.from(this.normals)),this.tangents&&(t.tangents=Array.from(this.tangents)),this.uvs&&(t.uvs=Array.from(this.uvs)),this.uvs2&&(t.uvs2=Array.from(this.uvs2)),this.uvs3&&(t.uvs3=Array.from(this.uvs3)),this.uvs4&&(t.uvs4=Array.from(this.uvs4)),this.uvs5&&(t.uvs5=Array.from(this.uvs5)),this.uvs6&&(t.uvs6=Array.from(this.uvs6)),this.colors&&(t.colors=Array.from(this.colors),t.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(t.matricesIndices=Array.from(this.matricesIndices),t.matricesIndices._isExpanded=!0),this.matricesWeights&&(t.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(t.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),t.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),t.indices=this.indices?Array.from(this.indices):[],this.materialInfos){t.materialInfos=[];for(const i of this.materialInfos){const r={"indexStart":i.indexStart,"indexCount":i.indexCount,"materialIndex":i.materialIndex,"verticesStart":i.verticesStart,"verticesCount":i.verticesCount};t.materialInfos.push(r)}}return t}static"ExtractFromMesh"(t,i,r){return VertexData._ExtractFrom(t,i,r)}static"ExtractFromGeometry"(t,i,r){return VertexData._ExtractFrom(t,i,r)}static"_ExtractFrom"(t,i,r){const a=new VertexData;if(t.isVerticesDataPresent(G.o.PositionKind)&&(a.positions=t.getVerticesData(G.o.PositionKind,i,r)),t.isVerticesDataPresent(G.o.NormalKind)&&(a.normals=t.getVerticesData(G.o.NormalKind,i,r)),t.isVerticesDataPresent(G.o.TangentKind)&&(a.tangents=t.getVerticesData(G.o.TangentKind,i,r)),t.isVerticesDataPresent(G.o.UVKind)&&(a.uvs=t.getVerticesData(G.o.UVKind,i,r)),t.isVerticesDataPresent(G.o.UV2Kind)&&(a.uvs2=t.getVerticesData(G.o.UV2Kind,i,r)),t.isVerticesDataPresent(G.o.UV3Kind)&&(a.uvs3=t.getVerticesData(G.o.UV3Kind,i,r)),t.isVerticesDataPresent(G.o.UV4Kind)&&(a.uvs4=t.getVerticesData(G.o.UV4Kind,i,r)),t.isVerticesDataPresent(G.o.UV5Kind)&&(a.uvs5=t.getVerticesData(G.o.UV5Kind,i,r)),t.isVerticesDataPresent(G.o.UV6Kind)&&(a.uvs6=t.getVerticesData(G.o.UV6Kind,i,r)),t.isVerticesDataPresent(G.o.ColorKind)){const o=t.geometry||t,h=o.getVertexBuffer(G.o.ColorKind),l=o.getVerticesData(G.o.ColorKind,i,r);if(3===h.getSize()){const t=new Float32Array(4*l.length/3);for(let i=0,r=0;i<l.length;i+=3,r+=4)t[r]=l[i],t[r+1]=l[i+1],t[r+2]=l[i+2],t[r+3]=1;a.colors=t}else{if(4!==h.getSize())throw new Error(`Unexpected number of color components: ${h.getSize()}`);a.colors=l}}return t.isVerticesDataPresent(G.o.MatricesIndicesKind)&&(a.matricesIndices=t.getVerticesData(G.o.MatricesIndicesKind,i,r)),t.isVerticesDataPresent(G.o.MatricesWeightsKind)&&(a.matricesWeights=t.getVerticesData(G.o.MatricesWeightsKind,i,r)),t.isVerticesDataPresent(G.o.MatricesIndicesExtraKind)&&(a.matricesIndicesExtra=t.getVerticesData(G.o.MatricesIndicesExtraKind,i,r)),t.isVerticesDataPresent(G.o.MatricesWeightsExtraKind)&&(a.matricesWeightsExtra=t.getVerticesData(G.o.MatricesWeightsExtraKind,i,r)),a.indices=t.getIndices(i,r),a}static"CreateRibbon"(t){throw(0,R.S)("ribbonBuilder")}static"CreateBox"(t){throw(0,R.S)("boxBuilder")}static"CreateTiledBox"(t){throw(0,R.S)("tiledBoxBuilder")}static"CreateTiledPlane"(t){throw(0,R.S)("tiledPlaneBuilder")}static"CreateSphere"(t){throw(0,R.S)("sphereBuilder")}static"CreateCylinder"(t){throw(0,R.S)("cylinderBuilder")}static"CreateTorus"(t){throw(0,R.S)("torusBuilder")}static"CreateLineSystem"(t){throw(0,R.S)("linesBuilder")}static"CreateDashedLines"(t){throw(0,R.S)("linesBuilder")}static"CreateGround"(t){throw(0,R.S)("groundBuilder")}static"CreateTiledGround"(t){throw(0,R.S)("groundBuilder")}static"CreateGroundFromHeightMap"(t){throw(0,R.S)("groundBuilder")}static"CreatePlane"(t){throw(0,R.S)("planeBuilder")}static"CreateDisc"(t){throw(0,R.S)("discBuilder")}static"CreatePolygon"(t,i,r,a,o,h,l){throw(0,R.S)("polygonBuilder")}static"CreateIcoSphere"(t){throw(0,R.S)("icoSphereBuilder")}static"CreatePolyhedron"(t){throw(0,R.S)("polyhedronBuilder")}static"CreateCapsule"(t={"orientation":x.P.Up(),"subdivisions":2,"tessellation":16,"height":1,"radius":.25,"capSubdivisions":6}){throw(0,R.S)("capsuleBuilder")}static"CreateTorusKnot"(t){throw(0,R.S)("torusKnotBuilder")}static"ComputeNormals"(t,i,r,a){let o=0,h=0,l=0,c=0,u=0,d=0,_=0,g=0,p=0,m=0,T=0,y=0,M=0,b=0,E=0,R=0,A=0,C=0,v=0,P=0,S=!1,I=!1,D=!1,O=!1,w=1,B=0,L=null;a&&(S=!!a.facetNormals,I=!!a.facetPositions,D=!!a.facetPartitioning,w=!0===a.useRightHandedSystem?-1:1,B=a.ratio||0,O=!!a.depthSort,L=a.distanceTo,O&&void 0===L&&(L=x.P.Zero()));let N=0,U=0,k=0,V=0;for(D&&a&&a.bbSize&&(N=a.subDiv.X*B/a.bbSize.x,U=a.subDiv.Y*B/a.bbSize.y,k=a.subDiv.Z*B/a.bbSize.z,V=a.subDiv.max*a.subDiv.max,a.facetPartitioning.length=0),o=0;o<t.length;o++)r[o]=0;const G=i.length/3|0;for(o=0;o<G;o++){if(y=3*i[3*o],M=y+1,b=y+2,E=3*i[3*o+1],R=E+1,A=E+2,C=3*i[3*o+2],v=C+1,P=C+2,h=t[y]-t[E],l=t[M]-t[R],c=t[b]-t[A],u=t[C]-t[E],d=t[v]-t[R],_=t[P]-t[A],g=w*(l*_-c*d),p=w*(c*u-h*_),m=w*(h*d-l*u),T=Math.sqrt(g*g+p*p+m*m),T=0===T?1:T,g/=T,p/=T,m/=T,S&&a&&(a.facetNormals[o].x=g,a.facetNormals[o].y=p,a.facetNormals[o].z=m),I&&a&&(a.facetPositions[o].x=(t[y]+t[E]+t[C])/3,a.facetPositions[o].y=(t[M]+t[R]+t[v])/3,a.facetPositions[o].z=(t[b]+t[A]+t[P])/3),D&&a){const i=Math.floor((a.facetPositions[o].x-a.bInfo.minimum.x*B)*N),r=Math.floor((a.facetPositions[o].y-a.bInfo.minimum.y*B)*U),h=Math.floor((a.facetPositions[o].z-a.bInfo.minimum.z*B)*k),l=Math.floor((t[y]-a.bInfo.minimum.x*B)*N),c=Math.floor((t[M]-a.bInfo.minimum.y*B)*U),u=Math.floor((t[b]-a.bInfo.minimum.z*B)*k),d=Math.floor((t[E]-a.bInfo.minimum.x*B)*N),_=Math.floor((t[R]-a.bInfo.minimum.y*B)*U),g=Math.floor((t[A]-a.bInfo.minimum.z*B)*k),p=Math.floor((t[C]-a.bInfo.minimum.x*B)*N),m=Math.floor((t[v]-a.bInfo.minimum.y*B)*U),T=Math.floor((t[P]-a.bInfo.minimum.z*B)*k),x=l+a.subDiv.max*c+V*u,S=d+a.subDiv.max*_+V*g,I=p+a.subDiv.max*m+V*T,D=i+a.subDiv.max*r+V*h;a.facetPartitioning[D]=a.facetPartitioning[D]?a.facetPartitioning[D]:new Array,a.facetPartitioning[x]=a.facetPartitioning[x]?a.facetPartitioning[x]:new Array,a.facetPartitioning[S]=a.facetPartitioning[S]?a.facetPartitioning[S]:new Array,a.facetPartitioning[I]=a.facetPartitioning[I]?a.facetPartitioning[I]:new Array,a.facetPartitioning[x].push(o),S!=x&&a.facetPartitioning[S].push(o),I!=S&&I!=x&&a.facetPartitioning[I].push(o),D!=x&&D!=S&&D!=I&&a.facetPartitioning[D].push(o)}if(O&&a&&a.facetPositions){const t=a.depthSortedFacets[o];t.ind=3*o,t.sqDistance=x.P.DistanceSquared(a.facetPositions[o],L)}r[y]+=g,r[M]+=p,r[b]+=m,r[E]+=g,r[R]+=p,r[A]+=m,r[C]+=g,r[v]+=p,r[P]+=m}for(o=0;o<r.length/3;o++)g=r[3*o],p=r[3*o+1],m=r[3*o+2],T=Math.sqrt(g*g+p*p+m*m),T=0===T?1:T,g/=T,p/=T,m/=T,r[3*o]=g,r[3*o+1]=p,r[3*o+2]=m}static"_ComputeSides"(t,i,r,a,o,h,l){const c=r.length,u=a.length;let d,_;switch(t=t||VertexData.DEFAULTSIDE){case VertexData.FRONTSIDE:break;case VertexData.BACKSIDE:for(d=0;d<c;d+=3){const t=r[d];r[d]=r[d+2],r[d+2]=t}for(_=0;_<u;_++)a[_]=-a[_];break;case VertexData.DOUBLESIDE:{const t=i.length,g=t/3;for(let r=0;r<t;r++)i[t+r]=i[r];for(d=0;d<c;d+=3)r[d+c]=r[d+2]+g,r[d+1+c]=r[d+1]+g,r[d+2+c]=r[d]+g;for(_=0;_<u;_++)a[u+_]=-a[_];const p=o.length;let m=0;for(m=0;m<p;m++)o[m+p]=o[m];for(h=h||new x.Lt(0,0,1,1),l=l||new x.Lt(0,0,1,1),m=0,d=0;d<p/2;d++)o[m]=h.x+(h.z-h.x)*o[m],o[m+1]=h.y+(h.w-h.y)*o[m+1],o[m+p]=l.x+(l.z-l.x)*o[m+p],o[m+p+1]=l.y+(l.w-l.y)*o[m+p+1],m+=2;break}}}static"Parse"(t){const i=new VertexData,r=t.positions;r&&i.set(r,G.o.PositionKind);const a=t.normals;a&&i.set(a,G.o.NormalKind);const o=t.tangents;o&&i.set(o,G.o.TangentKind);const h=t.uvs;h&&i.set(h,G.o.UVKind);const l=t.uvs2;l&&i.set(l,G.o.UV2Kind);const c=t.uvs3;c&&i.set(c,G.o.UV3Kind);const u=t.uvs4;u&&i.set(u,G.o.UV4Kind);const d=t.uvs5;d&&i.set(d,G.o.UV5Kind);const _=t.uvs6;_&&i.set(_,G.o.UV6Kind);const g=t.colors;g&&(i.set(V.HE.CheckColors4(g,r.length/3),G.o.ColorKind),void 0!==t.hasVertexAlpha&&(i.hasVertexAlpha=t.hasVertexAlpha));const p=t.matricesIndices;p&&i.set(p,G.o.MatricesIndicesKind);const m=t.matricesWeights;m&&i.set(m,G.o.MatricesWeightsKind);const T=t.indices;T&&(i.indices=T);const y=t.materialInfos;if(y){i.materialInfos=[];for(const t of y){const r=new VertexDataMaterialInfo;r.indexCount=t.indexCount,r.indexStart=t.indexStart,r.verticesCount=t.verticesCount,r.verticesStart=t.verticesStart,r.materialIndex=t.materialIndex,i.materialInfos.push(r)}}return i}static"ImportVertexData"(t,i){const r=VertexData.Parse(t);i.setAllVerticesData(r,t.updatable)}}VertexData.FRONTSIDE=0,VertexData.BACKSIDE=1,VertexData.DOUBLESIDE=2,VertexData.DEFAULTSIDE=0,VertexData._UniqueIDGenerator=0,(0,m.gn)([T.G6.filter((...[t])=>!Array.isArray(t))],VertexData,"_TransformVector3Coordinates",null),(0,m.gn)([T.G6.filter((...[t])=>!Array.isArray(t))],VertexData,"_TransformVector3Normals",null),(0,m.gn)([T.G6.filter((...[t])=>!Array.isArray(t))],VertexData,"_TransformVector4Normals",null),(0,m.gn)([T.G6.filter((...[t])=>!Array.isArray(t))],VertexData,"_FlipFaces",null);var ne=r(2827),ae=r(1995);class SceneLoaderFlags{static get"ForceFullSceneLoadingForIncremental"(){return SceneLoaderFlags._ForceFullSceneLoadingForIncremental}static set"ForceFullSceneLoadingForIncremental"(t){SceneLoaderFlags._ForceFullSceneLoadingForIncremental=t}static get"ShowLoadingScreen"(){return SceneLoaderFlags._ShowLoadingScreen}static set"ShowLoadingScreen"(t){SceneLoaderFlags._ShowLoadingScreen=t}static get"loggingLevel"(){return SceneLoaderFlags._LoggingLevel}static set"loggingLevel"(t){SceneLoaderFlags._LoggingLevel=t}static get"CleanBoneMatrixWeights"(){return SceneLoaderFlags._CleanBoneMatrixWeights}static set"CleanBoneMatrixWeights"(t){SceneLoaderFlags._CleanBoneMatrixWeights=t}}SceneLoaderFlags._ForceFullSceneLoadingForIncremental=!1,SceneLoaderFlags._ShowLoadingScreen=!0,SceneLoaderFlags._CleanBoneMatrixWeights=!1,SceneLoaderFlags._LoggingLevel=0;var oe=r(6629),he=r(6791);class Geometry{get"boundingBias"(){return this._boundingBias}set"boundingBias"(t){this._boundingBias?this._boundingBias.copyFrom(t):this._boundingBias=t.clone(),this._updateBoundingInfo(!0,null)}static"CreateGeometryForMesh"(t){const i=new Geometry(Geometry.RandomId(),t.getScene());return i.applyToMesh(t),i}get"meshes"(){return this._meshes}"constructor"(t,i,r,a=!1,o=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={"minimum":new x.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),"maximum":new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=i||E.l.LastCreatedScene,this._scene&&(this.id=t,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=a,r?this.setAllVerticesData(r,a):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0)))}get"extend"(){return this._extend}"getScene"(){return this._scene}"getEngine"(){return this._engine}"isReady"(){return 1===this.delayLoadState||0===this.delayLoadState}get"doNotSerialize"(){for(let t=0;t<this._meshes.length;t++)if(!this._meshes[t].doNotSerialize)return!1;return!0}"_rebuild"(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const t=new Set;for(const i in this._vertexBuffers)t.add(this._vertexBuffers[i].getWrapperBuffer());t.forEach(t=>{t._rebuild()})}"setAllVerticesData"(t,i){t.applyToGeometry(this,i),this._notifyUpdate()}"setVerticesData"(t,i,r=!1,a){r&&Array.isArray(i)&&(i=new Float32Array(i));const o=new G.o(this._engine,i,t,{"updatable":r,"postponeInternalCreation":0===this._meshes.length,"stride":a,"label":"Geometry_"+this.id+"_"+t});this.setVerticesBuffer(o)}"removeVerticesData"(t){this._vertexBuffers[t]&&(this._vertexBuffers[t].dispose(),delete this._vertexBuffers[t]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}"setVerticesBuffer"(t,i=null,r=!0){const a=t.getKind();this._vertexBuffers[a]&&r&&this._vertexBuffers[a].dispose(),t._buffer&&t._buffer._increaseReferences(),this._vertexBuffers[a]=t;const o=this._meshes,h=o.length;if(a===G.o.PositionKind){this._totalVertices=i??t._maxVerticesCount,this._updateExtend(t.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const r=this._extend&&this._extend.minimum||new x.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=this._extend&&this._extend.maximum||new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let t=0;t<h;t++){const i=o[t];i.buildBoundingInfo(r,a),i._createGlobalSubMesh(i.isUnIndexed),i.computeWorldMatrix(!0),i.synchronizeInstances()}}this._notifyUpdate(a)}"updateVerticesDataDirectly"(t,i,r,a=!1){const o=this.getVertexBuffer(t);o&&(o.updateDirectly(i,r,a),this._notifyUpdate(t))}"updateVerticesData"(t,i,r=!1){const a=this.getVertexBuffer(t);a&&(a.update(i),t===G.o.PositionKind&&this._updateBoundingInfo(r,i),this._notifyUpdate(t))}"_updateBoundingInfo"(t,i){if(t&&this._updateExtend(i),this._resetPointsArrayCache(),t){const t=this._meshes;for(const i of t){i.hasBoundingInfo?i.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):i.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const t=i.subMeshes;for(const i of t)i.refreshBoundingInfo()}}}"_bind"(t,i,r,a){if(!t)return;void 0===i&&(i=this._indexBuffer);const o=this.getVertexBuffers();if(!o)return;if(i!=this._indexBuffer||!this._vertexArrayObjects&&!a)return void this._engine.bindBuffers(o,i,t,r);const h=a||this._vertexArrayObjects,l=this._engine;h[t.key]||(h[t.key]=l.recordVertexArrayObject(o,i,t,r)),l.bindVertexArrayObject(h[t.key],i)}"getTotalVertices"(){return this.isReady()?this._totalVertices:0}"getVerticesData"(t,i,r){const a=this.getVertexBuffer(t);return a?a.getFloatData(this._totalVertices,r||i&&1!==this._meshes.length):null}"copyVerticesData"(t,i){const r=this.getVertexBuffer(t);if(!r)return;i[t]||(i[t]=new Float32Array(this._totalVertices*r.getSize()));const a=r.getData();a&&(0,he.tQ)(a,r.getSize(),r.type,r.byteOffset,r.byteStride,r.normalized,this._totalVertices,i[t])}"isVertexBufferUpdatable"(t){const i=this._vertexBuffers[t];return!!i&&i.isUpdatable()}"getVertexBuffer"(t){return this.isReady()?this._vertexBuffers[t]:null}"getVertexBuffers"(){return this.isReady()?this._vertexBuffers:null}"isVerticesDataPresent"(t){return this._vertexBuffers?void 0!==this._vertexBuffers[t]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)}"getVerticesDataKinds"(){const t=[];let i;if(!this._vertexBuffers&&this._delayInfo)for(i in this._delayInfo)t.push(i);else for(i in this._vertexBuffers)t.push(i);return t}"updateIndices"(t,i,r=!1){if(this._indexBuffer)if(this._indexBufferIsUpdatable){const a=t.length!==this._indices.length;if(r||(this._indices=t.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,t,i),a)for(const t of this._meshes)t._createGlobalSubMesh(!0)}else this.setIndices(t,null,!0)}"setIndexBuffer"(t,i,r,a=null){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=t,this._totalVertices=i,this._totalIndices=r,t.is32Bits=null===a?i>65535:a;for(const t of this._meshes)t._createGlobalSubMesh(!0),t.synchronizeInstances();this._notifyUpdate()}"setIndices"(t,i=null,r=!1,a=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=t,this._indexBufferIsUpdatable=r,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,r,"Geometry_"+this.id+"_IndexBuffer")),null!=i&&(this._totalVertices=i);for(const t of this._meshes)t._createGlobalSubMesh(!a),t.synchronizeInstances();this._notifyUpdate()}"getTotalIndices"(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}"getIndices"(t,i){if(!this.isReady())return null;const r=this._indices;return i||t&&1!==this._meshes.length?r.slice():r}"getIndexBuffer"(){return this.isReady()?this._indexBuffer:null}"_releaseVertexArrayObject"(t=null){t&&this._vertexArrayObjects&&this._vertexArrayObjects[t.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t.key]),delete this._vertexArrayObjects[t.key])}"releaseForMesh"(t,i){const r=this._meshes,a=r.indexOf(t);-1!==a&&(r.splice(a,1),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject(),t._geometry=null,0===r.length&&i&&this.dispose())}"applyToMesh"(t){if(t._geometry===this)return;const i=t._geometry;i&&i.releaseForMesh(t),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject();const r=this._meshes;t._geometry=this,t._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),r.push(t),this.isReady()?this._applyToMesh(t):this._boundingInfo&&t.setBoundingInfo(this._boundingInfo)}"_updateExtend"(t=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={"minimum":this._boundingInfo.minimum.clone(),"maximum":this._boundingInfo.maximum.clone()};else{if(!t&&!(t=this.getVerticesData(G.o.PositionKind)))return;this._extend=extractMinAndMax(t,0,this._totalVertices,this.boundingBias,3)}}"_applyToMesh"(t){const i=this._meshes.length;for(const r in this._vertexBuffers)1===i&&this._vertexBuffers[r].create(),r===G.o.PositionKind&&(this._extend||this._updateExtend(),t.buildBoundingInfo(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(t.isUnIndexed),t._updateBoundingInfo());1===i&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),t._syncGeometryWithMorphTargetManager(),t.synchronizeInstances()}"_notifyUpdate"(t){this.onGeometryUpdated&&this.onGeometryUpdated(this,t),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const t of this._meshes)t._markSubMeshesAsAttributesDirty()}"load"(t,i){2!==this.delayLoadState&&(this.isReady()?i&&i():(this.delayLoadState=2,this._queueLoad(t,i)))}"_queueLoad"(t,i){this.delayLoadingFile&&(t.addPendingData(this),t._loadFile(this.delayLoadingFile,r=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(r),this),this.delayLoadState=1,this._delayInfo=[],t.removePendingData(this);const a=this._meshes,o=a.length;for(let t=0;t<o;t++)this._applyToMesh(a[t]);i&&i()},void 0,!0))}"toLeftHanded"(){const t=this.getIndices(!1);if(null!=t&&t.length>0){for(let i=0;i<t.length;i+=3){const r=t[i+0];t[i+0]=t[i+2],t[i+2]=r}this.setIndices(t)}const i=this.getVerticesData(G.o.PositionKind,!1);if(null!=i&&i.length>0){for(let t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(G.o.PositionKind,i,!1)}const r=this.getVerticesData(G.o.NormalKind,!1);if(null!=r&&r.length>0){for(let t=0;t<r.length;t+=3)r[t+2]=-r[t+2];this.setVerticesData(G.o.NormalKind,r,!1)}}"_resetPointsArrayCache"(){this._positions=null}"_generatePointsArray"(){if(this._positions)return!0;const t=this.getVerticesData(G.o.PositionKind);if(!t||0===t.length)return!1;for(let i=3*this._positionsCache.length,r=this._positionsCache.length;i<t.length;i+=3,++r)this._positionsCache[r]=x.P.FromArray(t,i);for(let i=0,r=0;i<t.length;i+=3,++r)this._positionsCache[r].set(t[0+i],t[1+i],t[2+i]);return this._positionsCache.length=t.length/3,this._positions=this._positionsCache,!0}"isDisposed"(){return this._isDisposed}"_disposeVertexArrayObjects"(){if(this._vertexArrayObjects){for(const t in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t]);this._vertexArrayObjects={};const t=this._meshes,i=t.length;for(let r=0;r<i;r++)t[r]._invalidateInstanceVertexArrayObject()}}"dispose"(){const t=this._meshes,i=t.length;let r;for(r=0;r<i;r++)this.releaseForMesh(t[r]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const t in this._vertexBuffers)this._vertexBuffers[t].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const t=this._parentContainer.geometries.indexOf(this);t>-1&&this._parentContainer.geometries.splice(t,1),this._parentContainer=null}this._isDisposed=!0}"copy"(t){const i=new VertexData;i.indices=[];const r=this.getIndices();if(r)for(let t=0;t<r.length;t++)i.indices.push(r[t]);let a,o=!1,h=!1;for(a in this._vertexBuffers){const t=this.getVerticesData(a);if(t&&(t instanceof Float32Array?i.set(new Float32Array(t),a):i.set(t.slice(0),a),!h)){const t=this.getVertexBuffer(a);t&&(o=t.isUpdatable(),h=!o)}}const l=new Geometry(t,this._scene,i,o);for(a in l.delayLoadState=this.delayLoadState,l.delayLoadingFile=this.delayLoadingFile,l._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)l._delayInfo=l._delayInfo||[],l._delayInfo.push(a);return l._boundingInfo=new BoundingInfo(this._extend.minimum,this._extend.maximum),l}"serialize"(){const t={};return t.id=this.id,t.uniqueId=this.uniqueId,t.updatable=this._updatable,ae.$&&ae.$.HasTags(this)&&(t.tags=ae.$.GetTags(this)),t}"_toNumberArray"(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)}"clearCachedData"(){this._indices=[],this._resetPointsArrayCache();for(const t in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,t)&&(this._vertexBuffers[t]._buffer._data=null)}"serializeVerticeData"(){const t=this.serialize();return this.isVerticesDataPresent(G.o.PositionKind)&&(t.positions=this._toNumberArray(this.getVerticesData(G.o.PositionKind)),this.isVertexBufferUpdatable(G.o.PositionKind)&&(t.positions._updatable=!0)),this.isVerticesDataPresent(G.o.NormalKind)&&(t.normals=this._toNumberArray(this.getVerticesData(G.o.NormalKind)),this.isVertexBufferUpdatable(G.o.NormalKind)&&(t.normals._updatable=!0)),this.isVerticesDataPresent(G.o.TangentKind)&&(t.tangents=this._toNumberArray(this.getVerticesData(G.o.TangentKind)),this.isVertexBufferUpdatable(G.o.TangentKind)&&(t.tangents._updatable=!0)),this.isVerticesDataPresent(G.o.UVKind)&&(t.uvs=this._toNumberArray(this.getVerticesData(G.o.UVKind)),this.isVertexBufferUpdatable(G.o.UVKind)&&(t.uvs._updatable=!0)),this.isVerticesDataPresent(G.o.UV2Kind)&&(t.uvs2=this._toNumberArray(this.getVerticesData(G.o.UV2Kind)),this.isVertexBufferUpdatable(G.o.UV2Kind)&&(t.uvs2._updatable=!0)),this.isVerticesDataPresent(G.o.UV3Kind)&&(t.uvs3=this._toNumberArray(this.getVerticesData(G.o.UV3Kind)),this.isVertexBufferUpdatable(G.o.UV3Kind)&&(t.uvs3._updatable=!0)),this.isVerticesDataPresent(G.o.UV4Kind)&&(t.uvs4=this._toNumberArray(this.getVerticesData(G.o.UV4Kind)),this.isVertexBufferUpdatable(G.o.UV4Kind)&&(t.uvs4._updatable=!0)),this.isVerticesDataPresent(G.o.UV5Kind)&&(t.uvs5=this._toNumberArray(this.getVerticesData(G.o.UV5Kind)),this.isVertexBufferUpdatable(G.o.UV5Kind)&&(t.uvs5._updatable=!0)),this.isVerticesDataPresent(G.o.UV6Kind)&&(t.uvs6=this._toNumberArray(this.getVerticesData(G.o.UV6Kind)),this.isVertexBufferUpdatable(G.o.UV6Kind)&&(t.uvs6._updatable=!0)),this.isVerticesDataPresent(G.o.ColorKind)&&(t.colors=this._toNumberArray(this.getVerticesData(G.o.ColorKind)),this.isVertexBufferUpdatable(G.o.ColorKind)&&(t.colors._updatable=!0)),this.isVerticesDataPresent(G.o.MatricesIndicesKind)&&(t.matricesIndices=this._toNumberArray(this.getVerticesData(G.o.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(G.o.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(G.o.MatricesWeightsKind)&&(t.matricesWeights=this._toNumberArray(this.getVerticesData(G.o.MatricesWeightsKind)),this.isVertexBufferUpdatable(G.o.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this._toNumberArray(this.getIndices()),t}static"ExtractFromMesh"(t,i){const r=t._geometry;return r?r.copy(i):null}static"RandomId"(){return M.w1.RandomId()}static"_GetGeometryByLoadedUniqueId"(t,i){for(let r=0;r<i.geometries.length;r++)if(i.geometries[r]._loadedUniqueId===t)return i.geometries[r];return null}static"_ImportGeometry"(t,i){const r=i.getScene(),a=t.geometryUniqueId,o=t.geometryId;if(a||o){const t=a?this._GetGeometryByLoadedUniqueId(a,r):r.getGeometryById(o);t&&t.applyToMesh(i)}else if(t instanceof ArrayBuffer){const r=i._binaryInfo;if(r.positionsAttrDesc&&r.positionsAttrDesc.count>0){const a=new Float32Array(t,r.positionsAttrDesc.offset,r.positionsAttrDesc.count);i.setVerticesData(G.o.PositionKind,a,!1)}if(r.normalsAttrDesc&&r.normalsAttrDesc.count>0){const a=new Float32Array(t,r.normalsAttrDesc.offset,r.normalsAttrDesc.count);i.setVerticesData(G.o.NormalKind,a,!1)}if(r.tangetsAttrDesc&&r.tangetsAttrDesc.count>0){const a=new Float32Array(t,r.tangetsAttrDesc.offset,r.tangetsAttrDesc.count);i.setVerticesData(G.o.TangentKind,a,!1)}if(r.uvsAttrDesc&&r.uvsAttrDesc.count>0){const a=new Float32Array(t,r.uvsAttrDesc.offset,r.uvsAttrDesc.count);if(oe.VJ)for(let t=1;t<a.length;t+=2)a[t]=1-a[t];i.setVerticesData(G.o.UVKind,a,!1)}if(r.uvs2AttrDesc&&r.uvs2AttrDesc.count>0){const a=new Float32Array(t,r.uvs2AttrDesc.offset,r.uvs2AttrDesc.count);if(oe.VJ)for(let t=1;t<a.length;t+=2)a[t]=1-a[t];i.setVerticesData(G.o.UV2Kind,a,!1)}if(r.uvs3AttrDesc&&r.uvs3AttrDesc.count>0){const a=new Float32Array(t,r.uvs3AttrDesc.offset,r.uvs3AttrDesc.count);if(oe.VJ)for(let t=1;t<a.length;t+=2)a[t]=1-a[t];i.setVerticesData(G.o.UV3Kind,a,!1)}if(r.uvs4AttrDesc&&r.uvs4AttrDesc.count>0){const a=new Float32Array(t,r.uvs4AttrDesc.offset,r.uvs4AttrDesc.count);if(oe.VJ)for(let t=1;t<a.length;t+=2)a[t]=1-a[t];i.setVerticesData(G.o.UV4Kind,a,!1)}if(r.uvs5AttrDesc&&r.uvs5AttrDesc.count>0){const a=new Float32Array(t,r.uvs5AttrDesc.offset,r.uvs5AttrDesc.count);if(oe.VJ)for(let t=1;t<a.length;t+=2)a[t]=1-a[t];i.setVerticesData(G.o.UV5Kind,a,!1)}if(r.uvs6AttrDesc&&r.uvs6AttrDesc.count>0){const a=new Float32Array(t,r.uvs6AttrDesc.offset,r.uvs6AttrDesc.count);if(oe.VJ)for(let t=1;t<a.length;t+=2)a[t]=1-a[t];i.setVerticesData(G.o.UV6Kind,a,!1)}if(r.colorsAttrDesc&&r.colorsAttrDesc.count>0){const a=new Float32Array(t,r.colorsAttrDesc.offset,r.colorsAttrDesc.count);i.setVerticesData(G.o.ColorKind,a,!1,r.colorsAttrDesc.stride)}if(r.matricesIndicesAttrDesc&&r.matricesIndicesAttrDesc.count>0){const a=new Int32Array(t,r.matricesIndicesAttrDesc.offset,r.matricesIndicesAttrDesc.count),o=[];for(let t=0;t<a.length;t++){const i=a[t];o.push(255&i),o.push((65280&i)>>8),o.push((16711680&i)>>16),o.push(i>>24&255)}i.setVerticesData(G.o.MatricesIndicesKind,o,!1)}if(r.matricesIndicesExtraAttrDesc&&r.matricesIndicesExtraAttrDesc.count>0){const a=new Int32Array(t,r.matricesIndicesExtraAttrDesc.offset,r.matricesIndicesExtraAttrDesc.count),o=[];for(let t=0;t<a.length;t++){const i=a[t];o.push(255&i),o.push((65280&i)>>8),o.push((16711680&i)>>16),o.push(i>>24&255)}i.setVerticesData(G.o.MatricesIndicesExtraKind,o,!1)}if(r.matricesWeightsAttrDesc&&r.matricesWeightsAttrDesc.count>0){const a=new Float32Array(t,r.matricesWeightsAttrDesc.offset,r.matricesWeightsAttrDesc.count);i.setVerticesData(G.o.MatricesWeightsKind,a,!1)}if(r.indicesAttrDesc&&r.indicesAttrDesc.count>0){const a=new Int32Array(t,r.indicesAttrDesc.offset,r.indicesAttrDesc.count);i.setIndices(a,null)}if(r.subMeshesAttrDesc&&r.subMeshesAttrDesc.count>0){const a=new Int32Array(t,r.subMeshesAttrDesc.offset,5*r.subMeshesAttrDesc.count);i.subMeshes=[];for(let t=0;t<r.subMeshesAttrDesc.count;t++){const r=a[5*t+0],o=a[5*t+1],h=a[5*t+2],l=a[5*t+3],c=a[5*t+4];SubMesh.AddToMesh(r,o,h,l,c,i)}}}else if(t.positions&&t.normals&&t.indices){if(i.setVerticesData(G.o.PositionKind,t.positions,t.positions._updatable),i.setVerticesData(G.o.NormalKind,t.normals,t.normals._updatable),t.tangents&&i.setVerticesData(G.o.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&i.setVerticesData(G.o.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&i.setVerticesData(G.o.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&i.setVerticesData(G.o.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&i.setVerticesData(G.o.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&i.setVerticesData(G.o.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&i.setVerticesData(G.o.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&i.setVerticesData(G.o.ColorKind,V.HE.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(G.o.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{const r=[];for(let i=0;i<t.matricesIndices.length;i++){const a=t.matricesIndices[i];r.push(255&a),r.push((65280&a)>>8),r.push((16711680&a)>>16),r.push(a>>24&255)}i.setVerticesData(G.o.MatricesIndicesKind,r,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(G.o.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{const r=[];for(let i=0;i<t.matricesIndicesExtra.length;i++){const a=t.matricesIndicesExtra[i];r.push(255&a),r.push((65280&a)>>8),r.push((16711680&a)>>16),r.push(a>>24&255)}i.setVerticesData(G.o.MatricesIndicesExtraKind,r,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(Geometry._CleanMatricesWeights(t,i),i.setVerticesData(G.o.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&i.setVerticesData(G.o.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),i.setIndices(t.indices,null)}if(t.subMeshes){i.subMeshes=[];for(let r=0;r<t.subMeshes.length;r++){const a=t.subMeshes[r];SubMesh.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,i)}}i._shouldGenerateFlatShading&&(i.convertToFlatShadedMesh(),i._shouldGenerateFlatShading=!1),i.computeWorldMatrix(!0),r.onMeshImportedObservable.notifyObservers(i)}static"_CleanMatricesWeights"(t,i){const r=.001;if(!SceneLoaderFlags.CleanBoneMatrixWeights)return;let a=0;if(!(t.skeletonId>-1))return;{const r=i.getScene().getLastSkeletonById(t.skeletonId);if(!r)return;a=r.bones.length}const o=i.getVerticesData(G.o.MatricesIndicesKind),h=i.getVerticesData(G.o.MatricesIndicesExtraKind),l=t.matricesWeights,c=t.matricesWeightsExtra,u=t.numBoneInfluencer,d=l.length;for(let t=0;t<d;t+=4){let i=0,d=-1;for(let a=0;a<4;a++){const o=l[t+a];i+=o,o<r&&d<0&&(d=a)}if(c)for(let a=0;a<4;a++){const o=c[t+a];i+=o,o<r&&d<0&&(d=a+4)}if((d<0||d>u-1)&&(d=u-1),i>r){const r=1/i;for(let i=0;i<4;i++)l[t+i]*=r;if(c)for(let i=0;i<4;i++)c[t+i]*=r}else d>=4?(c[t+d-4]=1-i,h[t+d-4]=a):(l[t+d]=1-i,o[t+d]=a)}i.setVerticesData(G.o.MatricesIndicesKind,o),t.matricesWeightsExtra&&i.setVerticesData(G.o.MatricesIndicesExtraKind,h)}static"Parse"(t,i,r){const a=new Geometry(t.id,i,void 0,t.updatable);return a._loadedUniqueId=t.uniqueId,ae.$&&ae.$.AddTagsTo(a,t.tags),t.delayLoadingFile?(a.delayLoadState=4,a.delayLoadingFile=r+t.delayLoadingFile,a._boundingInfo=new BoundingInfo(x.P.FromArray(t.boundingBoxMinimum),x.P.FromArray(t.boundingBoxMaximum)),a._delayInfo=[],t.hasUVs&&a._delayInfo.push(G.o.UVKind),t.hasUVs2&&a._delayInfo.push(G.o.UV2Kind),t.hasUVs3&&a._delayInfo.push(G.o.UV3Kind),t.hasUVs4&&a._delayInfo.push(G.o.UV4Kind),t.hasUVs5&&a._delayInfo.push(G.o.UV5Kind),t.hasUVs6&&a._delayInfo.push(G.o.UV6Kind),t.hasColors&&a._delayInfo.push(G.o.ColorKind),t.hasMatricesIndices&&a._delayInfo.push(G.o.MatricesIndicesKind),t.hasMatricesWeights&&a._delayInfo.push(G.o.MatricesWeightsKind),a._delayLoadingFunction=VertexData.ImportVertexData):VertexData.ImportVertexData(t,a),i.pushGeometry(a,!0),a}}const le=x.y3.Compose(x.P.One(),x._f.FromEulerAngles(0,Math.PI,0),x.P.Zero());class TransformNode extends Node{get"billboardMode"(){return this._billboardMode}set"billboardMode"(t){this._billboardMode!==t&&(this._billboardMode=t,this._cache.useBillboardPosition=0!==(this._billboardMode&TransformNode.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get"preserveParentRotationForBillboard"(){return this._preserveParentRotationForBillboard}set"preserveParentRotationForBillboard"(t){t!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=t,this._computeUseBillboardPath())}"_computeUseBillboardPath"(){this._cache.useBillboardPath=this._billboardMode!==TransformNode.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get"infiniteDistance"(){return this._infiniteDistance}set"infiniteDistance"(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)}"constructor"(t,i=null,r=!0){super(t,i,!1),this._forward=new x.P(0,0,1),this._up=new x.P(0,1,0),this._right=new x.P(1,0,0),this._position=x.P.Zero(),this._rotation=x.P.Zero(),this._rotationQuaternion=null,this._scaling=x.P.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=TransformNode.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=x.y3.Zero(),this._usePivotMatrix=!1,this._absolutePosition=x.P.Zero(),this._absoluteScaling=x.P.Zero(),this._absoluteRotationQuaternion=x._f.Identity(),this._pivotMatrix=x.y3.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new b.y$,this._nonUniformScaling=!1,r&&this.getScene().addTransformNode(this)}"getClassName"(){return"TransformNode"}get"position"(){return this._position}set"position"(t){this._position=t,this._markAsDirtyInternal()}"isUsingPivotMatrix"(){return this._usePivotMatrix}"isUsingPostMultiplyPivotMatrix"(){return this._postMultiplyPivotMatrix}get"rotation"(){return this._rotation}set"rotation"(t){this._rotation=t,this._rotationQuaternion=null,this._markAsDirtyInternal()}get"scaling"(){return this._scaling}set"scaling"(t){this._scaling=t,this._markAsDirtyInternal()}get"rotationQuaternion"(){return this._rotationQuaternion}set"rotationQuaternion"(t){this._rotationQuaternion=t,t&&this._rotation.setAll(0),this._markAsDirtyInternal()}"_markAsDirtyInternal"(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get"forward"(){return x.P.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get"up"(){return x.P.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get"right"(){return x.P.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}"updatePoseMatrix"(t){return this._poseMatrix?(this._poseMatrix.copyFrom(t),this):(this._poseMatrix=t.clone(),this)}"getPoseMatrix"(){return this._poseMatrix||(this._poseMatrix=x.y3.Identity()),this._poseMatrix}"_isSynchronized"(){const t=this._cache;return this._billboardMode===t.billboardMode&&this._billboardMode===TransformNode.BILLBOARDMODE_NONE&&(!t.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}"_initCache"(){super._initCache();const t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1,t.useBillboardPosition=!1,t.useBillboardPath=!1}get"absolutePosition"(){return this.getAbsolutePosition()}get"absoluteScaling"(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get"absoluteRotationQuaternion"(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}"setPreTransformMatrix"(t){return this.setPivotMatrix(t,!1)}"setPivotMatrix"(t,i=!0){return this._pivotMatrix.copyFrom(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=x.y3.Invert(this._pivotMatrix)),this}"getPivotMatrix"(){return this._pivotMatrix}"instantiateHierarchy"(t=null,i,r){const a=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);a&&r&&r(this,a);for(const t of this.getChildTransformNodes(!0))t.instantiateHierarchy(a,i,r);return a}"freezeWorldMatrix"(t=null,i=!1){return t?i?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||x._f.Identity(),t.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=t,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}"unfreezeWorldMatrix"(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get"isWorldMatrixFrozen"(){return this._isWorldMatrixFrozen}"getAbsolutePosition"(){return this.computeWorldMatrix(),this._absolutePosition}"setAbsolutePosition"(t){if(!t)return this;let i,r,a;if(void 0===t.x){if(arguments.length<3)return this;i=arguments[0],r=arguments[1],a=arguments[2]}else i=t.x,r=t.y,a=t.z;if(this.parent){const t=x.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(t),x.P.TransformCoordinatesFromFloatsToRef(i,r,a,t,this.position)}else this.position.x=i,this.position.y=r,this.position.z=a;return this._absolutePosition.copyFrom(t),this}"setPositionWithLocalVector"(t){return this.computeWorldMatrix(),this.position=x.P.TransformNormal(t,this._localMatrix),this}"getPositionExpressedInLocalSpace"(){this.computeWorldMatrix();const t=x.jp.Matrix[0];return this._localMatrix.invertToRef(t),x.P.TransformNormal(this.position,t)}"locallyTranslate"(t){return this.computeWorldMatrix(!0),this.position=x.P.TransformCoordinates(t,this._localMatrix),this}"lookAt"(t,i=0,r=0,a=0,o=0){const h=TransformNode._LookAtVectorCache,l=0===o?this.position:this.getAbsolutePosition();if(t.subtractToRef(l,h),this.setDirection(h,i,r,a),1===o&&this.parent)if(this.rotationQuaternion){const t=x.jp.Matrix[0];this.rotationQuaternion.toRotationMatrix(t);const i=x.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),t.multiplyToRef(i,t),this.rotationQuaternion.fromRotationMatrix(t)}else{const t=x.jp.Quaternion[0];x._f.FromEulerVectorToRef(this.rotation,t);const i=x.jp.Matrix[0];t.toRotationMatrix(i);const r=x.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(r),r.invert(),i.multiplyToRef(r,i),t.fromRotationMatrix(i),t.toEulerAnglesToRef(this.rotation)}return this}"getDirection"(t){const i=x.P.Zero();return this.getDirectionToRef(t,i),i}"getDirectionToRef"(t,i){return x.P.TransformNormalToRef(t,this.getWorldMatrix(),i),this}"setDirection"(t,i=0,r=0,a=0){const o=-Math.atan2(t.z,t.x)+Math.PI/2,h=Math.sqrt(t.x*t.x+t.z*t.z),l=-Math.atan2(t.y,h);return this.rotationQuaternion?x._f.RotationYawPitchRollToRef(o+i,l+r,a,this.rotationQuaternion):(this.rotation.x=l+r,this.rotation.y=o+i,this.rotation.z=a),this}"setPivotPoint"(t,i=0){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const r=this.getWorldMatrix();if(1==i){const i=x.jp.Matrix[0];r.invertToRef(i),t=x.P.TransformCoordinates(t,i)}return this.setPivotMatrix(x.y3.Translation(-t.x,-t.y,-t.z),!0)}"getPivotPoint"(){const t=x.P.Zero();return this.getPivotPointToRef(t),t}"getPivotPointToRef"(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this}"getAbsolutePivotPoint"(){const t=x.P.Zero();return this.getAbsolutePivotPointToRef(t),t}"getAbsolutePivotPointToRef"(t){return this.getPivotPointToRef(t),x.P.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this}"markAsDirty"(t){if(this._isDirty)return this;if(this._children)for(const i of this._children)i.markAsDirty(t);return super.markAsDirty(t)}"setParent"(t,i=!1,r=!1){if(!t&&!this.parent)return this;const a=x.jp.Quaternion[0],o=x.jp.Vector3[0],h=x.jp.Vector3[1],l=x.jp.Matrix[1];x.y3.IdentityToRef(l);const c=x.jp.Matrix[0];this.computeWorldMatrix(!0);let u=this.rotationQuaternion;return u||(u=TransformNode._TmpRotation,x._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,u)),x.y3.ComposeToRef(this.scaling,u,this.position,c),this.parent&&c.multiplyToRef(this.parent.computeWorldMatrix(!0),c),t&&(t.computeWorldMatrix(!0).invertToRef(l),c.multiplyToRef(l,c)),c.decompose(h,a,o,i?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(h),this.position.copyFrom(o),this.parent=t,r&&this.setPivotMatrix(x.y3.Identity()),this}"addChild"(t,i=!1){return t.setParent(this,i),this}"removeChild"(t,i=!1){return t.parent!==this||t.setParent(null,i),this}get"nonUniformScaling"(){return this._nonUniformScaling}"_updateNonUniformScalingState"(t){return this._nonUniformScaling!==t&&(this._nonUniformScaling=t,!0)}"attachToBone"(t,i){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=i,this.parent=t,t.getSkeleton().prepare(!0),t.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}"detachFromBone"(t=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=t?this._currentParentWhenAttachingToBone:null,this):(t&&(this.parent=this._currentParentWhenAttachingToBone),this)}"rotate"(t,i,r){let a;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),r&&0!==r){if(this.parent){const r=this.parent.getWorldMatrix(),a=x.jp.Matrix[0];r.invertToRef(a),t=x.P.TransformNormal(t,a),r.determinant()<0&&(i*=-1)}a=x._f.RotationAxisToRef(t,i,TransformNode._RotationAxisCache),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else a=x._f.RotationAxisToRef(t,i,TransformNode._RotationAxisCache),this.rotationQuaternion.multiplyToRef(a,this.rotationQuaternion);return this}"rotateAround"(t,i,r){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=x._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const a=x.jp.Vector3[0],o=x.jp.Vector3[1],h=x.jp.Vector3[2],l=x.jp.Quaternion[0],c=x.jp.Matrix[0],u=x.jp.Matrix[1],d=x.jp.Matrix[2],_=x.jp.Matrix[3];return t.subtractToRef(this.position,a),x.y3.TranslationToRef(a.x,a.y,a.z,c),x.y3.TranslationToRef(-a.x,-a.y,-a.z,u),x.y3.RotationAxisToRef(i,r,d),u.multiplyToRef(d,_),_.multiplyToRef(c,_),_.decompose(o,l,h),this.position.addInPlace(h),l.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}"translate"(t,i,r){const a=t.scale(i);if(r&&0!==r)this.setAbsolutePosition(this.getAbsolutePosition().add(a));else{const t=this.getPositionExpressedInLocalSpace().add(a);this.setPositionWithLocalVector(t)}return this}"addRotation"(t,i,r){let a;this.rotationQuaternion?a=this.rotationQuaternion:(a=x.jp.Quaternion[1],x._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,a));const o=x.jp.Quaternion[0];return x._f.RotationYawPitchRollToRef(i,t,r,o),a.multiplyInPlace(o),this.rotationQuaternion||a.toEulerAnglesToRef(this.rotation),this}"_getEffectiveParent"(){return this.parent}"isWorldMatrixCameraDependent"(){return this._infiniteDistance&&!this.parent||this._billboardMode!==TransformNode.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}"computeWorldMatrix"(t=!1,i=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const r=this.getScene().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===r||this.isSynchronized()))return this._currentRenderId=r,this._worldMatrix;i=i||this.getScene().activeCamera,this._updateCache();const a=this._cache;a.pivotMatrixUpdated=!1,a.billboardMode=this.billboardMode,a.infiniteDistance=this.infiniteDistance,a.parent=this._parentNode,this._currentRenderId=r,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const o=this._getEffectiveParent(),h=TransformNode._TmpScaling;let l,c=this._position;if(this._infiniteDistance&&!this.parent&&i){const t=i.getWorldMatrix(),r=new x.P(t.m[12],t.m[13],t.m[14]);c=TransformNode._TmpTranslation,c.copyFromFloats(this._position.x+r.x,this._position.y+r.y,this._position.z+r.z)}if(h.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,l=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(x._f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else l=TransformNode._TmpRotation,x._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l);if(this._usePivotMatrix){const t=x.jp.Matrix[1];x.y3.ScalingToRef(h.x,h.y,h.z,t);const i=x.jp.Matrix[0];l.toRotationMatrix(i),this._pivotMatrix.multiplyToRef(t,x.jp.Matrix[4]),x.jp.Matrix[4].multiplyToRef(i,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(c.x,c.y,c.z)}else x.y3.ComposeToRef(h,l,c,this._localMatrix);if(o&&o.getWorldMatrix){if(t&&o.computeWorldMatrix(t),a.useBillboardPath){if(this._transformToBoneReferal){const t=this.parent;t.getSkeleton().prepare(),t.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),x.jp.Matrix[7])}else x.jp.Matrix[7].copyFrom(o.getWorldMatrix());const t=x.jp.Vector3[5],i=x.jp.Vector3[6],r=x.jp.Quaternion[0];x.jp.Matrix[7].decompose(i,r,t),x.y3.ScalingToRef(i.x,i.y,i.z,x.jp.Matrix[7]),x.jp.Matrix[7].setTranslation(t),TransformNode.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(r,t),this._localMatrix.setTranslation(t)),this._localMatrix.multiplyToRef(x.jp.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const t=this.parent;t.getSkeleton().prepare(),this._localMatrix.multiplyToRef(t.getFinalMatrix(),x.jp.Matrix[6]),x.jp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(o.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(a.useBillboardPath&&i&&this.billboardMode&&!a.useBillboardPosition){const t=x.jp.Vector3[0];if(this._worldMatrix.getTranslationToRef(t),x.jp.Matrix[1].copyFrom(i.getViewMatrix()),this._scene.useRightHandedSystem&&x.jp.Matrix[1].multiplyToRef(le,x.jp.Matrix[1]),x.jp.Matrix[1].setTranslationFromFloats(0,0,0),x.jp.Matrix[1].invertToRef(x.jp.Matrix[0]),(this.billboardMode&TransformNode.BILLBOARDMODE_ALL)!==TransformNode.BILLBOARDMODE_ALL){x.jp.Matrix[0].decompose(void 0,x.jp.Quaternion[0],void 0);const t=x.jp.Vector3[1];x.jp.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&TransformNode.BILLBOARDMODE_X)!==TransformNode.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&TransformNode.BILLBOARDMODE_Y)!==TransformNode.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&TransformNode.BILLBOARDMODE_Z)!==TransformNode.BILLBOARDMODE_Z&&(t.z=0),x.y3.RotationYawPitchRollToRef(t.y,t.x,t.z,x.jp.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(x.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(x.jp.Vector3[0])}else if(a.useBillboardPath&&i&&a.useBillboardPosition){const t=x.jp.Vector3[0];this._worldMatrix.getTranslationToRef(t);const r=i.globalPosition;this._worldMatrix.invertToRef(x.jp.Matrix[1]);const a=x.jp.Vector3[1];x.P.TransformCoordinatesToRef(r,x.jp.Matrix[1],a),a.normalize();const o=-Math.atan2(a.z,a.x)+Math.PI/2,h=Math.sqrt(a.x*a.x+a.z*a.z),l=-Math.atan2(a.y,h);if(x._f.RotationYawPitchRollToRef(o,l,0,x.jp.Quaternion[0]),(this.billboardMode&TransformNode.BILLBOARDMODE_ALL)!==TransformNode.BILLBOARDMODE_ALL){const t=x.jp.Vector3[1];x.jp.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&TransformNode.BILLBOARDMODE_X)!==TransformNode.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&TransformNode.BILLBOARDMODE_Y)!==TransformNode.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&TransformNode.BILLBOARDMODE_Z)!==TransformNode.BILLBOARDMODE_Z&&(t.z=0),x.y3.RotationYawPitchRollToRef(t.y,t.x,t.z,x.jp.Matrix[0])}else x.y3.FromQuaternionToRef(x.jp.Quaternion[0],x.jp.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(x.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(x.jp.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):o&&o._nonUniformScaling?this._updateNonUniformScalingState(o._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=x.y3.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}"resetLocalMatrix"(t=!0){if(this.computeWorldMatrix(),t){const t=this.getChildren();for(let i=0;i<t.length;++i){const r=t[i];if(r){r.computeWorldMatrix();const t=x.jp.Matrix[0];r._localMatrix.multiplyToRef(this._localMatrix,t);const i=x.jp.Quaternion[0];t.decompose(r.scaling,i,r.position),r.rotationQuaternion?r.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(r.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=x._f.Identity()),this._worldMatrix=x.y3.Identity()}"_afterComputeWorldMatrix"(){}"registerAfterWorldMatrixUpdate"(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this}"unregisterAfterWorldMatrixUpdate"(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this}"getPositionInCameraSpace"(t=null){return t||(t=this.getScene().activeCamera),x.P.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())}"getDistanceToCamera"(t=null){return t||(t=this.getScene().activeCamera),this.getAbsolutePosition().subtract(t.globalPosition).length()}"clone"(t,i,r){const a=A.p.Clone(()=>new TransformNode(t,this.getScene()),this);if(a.name=t,a.id=t,i&&(a.parent=i),!r){const i=this.getDescendants(!0);for(let r=0;r<i.length;r++){const o=i[r];o.clone&&o.clone(t+"."+o.name,a)}}return a}"serialize"(t){const i=A.p.Serialize(this,t);return i.type=this.getClassName(),i.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(i),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),A.p.AppendSerializedAnimations(this,i),i.ranges=this.serializeAnimationRanges(),i}static"Parse"(t,i,r){const a=A.p.Parse(()=>new TransformNode(t.name,i),t,i,r);if(t.localMatrix?a.setPreTransformMatrix(x.y3.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(x.y3.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),a._waitingParsedUniqueId=t.uniqueId,void 0!==t.parentId&&(a._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(a._waitingParentInstanceIndex=t.parentInstanceIndex),t.animations){for(let i=0;i<t.animations.length;i++){const r=t.animations[i],o=(0,v.qw)("BABYLON.Animation");o&&a.animations.push(o.Parse(r))}Node.ParseAnimationRanges(a,t,i)}return t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),a}"getChildTransformNodes"(t,i){const r=[];return this._getDescendants(r,t,t=>(!i||i(t))&&t instanceof TransformNode),r}"dispose"(t,i=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const t=this._parentContainer.transformNodes.indexOf(this);t>-1&&this._parentContainer.transformNodes.splice(t,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t){const t=this.getChildTransformNodes(!0);for(const i of t)i.parent=null,i.computeWorldMatrix(!0)}super.dispose(t,i)}"normalizeToUnitCube"(t=!0,i=!1,r){let a=null,o=null;i&&(this.rotationQuaternion?(o=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(a=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const h=this.getHierarchyBoundingVectors(t,r),l=h.max.subtract(h.min),c=Math.max(l.x,l.y,l.z);if(0===c)return this;const u=1/c;return this.scaling.scaleInPlace(u),i&&(this.rotationQuaternion&&o?this.rotationQuaternion.copyFrom(o):this.rotation&&a&&this.rotation.copyFrom(a)),this}"_syncAbsoluteScalingAndRotation"(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}TransformNode.BILLBOARDMODE_NONE=0,TransformNode.BILLBOARDMODE_X=1,TransformNode.BILLBOARDMODE_Y=2,TransformNode.BILLBOARDMODE_Z=4,TransformNode.BILLBOARDMODE_ALL=7,TransformNode.BILLBOARDMODE_USE_POSITION=128,TransformNode.BillboardUseParentOrientation=!1,TransformNode._TmpRotation=x._f.Zero(),TransformNode._TmpScaling=x.P.Zero(),TransformNode._TmpTranslation=x.P.Zero(),TransformNode._LookAtVectorCache=new x.P(0,0,0),TransformNode._RotationAxisCache=new x._f,(0,m.gn)([(0,T.hd)("position")],TransformNode.prototype,"_position",void 0),(0,m.gn)([(0,T.hd)("rotation")],TransformNode.prototype,"_rotation",void 0),(0,m.gn)([(0,T.mv)("rotationQuaternion")],TransformNode.prototype,"_rotationQuaternion",void 0),(0,m.gn)([(0,T.hd)("scaling")],TransformNode.prototype,"_scaling",void 0),(0,m.gn)([(0,T.qC)("billboardMode")],TransformNode.prototype,"_billboardMode",void 0),(0,m.gn)([(0,T.qC)()],TransformNode.prototype,"scalingDeterminant",void 0),(0,m.gn)([(0,T.qC)("infiniteDistance")],TransformNode.prototype,"_infiniteDistance",void 0),(0,m.gn)([(0,T.qC)()],TransformNode.prototype,"ignoreNonUniformScaling",void 0),(0,m.gn)([(0,T.qC)()],TransformNode.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);class _MeshCollisionData{"constructor"(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new x.P(0,0,0),this._diffPositionForCollisions=new x.P(0,0,0),this._collisionResponse=!0}}var ce=r(5241);class _FacetDataStorage{"constructor"(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=x.P.Zero(),this.subDiv={"max":1,"X":1,"Y":1,"Z":1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class _InternalAbstractMeshDataInfo{"constructor"(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new _FacetDataStorage,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new _MeshCollisionData,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class AbstractMesh extends TransformNode{static get"BILLBOARDMODE_NONE"(){return TransformNode.BILLBOARDMODE_NONE}static get"BILLBOARDMODE_X"(){return TransformNode.BILLBOARDMODE_X}static get"BILLBOARDMODE_Y"(){return TransformNode.BILLBOARDMODE_Y}static get"BILLBOARDMODE_Z"(){return TransformNode.BILLBOARDMODE_Z}static get"BILLBOARDMODE_ALL"(){return TransformNode.BILLBOARDMODE_ALL}static get"BILLBOARDMODE_USE_POSITION"(){return TransformNode.BILLBOARDMODE_USE_POSITION}get"facetNb"(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get"partitioningSubdivisions"(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set"partitioningSubdivisions"(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t}get"partitioningBBoxRatio"(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set"partitioningBBoxRatio"(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t}get"mustDepthSortFacets"(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set"mustDepthSortFacets"(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t}get"facetDepthSortFrom"(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set"facetDepthSortFrom"(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t}get"collisionRetryCount"(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set"collisionRetryCount"(t){this._internalAbstractMeshDataInfo._collisionRetryCount=t}get"isFacetDataEnabled"(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get"morphTargetManager"(){return this._internalAbstractMeshDataInfo._morphTargetManager}set"morphTargetManager"(t){this._internalAbstractMeshDataInfo._morphTargetManager!==t&&(this._internalAbstractMeshDataInfo._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())}get"bakedVertexAnimationManager"(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set"bakedVertexAnimationManager"(t){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==t&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=t,this._markSubMeshesAsAttributesDirty())}"_syncGeometryWithMorphTargetManager"(){}"_updateNonUniformScalingState"(t){return!!super._updateNonUniformScalingState(t)&&(this._markSubMeshesAsMiscDirty(),!0)}get"rawBoundingInfo"(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set"rawBoundingInfo"(t){this._internalAbstractMeshDataInfo._rawBoundingInfo=t}set"onCollide"(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)}set"onCollisionPositionChange"(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)}get"visibility"(){return this._internalAbstractMeshDataInfo._visibility}set"visibility"(t){if(this._internalAbstractMeshDataInfo._visibility===t)return;const i=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=t,(1===i&&1!==t||1!==i&&1===t)&&this._markSubMeshesAsDirty(t=>{t.markAsMiscDirty(),t.markAsPrePassDirty()})}get"inheritVisibility"(){return this._internalAbstractMeshDataInfo._inheritVisibility}set"inheritVisibility"(t){this._internalAbstractMeshDataInfo._inheritVisibility=t}get"isVisible"(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let t=this._parentNode;for(;t;){const i=t.isVisible;if(void 0!==i)return i;t=t.parent}}return this._isVisible}set"isVisible"(t){this._isVisible=t}get"pointerOverDisableMeshTesting"(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set"pointerOverDisableMeshTesting"(t){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=t}get"renderingGroupId"(){return this._internalAbstractMeshDataInfo._renderingGroupId}set"renderingGroupId"(t){this._internalAbstractMeshDataInfo._renderingGroupId=t}get"material"(){return this._internalAbstractMeshDataInfo._material}set"material"(t){this._setMaterial(t)}"_setMaterial"(t){this._internalAbstractMeshDataInfo._material!==t&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(void 0,null==t),this._unBindEffect()))}"getMaterialForRenderPass"(t){return this._internalAbstractMeshDataInfo._materialForRenderPass?.[t]}"setMaterialForRenderPass"(t,i){this.resetDrawCache(t),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const r=this._internalAbstractMeshDataInfo._materialForRenderPass[t];r?.meshMap?.[this.uniqueId]&&(r.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[t]=i,i&&i.meshMap&&(i.meshMap[this.uniqueId]=this)}get"receiveShadows"(){return this._internalAbstractMeshDataInfo._receiveShadows}set"receiveShadows"(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())}get"hasVertexAlpha"(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set"hasVertexAlpha"(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get"useVertexColors"(){return this._internalAbstractMeshDataInfo._useVertexColors}set"useVertexColors"(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())}get"computeBonesUsingShaders"(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set"computeBonesUsingShaders"(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())}get"numBoneInfluencers"(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set"numBoneInfluencers"(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())}get"applyFog"(){return this._internalAbstractMeshDataInfo._applyFog}set"applyFog"(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())}get"enableDistantPicking"(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set"enableDistantPicking"(t){this._internalAbstractMeshDataInfo._enableDistantPicking=t}get"layerMask"(){return this._internalAbstractMeshDataInfo._layerMask}set"layerMask"(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())}get"collisionMask"(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set"collisionMask"(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(t)?-1:t}get"collisionResponse"(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set"collisionResponse"(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=t}get"collisionGroup"(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set"collisionGroup"(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(t)?-1:t}get"surroundingMeshes"(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set"surroundingMeshes"(t){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=t}get"lightSources"(){return this._lightSources}set"skeleton"(t){const i=this._internalAbstractMeshDataInfo._skeleton;i&&i.needInitialSkinMatrix&&i._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get"skeleton"(){return this._internalAbstractMeshDataInfo._skeleton}"constructor"(t,i=null){switch(super(t,i,!1),this._internalAbstractMeshDataInfo=new _InternalAbstractMeshDataInfo,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.cullingStrategy=AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new b.y$,this.onCollisionPositionChangeObservable=new b.y$,this.onMaterialChangedObservable=new b.y$,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=V.Wo.Red(),this.outlineWidth=.02,this.overlayColor=V.Wo.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new x.P(.5,1,.5),this.ellipsoidOffset=new x.P(0,0,0),this.edgesWidth=1,this.edgesColor=new V.HE(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={"lods":null,"actions":null,"freezeWorldMatrix":null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new b.y$,this._onCollisionPositionChange=(t,i,r=null)=>{i.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>U.a.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),r&&this.onCollideObservable.notifyObservers(r),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(i=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new K.M(this.getScene().getEngine(),void 0,void 0,t,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),i.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}"_buildUniformLayout"(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}"transferToEffect"(t){const i=this._uniformBuffer;i.updateMatrix("world",t),i.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),i.update()}"getMeshUniformBuffer"(){return this._uniformBuffer}"getClassName"(){return"AbstractMesh"}"toString"(t){let i="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const r=this._internalAbstractMeshDataInfo._skeleton;return r&&(i+=", skeleton: "+r.name),t&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),i}"_getEffectiveParent"(){return this._masterMesh&&this.billboardMode!==TransformNode.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}"_getActionManagerForTrigger"(t,i=!0){if(this.actionManager&&(i||this.actionManager.isRecursive)){if(!t)return this.actionManager;if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}"_rebuild"(t=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){for(const t of this.subMeshes)t._rebuild();this.resetDrawCache()}}"_resyncLightSources"(){this._lightSources.length=0;for(const t of this.getScene().lights)t.isEnabled()&&t.canAffectMesh(this)&&this._lightSources.push(t);this._markSubMeshesAsLightDirty()}"_resyncLightSource"(t){const i=t.isEnabled()&&t.canAffectMesh(this),r=this._lightSources.indexOf(t);let a=!1;if(-1===r){if(!i)return;this._lightSources.push(t)}else{if(i)return;a=!0,this._lightSources.splice(r,1)}this._markSubMeshesAsLightDirty(a)}"_unBindEffect"(){for(const t of this.subMeshes)t.setEffect(null)}"_removeLightSource"(t,i){const r=this._lightSources.indexOf(t);-1!==r&&(this._lightSources.splice(r,1),this._markSubMeshesAsLightDirty(i))}"_markSubMeshesAsDirty"(t){if(this.subMeshes)for(const i of this.subMeshes)for(let r=0;r<i._drawWrappers.length;++r){const a=i._drawWrappers[r];a&&a.defines&&a.defines.markAllAsDirty&&t(a.defines)}}"_markSubMeshesAsLightDirty"(t=!1){this._markSubMeshesAsDirty(i=>i.markAsLightDirty(t))}"_markSubMeshesAsAttributesDirty"(){this._markSubMeshesAsDirty(t=>t.markAsAttributesDirty())}"_markSubMeshesAsMiscDirty"(){this._markSubMeshesAsDirty(t=>t.markAsMiscDirty())}"markAsDirty"(t){return this._currentRenderId=Number.MAX_VALUE,super.markAsDirty(t),this._isDirty=!0,this}"resetDrawCache"(t,i=!1){if(this.subMeshes)for(const r of this.subMeshes)r.resetDrawCache(t,i)}get"isBlocked"(){return!1}"getLOD"(t){return this}"getTotalVertices"(){return 0}"getTotalIndices"(){return 0}"getIndices"(){return null}"getVerticesData"(t){return null}"setVerticesData"(t,i,r,a){return this}"updateVerticesData"(t,i,r,a){return this}"setIndices"(t,i){return this}"isVerticesDataPresent"(t){return!1}"getBoundingInfo"(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}"getRawBoundingInfo"(){return this.rawBoundingInfo??this.getBoundingInfo()}"setBoundingInfo"(t){return this._boundingInfo=t,this}get"hasBoundingInfo"(){return null!==this._boundingInfo}"buildBoundingInfo"(t,i,r){return this._boundingInfo=new BoundingInfo(t,i,r),this._boundingInfo}"normalizeToUnitCube"(t=!0,i=!1,r){return super.normalizeToUnitCube(t,i,r)}get"useBones"(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(G.o.MatricesIndicesKind)&&this.isVerticesDataPresent(G.o.MatricesWeightsKind)}"_preActivate"(){}"_preActivateForIntermediateRendering"(t){}"_activate"(t,i){return this._renderId=t,!0}"_postActivate"(){}"_freeze"(){}"_unFreeze"(){}"getWorldMatrix"(){return this._masterMesh&&this.billboardMode===TransformNode.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}"_getWorldMatrixDeterminant"(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get"isAnInstance"(){return!1}get"hasInstances"(){return!1}get"hasThinInstances"(){return!1}"movePOV"(t,i,r){return this.position.addInPlace(this.calcMovePOV(t,i,r)),this}"calcMovePOV"(t,i,r){const a=new x.y3;(this.rotationQuaternion?this.rotationQuaternion:x._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(a);const o=x.P.Zero(),h=this.definedFacingForward?-1:1;return x.P.TransformCoordinatesFromFloatsToRef(t*h,i,r*h,a,o),o}"rotatePOV"(t,i,r){return this.rotation.addInPlace(this.calcRotatePOV(t,i,r)),this}"calcRotatePOV"(t,i,r){const a=this.definedFacingForward?1:-1;return new x.P(t*a,i,r*a)}"_refreshBoundingInfo"(t,i){if(t){const r=extractMinAndMax(t,0,this.getTotalVertices(),i);this._boundingInfo?this._boundingInfo.reConstruct(r.minimum,r.maximum):this._boundingInfo=new BoundingInfo(r.minimum,r.maximum)}if(this.subMeshes)for(let i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(t);this._updateBoundingInfo()}"_refreshBoundingInfoDirect"(t){if(this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new BoundingInfo(t.minimum,t.maximum),this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(null);this._updateBoundingInfo()}static"_ApplySkeleton"(t,i,r,a,o,h,l){!function applySkeleton(t,i,r,a,o,h,l){const c=x.jp.Vector3[0],u=x.jp.Matrix[0],d=x.jp.Matrix[1],_=i===G.o.NormalKind?x.P.TransformNormalFromFloatsToRef:x.P.TransformCoordinatesFromFloatsToRef;for(let i=0,g=0;i<t.length;i+=3,g+=4){let p,m;for(u.reset(),p=0;p<4;p++)m=o[g+p],m>0&&(x.y3.FromFloat32ArrayToRefScaled(r,Math.floor(16*a[g+p]),m,d),u.addToSelf(d));if(h&&l)for(p=0;p<4;p++)m=l[g+p],m>0&&(x.y3.FromFloat32ArrayToRefScaled(r,Math.floor(16*h[g+p]),m,d),u.addToSelf(d));_(t[i],t[i+1],t[i+2],u,c),c.toArray(t,i)}}(t,i,r,a,o,h,l)}"_getData"(t,i,r=G.o.PositionKind){const a=t.cache,getVertexData=t=>{if(a){const i=a._vertexData||(a._vertexData={});return i[t]||this.copyVerticesData(t,i),i[t]}return this.getVerticesData(t)};if(i||(i=getVertexData(r)),!i)return null;if(a?(a._outputData?a._outputData.set(i):a._outputData=new Float32Array(i),i=a._outputData):(t.applyMorph&&this.morphTargetManager||t.applySkeleton&&this.skeleton)&&(i=i.slice()),t.applyMorph&&this.morphTargetManager&&function applyMorph(t,i,r){let a=null;switch(i){case G.o.PositionKind:a=t=>t.getPositions();break;case G.o.NormalKind:a=t=>t.getNormals();break;case G.o.TangentKind:a=t=>t.getTangents();break;case G.o.UVKind:a=t=>t.getUVs();break;case G.o.UV2Kind:a=t=>t.getUV2s();break;case G.o.ColorKind:a=t=>t.getColors();break;default:return}for(let i=0;i<t.length;i++){let o=t[i];for(let h=0;h<r.numTargets;h++){const l=r.getTarget(h),c=l.influence;if(0!==c){const r=a(l);r&&(o+=(r[i]-t[i])*c)}}t[i]=o}}(i,r,this.morphTargetManager),t.applySkeleton&&this.skeleton){const t=getVertexData(G.o.MatricesIndicesKind),a=getVertexData(G.o.MatricesWeightsKind);if(a&&t){const o=this.numBoneInfluencers>4,h=o?getVertexData(G.o.MatricesIndicesExtraKind):null,l=o?getVertexData(G.o.MatricesWeightsExtraKind):null,c=this.skeleton.getTransformMatrices(this);AbstractMesh._ApplySkeleton(i,r,c,t,a,h,l)}}if(!1!==t.updatePositionsArray&&r===G.o.PositionKind){const t=this._internalAbstractMeshDataInfo._positions||[],r=t.length;if(t.length=i.length/3,r<t.length)for(let i=r;i<t.length;i++)t[i]=new x.P;for(let r=0,a=0;r<t.length;r++,a+=3)t[r].copyFromFloats(i[a],i[a+1],i[a+2]);this._internalAbstractMeshDataInfo._positions=t}return i}"getNormalsData"(t=!1,i=!1){return this._getData({"applySkeleton":t,"applyMorph":i,"updatePositionsArray":!1},null,G.o.NormalKind)}"getPositionData"(t=!1,i=!1,r=null){return this._getData({"applySkeleton":t,"applyMorph":i,"updatePositionsArray":!1},r,G.o.PositionKind)}"_updateBoundingInfo"(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new BoundingInfo(x.P.Zero(),x.P.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}"_updateSubMeshesBoundingInfo"(t){if(!this.subMeshes)return this;const i=this.subMeshes.length;for(let r=0;r<i;r++){const a=this.subMeshes[r];(i>1||!a.IsGlobal)&&a.updateBoundingInfo(t)}return this}"_afterComputeWorldMatrix"(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}"isInFrustum"(t){return this.getBoundingInfo().isInFrustum(t,this.cullingStrategy)}"isCompletelyInFrustum"(t){return this.getBoundingInfo().isCompletelyInFrustum(t)}"intersectsMesh"(t,i=!1,r){const a=this.getBoundingInfo(),o=t.getBoundingInfo();if(a.intersects(o,i))return!0;if(r)for(const r of this.getChildMeshes())if(r.intersectsMesh(t,i,!0))return!0;return!1}"intersectsPoint"(t){return this.getBoundingInfo().intersectsPoint(t)}get"checkCollisions"(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set"checkCollisions"(t){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=t}get"collider"(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}"moveWithCollisions"(t){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const i=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=i.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,i.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}"_collideForSubMesh"(t,i,r){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];const r=t.verticesStart,a=t.verticesStart+t.verticesCount;for(let o=r;o<a;o++)t._lastColliderWorldVertices.push(x.P.TransformCoordinates(this._positions[o],i))}return r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this,this._shouldConvertRHS(),7===t.getMaterial()?.fillMode),this}"_processCollisionsForSubMeshes"(t,i){const r=this._scene.getCollidingSubMeshCandidates(this,t),a=r.length;for(let o=0;o<a;o++){const h=r.data[o];a>1&&!h._checkCollision(t)||this._collideForSubMesh(h,i,t)}return this}"_shouldConvertRHS"(){return!1}"_checkCollision"(t){if(!this.getBoundingInfo()._checkCollision(t))return this;const i=x.jp.Matrix[0],r=x.jp.Matrix[1];return x.y3.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,i),this.worldMatrixFromCache.multiplyToRef(i,r),this._processCollisionsForSubMeshes(t,r),this}"_generatePointsArray"(){return!1}"intersects"(t,i,r,a=!1,o,h=!1){const l=new O.p,c=this.getClassName(),u="InstancedLinesMesh"===c||"LinesMesh"===c||"GreasedLineMesh"===c?this.intersectionThreshold:0,d=this.getBoundingInfo();if(!this.subMeshes)return l;if(!(h||t.intersectsSphere(d.boundingSphere,u)&&t.intersectsBox(d.boundingBox,u)))return l;if(a)return l.hit=!h,l.pickedMesh=h?null:this,l.distance=h?0:x.P.Distance(t.origin,d.boundingSphere.center),l.subMeshId=0,l;if(!this._generatePointsArray())return l;let _=null;const g=this._scene.getIntersectingSubMeshCandidates(this,t),p=g.length;let m=!1;for(let t=0;t<p;t++){const i=g.data[t].getMaterial();if(i&&(7==i.fillMode||0==i.fillMode||1==i.fillMode||2==i.fillMode||4==i.fillMode)){m=!0;break}}if(!m)return l.hit=!0,l.pickedMesh=this,l.distance=x.P.Distance(t.origin,d.boundingSphere.center),l.subMeshId=-1,l;for(let a=0;a<p;a++){const o=g.data[a];if(p>1&&!h&&!o.canIntersects(t))continue;const l=o.intersects(t,this._positions,this.getIndices(),i,r);if(l&&(i||!_||l.distance<_.distance)&&(_=l,_.subMeshId=a,i))break}if(_){const i=o??this.getWorldMatrix(),r=x.jp.Vector3[0],a=x.jp.Vector3[1];x.P.TransformCoordinatesToRef(t.origin,i,r),t.direction.scaleToRef(_.distance,a);const h=x.P.TransformNormal(a,i).addInPlace(r);return l.hit=!0,l.distance=x.P.Distance(r,h),l.pickedPoint=h,l.pickedMesh=this,l.bu=_.bu||0,l.bv=_.bv||0,l.subMeshFaceId=_.faceId,l.faceId=_.faceId+g.data[_.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),l.subMeshId=_.subMeshId,l}return l}"clone"(t,i,r){return null}"releaseSubMeshes"(t=!1){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose(t);else this.subMeshes=[];return this}"dispose"(t,i=!1){let r;const a=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),a.freeActiveMeshes(),a.freeRenderingGroups(),a.renderingManager.maintainStateBetweenFrames&&a.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some(t=>t!==this&&t.actionManager===this.actionManager)&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),r=0;r<this._intersectionsInProgress.length;r++){const t=this._intersectionsInProgress[r],i=t._intersectionsInProgress.indexOf(this);t._intersectionsInProgress.splice(i,1)}this._intersectionsInProgress.length=0;a.lights.forEach(t=>{let i=t.includedOnlyMeshes.indexOf(this);-1!==i&&t.includedOnlyMeshes.splice(i,1),i=t.excludedMeshes.indexOf(this),-1!==i&&t.excludedMeshes.splice(i,1);const r=t.getShadowGenerators();if(r){const t=r.values();for(let r=t.next();!0!==r.done;r=t.next()){const t=r.value.getShadowMap();t&&t.renderList&&(i=t.renderList.indexOf(this),-1!==i&&t.renderList.splice(i,1))}}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const o=a.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,o.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),o.wipeCaches(),a.removeMesh(this),this._parentContainer){const t=this._parentContainer.meshes.indexOf(this);t>-1&&this._parentContainer.meshes.splice(t,1),this._parentContainer=null}if(i&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(r=0;r<a.particleSystems.length;r++)a.particleSystems[r].emitter===this&&(a.particleSystems[r].dispose(),r--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(t,i)}"_initFacetData"(){const t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=[]),t.facetPositions||(t.facetPositions=[]),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(let i=0;i<t.facetNb;i++)t.facetNormals[i]=x.P.Zero(),t.facetPositions[i]=x.P.Zero();return t.facetDataEnabled=!0,this}"updateFacetData"(){const t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();const i=this.getVerticesData(G.o.PositionKind),r=this.getIndices(),a=this.getVerticesData(G.o.NormalKind),o=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,r instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(r);else if(r instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(r);else{let i=!1;for(let t=0;t<r.length;t++)if(r[t]>65535){i=!0;break}t.depthSortedIndices=i?new Uint32Array(r):new Uint16Array(r)}if(t.facetDepthSortFunction=function(t,i){return i.sqDistance-t.sqDistance},!t.facetDepthSortFrom){const i=this.getScene().activeCamera;t.facetDepthSortFrom=i?i.position:x.P.Zero()}t.depthSortedFacets=[];for(let i=0;i<t.facetNb;i++){const r={"ind":3*i,"sqDistance":0};t.depthSortedFacets.push(r)}t.invertedMatrix=x.y3.Identity(),t.facetDepthSortOrigin=x.P.Zero()}t.bbSize.x=o.maximum.x-o.minimum.x>I.kn?o.maximum.x-o.minimum.x:I.kn,t.bbSize.y=o.maximum.y-o.minimum.y>I.kn?o.maximum.y-o.minimum.y:I.kn,t.bbSize.z=o.maximum.z-o.minimum.z>I.kn?o.maximum.z-o.minimum.z:I.kn;let h=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(h=h>t.bbSize.z?h:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/h),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/h),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/h),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=o,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),x.P.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,a&&VertexData.ComputeNormals(i,r,a,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);const i=t.depthSortedIndices.length/3|0;for(let a=0;a<i;a++){const i=t.depthSortedFacets[a].ind;t.depthSortedIndices[3*a]=r[i],t.depthSortedIndices[3*a+1]=r[i+1],t.depthSortedIndices[3*a+2]=r[i+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this}"getFacetLocalNormals"(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals}"getFacetLocalPositions"(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions}"getFacetLocalPartitioning"(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning}"getFacetPosition"(t){const i=x.P.Zero();return this.getFacetPositionToRef(t,i),i}"getFacetPositionToRef"(t,i){const r=this.getFacetLocalPositions()[t],a=this.getWorldMatrix();return x.P.TransformCoordinatesToRef(r,a,i),this}"getFacetNormal"(t){const i=x.P.Zero();return this.getFacetNormalToRef(t,i),i}"getFacetNormalToRef"(t,i){const r=this.getFacetLocalNormals()[t];return x.P.TransformNormalToRef(r,this.getWorldMatrix(),i),this}"getFacetsAtLocalCoordinates"(t,i,r){const a=this.getBoundingInfo(),o=this._internalAbstractMeshDataInfo._facetData,h=Math.floor((t-a.minimum.x*o.partitioningBBoxRatio)*o.subDiv.X*o.partitioningBBoxRatio/o.bbSize.x),l=Math.floor((i-a.minimum.y*o.partitioningBBoxRatio)*o.subDiv.Y*o.partitioningBBoxRatio/o.bbSize.y),c=Math.floor((r-a.minimum.z*o.partitioningBBoxRatio)*o.subDiv.Z*o.partitioningBBoxRatio/o.bbSize.z);return h<0||h>o.subDiv.max||l<0||l>o.subDiv.max||c<0||c>o.subDiv.max?null:o.facetPartitioning[h+o.subDiv.max*l+o.subDiv.max*o.subDiv.max*c]}"getClosestFacetAtCoordinates"(t,i,r,a,o=!1,h=!0){const l=this.getWorldMatrix(),c=x.jp.Matrix[5];l.invertToRef(c);const u=x.jp.Vector3[8];x.P.TransformCoordinatesFromFloatsToRef(t,i,r,c,u);const d=this.getClosestFacetAtLocalCoordinates(u.x,u.y,u.z,a,o,h);return a&&x.P.TransformCoordinatesFromFloatsToRef(a.x,a.y,a.z,l,a),d}"getClosestFacetAtLocalCoordinates"(t,i,r,a,o=!1,h=!0){let l=null,c=0,u=0,d=0,_=0,g=0,p=0,m=0,T=0;const y=this.getFacetLocalPositions(),M=this.getFacetLocalNormals(),b=this.getFacetsAtLocalCoordinates(t,i,r);if(!b)return null;let x,E,R,A=Number.MAX_VALUE,C=A;for(let v=0;v<b.length;v++)x=b[v],E=M[x],R=y[x],_=(t-R.x)*E.x+(i-R.y)*E.y+(r-R.z)*E.z,(!o||o&&h&&_>=0||o&&!h&&_<=0)&&(_=E.x*R.x+E.y*R.y+E.z*R.z,g=-(E.x*t+E.y*i+E.z*r-_)/(E.x*E.x+E.y*E.y+E.z*E.z),p=t+E.x*g,m=i+E.y*g,T=r+E.z*g,c=p-t,u=m-i,d=T-r,C=c*c+u*u+d*d,C<A&&(A=C,l=x,a&&(a.x=p,a.y=m,a.z=T)));return l}"getFacetDataParameters"(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}"disableFacetData"(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=[],t.facetNormals=[],t.facetPartitioning=new Array,t.facetParameters={},t.depthSortedIndices=new Uint32Array(0)),this}"updateIndices"(t,i,r=!1){return this}"createNormals"(t){const i=this.getVerticesData(G.o.PositionKind),r=this.getIndices();let a;return a=this.isVerticesDataPresent(G.o.NormalKind)?this.getVerticesData(G.o.NormalKind):[],VertexData.ComputeNormals(i,r,a,{"useRightHandedSystem":this.getScene().useRightHandedSystem}),this.setVerticesData(G.o.NormalKind,a,t),this}async"optimizeIndicesAsync"(){const t=this.getIndices();if(!t)return this;const{"OptimizeIndices":i}=await r.e(242).then(r.bind(r,3242));return i(t),this.setIndices(t,this.getTotalVertices()),this}"alignWithNormal"(t,i){i||(i=ce.RD.Y);const r=x.jp.Vector3[0],a=x.jp.Vector3[1];return x.P.CrossToRef(i,t,a),x.P.CrossToRef(t,a,r),this.rotationQuaternion?x._f.RotationQuaternionFromAxisToRef(r,t,a,this.rotationQuaternion):x.P.RotationFromAxisToRef(r,t,a,this.rotation),this}"_checkOcclusionQuery"(){return!1}"disableEdgesRendering"(){throw(0,R.S)("EdgesRenderer")}"enableEdgesRendering"(t,i,r){throw(0,R.S)("EdgesRenderer")}"getConnectedParticleSystems"(){return this._scene.particleSystems.filter(t=>t.emitter===this)}}AbstractMesh.OCCLUSION_TYPE_NONE=0,AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC=1,AbstractMesh.OCCLUSION_TYPE_STRICT=2,AbstractMesh.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,AbstractMesh.CULLINGSTRATEGY_STANDARD=0,AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,m.gn)([T.G6.filter((...[t,i,r,a,o])=>!(Array.isArray(t)||Array.isArray(i)||Array.isArray(r)||Array.isArray(a)||Array.isArray(o)))],AbstractMesh,"_ApplySkeleton",null),(0,v.H7)("BABYLON.AbstractMesh",AbstractMesh);class MultiMaterial extends material_Material{get"subMaterials"(){return this._subMaterials}set"subMaterials"(t){this._subMaterials=t,this._hookArray(t)}"getChildren"(){return this.subMaterials}"constructor"(t,i){super(t,i,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}"_hookArray"(t){const i=t.push;t.push=(...r)=>{const a=i.apply(t,r);return this._markAllSubMeshesAsTexturesDirty(),a};const r=t.splice;t.splice=(i,a)=>{const o=r.apply(t,[i,a]);return this._markAllSubMeshesAsTexturesDirty(),o}}"getSubMaterial"(t){return t<0||t>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[t]}"getActiveTextures"(){return super.getActiveTextures().concat(...this.subMaterials.map(t=>t?t.getActiveTextures():[]))}"hasTexture"(t){if(super.hasTexture(t))return!0;for(let i=0;i<this.subMaterials.length;i++)if(this.subMaterials[i]?.hasTexture(t))return!0;return!1}"getClassName"(){return"MultiMaterial"}"isReadyForSubMesh"(t,i,r){for(let a=0;a<this.subMaterials.length;a++){const o=this.subMaterials[a];if(o){if(o._storeEffectOnSubMeshes){if(!o.isReadyForSubMesh(t,i,r))return!1;continue}if(!o.isReady(t))return!1}}return!0}"clone"(t,i){const r=new MultiMaterial(t,this.getScene());for(let a=0;a<this.subMaterials.length;a++){let o=null;const h=this.subMaterials[a];o=i&&h?h.clone(t+"-"+h.name):this.subMaterials[a],r.subMaterials.push(o)}return r}"serialize"(){const t={};t.name=this.name,t.id=this.id,t.uniqueId=this.uniqueId,ae.$&&(t.tags=ae.$.GetTags(this)),t.materialsUniqueIds=[],t.materials=[];for(let i=0;i<this.subMaterials.length;i++){const r=this.subMaterials[i];r?(t.materialsUniqueIds.push(r.uniqueId),t.materials.push(r.id)):(t.materialsUniqueIds.push(null),t.materials.push(null))}return t}"dispose"(t,i,r){const a=this.getScene();if(!a)return;if(r)for(let r=0;r<this.subMaterials.length;r++){const a=this.subMaterials[r];a&&a.dispose(t,i)}const o=a.multiMaterials.indexOf(this);o>=0&&a.multiMaterials.splice(o,1),super.dispose(t,i)}static"ParseMultiMaterial"(t,i){const r=new MultiMaterial(t.name,i);return r.id=t.id,r._loadedUniqueId=t.uniqueId,ae.$&&ae.$.AddTagsTo(r,t.tags),t.materialsUniqueIds?r._waitingSubMaterialsUniqueIds=t.materialsUniqueIds:t.materials.forEach(t=>r.subMaterials.push(i.getLastMaterialById(t))),r}}(0,v.H7)("BABYLON.MultiMaterial",MultiMaterial);var ue=r(4559);class MeshLODLevel{"constructor"(t,i){this.distanceOrScreenCoverage=t,this.mesh=i}}class _InstanceDataStorage{"constructor"(){this.visibleInstances={},this.batchCache=new _InstancesBatch,this.batchCacheReplacementModeInFrozenMode=new _InstancesBatch,this.instancesBufferSize=2048}}class _InstancesBatch{"constructor"(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class _ThinInstanceDataStorage{"constructor"(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class _InternalMeshDataInfo{"constructor"(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const de={"source":null,"parent":null,"doNotCloneChildren":!1,"clonePhysicsImpostor":!0,"cloneThinInstances":!1};class Mesh extends AbstractMesh{static"_GetDefaultSideOrientation"(t){return t||Mesh.FRONTSIDE}get"useLODScreenCoverage"(){return this._internalMeshDataInfo._useLODScreenCoverage}set"useLODScreenCoverage"(t){this._internalMeshDataInfo._useLODScreenCoverage=t,this._sortLODLevels()}get"computeBonesUsingShaders"(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set"computeBonesUsingShaders"(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(t&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(G.o.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(G.o.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())}get"onBeforeRenderObservable"(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new b.y$),this._internalMeshDataInfo._onBeforeRenderObservable}get"onBeforeBindObservable"(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new b.y$),this._internalMeshDataInfo._onBeforeBindObservable}get"onAfterRenderObservable"(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new b.y$),this._internalMeshDataInfo._onAfterRenderObservable}get"onBetweenPassObservable"(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new b.y$),this._internalMeshDataInfo._onBetweenPassObservable}get"onBeforeDrawObservable"(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new b.y$),this._internalMeshDataInfo._onBeforeDrawObservable}set"onBeforeDraw"(t){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(t)}get"hasInstances"(){return this.instances.length>0}get"hasThinInstances"(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get"forcedInstanceCount"(){return this._internalMeshDataInfo._forcedInstanceCount}set"forcedInstanceCount"(t){this._internalMeshDataInfo._forcedInstanceCount=t}get"sideOrientation"(){return this._internalMeshDataInfo._sideOrientation}set"sideOrientation"(t){this._internalMeshDataInfo._sideOrientation=t,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===t||!this._scene.useRightHandedSystem&&0===t}get"overrideMaterialSideOrientation"(){return this.sideOrientation}set"overrideMaterialSideOrientation"(t){this.sideOrientation=t,this.material&&(this.material.sideOrientation=null)}get"overrideRenderingFillMode"(){return this._internalMeshDataInfo._overrideRenderingFillMode}set"overrideRenderingFillMode"(t){this._internalMeshDataInfo._overrideRenderingFillMode=t}get"material"(){return this._internalAbstractMeshDataInfo._material}set"material"(t){t&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(t.sideOrientation=null),this._setMaterial(t)}get"source"(){return this._internalMeshDataInfo._source}get"cloneMeshMap"(){return this._internalMeshDataInfo.meshMap}get"isUnIndexed"(){return this._unIndexed}set"isUnIndexed"(t){this._unIndexed!==t&&(this._unIndexed=t,this._markSubMeshesAsAttributesDirty())}get"worldMatrixInstancedBuffer"(){return this._instanceDataStorage.instancesData}get"previousWorldMatrixInstancedBuffer"(){return this._instanceDataStorage.instancesPreviousData}get"manualUpdateOfWorldMatrixInstancedBuffer"(){return this._instanceDataStorage.manualUpdate}set"manualUpdateOfWorldMatrixInstancedBuffer"(t){this._instanceDataStorage.manualUpdate=t}get"manualUpdateOfPreviousWorldMatrixInstancedBuffer"(){return this._instanceDataStorage.previousManualUpdate}set"manualUpdateOfPreviousWorldMatrixInstancedBuffer"(t){this._instanceDataStorage.previousManualUpdate=t}get"forceWorldMatrixInstancedBufferUpdate"(){return this._instanceDataStorage.forceMatrixUpdates}set"forceWorldMatrixInstancedBufferUpdate"(t){this._instanceDataStorage.forceMatrixUpdates=t}"_copySource"(t,i,r=!0,a=!1){const o=this.getScene();if(t._geometry&&t._geometry.applyToMesh(this),ne.j.DeepCopy(t,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=t,o.useClonedMeshMap&&(t._internalMeshDataInfo.meshMap||(t._internalMeshDataInfo.meshMap={}),t._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=t._originalBuilderSideOrientation,this._creationDataStorage=t._creationDataStorage,t._ranges){const i=t._ranges;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&i[t]&&this.createAnimationRange(t,i[t].from,i[t].to)}if(t.metadata&&t.metadata.clone?this.metadata=t.metadata.clone():this.metadata=t.metadata,this._internalMetadata=t._internalMetadata,ae.$&&ae.$.HasTags(t)&&ae.$.AddTagsTo(this,ae.$.GetTags(t,!0)),this.setEnabled(t.isEnabled(!1)),this.parent=t.parent,this.setPivotMatrix(t.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+t.id,this.material=t.material,!i){const o=t.getDescendants(!0);for(let t=0;t<o.length;t++){const h=o[t];h._isMesh?(de.parent=this,de.doNotCloneChildren=i,de.clonePhysicsImpostor=r,de.cloneThinInstances=a,h.clone(this.name+"."+h.name,de)):h.clone&&h.clone(this.name+"."+h.name,this)}}if(t.morphTargetManager&&(this.morphTargetManager=t.morphTargetManager),o.getPhysicsEngine){const i=o.getPhysicsEngine();if(r&&i)if(1===i.getPluginVersion()){const r=i.getImpostorForPhysicsObject(t);r&&(this.physicsImpostor=r.clone(this))}else 2===i.getPluginVersion()&&t.physicsBody&&t.physicsBody.clone(this)}for(let i=0;i<o.particleSystems.length;i++){const r=o.particleSystems[i];r.emitter===t&&r.clone(r.name,this)}if(this.skeleton=t.skeleton,a&&(t._thinInstanceDataStorage.matrixData?(this.thinInstanceSetBuffer("matrix",new Float32Array(t._thinInstanceDataStorage.matrixData),16,!t._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=t._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=t._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=t._thinInstanceDataStorage.matrixBufferSize,t._userThinInstanceBuffersStorage)){const i=t._userThinInstanceBuffersStorage;for(const t in i.data)this.thinInstanceSetBuffer(t,new Float32Array(i.data[t]),i.strides[t],!i.vertexBuffers?.[t]?.isUpdatable()),this._userThinInstanceBuffersStorage.sizes[t]=i.sizes[t]}this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}"constructor"(t,i=null,r=null,a=null,o,h=!0){super(t,i),this._internalMeshDataInfo=new _InternalMeshDataInfo,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new _InstanceDataStorage,this._thinInstanceDataStorage=new _ThinInstanceDataStorage,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=Mesh.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,i=this.getScene(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(t,i,r)=>{t&&r&&(this._uniformBuffer?this.transferToEffect(i):r.bindOnlyWorldMatrix(i))};let l=null,c=!1;if(r&&void 0===r._addToSceneRootNodes){const t=r;l=t.parent??null,a=t.source??null,o=t.doNotCloneChildren??!1,h=t.clonePhysicsImpostor??!0,c=t.cloneThinInstances??!1}else l=r;a&&this._copySource(a,o,h,c),null!==l&&(this.parent=l),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=t=>{t.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add(()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))}))},this.onMeshReadyObservable=new b.y$(this._internalMeshDataInfo._onMeshReadyObserverAdded),a&&a.onClonedObservable.notifyObservers(this)}"instantiateHierarchy"(t=null,i,r){const a=0===this.getTotalVertices()||i&&i.doNotInstantiate&&(!0===i.doNotInstantiate||i.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),t||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));a.parent=t||this.parent,a.position=this.position.clone(),a.scaling=this.scaling.clone(),this.rotationQuaternion?a.rotationQuaternion=this.rotationQuaternion.clone():a.rotation=this.rotation.clone(),r&&r(this,a);for(const t of this.getChildTransformNodes(!0))"InstancedMesh"===t.getClassName()&&"Mesh"===a.getClassName()&&t.sourceMesh===this?t.instantiateHierarchy(a,{"doNotInstantiate":i&&i.doNotInstantiate||!1,"newSourcedMesh":a},r):t.instantiateHierarchy(a,i,r);return a}"getClassName"(){return"Mesh"}get"_isMesh"(){return!0}"toString"(t){let i=super.toString(t);if(i+=", n vertices: "+this.getTotalVertices(),i+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let r=0;r<this.animations.length;r++)i+=", animation[0]: "+this.animations[r].toString(t);if(t)if(this._geometry){const t=this.getIndices(),r=this.getVerticesData(G.o.PositionKind);r&&t&&(i+=", flat shading: "+(r.length/3===t.length?"YES":"NO"))}else i+=", flat shading: UNKNOWN";return i}"_unBindEffect"(){super._unBindEffect();for(const t of this.instances)t._unBindEffect()}get"hasLODLevels"(){return this._internalMeshDataInfo._LODLevels.length>0}"getLODLevels"(){return this._internalMeshDataInfo._LODLevels}"_sortLODLevels"(){const t=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((i,r)=>i.distanceOrScreenCoverage<r.distanceOrScreenCoverage?t:i.distanceOrScreenCoverage>r.distanceOrScreenCoverage?-t:0)}"addLODLevel"(t,i){if(i&&i._masterMesh)return C.Y.Warn("You cannot use a mesh as LOD level twice"),this;const r=new MeshLODLevel(t,i);return this._internalMeshDataInfo._LODLevels.push(r),i&&(i._masterMesh=this),this._sortLODLevels(),this}"getLODLevelAtDistance"(t){const i=this._internalMeshDataInfo;for(let r=0;r<i._LODLevels.length;r++){const a=i._LODLevels[r];if(a.distanceOrScreenCoverage===t)return a.mesh}return null}"removeLODLevel"(t){const i=this._internalMeshDataInfo;for(let r=0;r<i._LODLevels.length;r++)i._LODLevels[r].mesh===t&&(i._LODLevels.splice(r,1),t&&(t._masterMesh=null));return this._sortLODLevels(),this}"getLOD"(t,i){const r=this._internalMeshDataInfo;if(!r._LODLevels||0===r._LODLevels.length)return this;const a=i||this.getBoundingInfo().boundingSphere,o=t.mode===Camera.ORTHOGRAPHIC_CAMERA?t.minZ:a.centerWorld.subtract(t.globalPosition).length();let h=o,l=1;if(r._useLODScreenCoverage){const i=t.screenArea;let r=a.radiusWorld*t.minZ/o;r=r*r*Math.PI,h=r/i,l=-1}if(l*r._LODLevels[r._LODLevels.length-1].distanceOrScreenCoverage>l*h)return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this),this;for(let t=0;t<r._LODLevels.length;t++){const i=r._LODLevels[t];if(l*i.distanceOrScreenCoverage<l*h){if(i.mesh){if(4===i.mesh.delayLoadState)return i.mesh._checkDelayState(),this;if(2===i.mesh.delayLoadState)return this;i.mesh._preActivate(),i.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,i.mesh),i.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this),this}get"geometry"(){return this._geometry}"getTotalVertices"(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}"getVerticesData"(t,i,r,a){if(!this._geometry)return null;let o=a?void 0:this._userInstancedBuffersStorage?.vertexBuffers[t]?.getFloatData(this.instances.length+1,r||i&&1!==this._geometry.meshes.length);return o||(o=this._geometry.getVerticesData(t,i,r)),o}"copyVerticesData"(t,i){this._geometry&&this._geometry.copyVerticesData(t,i)}"getVertexBuffer"(t,i){return this._geometry?(i?void 0:this._userInstancedBuffersStorage?.vertexBuffers[t])??this._geometry.getVertexBuffer(t):null}"isVerticesDataPresent"(t,i){return this._geometry?!i&&void 0!==this._userInstancedBuffersStorage?.vertexBuffers[t]||this._geometry.isVerticesDataPresent(t):!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)}"isVertexBufferUpdatable"(t,i){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(t);if(!i){const i=this._userInstancedBuffersStorage?.vertexBuffers[t];if(i)return i.isUpdatable()}return this._geometry.isVertexBufferUpdatable(t)}"getVerticesDataKinds"(t){if(!this._geometry){const t=[];return this._delayInfo&&this._delayInfo.forEach(function(i){t.push(i)}),t}const i=this._geometry.getVerticesDataKinds();if(!t&&this._userInstancedBuffersStorage)for(const t in this._userInstancedBuffersStorage.vertexBuffers)-1===i.indexOf(t)&&i.push(t);return i}"getTotalIndices"(){return this._geometry?this._geometry.getTotalIndices():0}"getIndices"(t,i){return this._geometry?this._geometry.getIndices(t,i):[]}get"isBlocked"(){return null!==this._masterMesh&&void 0!==this._masterMesh}"isReady"(t=!1,i=!1){if(2===this.delayLoadState)return!1;if(!super.isReady(t))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!t)return!0;const r=this.getEngine(),a=this.getScene(),o=i||r.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const h=this.material||a.defaultMaterial;if(h)if(h._storeEffectOnSubMeshes)for(const t of this.subMeshes){const i=t.getMaterial();if(i)if(i._storeEffectOnSubMeshes){if(!i.isReadyForSubMesh(this,t,o))return!1}else if(!i.isReady(this,o))return!1}else if(!h.isReady(this,o))return!1;const l=r.currentRenderPassId;for(const t of this.lightSources){const i=t.getShadowGenerators();if(!i)continue;const a=i.values();for(let t=a.next();!0!==t.done;t=a.next()){const i=t.value;if(i&&(!i.getShadowMap()?.renderList||i.getShadowMap()?.renderList&&-1!==i.getShadowMap()?.renderList?.indexOf(this))){const t=i.getShadowMap().renderPassIds??[r.currentRenderPassId];for(let a=0;a<t.length;++a){r.currentRenderPassId=t[a];for(const t of this.subMeshes)if(!i.isReady(t,o,t.getMaterial()?.needAlphaBlendingForMesh(this)??!1))return r.currentRenderPassId=l,!1}r.currentRenderPassId=l}}}for(const t of this._internalMeshDataInfo._LODLevels)if(t.mesh&&!t.mesh.isReady(o))return!1;return!0}get"areNormalsFrozen"(){return this._internalMeshDataInfo._areNormalsFrozen}"freezeNormals"(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}"unfreezeNormals"(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set"overridenInstanceCount"(t){this._instanceDataStorage.overridenInstanceCount=t}"_preActivate"(){const t=this._internalMeshDataInfo,i=this.getScene().getRenderId();return t._preActivateId===i||(t._preActivateId=i,this._instanceDataStorage.visibleInstances=null),this}"_preActivateForIntermediateRendering"(t){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=t),this}"_registerInstanceForRenderId"(t,i){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={"defaultRenderId":i,"selfDefaultRenderId":this._renderId}),this._instanceDataStorage.visibleInstances[i]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=i,this._instanceDataStorage.visibleInstances[i]=new Array),this._instanceDataStorage.visibleInstances[i].push(t),this}"_afterComputeWorldMatrix"(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}"_postActivate"(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}"refreshBoundingInfo"(t=!1,i=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let r;r="object"==typeof t?t:{"applySkeleton":t,"applyMorph":i};const a=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData(r,null,G.o.PositionKind),a),this}"_createGlobalSubMesh"(t){const i=this.getTotalVertices();if(!i||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const r=this.getIndices();if(!r)return null;const a=r.length;let o=!1;if(t)o=!0;else for(const t of this.subMeshes){if(t.indexStart+t.indexCount>a){o=!0;break}if(t.verticesStart+t.verticesCount>i){o=!0;break}}if(!o)return this.subMeshes[0]}return this.releaseSubMeshes(),new SubMesh(0,0,i,0,this.getTotalIndices()||i,this)}"subdivide"(t){if(t<1)return;const i=this.getTotalIndices();let r=i/t|0,a=0;for(;r%3!=0;)r++;this.releaseSubMeshes();for(let o=0;o<t&&!(a>=i);o++)SubMesh.CreateFromIndices(0,a,o===t-1?i-a:r,this,void 0,!1),a+=r;this.refreshBoundingInfo(),this.synchronizeInstances()}"setVerticesData"(t,i,r=!1,a){if(this._geometry)this._geometry.setVerticesData(t,i,r,a);else{const a=new VertexData;a.set(i,t);const o=this.getScene();new Geometry(Geometry.RandomId(),o,a,r,this)}return this}"removeVerticesData"(t){this._geometry&&this._geometry.removeVerticesData(t)}"markVerticesDataAsUpdatable"(t,i=!0){const r=this.getVertexBuffer(t);r&&r.isUpdatable()!==i&&this.setVerticesData(t,this.getVerticesData(t),i)}"setVerticesBuffer"(t,i=!0){return this._geometry||(this._geometry=Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(t,null,i),this}"updateVerticesData"(t,i,r,a){return this._geometry?(a?(this.makeGeometryUnique(),this.updateVerticesData(t,i,r,!1)):this._geometry.updateVerticesData(t,i,r),this):this}"updateMeshPositions"(t,i=!0){const r=this.getVerticesData(G.o.PositionKind);if(!r)return this;if(t(r),this.updateVerticesData(G.o.PositionKind,r,!1,!1),i){const t=this.getIndices(),i=this.getVerticesData(G.o.NormalKind);if(!i)return this;VertexData.ComputeNormals(r,t,i),this.updateVerticesData(G.o.NormalKind,i,!1,!1)}return this}"makeGeometryUnique"(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const t=this._geometry,i=this._geometry.copy(Geometry.RandomId());return t.releaseForMesh(this,!0),i.applyToMesh(this),this}"setIndexBuffer"(t,i,r,a=null){let o=this._geometry;o||(o=new Geometry(Geometry.RandomId(),this.getScene(),void 0,void 0,this)),o.setIndexBuffer(t,i,r,a)}"setIndices"(t,i=null,r=!1,a=!1){if(this._geometry)this._geometry.setIndices(t,i,r,a);else{const i=new VertexData;i.indices=t;const a=this.getScene();new Geometry(Geometry.RandomId(),a,i,r,this)}return this}"updateIndices"(t,i,r=!1){return this._geometry?(this._geometry.updateIndices(t,i,r),this):this}"toLeftHanded"(){return this._geometry?(this._geometry.toLeftHanded(),this):this}"_bind"(t,i,r,a=!0){if(!this._geometry)return this;const o=this.getScene().getEngine();let h;if(this._unIndexed)if(this._getRenderingFillMode(r)===material_Material.WireFrameFillMode)h=t._getLinesIndexBuffer(this.getIndices(),o);else h=null;else switch(this._getRenderingFillMode(r)){case material_Material.PointFillMode:h=null;break;case material_Material.WireFrameFillMode:h=t._getLinesIndexBuffer(this.getIndices(),o);break;default:case material_Material.TriangleFillMode:h=this._geometry.getIndexBuffer()}return this._bindDirect(i,h,a)}"_bindDirect"(t,i,r=!0){return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(t),r&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(t,i),this):this}"_draw"(t,i,r){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const a=this.getScene().getEngine();return this._unIndexed&&i!==material_Material.WireFrameFillMode||i==material_Material.PointFillMode?a.drawArraysType(i,t.verticesStart,t.verticesCount,this.forcedInstanceCount||r):i==material_Material.WireFrameFillMode?a.drawElementsType(i,0,t._linesIndexCount,this.forcedInstanceCount||r):a.drawElementsType(i,t.indexStart,t.indexCount,this.forcedInstanceCount||r),this}"registerBeforeRender"(t){return this.onBeforeRenderObservable.add(t),this}"unregisterBeforeRender"(t){return this.onBeforeRenderObservable.removeCallback(t),this}"registerAfterRender"(t){return this.onAfterRenderObservable.add(t),this}"unregisterAfterRender"(t){return this.onAfterRenderObservable.removeCallback(t),this}"_getInstancesRenderList"(t,i=!1){if(this._instanceDataStorage.isFrozen){if(i)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[t]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[t]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const r=this.getScene(),a=r._isInIntermediateRendering(),o=a?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,h=this._instanceDataStorage.batchCache;if(h.mustReturn=!1,h.renderSelf[t]=i||!o&&this.isEnabled()&&this.isVisible,h.visibleInstances[t]=null,this._instanceDataStorage.visibleInstances&&!i){const i=this._instanceDataStorage.visibleInstances,o=r.getRenderId(),l=a?i.intermediateDefaultRenderId:i.defaultRenderId;h.visibleInstances[t]=i[o],!h.visibleInstances[t]&&l&&(h.visibleInstances[t]=i[l])}return h.hardwareInstancedRendering[t]=!i&&this._instanceDataStorage.hardwareInstancedRendering&&null!==h.visibleInstances[t]&&void 0!==h.visibleInstances[t],this._instanceDataStorage.previousBatch=h,h}"_updateInstancedBuffers"(t,i,r,a,o,h){const l=i.visibleInstances[t._id],c=l?l.length:0,u=this._instanceDataStorage;let d=u.instancesBuffer,_=u.instancesPreviousBuffer,g=0,p=0;const m=i.renderSelf[t._id],T=!d||r!==u.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!u.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||u.isFrozen&&!T)p=(m?1:0)+c;else{const i=this.getWorldMatrix();if(m&&(this._scene.needsPreviousWorldMatrices&&(u.masterMeshPreviousWorldMatrix?(u.masterMeshPreviousWorldMatrix.copyToArray(u.instancesPreviousData,g),u.masterMeshPreviousWorldMatrix.copyFrom(i)):(u.masterMeshPreviousWorldMatrix=i.clone(),u.masterMeshPreviousWorldMatrix.copyToArray(u.instancesPreviousData,g))),i.copyToArray(u.instancesData,g),g+=16,p++),l){if(Mesh.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&t.getMaterial()?.needAlphaBlendingForMesh(t.getRenderingMesh())){const t=this._scene.activeCamera.globalPosition;for(let i=0;i<l.length;i++){const r=l[i];r._distanceToCamera=x.P.Distance(r.getBoundingInfo().boundingSphere.centerWorld,t)}l.sort((t,i)=>t._distanceToCamera>i._distanceToCamera?-1:t._distanceToCamera<i._distanceToCamera?1:0)}for(let t=0;t<l.length;t++){const i=l[t],r=i.getWorldMatrix();r.copyToArray(u.instancesData,g),this._scene.needsPreviousWorldMatrices&&(i._previousWorldMatrix?(i._previousWorldMatrix.copyToArray(u.instancesPreviousData,g),i._previousWorldMatrix.copyFrom(r)):(i._previousWorldMatrix=r.clone(),i._previousWorldMatrix.copyToArray(u.instancesPreviousData,g))),g+=16,p++}}}T?(d&&d.dispose(),_&&_.dispose(),d=new G.l(a,u.instancesData,!0,16,!1,!0),u.instancesBuffer=d,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={"data":{},"vertexBuffers":{},"strides":{},"sizes":{},"vertexArrayObjects":this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=d.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=d.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=d.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=d.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(_=new G.l(a,u.instancesPreviousData,!0,16,!1,!0),u.instancesPreviousBuffer=_,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=_.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=_.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=_.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=_.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(d.updateDirectly(u.instancesData,0,p),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||_.updateDirectly(u.instancesPreviousData,0,p)),this._processInstancedBuffers(l,m),h&&void 0!==o&&(this.getScene()._activeIndices.addCount(t.indexCount*p,!1),a._currentDrawContext&&(a._currentDrawContext.useInstancing=!0),this._bind(t,h,o),this._draw(t,o,p)),!this._scene.needsPreviousWorldMatrices||T||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||_.updateDirectly(u.instancesData,0,p)}"_renderWithInstances"(t,i,r,a,o){const h=r.visibleInstances[t._id],l=h?h.length:0,c=this._instanceDataStorage,u=c.instancesBufferSize,d=16*(l+1)*4;for(;c.instancesBufferSize<d;)c.instancesBufferSize*=2;return c.instancesData&&u==c.instancesBufferSize||(c.instancesData=new Float32Array(c.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!c.instancesPreviousData||u!=c.instancesBufferSize)&&(c.instancesPreviousData=new Float32Array(c.instancesBufferSize/4)),this._updateInstancedBuffers(t,r,u,o,i,a),o.unbindInstanceAttributes(),this}"_renderWithThinInstances"(t,i,r,a){const o=this._thinInstanceDataStorage?.instancesCount??0;this.getScene()._activeIndices.addCount(t.indexCount*o,!1),a._currentDrawContext&&(a._currentDrawContext.useInstancing=!0),this._bind(t,r,i),this._draw(t,i,o),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,o):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),a.unbindInstanceAttributes()}"_processInstancedBuffers"(t,i){}"_processRendering"(t,i,r,a,o,h,l,c){const u=this.getScene(),d=u.getEngine();if(a=this._getRenderingFillMode(a),h&&i.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(i,a,r,d),this;if(h)this._renderWithInstances(i,a,o,r,d);else{d._currentDrawContext&&(d._currentDrawContext.useInstancing=!1);let r=0;o.renderSelf[i._id]&&(l&&l(!1,t.getWorldMatrix(),c),r++,this._draw(i,a,this._instanceDataStorage.overridenInstanceCount));const h=o.visibleInstances[i._id];if(h){const t=h.length;r+=t;for(let r=0;r<t;r++){const t=h[r].getWorldMatrix();l&&l(!0,t,c),this._draw(i,a)}}u._activeIndices.addCount(i.indexCount*r,!1)}return this}"_rebuild"(t=!1){if(this._instanceDataStorage.instancesBuffer&&(t&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const i in this._userInstancedBuffersStorage.vertexBuffers){const r=this._userInstancedBuffersStorage.vertexBuffers[i];r&&(t&&r.dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(t)}"_freeze"(){if(this.subMeshes){for(let t=0;t<this.subMeshes.length;t++)this._getInstancesRenderList(t);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}"_unFreeze"(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}"renderWithRenderPassId"(t,i,r,a,o=!0){const h=this._scene.getEngine(),l=h.currentRenderPassId;if(void 0!==t&&(h.currentRenderPassId=t),a)(!o||o&&a.isInFrustum(this._scene._frustumPlanes))&&this.render(a,!!i,r);else for(let t=0;t<this.subMeshes.length;t++){const a=this.subMeshes[t];(!o||o&&a.isInFrustum(this._scene._frustumPlanes))&&this.render(a,!!i,r)}return void 0!==t&&(h.currentRenderPassId=l),this}"directRender"(){if(!this.subMeshes)return this;for(const t of this.subMeshes)this.render(t,!1);return this}"render"(t,i,r){const a=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const o=a.activeCameras?.length??0;if((o>1&&a.activeCamera===a.activeCameras[0]||o<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const h=this._getInstancesRenderList(t._id,!!r);if(h.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const l=a.getEngine();let c=0,u=null;this.ignoreCameraMaxZ&&a.activeCamera&&!a._isInIntermediateRendering()&&(c=a.activeCamera.maxZ,u=a.activeCamera,a.activeCamera.maxZ=0,a.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const d=t.getRenderingMesh(),_=h.hardwareInstancedRendering[t._id]||d.hasThinInstances||!!this._userInstancedBuffersStorage&&!t.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,g=this._instanceDataStorage,p=t.getMaterial();if(!p)return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this;if(g.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===p){if(p._storeEffectOnSubMeshes&&!t._drawWrapper?._wasPreviouslyReady||!p._storeEffectOnSubMeshes&&!p._getDrawWrapper()._wasPreviouslyReady)return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this}else{if(p._storeEffectOnSubMeshes){if(!p.isReadyForSubMesh(this,t,_))return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this}else if(!p.isReady(this,_))return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=p}let m;i&&l.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),m=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?t._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const T=m?.effect??null;for(const i of a._beforeRenderingMeshStage)i.action(this,t,h,T);if(!m||!T)return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this;const y=r||this;let M;if(g.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)M=g.sideOrientation;else{const t=y._getWorldMatrixDeterminant();M=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),t<0&&(M=M===material_Material.ClockWiseSideOrientation?material_Material.CounterClockWiseSideOrientation:material_Material.ClockWiseSideOrientation),g.sideOrientation=M}const b=this._internalMeshDataInfo._effectiveMaterial._preBind(m,M);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&l.setDepthWrite(!0);const x=this._internalMeshDataInfo._effectiveMaterial,E=x.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),_||this._bind(t,T,E,!1);const R=y.getWorldMatrix();x._storeEffectOnSubMeshes?x.bindForSubMesh(R,this,t):x.bind(R,this),!x.backFaceCulling&&x.separateCullingPass&&(l.setState(!0,x.zOffset,!1,!b,x.cullBackFaces,x.stencil,x.zOffsetUnits),this._processRendering(this,t,T,E,h,_,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),l.setState(!0,x.zOffset,!1,b,x.cullBackFaces,x.stencil,x.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(t)),this._processRendering(this,t,T,E,h,_,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const i of a._afterRenderingMeshStage)i.action(this,t,h,T);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),u&&(u.maxZ=c,a.updateTransformMatrix(!0)),2!==a.performancePriority||g.isFrozen||this._freeze(),this}"cleanMatrixWeights"(){this.isVerticesDataPresent(G.o.MatricesWeightsKind)&&(this.isVerticesDataPresent(G.o.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}"_normalizeSkinFourWeights"(){const t=this.getVerticesData(G.o.MatricesWeightsKind),i=t.length;for(let r=0;r<i;r+=4){const i=t[r]+t[r+1]+t[r+2]+t[r+3];if(0===i)t[r]=1;else{const a=1/i;t[r]*=a,t[r+1]*=a,t[r+2]*=a,t[r+3]*=a}}this.setVerticesData(G.o.MatricesWeightsKind,t)}"_normalizeSkinWeightsAndExtra"(){const t=this.getVerticesData(G.o.MatricesWeightsExtraKind),i=this.getVerticesData(G.o.MatricesWeightsKind),r=i.length;for(let a=0;a<r;a+=4){let r=i[a]+i[a+1]+i[a+2]+i[a+3];if(r+=t[a]+t[a+1]+t[a+2]+t[a+3],0===r)i[a]=1;else{const o=1/r;i[a]*=o,i[a+1]*=o,i[a+2]*=o,i[a+3]*=o,t[a]*=o,t[a+1]*=o,t[a+2]*=o,t[a+3]*=o}}this.setVerticesData(G.o.MatricesWeightsKind,i),this.setVerticesData(G.o.MatricesWeightsKind,t)}"validateSkinning"(){const t=this.getVerticesData(G.o.MatricesWeightsExtraKind),i=this.getVerticesData(G.o.MatricesWeightsKind);if(null===i||null==this.skeleton)return{"skinned":!1,"valid":!0,"report":"not skinned"};const r=i.length;let a=0,o=0,h=0,l=0;const c=null===t?4:8,u=[];for(let t=0;t<=c;t++)u[t]=0;for(let d=0;d<r;d+=4){let r=i[d],_=r,g=0===_?0:1;for(let o=1;o<c;o++){const h=o<4?i[d+o]:t[d+o-4];h>r&&a++,0!==h&&g++,_+=h,r=h}if(u[g]++,g>h&&(h=g),0===_)o++;else{const r=1/_;let a=0;for(let o=0;o<c;o++)a+=o<4?Math.abs(i[d+o]-i[d+o]*r):Math.abs(t[d+o-4]-t[d+o-4]*r);a>.001&&l++}}const d=this.skeleton.bones.length,_=this.getVerticesData(G.o.MatricesIndicesKind),g=this.getVerticesData(G.o.MatricesIndicesExtraKind);let p=0;for(let t=0;t<r;t+=4)for(let i=0;i<c;i++){const r=i<4?_[t+i]:g[t+i-4];(r>=d||r<0)&&p++}return{"skinned":!0,"valid":0===o&&0===l&&0===p,"report":"Number of Weights = "+r/4+"\nMaximum influences = "+h+"\nMissing Weights = "+o+"\nNot Sorted = "+a+"\nNot Normalized = "+l+"\nWeightCounts = ["+u+"]\nNumber of bones = "+d+"\nBad Bone Indices = "+p}}"_checkDelayState"(){const t=this.getScene();return this._geometry?this._geometry.load(t):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(t)),this}"_queueLoad"(t){t.addPendingData(this);const i=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return M.w1.LoadFile(this.delayLoadingFile,i=>{i instanceof ArrayBuffer?this._delayLoadingFunction(i,this):this._delayLoadingFunction(JSON.parse(i),this),this.instances.forEach(t=>{t.refreshBoundingInfo(),t._syncSubMeshes()}),this.delayLoadState=1,t.removePendingData(this)},()=>{},t.offlineProvider,i),this}"isInFrustum"(t){return 2!==this.delayLoadState&&(!!super.isInFrustum(t)&&(this._checkDelayState(),!0))}"setMaterialById"(t){const i=this.getScene().materials;let r;for(r=i.length-1;r>-1;r--)if(i[r].id===t)return this.material=i[r],this;const a=this.getScene().multiMaterials;for(r=a.length-1;r>-1;r--)if(a[r].id===t)return this.material=a[r],this;return this}"getAnimatables"(){const t=[];return this.material&&t.push(this.material),this.skeleton&&t.push(this.skeleton),t}"bakeTransformIntoVertices"(t){if(!this.isVerticesDataPresent(G.o.PositionKind))return this;const i=this.subMeshes.splice(0);this._resetPointsArrayCache();let r=this.getVerticesData(G.o.PositionKind);const a=x.P.Zero();let o;for(o=0;o<r.length;o+=3)x.P.TransformCoordinatesFromFloatsToRef(r[o],r[o+1],r[o+2],t,a).toArray(r,o);if(this.setVerticesData(G.o.PositionKind,r,this.getVertexBuffer(G.o.PositionKind).isUpdatable()),this.isVerticesDataPresent(G.o.NormalKind)){for(r=this.getVerticesData(G.o.NormalKind),o=0;o<r.length;o+=3)x.P.TransformNormalFromFloatsToRef(r[o],r[o+1],r[o+2],t,a).normalize().toArray(r,o);this.setVerticesData(G.o.NormalKind,r,this.getVertexBuffer(G.o.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(G.o.TangentKind)){for(r=this.getVerticesData(G.o.TangentKind),o=0;o<r.length;o+=4)x.P.TransformNormalFromFloatsToRef(r[o],r[o+1],r[o+2],t,a).normalize().toArray(r,o);this.setVerticesData(G.o.TangentKind,r,this.getVertexBuffer(G.o.TangentKind).isUpdatable())}return t.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i,this}"bakeCurrentTransformIntoVertices"(t=!0,i=!1){return i&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(t),this}get"_positions"(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}"_resetPointsArrayCache"(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}"_generatePointsArray"(){return!!this._geometry&&this._geometry._generatePointsArray()}"clone"(t="",i=null,r,a=!0){if(i&&void 0===i._addToSceneRootNodes){const r=i;return de.source=this,de.doNotCloneChildren=r.doNotCloneChildren,de.clonePhysicsImpostor=r.clonePhysicsImpostor,de.cloneThinInstances=r.cloneThinInstances,new Mesh(t,this.getScene(),de)}return new Mesh(t,this.getScene(),i,this,r,a)}"dispose"(t,i=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const r=this._internalMeshDataInfo;if(r._onBeforeDrawObservable&&r._onBeforeDrawObservable.clear(),r._onBeforeBindObservable&&r._onBeforeBindObservable.clear(),r._onBeforeRenderObservable&&r._onBeforeRenderObservable.clear(),r._onAfterRenderObservable&&r._onAfterRenderObservable.clear(),r._onBetweenPassObservable&&r._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(r.meshMap)for(const t in r.meshMap){const i=r.meshMap[t];i&&(i._internalMeshDataInfo._source=null,r.meshMap[t]=void 0)}r._source&&r._source._internalMeshDataInfo.meshMap&&(r._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const t=this.getScene().meshes;for(const i of t){const t=i;t._internalMeshDataInfo&&t._internalMeshDataInfo._source&&t._internalMeshDataInfo._source===this&&(t._internalMeshDataInfo._source=null)}}r._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(t,i)}"_disposeInstanceSpecificData"(){}"_disposeThinInstanceSpecificData"(){}"_invalidateInstanceVertexArrayObject"(){}"applyDisplacementMap"(t,i,r,a,o,h,l=!1,c){const u=this.getScene();return M.w1.LoadImage(t,t=>{const c=t.width,u=t.height,d=this.getEngine().createCanvas(c,u).getContext("2d");d.drawImage(t,0,0);const _=d.getImageData(0,0,c,u).data;this.applyDisplacementMapFromBuffer(_,c,u,i,r,o,h,l),a&&a(this)},c||(()=>{}),u.offlineProvider),this}"applyDisplacementMapFromBuffer"(t,i,r,a,o,h,l,c=!1){if(!this.isVerticesDataPresent(G.o.PositionKind)||!this.isVerticesDataPresent(G.o.NormalKind)||!this.isVerticesDataPresent(G.o.UVKind))return C.Y.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const u=this.getVerticesData(G.o.PositionKind,!0,!0),d=this.getVerticesData(G.o.NormalKind),_=this.getVerticesData(G.o.UVKind);let g=x.P.Zero();const p=x.P.Zero(),m=x.FM.Zero();h=h||x.FM.Zero(),l=l||new x.FM(1,1);for(let c=0;c<u.length;c+=3){x.P.FromArrayToRef(u,c,g),x.P.FromArrayToRef(d,c,p),x.FM.FromArrayToRef(_,c/3*2,m);const T=4*((Math.abs(m.x*l.x+h.x%1)*(i-1)%i|0)+(Math.abs(m.y*l.y+h.y%1)*(r-1)%r|0)*i),y=.3*(t[T]/255)+.59*(t[T+1]/255)+.11*(t[T+2]/255);p.normalize(),p.scaleInPlace(a+(o-a)*y),g=g.add(p),g.toArray(u,c)}return VertexData.ComputeNormals(u,this.getIndices(),d),c?(this.setVerticesData(G.o.PositionKind,u),this.setVerticesData(G.o.NormalKind,d),this.setVerticesData(G.o.UVKind,_)):(this.updateVerticesData(G.o.PositionKind,u),this.updateVerticesData(G.o.NormalKind,d)),this}"_getFlattenedNormals"(t,i){const r=new Float32Array(3*t.length);let a=0;const o=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let h=0;h<t.length;h+=3){const l=x.P.FromArray(i,3*t[h]),c=x.P.FromArray(i,3*t[h+1]),u=x.P.FromArray(i,3*t[h+2]),d=l.subtract(c),_=u.subtract(c),g=x.P.Normalize(x.P.Cross(d,_));o&&g.scaleInPlace(-1);for(let t=0;t<3;t++)r[a++]=g.x,r[a++]=g.y,r[a++]=g.z}return r}"_convertToUnIndexedMesh"(t=!1){const i=this.getVerticesDataKinds().filter(t=>!this.getVertexBuffer(t)?.getIsInstanced()),r=this.getIndices(),a={},separateVertices=(t,i)=>{const a=new Float32Array(r.length*i);let o=0;for(let h=0;h<r.length;h++)for(let l=0;l<i;l++)a[o++]=t[r[h]*i+l];return a},o=this.getBoundingInfo(),h=this.geometry?this.subMeshes.slice(0):[];for(const t of i)a[t]=this.getVerticesData(t);for(const o of i){const i=this.getVertexBuffer(o),h=i.getSize();if(t&&o===G.o.NormalKind){const t=this._getFlattenedNormals(r,a[G.o.PositionKind]);this.setVerticesData(G.o.NormalKind,t,i.isUpdatable(),h)}else this.setVerticesData(o,separateVertices(a[o],h),i.isUpdatable(),h)}if(this.morphTargetManager){for(let i=0;i<this.morphTargetManager.numTargets;i++){const a=this.morphTargetManager.getTarget(i),o=a.getPositions();a.setPositions(separateVertices(o,3));const h=a.getNormals();h&&a.setNormals(t?this._getFlattenedNormals(r,o):separateVertices(h,3));const l=a.getTangents();l&&a.setTangents(separateVertices(l,3));const c=a.getUVs();c&&a.setUVs(separateVertices(c,2));const u=a.getColors();u&&a.setColors(separateVertices(u,4))}this.morphTargetManager.synchronize()}for(let t=0;t<r.length;t++)r[t]=t;this.setIndices(r),this._unIndexed=!0,this.releaseSubMeshes();for(const t of h){const i=t.getBoundingInfo();SubMesh.AddToMesh(t.materialIndex,t.indexStart,t.indexCount,t.indexStart,t.indexCount,this).setBoundingInfo(i)}return this.setBoundingInfo(o),this.synchronizeInstances(),this}"convertToFlatShadedMesh"(){return this._convertToUnIndexedMesh(!0)}"convertToUnIndexedMesh"(){return this._convertToUnIndexedMesh()}"flipFaces"(t=!1){const i=VertexData.ExtractFromMesh(this);let r;if(t&&this.isVerticesDataPresent(G.o.NormalKind)&&i.normals){for(r=0;r<i.normals.length;r++)i.normals[r]*=-1;this.setVerticesData(G.o.NormalKind,i.normals,this.isVertexBufferUpdatable(G.o.NormalKind))}if(i.indices){let t;for(r=0;r<i.indices.length;r+=3)t=i.indices[r+1],i.indices[r+1]=i.indices[r+2],i.indices[r+2]=t;this.setIndices(i.indices,null,this.isVertexBufferUpdatable(G.o.PositionKind),!0)}return this}"increaseVertices"(t=1){const i=VertexData.ExtractFromMesh(this),r=i.indices&&!Array.isArray(i.indices)&&Array.from?Array.from(i.indices):i.indices,a=i.positions&&!Array.isArray(i.positions)&&Array.from?Array.from(i.positions):i.positions,o=i.uvs&&!Array.isArray(i.uvs)&&Array.from?Array.from(i.uvs):i.uvs,h=i.normals&&!Array.isArray(i.normals)&&Array.from?Array.from(i.normals):i.normals;if(r&&a){i.indices=r,i.positions=a,o&&(i.uvs=o),h&&(i.normals=h);const l=t+1,c=new Array;for(let t=0;t<l+1;t++)c[t]=new Array;let u,d;const _=new x.P(0,0,0),g=new x.P(0,0,0),p=new x.FM(0,0),m=new Array,T=new Array,y=new Array;let M,b,E,R=a.length;o&&(b=o.length),h&&(E=h.length);for(let t=0;t<r.length;t+=3){T[0]=r[t],T[1]=r[t+1],T[2]=r[t+2];for(let t=0;t<3;t++)if(u=T[t],d=T[(t+1)%3],void 0===y[u]&&void 0===y[d]?(y[u]=new Array,y[d]=new Array):(void 0===y[u]&&(y[u]=new Array),void 0===y[d]&&(y[d]=new Array)),void 0===y[u][d]&&void 0===y[d][u]){y[u][d]=[],_.x=(a[3*d]-a[3*u])/l,_.y=(a[3*d+1]-a[3*u+1])/l,_.z=(a[3*d+2]-a[3*u+2])/l,h&&(g.x=(h[3*d]-h[3*u])/l,g.y=(h[3*d+1]-h[3*u+1])/l,g.z=(h[3*d+2]-h[3*u+2])/l),o&&(p.x=(o[2*d]-o[2*u])/l,p.y=(o[2*d+1]-o[2*u+1])/l),y[u][d].push(u);for(let t=1;t<l;t++)y[u][d].push(a.length/3),a[R++]=a[3*u]+t*_.x,a[R++]=a[3*u+1]+t*_.y,a[R++]=a[3*u+2]+t*_.z,h&&(h[E++]=h[3*u]+t*g.x,h[E++]=h[3*u+1]+t*g.y,h[E++]=h[3*u+2]+t*g.z),o&&(o[b++]=o[2*u]+t*p.x,o[b++]=o[2*u+1]+t*p.y);y[u][d].push(d),y[d][u]=new Array,M=y[u][d].length;for(let t=0;t<M;t++)y[d][u][t]=y[u][d][M-1-t]}c[0][0]=r[t],c[1][0]=y[r[t]][r[t+1]][1],c[1][1]=y[r[t]][r[t+2]][1];for(let i=2;i<l;i++){c[i][0]=y[r[t]][r[t+1]][i],c[i][i]=y[r[t]][r[t+2]][i],_.x=(a[3*c[i][i]]-a[3*c[i][0]])/i,_.y=(a[3*c[i][i]+1]-a[3*c[i][0]+1])/i,_.z=(a[3*c[i][i]+2]-a[3*c[i][0]+2])/i,h&&(g.x=(h[3*c[i][i]]-h[3*c[i][0]])/i,g.y=(h[3*c[i][i]+1]-h[3*c[i][0]+1])/i,g.z=(h[3*c[i][i]+2]-h[3*c[i][0]+2])/i),o&&(p.x=(o[2*c[i][i]]-o[2*c[i][0]])/i,p.y=(o[2*c[i][i]+1]-o[2*c[i][0]+1])/i);for(let t=1;t<i;t++)c[i][t]=a.length/3,a[R++]=a[3*c[i][0]]+t*_.x,a[R++]=a[3*c[i][0]+1]+t*_.y,a[R++]=a[3*c[i][0]+2]+t*_.z,h&&(h[E++]=h[3*c[i][0]]+t*g.x,h[E++]=h[3*c[i][0]+1]+t*g.y,h[E++]=h[3*c[i][0]+2]+t*g.z),o&&(o[b++]=o[2*c[i][0]]+t*p.x,o[b++]=o[2*c[i][0]+1]+t*p.y)}c[l]=y[r[t+1]][r[t+2]],m.push(c[0][0],c[1][0],c[1][1]);for(let t=1;t<l;t++){let i;for(i=0;i<t;i++)m.push(c[t][i],c[t+1][i],c[t+1][i+1]),m.push(c[t][i],c[t+1][i+1],c[t][i+1]);m.push(c[t][i],c[t+1][i],c[t+1][i+1])}}i.indices=m,i.applyToMesh(this,this.isVertexBufferUpdatable(G.o.PositionKind))}else C.Y.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}"forceSharedVertices"(){const t=VertexData.ExtractFromMesh(this),i=t.uvs,r=t.indices,a=t.positions,o=t.colors,h=t.matricesIndices,l=t.matricesWeights,c=t.matricesIndicesExtra,u=t.matricesWeightsExtra;if(void 0===r||void 0===a||null===r||null===a)C.Y.Warn("VertexData contains empty entries");else{const d=new Array,_=new Array,g=new Array,p=new Array,m=new Array,T=new Array,y=new Array,M=new Array;let b=new Array,x=0;const E={};let R,A;for(let t=0;t<r.length;t+=3){A=[r[t],r[t+1],r[t+2]],b=[];for(let t=0;t<3;t++){b[t]="";for(let i=0;i<3;i++)Math.abs(a[3*A[t]+i])<1e-8&&(a[3*A[t]+i]=0),b[t]+=a[3*A[t]+i]+"|"}if(b[0]!=b[1]&&b[0]!=b[2]&&b[1]!=b[2])for(let t=0;t<3;t++){if(R=E[b[t]],void 0===R){E[b[t]]=x,R=x++;for(let i=0;i<3;i++)d.push(a[3*A[t]+i]);if(null!=o)for(let i=0;i<4;i++)p.push(o[4*A[t]+i]);if(null!=i)for(let r=0;r<2;r++)g.push(i[2*A[t]+r]);if(null!=h)for(let i=0;i<4;i++)m.push(h[4*A[t]+i]);if(null!=l)for(let i=0;i<4;i++)T.push(l[4*A[t]+i]);if(null!=c)for(let i=0;i<4;i++)y.push(c[4*A[t]+i]);if(null!=u)for(let i=0;i<4;i++)M.push(u[4*A[t]+i])}_.push(R)}}const C=new Array;VertexData.ComputeNormals(d,_,C),t.positions=d,t.indices=_,t.normals=C,null!=i&&(t.uvs=g),null!=o&&(t.colors=p),null!=h&&(t.matricesIndices=m),null!=l&&(t.matricesWeights=T),null!=c&&(t.matricesIndicesExtra=y),null!=l&&(t.matricesWeightsExtra=M),t.applyToMesh(this,this.isVertexBufferUpdatable(G.o.PositionKind))}}static"_instancedMeshFactory"(t,i){throw(0,R.S)("InstancedMesh")}static"_PhysicsImpostorParser"(t,i,r){throw(0,R.S)("PhysicsImpostor")}"createInstance"(t){const i=Mesh._instancedMeshFactory(t,this);return i.parent=this.parent,i}"synchronizeInstances"(){for(let t=0;t<this.instances.length;t++){this.instances[t]._syncSubMeshes()}return this}"optimizeIndices"(t){const i=this.getIndices(),r=this.getVerticesData(G.o.PositionKind);if(!r||!i)return this;const a=[];for(let t=0;t<r.length;t+=3)a.push(x.P.FromArray(r,t));const o=[];return M.$g.SyncAsyncForLoop(a.length,40,t=>{const i=a.length-1-t,r=a[i];for(let t=0;t<i;++t){const h=a[t];if(r.equals(h)){o[i]=t;break}}},()=>{for(let t=0;t<i.length;++t)i[t]=o[i[t]]||i[t];const r=this.subMeshes.slice(0);this.setIndices(i),this.subMeshes=r,t&&t(this)}),this}"serialize"(t={}){t.name=this.name,t.id=this.id,t.uniqueId=this.uniqueId,t.type=this.getClassName(),ae.$&&ae.$.HasTags(this)&&(t.tags=ae.$.GetTags(this)),t.position=this.position.asArray(),this.rotationQuaternion?t.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(t.rotation=this.rotation.asArray()),t.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?t.pivotMatrix=this.getPivotMatrix().asArray():t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(!1),t.isVisible=this.isVisible,t.infiniteDistance=this.infiniteDistance,t.pickable=this.isPickable,t.receiveShadows=this.receiveShadows,t.billboardMode=this.billboardMode,t.visibility=this.visibility,t.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,t.checkCollisions=this.checkCollisions,t.ellipsoid=this.ellipsoid.asArray(),t.ellipsoidOffset=this.ellipsoidOffset.asArray(),t.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,t.isBlocker=this.isBlocker,t.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(t),t.isUnIndexed=this.isUnIndexed;const i=this._geometry;if(i&&this.subMeshes){t.geometryUniqueId=i.uniqueId,t.geometryId=i.id,t.subMeshes=[];for(let i=0;i<this.subMeshes.length;i++){const r=this.subMeshes[i];t.subMeshes.push({"materialIndex":r.materialIndex,"verticesStart":r.verticesStart,"verticesCount":r.verticesCount,"indexStart":r.indexStart,"indexCount":r.indexCount})}}if(this.material?this.material.doNotSerialize||(t.materialUniqueId=this.material.uniqueId,t.materialId=this.material.id):(this.material=null,t.materialUniqueId=this._scene.defaultMaterial.uniqueId,t.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(t.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(t.skeletonId=this.skeleton.id,t.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(ue.l.NAME_PHYSICSENGINE)){const i=this.getPhysicsImpostor();i&&(t.physicsMass=i.getParam("mass"),t.physicsFriction=i.getParam("friction"),t.physicsRestitution=i.getParam("mass"),t.physicsImpostor=i.type)}this.metadata&&(t.metadata=this.metadata),t.instances=[];for(let i=0;i<this.instances.length;i++){const r=this.instances[i];if(r.doNotSerialize)continue;const a={"name":r.name,"id":r.id,"isEnabled":r.isEnabled(!1),"isVisible":r.isVisible,"isPickable":r.isPickable,"checkCollisions":r.checkCollisions,"position":r.position.asArray(),"scaling":r.scaling.asArray()};if(r.parent&&r.parent._serializeAsParent(a),r.rotationQuaternion?a.rotationQuaternion=r.rotationQuaternion.asArray():r.rotation&&(a.rotation=r.rotation.asArray()),this.getScene()._getComponent(ue.l.NAME_PHYSICSENGINE)){const t=r.getPhysicsImpostor();t&&(a.physicsMass=t.getParam("mass"),a.physicsFriction=t.getParam("friction"),a.physicsRestitution=t.getParam("mass"),a.physicsImpostor=t.type)}r.metadata&&(a.metadata=r.metadata),r.actionManager&&(a.actions=r.actionManager.serialize(r.name)),t.instances.push(a),A.p.AppendSerializedAnimations(r,a),a.ranges=r.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(t.thinInstances={"instancesCount":this._thinInstanceDataStorage.instancesCount,"matrixData":Array.from(this._thinInstanceDataStorage.matrixData),"matrixBufferSize":this._thinInstanceDataStorage.matrixBufferSize,"enablePicking":this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const i={"data":{},"sizes":{},"strides":{}};for(const t in this._userThinInstanceBuffersStorage.data)i.data[t]=Array.from(this._userThinInstanceBuffersStorage.data[t]),i.sizes[t]=this._userThinInstanceBuffersStorage.sizes[t],i.strides[t]=this._userThinInstanceBuffersStorage.strides[t];t.thinInstances.userThinInstance=i}return A.p.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.layerMask=this.layerMask,t.alphaIndex=this.alphaIndex,t.hasVertexAlpha=this.hasVertexAlpha,t.overlayAlpha=this.overlayAlpha,t.overlayColor=this.overlayColor.asArray(),t.renderOverlay=this.renderOverlay,t.applyFog=this.applyFog,this.actionManager&&(t.actions=this.actionManager.serialize(this.name)),t}"_syncGeometryWithMorphTargetManager"(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const t=this._internalAbstractMeshDataInfo._morphTargetManager;if(t&&t.vertexCount){if(t.vertexCount!==this.getTotalVertices())return C.Y.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(t.isUsingTextureForTargets)return;for(let i=0;i<t.numInfluencers;i++){const r=t.getActiveTarget(i),a=r.getPositions();if(!a)return void C.Y.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(G.o.PositionKind+i,a,!1,3);const o=r.getNormals();o&&this.geometry.setVerticesData(G.o.NormalKind+i,o,!1,3);const h=r.getTangents();h&&this.geometry.setVerticesData(G.o.TangentKind+i,h,!1,3);const l=r.getUVs();l&&this.geometry.setVerticesData(G.o.UVKind+"_"+i,l,!1,2);const c=r.getUV2s();c&&this.geometry.setVerticesData(G.o.UV2Kind+"_"+i,c,!1,2);const u=r.getColors();u&&this.geometry.setVerticesData(G.o.ColorKind+i,u,!1,4)}}else{let t=0;for(;this.geometry.isVerticesDataPresent(G.o.PositionKind+t);)this.geometry.removeVerticesData(G.o.PositionKind+t),this.geometry.isVerticesDataPresent(G.o.NormalKind+t)&&this.geometry.removeVerticesData(G.o.NormalKind+t),this.geometry.isVerticesDataPresent(G.o.TangentKind+t)&&this.geometry.removeVerticesData(G.o.TangentKind+t),this.geometry.isVerticesDataPresent(G.o.UVKind+t)&&this.geometry.removeVerticesData(G.o.UVKind+"_"+t),this.geometry.isVerticesDataPresent(G.o.UV2Kind+t)&&this.geometry.removeVerticesData(G.o.UV2Kind+"_"+t),this.geometry.isVerticesDataPresent(G.o.ColorKind+t)&&this.geometry.removeVerticesData(G.o.ColorKind+t),t++}}static"Parse"(t,i,r){let a;if(a=t.type&&"LinesMesh"===t.type?Mesh._LinesMeshParser(t,i):t.type&&"GroundMesh"===t.type?Mesh._GroundMeshParser(t,i):t.type&&"GoldbergMesh"===t.type?Mesh._GoldbergMeshParser(t,i):t.type&&"GreasedLineMesh"===t.type?Mesh._GreasedLineMeshParser(t,i):t.type&&"TrailMesh"===t.type?Mesh._TrailMeshParser(t,i):new Mesh(t.name,i),a.id=t.id,a._waitingParsedUniqueId=t.uniqueId,ae.$&&ae.$.AddTagsTo(a,t.tags),a.position=x.P.FromArray(t.position),void 0!==t.metadata&&(a.metadata=t.metadata),t.rotationQuaternion?a.rotationQuaternion=x._f.FromArray(t.rotationQuaternion):t.rotation&&(a.rotation=x.P.FromArray(t.rotation)),a.scaling=x.P.FromArray(t.scaling),t.localMatrix?a.setPreTransformMatrix(x.y3.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(x.y3.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),a.isVisible=t.isVisible,a.infiniteDistance=t.infiniteDistance,a.alwaysSelectAsActiveMesh=!!t.alwaysSelectAsActiveMesh,a.showBoundingBox=t.showBoundingBox,a.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(a.applyFog=t.applyFog),void 0!==t.pickable&&(a.isPickable=t.pickable),void 0!==t.alphaIndex&&(a.alphaIndex=t.alphaIndex),a.receiveShadows=t.receiveShadows,void 0!==t.billboardMode&&(a.billboardMode=t.billboardMode),void 0!==t.visibility&&(a.visibility=t.visibility),a.checkCollisions=t.checkCollisions,a.doNotSyncBoundingInfo=!!t.doNotSyncBoundingInfo,t.ellipsoid&&(a.ellipsoid=x.P.FromArray(t.ellipsoid)),t.ellipsoidOffset&&(a.ellipsoidOffset=x.P.FromArray(t.ellipsoidOffset)),null!=t.overrideMaterialSideOrientation&&(a.sideOrientation=t.overrideMaterialSideOrientation),void 0!==t.sideOrientation&&(a.sideOrientation=t.sideOrientation),void 0!==t.isBlocker&&(a.isBlocker=t.isBlocker),a._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(a._waitingData.freezeWorldMatrix=t.freezeWorldMatrix),void 0!==t.parentId&&(a._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(a._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.actions&&(a._waitingData.actions=t.actions),void 0!==t.overlayAlpha&&(a.overlayAlpha=t.overlayAlpha),void 0!==t.overlayColor&&(a.overlayColor=V.Wo.FromArray(t.overlayColor)),void 0!==t.renderOverlay&&(a.renderOverlay=t.renderOverlay),a.isUnIndexed=!!t.isUnIndexed,a.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(a.delayLoadState=4,a.delayLoadingFile=r+t.delayLoadingFile,a.buildBoundingInfo(x.P.FromArray(t.boundingBoxMinimum),x.P.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(a._binaryInfo=t._binaryInfo),a._delayInfo=[],t.hasUVs&&a._delayInfo.push(G.o.UVKind),t.hasUVs2&&a._delayInfo.push(G.o.UV2Kind),t.hasUVs3&&a._delayInfo.push(G.o.UV3Kind),t.hasUVs4&&a._delayInfo.push(G.o.UV4Kind),t.hasUVs5&&a._delayInfo.push(G.o.UV5Kind),t.hasUVs6&&a._delayInfo.push(G.o.UV6Kind),t.hasColors&&a._delayInfo.push(G.o.ColorKind),t.hasMatricesIndices&&a._delayInfo.push(G.o.MatricesIndicesKind),t.hasMatricesWeights&&a._delayInfo.push(G.o.MatricesWeightsKind),a._delayLoadingFunction=Geometry._ImportGeometry,SceneLoaderFlags.ForceFullSceneLoadingForIncremental&&a._checkDelayState()):Geometry._ImportGeometry(t,a),t.materialUniqueId?a._waitingMaterialId=t.materialUniqueId:t.materialId&&(a._waitingMaterialId=t.materialId),t.morphTargetManagerId>-1&&(a._waitingMorphTargetManagerId=t.morphTargetManagerId),void 0!==t.skeletonId&&null!==t.skeletonId&&(a.skeleton=i.getLastSkeletonById(t.skeletonId),t.numBoneInfluencers&&(a.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(let i=0;i<t.animations.length;i++){const r=t.animations[i],o=(0,v.qw)("BABYLON.Animation");o&&a.animations.push(o.Parse(r))}Node.ParseAnimationRanges(a,t,i)}if(t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?a.layerMask=Math.abs(parseInt(t.layerMask)):a.layerMask=268435455,t.physicsImpostor&&(a.physicsImpostor=Mesh._PhysicsImpostorParser(i,a,t)),t.lodMeshIds&&(a._waitingData.lods={"ids":t.lodMeshIds,"distances":t.lodDistances?t.lodDistances:null,"coverages":t.lodCoverages?t.lodCoverages:null}),t.instances)for(let r=0;r<t.instances.length;r++){const o=t.instances[r],h=a.createInstance(o.name);if(o.id&&(h.id=o.id),ae.$&&(o.tags?ae.$.AddTagsTo(h,o.tags):ae.$.AddTagsTo(h,t.tags)),h.position=x.P.FromArray(o.position),void 0!==o.metadata&&(h.metadata=o.metadata),void 0!==o.parentId&&(h._waitingParentId=o.parentId),void 0!==o.parentInstanceIndex&&(h._waitingParentInstanceIndex=o.parentInstanceIndex),void 0!==o.isEnabled&&null!==o.isEnabled&&h.setEnabled(o.isEnabled),void 0!==o.isVisible&&null!==o.isVisible&&(h.isVisible=o.isVisible),void 0!==o.isPickable&&null!==o.isPickable&&(h.isPickable=o.isPickable),o.rotationQuaternion?h.rotationQuaternion=x._f.FromArray(o.rotationQuaternion):o.rotation&&(h.rotation=x.P.FromArray(o.rotation)),h.scaling=x.P.FromArray(o.scaling),null!=o.checkCollisions&&null!=o.checkCollisions&&(h.checkCollisions=o.checkCollisions),null!=o.pickable&&null!=o.pickable&&(h.isPickable=o.pickable),null!=o.showBoundingBox&&null!=o.showBoundingBox&&(h.showBoundingBox=o.showBoundingBox),null!=o.showSubMeshesBoundingBox&&null!=o.showSubMeshesBoundingBox&&(h.showSubMeshesBoundingBox=o.showSubMeshesBoundingBox),null!=o.alphaIndex&&null!=o.showSubMeshesBoundingBox&&(h.alphaIndex=o.alphaIndex),o.physicsImpostor&&(h.physicsImpostor=Mesh._PhysicsImpostorParser(i,h,o)),void 0!==o.actions&&(h._waitingData.actions=o.actions),o.animations){for(let t=0;t<o.animations.length;t++){const i=o.animations[t],r=(0,v.qw)("BABYLON.Animation");r&&h.animations.push(r.Parse(i))}Node.ParseAnimationRanges(h,o,i),o.autoAnimate&&i.beginAnimation(h,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1)}}if(t.thinInstances){const i=t.thinInstances;if(a.thinInstanceEnablePicking=!!i.enablePicking,i.matrixData?(a.thinInstanceSetBuffer("matrix",new Float32Array(i.matrixData),16,!1),a._thinInstanceDataStorage.matrixBufferSize=i.matrixBufferSize,a._thinInstanceDataStorage.instancesCount=i.instancesCount):a._thinInstanceDataStorage.matrixBufferSize=i.matrixBufferSize,t.thinInstances.userThinInstance){const i=t.thinInstances.userThinInstance;for(const t in i.data)a.thinInstanceSetBuffer(t,new Float32Array(i.data[t]),i.strides[t],!1),a._userThinInstanceBuffersStorage.sizes[t]=i.sizes[t]}}return a}"setPositionsForCPUSkinning"(){const t=this._internalMeshDataInfo;if(!t._sourcePositions){const i=this.getVerticesData(G.o.PositionKind);if(!i)return t._sourcePositions;t._sourcePositions=new Float32Array(i),this.isVertexBufferUpdatable(G.o.PositionKind)||this.setVerticesData(G.o.PositionKind,i,!0)}return t._sourcePositions}"setNormalsForCPUSkinning"(){const t=this._internalMeshDataInfo;if(!t._sourceNormals){const i=this.getVerticesData(G.o.NormalKind);if(!i)return t._sourceNormals;t._sourceNormals=new Float32Array(i),this.isVertexBufferUpdatable(G.o.NormalKind)||this.setVerticesData(G.o.NormalKind,i,!0)}return t._sourceNormals}"applySkeleton"(t){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(G.o.PositionKind))return this;if(!this.isVerticesDataPresent(G.o.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(G.o.MatricesWeightsKind))return this;const i=this.isVerticesDataPresent(G.o.NormalKind),r=this._internalMeshDataInfo;if(!r._sourcePositions){const t=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=t}i&&!r._sourceNormals&&this.setNormalsForCPUSkinning();let a=this.getVerticesData(G.o.PositionKind);if(!a)return this;a instanceof Float32Array||(a=new Float32Array(a));let o=this.getVerticesData(G.o.NormalKind);if(i){if(!o)return this;o instanceof Float32Array||(o=new Float32Array(o))}const h=this.getVerticesData(G.o.MatricesIndicesKind),l=this.getVerticesData(G.o.MatricesWeightsKind);if(!l||!h)return this;const c=this.numBoneInfluencers>4,u=c?this.getVerticesData(G.o.MatricesIndicesExtraKind):null,d=c?this.getVerticesData(G.o.MatricesWeightsExtraKind):null,_=t.getTransformMatrices(this),g=x.P.Zero(),p=new x.y3,m=new x.y3;let T,y=0;for(let t=0;t<a.length;t+=3,y+=4){let M;for(T=0;T<4;T++)M=l[y+T],M>0&&(x.y3.FromFloat32ArrayToRefScaled(_,Math.floor(16*h[y+T]),M,m),p.addToSelf(m));if(c)for(T=0;T<4;T++)M=d[y+T],M>0&&(x.y3.FromFloat32ArrayToRefScaled(_,Math.floor(16*u[y+T]),M,m),p.addToSelf(m));x.P.TransformCoordinatesFromFloatsToRef(r._sourcePositions[t],r._sourcePositions[t+1],r._sourcePositions[t+2],p,g),g.toArray(a,t),i&&(x.P.TransformNormalFromFloatsToRef(r._sourceNormals[t],r._sourceNormals[t+1],r._sourceNormals[t+2],p,g),g.toArray(o,t)),p.reset()}return this.updateVerticesData(G.o.PositionKind,a),i&&this.updateVerticesData(G.o.NormalKind,o),this}static"MinMax"(t){let i=null,r=null;return t.forEach(function(t){const a=t.getBoundingInfo().boundingBox;i&&r?(i.minimizeInPlace(a.minimumWorld),r.maximizeInPlace(a.maximumWorld)):(i=a.minimumWorld,r=a.maximumWorld)}),i&&r?{"min":i,"max":r}:{"min":x.P.Zero(),"max":x.P.Zero()}}static"Center"(t){const i=t instanceof Array?Mesh.MinMax(t):t;return x.P.Center(i.min,i.max)}static"MergeMeshes"(t,i=!0,r,a,o,h){return runCoroutineSync(Mesh._MergeMeshesCoroutine(t,i,r,a,o,h,!1))}static"MergeMeshesAsync"(t,i=!0,r,a,o,h){return runCoroutineAsync(Mesh._MergeMeshesCoroutine(t,i,r,a,o,h,!0),function createYieldingScheduler(t=25){let i;return(r,a,o)=>{const h=performance.now();void 0===i||h-i>t?(i=h,setTimeout(()=>{inlineScheduler(r,a,o)},0)):inlineScheduler(r,a,o)}}())}static*"_MergeMeshesCoroutine"(t,i=!0,r,a,o,h,l){if(0===(t=t.filter(Boolean)).length)return null;let c;if(!r){let i=0;for(c=0;c<t.length;c++)if(i+=t[c].getTotalVertices(),i>=65536)return C.Y.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}h&&(o=!1);const u=new Array,d=new Array,_=new Array,g=t[0].sideOrientation;for(c=0;c<t.length;c++){const i=t[c];if(i.isAnInstance)return C.Y.Warn("Cannot merge instance meshes."),null;if(g!==i.sideOrientation)return C.Y.Warn("Cannot merge meshes with different sideOrientation values."),null;if(o&&_.push(i.getTotalIndices()),h)if(i.material){const t=i.material;if(t instanceof MultiMaterial){for(let i=0;i<t.subMaterials.length;i++)u.indexOf(t.subMaterials[i])<0&&u.push(t.subMaterials[i]);for(let r=0;r<i.subMeshes.length;r++)d.push(u.indexOf(t.subMaterials[i.subMeshes[r].materialIndex])),_.push(i.subMeshes[r].indexCount)}else{u.indexOf(t)<0&&u.push(t);for(let r=0;r<i.subMeshes.length;r++)d.push(u.indexOf(t)),_.push(i.subMeshes[r].indexCount)}}else for(let t=0;t<i.subMeshes.length;t++)d.push(0),_.push(i.subMeshes[t].indexCount)}const p=t[0],getVertexDataFromMesh=t=>{const i=t.computeWorldMatrix(!0);return{"vertexData":VertexData.ExtractFromMesh(t,!1,!1),"transform":i}},{"vertexData":m,"transform":T}=getVertexDataFromMesh(p);l&&(yield);const y=new Array(t.length-1);for(let i=1;i<t.length;i++)y[i-1]=getVertexDataFromMesh(t[i]),l&&(yield);const M=m._mergeCoroutine(T,y,r,l,!i);let b=M.next();for(;!b.done;)l&&(yield),b=M.next();const x=b.value;a||(a=new Mesh(p.name+"_merged",p.getScene()));const E=x._applyToCoroutine(a,void 0,l);let R=E.next();for(;!R.done;)l&&(yield),R=E.next();if(a.checkCollisions=p.checkCollisions,a.sideOrientation=p.sideOrientation,i)for(c=0;c<t.length;c++)t[c].dispose();if(o||h){a.releaseSubMeshes(),c=0;let t=0;for(;c<_.length;)SubMesh.CreateFromIndices(0,t,_[c],a,void 0,!1),t+=_[c],c++;for(const t of a.subMeshes)t.refreshBoundingInfo();a.computeWorldMatrix(!0)}if(h){const t=new MultiMaterial(p.name+"_merged",p.getScene());t.subMaterials=u;for(let t=0;t<a.subMeshes.length;t++)a.subMeshes[t].materialIndex=d[t];a.material=t}else a.material=p.material;return a}"addInstance"(t){t._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(t)}"removeInstance"(t){const i=t._indexInSourceMeshInstanceArray;if(-1!=i){if(i!==this.instances.length-1){const t=this.instances[this.instances.length-1];this.instances[i]=t,t._indexInSourceMeshInstanceArray=i}t._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}"_shouldConvertRHS"(){return this._scene.useRightHandedSystem&&this.sideOrientation===material_Material.CounterClockWiseSideOrientation}"_getRenderingFillMode"(t){const i=this.getScene();return i.forcePointsCloud?material_Material.PointFillMode:i.forceWireframe?material_Material.WireFrameFillMode:this.overrideRenderingFillMode??t}"setMaterialByID"(t){return this.setMaterialById(t)}static"CreateRibbon"(t,i,r,a,o,h,l,c,u){throw new Error("Import MeshBuilder to populate this function")}static"CreateDisc"(t,i,r,a,o,h){throw new Error("Import MeshBuilder to populate this function")}static"CreateBox"(t,i,r,a,o){throw new Error("Import MeshBuilder to populate this function")}static"CreateSphere"(t,i,r,a,o,h){throw new Error("Import MeshBuilder to populate this function")}static"CreateHemisphere"(t,i,r,a){throw new Error("Import MeshBuilder to populate this function")}static"CreateCylinder"(t,i,r,a,o,h,l,c,u){throw new Error("Import MeshBuilder to populate this function")}static"CreateTorus"(t,i,r,a,o,h,l){throw new Error("Import MeshBuilder to populate this function")}static"CreateTorusKnot"(t,i,r,a,o,h,l,c,u,d){throw new Error("Import MeshBuilder to populate this function")}static"CreateLines"(t,i,r,a,o){throw new Error("Import MeshBuilder to populate this function")}static"CreateDashedLines"(t,i,r,a,o,h,l,c){throw new Error("Import MeshBuilder to populate this function")}static"CreatePolygon"(t,i,r,a,o,h,l){throw new Error("Import MeshBuilder to populate this function")}static"ExtrudePolygon"(t,i,r,a,o,h,l,c){throw new Error("Import MeshBuilder to populate this function")}static"ExtrudeShape"(t,i,r,a,o,h,l,c,u,d){throw new Error("Import MeshBuilder to populate this function")}static"ExtrudeShapeCustom"(t,i,r,a,o,h,l,c,u,d,_,g){throw new Error("Import MeshBuilder to populate this function")}static"CreateLathe"(t,i,r,a,o,h,l){throw new Error("Import MeshBuilder to populate this function")}static"CreatePlane"(t,i,r,a,o){throw new Error("Import MeshBuilder to populate this function")}static"CreateGround"(t,i,r,a,o,h){throw new Error("Import MeshBuilder to populate this function")}static"CreateTiledGround"(t,i,r,a,o,h,l,c,u){throw new Error("Import MeshBuilder to populate this function")}static"CreateGroundFromHeightMap"(t,i,r,a,o,h,l,c,u,d,_){throw new Error("Import MeshBuilder to populate this function")}static"CreateTube"(t,i,r,a,o,h,l,c,u,d){throw new Error("Import MeshBuilder to populate this function")}static"CreatePolyhedron"(t,i,r){throw new Error("Import MeshBuilder to populate this function")}static"CreateIcoSphere"(t,i,r){throw new Error("Import MeshBuilder to populate this function")}static"CreateDecal"(t,i,r,a,o,h){throw new Error("Import MeshBuilder to populate this function")}static"CreateCapsule"(t,i,r){throw new Error("Import MeshBuilder to populate this function")}static"ExtendToGoldberg"(t){throw new Error("Import MeshBuilder to populate this function")}}function CreateCapsuleVertexData(t={"subdivisions":2,"tessellation":16,"height":1,"radius":.25,"capSubdivisions":6}){const i=0|Math.max(t.subdivisions?t.subdivisions:2,1),r=0|Math.max(t.tessellation?t.tessellation:16,3),a=Math.max(t.height?t.height:1,0),o=Math.max(t.radius?t.radius:.25,0),h=0|Math.max(t.capSubdivisions?t.capSubdivisions:6,1),l=r,c=i,u=Math.max(t.radiusTop?t.radiusTop:o,0),d=Math.max(t.radiusBottom?t.radiusBottom:o,0),_=a-(u+d),g=2*Math.PI,p=Math.max(t.topCapSubdivisions?t.topCapSubdivisions:h,1),m=Math.max(t.bottomCapSubdivisions?t.bottomCapSubdivisions:h,1),T=Math.acos((d-u)/a);let y=[];const M=[],b=[],E=[];let R=0;const A=[],C=.5*_,v=.5*Math.PI;let P,S;const I=x.P.Zero(),D=x.P.Zero(),O=Math.cos(T),w=Math.sin(T),B=new x.FM(u*w,C+u*O).subtract(new x.FM(d*w,d*O-C)).length(),L=u*T+B+d*(v-T);let N=0;for(S=0;S<=p;S++){const t=[],i=v-T*(S/p);N+=u*T/p;const r=Math.cos(i),a=Math.sin(i),o=r*u;for(P=0;P<=l;P++){const i=P/l,h=i*g+0,c=Math.sin(h),d=Math.cos(h);D.x=o*c,D.y=C+a*u,D.z=o*d,M.push(D.x,D.y,D.z),I.set(r*c,a,r*d),b.push(I.x,I.y,I.z),E.push(i,oe.VJ?N/L:1-N/L),t.push(R),R++}A.push(t)}const U=a-u-d+O*u-O*d,k=w*(d-u)/U;for(S=1;S<=c;S++){const t=[];N+=B/c;const i=w*(S*(d-u)/c+u);for(P=0;P<=l;P++){const r=P/l,a=r*g+0,o=Math.sin(a),h=Math.cos(a);D.x=i*o,D.y=C+O*u-S*U/c,D.z=i*h,M.push(D.x,D.y,D.z),I.set(o,k,h).normalize(),b.push(I.x,I.y,I.z),E.push(r,oe.VJ?N/L:1-N/L),t.push(R),R++}A.push(t)}for(S=1;S<=m;S++){const t=[],i=v-T-(Math.PI-T)*(S/m);N+=d*T/m;const r=Math.cos(i),a=Math.sin(i),o=r*d;for(P=0;P<=l;P++){const i=P/l,h=i*g+0,c=Math.sin(h),u=Math.cos(h);D.x=o*c,D.y=a*d-C,D.z=o*u,M.push(D.x,D.y,D.z),I.set(r*c,a,r*u),b.push(I.x,I.y,I.z),E.push(i,oe.VJ?N/L:1-N/L),t.push(R),R++}A.push(t)}for(P=0;P<l;P++)for(S=0;S<p+c+m;S++){const t=A[S][P],i=A[S+1][P],r=A[S+1][P+1],a=A[S][P+1];y.push(t),y.push(i),y.push(a),y.push(i),y.push(r),y.push(a)}if(y=y.reverse(),t.orientation&&!t.orientation.equals(x.P.Up())){const i=new x.y3;t.orientation.clone().scale(.5*Math.PI).cross(x.P.Up()).toQuaternion().toRotationMatrix(i);const r=x.P.Zero();for(let t=0;t<M.length;t+=3)r.set(M[t],M[t+1],M[t+2]),x.P.TransformCoordinatesToRef(r.clone(),i,r),M[t]=r.x,M[t+1]=r.y,M[t+2]=r.z}const V=new VertexData;return V.positions=M,V.normals=b,V.uvs=E,V.indices=y,V}function CreateCapsule(t,i={"orientation":x.P.Up(),"subdivisions":2,"tessellation":16,"height":1,"radius":.25,"capSubdivisions":6,"updatable":!1},r=null){const a=new Mesh(t,r);return CreateCapsuleVertexData(i).applyToMesh(a,i.updatable),a}Mesh.FRONTSIDE=VertexData.FRONTSIDE,Mesh.BACKSIDE=VertexData.BACKSIDE,Mesh.DOUBLESIDE=VertexData.DOUBLESIDE,Mesh.DEFAULTSIDE=VertexData.DEFAULTSIDE,Mesh.NO_CAP=0,Mesh.CAP_START=1,Mesh.CAP_END=2,Mesh.CAP_ALL=3,Mesh.NO_FLIP=0,Mesh.FLIP_TILE=1,Mesh.ROTATE_TILE=2,Mesh.FLIP_ROW=3,Mesh.ROTATE_ROW=4,Mesh.FLIP_N_ROTATE_TILE=5,Mesh.FLIP_N_ROTATE_ROW=6,Mesh.CENTER=0,Mesh.LEFT=1,Mesh.RIGHT=2,Mesh.TOP=3,Mesh.BOTTOM=4,Mesh.INSTANCEDMESH_SORT_TRANSPARENT=!1,Mesh._GroundMeshParser=(t,i)=>{throw(0,R.S)("GroundMesh")},Mesh._GoldbergMeshParser=(t,i)=>{throw(0,R.S)("GoldbergMesh")},Mesh._LinesMeshParser=(t,i)=>{throw(0,R.S)("LinesMesh")},Mesh._GreasedLineMeshParser=(t,i)=>{throw(0,R.S)("GreasedLineMesh")},Mesh._GreasedLineRibbonMeshParser=(t,i)=>{throw(0,R.S)("GreasedLineRibbonMesh")},Mesh._TrailMeshParser=(t,i)=>{throw(0,R.S)("TrailMesh")},(0,v.H7)("BABYLON.Mesh",Mesh);Mesh.CreateCapsule=(t,i,r)=>CreateCapsule(t,i,r),VertexData.CreateCapsule=CreateCapsuleVertexData;var _e=r(5336),fe=r(5459),ge=r(3369);fe.ThinEngine.prototype.createDynamicTexture=function(t,i,r,a){const o=new ge.l(this,4);return o.baseWidth=t,o.baseHeight=i,r&&(t=this.needPOTTextures?(0,_e.p7)(t,this._caps.maxTextureSize):t,i=this.needPOTTextures?(0,_e.p7)(i,this._caps.maxTextureSize):i),o.width=t,o.height=i,o.isReady=!1,o.generateMipMaps=r,o.samplingMode=a,this.updateTextureSamplingMode(a,o),this._internalTexturesCache.push(o),o},fe.ThinEngine.prototype.updateDynamicTexture=function(t,i,r,a=!1,o,h=!1,l=!1){if(!t)return;const c=this._gl,u=c.TEXTURE_2D,d=this._bindTextureDirectly(u,t,!0,h);this._unpackFlipY(void 0===r?t.invertY:r),a&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const _=this._getWebGLTextureType(t.type),g=this._getInternalFormat(o||t.format),p=this._getRGBABufferInternalSizedFormat(t.type,g);c.texImage2D(u,0,p,g,_,i),t.generateMipMaps&&c.generateMipmap(u),d||this._bindTextureDirectly(u,null),a&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),o&&(t.format=o),t._dynamicTextureSource=i,t._premulAlpha=a,t.invertY=r||!1,t.isReady=!0};class DynamicTexture extends j.x{"constructor"(t,i,r,a=!1,o=3,h=5,l){const c=!r||r._isScene;super(null,c?r:r?.scene,c?!a:r,l,o,void 0,void 0,void 0,void 0,h),this.name=t,this.wrapU=j.x.CLAMP_ADDRESSMODE,this.wrapV=j.x.CLAMP_ADDRESSMODE,this._generateMipMaps=a;const u=this._getEngine();if(!u)return;if(i.getContext)this._canvas=i,this._ownCanvas=!1,this._texture=u.createDynamicTexture(this._canvas.width,this._canvas.height,a,o);else{this._canvas=u.createCanvas(1,1),this._ownCanvas=!0;const t=i;t.width||0===t.width?this._texture=u.createDynamicTexture(t.width,t.height,a,o):this._texture=u.createDynamicTexture(i,i,a,o)}const d=this.getSize();this._canvas.width!==d.width&&(this._canvas.width=d.width),this._canvas.height!==d.height&&(this._canvas.height=d.height),this._context=this._canvas.getContext("2d")}"getClassName"(){return"DynamicTexture"}get"canRescale"(){return!0}"_recreate"(t){this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this.samplingMode)}"scale"(t){const i=this.getSize();i.width*=t,i.height*=t,this._recreate(i)}"scaleTo"(t,i){const r=this.getSize();r.width=t,r.height=i,this._recreate(r)}"getContext"(){return this._context}"clear"(t){const i=this.getSize();t&&(this._context.fillStyle=t),this._context.clearRect(0,0,i.width,i.height)}"update"(t,i=!1,r=!1){this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===t||t,i,this._format||void 0,void 0,r)}"drawText"(t,i,r,a,o,h,l,c=!0){const u=this.getSize();if(h&&(this._context.fillStyle=h,this._context.fillRect(0,0,u.width,u.height)),this._context.font=a,null==i){const r=this._context.measureText(t);i=(u.width-r.width)/2}if(null==r){const t=parseInt(a.replace(/\D/g,""));r=u.height/2+t/3.65}this._context.fillStyle=o||"",this._context.fillText(t,i,r),c&&this.update(l)}"dispose"(){super.dispose(),this._ownCanvas&&this._canvas?.remove?.(),this._canvas=null,this._context=null}"clone"(){const t=this.getScene();if(!t)return this;const i=this.getSize(),r=new DynamicTexture(this.name,i,t,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.wrapU=this.wrapU,r.wrapV=this.wrapV,r}"serialize"(){const t=this.getScene();t&&!t.isReady()&&C.Y.Warn("The scene must be ready before serializing the dynamic texture");const i=super.serialize();return DynamicTexture._IsCanvasElement(this._canvas)&&(i.base64String=this._canvas.toDataURL()),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i}static"_IsCanvasElement"(t){return void 0!==t.toDataURL}"_rebuild"(){this.update()}}function CreatePlaneVertexData(t){const i=[],r=[],a=[],o=[],h=void 0!==t.width?t.width:void 0!==t.size?t.size:1,l=void 0!==t.height?t.height:void 0!==t.size?t.size:1,c=0===t.sideOrientation?0:t.sideOrientation||VertexData.DEFAULTSIDE,u=h/2,d=l/2;r.push(-u,-d,0),a.push(0,0,-1),o.push(0,oe.VJ?1:0),r.push(u,-d,0),a.push(0,0,-1),o.push(1,oe.VJ?1:0),r.push(u,d,0),a.push(0,0,-1),o.push(1,oe.VJ?0:1),r.push(-u,d,0),a.push(0,0,-1),o.push(0,oe.VJ?0:1),i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),VertexData._ComputeSides(c,r,i,a,o,t.frontUVs,t.backUVs);const _=new VertexData;return _.indices=i,_.positions=r,_.normals=a,_.uvs=o,_}function CreatePlane(t,i={},r=null){const a=new Mesh(t,r);i.sideOrientation=Mesh._GetDefaultSideOrientation(i.sideOrientation),a._originalBuilderSideOrientation=i.sideOrientation;return CreatePlaneVertexData(i).applyToMesh(a,i.updatable),i.sourcePlane&&(a.translate(i.sourcePlane.normal,-i.sourcePlane.d),a.setDirection(i.sourcePlane.normal.scale(-1))),a}VertexData.CreatePlane=CreatePlaneVertexData,Mesh.CreatePlane=(t,i,r,a,o)=>CreatePlane(t,{"size":i,"width":i,"height":i,"sideOrientation":o,"updatable":a},r);var pe=512,me=256,Te=function createBillboardText(t,i,r){var a,o=CreatePlane(i,{"width":r.width,"height":r.height},t);o.isPickable=!1,o.billboardMode=Mesh.BILLBOARDMODE_ALL,r.offset&&o.position.copyFrom(r.offset),r.parent&&(o.parent=r.parent);var h=new DynamicTexture("".concat(i,"-texture"),{"width":pe,"height":me},t,!0);h.hasAlpha=!0;var l=new StandardMaterial("".concat(i,"-material"),t);l.diffuseTexture=h,l.opacityTexture=h,l.emissiveColor=null!==(a=r.emissiveColor)&&void 0!==a?a:new V.Wo(1,1,1),l.specularColor=V.Wo.Black(),l.backFaceCulling=!1,o.material=l;var c="";return{"mesh":o,"setText":function setText(t){if(t!==c){c=t;var i=h.getContext();i.clearRect(0,0,pe,me),i.fillStyle=r.backgroundColor,i.fillRect(0,0,pe,me),i.font=r.font,i.textAlign="center",i.textBaseline="middle",i.fillStyle=r.textColor;var a=t.split("\n"),o=56*a.length,l=(me-o)/2+28;a.forEach(function(t,r){var a=l+56*r;i.fillText(t,256,a)}),h.update(!0)}},"dispose":function dispose(){o.dispose(),h.dispose(),l.dispose()}}},ye=r(1413),Me=200,be=100,xe=.2,Ee=.45,Re=function(){return(0,_.Z)(function BehaviorTree(t){(0,d.Z)(this,BehaviorTree),(0,g.Z)(this,"root",void 0),this.root=t},[{"key":"tick","value":function tick(t){return this.root.tick(t)}},{"key":"reset","value":function reset(){var t,i;null===(t=(i=this.root).reset)||void 0===t||t.call(i)}}])}(),Ae=function(){return(0,_.Z)(function ActionNode(t){(0,d.Z)(this,ActionNode),(0,g.Z)(this,"action",void 0),this.action=t},[{"key":"tick","value":function tick(t){return this.action(t)}}])}(),Ce=function(t){return t.Running="Running",t.Success="Success",t.Failure="Failure",t}({}),ve=function(){return(0,_.Z)(function ConditionNode(t){(0,d.Z)(this,ConditionNode),(0,g.Z)(this,"predicate",void 0),this.predicate=t},[{"key":"tick","value":function tick(t){return this.predicate(t)?Ce.Success:Ce.Failure}}])}(),Pe=function(){return(0,_.Z)(function SelectorNode(t){(0,d.Z)(this,SelectorNode),(0,g.Z)(this,"children",void 0),(0,g.Z)(this,"runningIndex",0),this.children=t},[{"key":"reset","value":function reset(){this.runningIndex=0,this.children.forEach(function(t){var i;return null===(i=t.reset)||void 0===i?void 0:i.call(t)})}},{"key":"tick","value":function tick(t){for(var i=this.runningIndex;i<this.children.length;i+=1){var r=this.children[i].tick(t);if(r===Ce.Running)return this.runningIndex=i,Ce.Running;if(r===Ce.Success)return this.reset(),Ce.Success}return this.reset(),Ce.Failure}}])}(),Se=function(){return(0,_.Z)(function SequenceNode(t){(0,d.Z)(this,SequenceNode),(0,g.Z)(this,"children",void 0),(0,g.Z)(this,"runningIndex",0),this.children=t},[{"key":"reset","value":function reset(){this.runningIndex=0,this.children.forEach(function(t){var i;return null===(i=t.reset)||void 0===i?void 0:i.call(t)})}},{"key":"tick","value":function tick(t){for(var i=this.runningIndex;i<this.children.length;i+=1){var r=this.children[i].tick(t);if(r===Ce.Running)return this.runningIndex=i,Ce.Running;if(r===Ce.Failure)return this.reset(),Ce.Failure}return this.reset(),Ce.Success}}])}(),Ie=function(){return(0,_.Z)(function BuilderAgent(t){(0,d.Z)(this,BuilderAgent),(0,g.Z)(this,"id",void 0),(0,g.Z)(this,"name",void 0),(0,g.Z)(this,"mesh",void 0),(0,g.Z)(this,"buildingManager",void 0),(0,g.Z)(this,"patrolRoute",void 0),(0,g.Z)(this,"behaviorTree",void 0),(0,g.Z)(this,"movementTarget",null),(0,g.Z)(this,"mode","idle"),(0,g.Z)(this,"statusText",""),(0,g.Z)(this,"patrolIndex",0),(0,g.Z)(this,"currentTask",null),(0,g.Z)(this,"currentBuildingId",null),(0,g.Z)(this,"buildProgress",0),this.id=t.id,this.name=t.name,this.mesh=t.mesh,this.buildingManager=t.buildingManager,this.patrolRoute=t.patrolRoute.map(function(t){return t.clone()}),this.behaviorTree=this.createBehaviorTree()},[{"key":"fixedTick","value":function fixedTick(t){this.behaviorTree.tick(t)}},{"key":"frameUpdate","value":function frameUpdate(t){if(this.movementTarget){var i=this.movementTarget.subtract(this.mesh.position);i.y=0;var r=i.length();if(!(r<=1e-4)){var a=i.scale(1/r),o=Math.min(2.8*t,r),h=new x.P(a.x*o,0,a.z*o);this.mesh.moveWithCollisions(h),this.mesh.position.y<1&&(this.mesh.position.y=1),(Math.abs(a.x)>.001||Math.abs(a.z)>.001)&&(this.mesh.rotation.y=Math.atan2(a.x,a.z))}}}},{"key":"assignBuildTask","value":function assignBuildTask(t){this.currentTask=(0,ye.Z)((0,ye.Z)({},t),{},{"position":t.position.clone()}),this.currentBuildingId=null,this.buildProgress=0}},{"key":"hasBuildTask","value":function hasBuildTask(){return null!==this.currentTask}},{"key":"isReadyForTask","value":function isReadyForTask(){return null===this.currentTask}},{"key":"getStatusText","value":function getStatusText(){return this.statusText}},{"key":"getMode","value":function getMode(){return this.mode}},{"key":"getDisplayName","value":function getDisplayName(){return this.name}},{"key":"getSnapshot","value":function getSnapshot(){var t={"id":this.id,"name":this.name,"position":this.mesh.position.clone(),"rotationY":this.mesh.rotation.y,"mode":this.mode,"statusText":this.statusText};return this.currentTask&&(t.taskId=this.currentTask.id,t.buildProgress=this.buildProgress),t}},{"key":"dispose","value":function dispose(){this.mesh.dispose()}},{"key":"createBehaviorTree","value":function createBehaviorTree(){var t=this,i=new Pe([new Se([new ve(function(){return null!==t.currentTask}),new Ae(function(){return t.moveToBuildTarget()}),new Ae(function(i){return t.progressBuild(i.deltaSeconds)})]),new Se([new ve(function(){return t.patrolRoute.length>0}),new Ae(function(){return t.moveToPatrolTarget()}),new Ae(function(){return t.advancePatrolIndex()})]),new Ae(function(){return t.tickIdle()})]);return new Re(i)}},{"key":"moveToBuildTarget","value":function moveToBuildTarget(){return this.currentTask?(this.mode="building",this.statusText="".concat(this.currentTask.name),this.movementTarget=this.currentTask.position,this.distanceTo(this.currentTask.position)<=1.2?(this.movementTarget=null,Ce.Success):Ce.Running):Ce.Failure}},{"key":"progressBuild","value":function progressBuild(t){if(!this.currentTask)return Ce.Failure;this.currentBuildingId||(this.currentBuildingId=this.buildingManager.createBuildingSite({"type":this.currentTask.type,"name":this.currentTask.name,"position":this.currentTask.position,"rotationY":this.currentTask.rotationY,"requestedBy":this.currentTask.requestedBy})),this.buildProgress=Math.min(1,this.buildProgress+.22*t),this.buildingManager.setProgress(this.currentBuildingId,this.buildProgress);var i=Math.round(100*this.buildProgress);return this.statusText="".concat(this.currentTask.name," ").concat(i,"%"),this.buildProgress>=1?(this.buildingManager.complete(this.currentBuildingId),this.statusText="".concat(this.currentTask.name),this.currentTask=null,this.currentBuildingId=null,this.buildProgress=0,Ce.Success):Ce.Running}},{"key":"moveToPatrolTarget","value":function moveToPatrolTarget(){if(0===this.patrolRoute.length)return Ce.Failure;var t=this.patrolIndex%this.patrolRoute.length,i=this.patrolRoute[t];return this.mode="patrol",this.statusText=" (".concat(t+1,"/").concat(this.patrolRoute.length,")"),this.movementTarget=i,this.distanceTo(i)<=1.2?(this.movementTarget=null,Ce.Success):Ce.Running}},{"key":"advancePatrolIndex","value":function advancePatrolIndex(){return 0===this.patrolRoute.length?Ce.Failure:(this.patrolIndex=(this.patrolIndex+1)%this.patrolRoute.length,Ce.Success)}},{"key":"tickIdle","value":function tickIdle(){return this.mode="idle",this.statusText="",this.movementTarget=null,Ce.Running}},{"key":"distanceTo","value":function distanceTo(t){var i=t.x-this.mesh.position.x,r=t.z-this.mesh.position.z;return Math.sqrt(i*i+r*r)}}])}(),De=["Builder-01","Builder-02","Builder-03","Builder-04","Builder-05","Builder-06","Builder-07"],Fe=[new x.P(24,0,-8),new x.P(18,0,20),new x.P(32,0,14),new x.P(-20,0,24),new x.P(-30,0,8),new x.P(-22,0,-18),new x.P(8,0,-28),new x.P(-2,0,30),new x.P(34,0,-24),new x.P(-34,0,-6),new x.P(10,0,34),new x.P(-12,0,-32)],Oe=["monument","house","garden"],we=[new x.P(14,1,-4),new x.P(-14,1,2),new x.P(3,1,14),new x.P(-3,1,-14),new x.P(20,1,16),new x.P(-22,1,-12),new x.P(0,1,24)],Be=function randomBetween(t,i){return t+Math.random()*(i-t)},Le=function(){return(0,_.Z)(function AgentManager(t,i){(0,d.Z)(this,AgentManager),(0,g.Z)(this,"scene",void 0),(0,g.Z)(this,"buildingManager",void 0),(0,g.Z)(this,"agents",[]),(0,g.Z)(this,"taskQueue",[]),(0,g.Z)(this,"taskCounter",0),this.scene=t,this.buildingManager=i,this.spawnAgents(),this.refillTaskQueue(16)},[{"key":"fixedTick","value":function fixedTick(t,i){var r=this;this.refillTaskQueue(8),this.agents.forEach(function(a){a.agent.fixedTick({"deltaSeconds":t,"nowMs":i}),r.updateAgentLabel(a);var o=a.agent.hasBuildTask();a.wasBusy&&!o&&(a.nextTaskAtMs=i+Be(1500,4500)),a.wasBusy=o,!o&&i>=a.nextTaskAtMs&&r.assignNextAvailableTask(a,i)})}},{"key":"frameUpdate","value":function frameUpdate(t){this.agents.forEach(function(i){i.agent.frameUpdate(t)})}},{"key":"getSnapshots","value":function getSnapshots(){return this.agents.map(function(t){return t.agent.getSnapshot()})}},{"key":"dispose","value":function dispose(){this.agents.forEach(function(t){t.label.dispose(),t.agent.dispose()}),this.agents.length=0,this.taskQueue.length=0}},{"key":"spawnAgents","value":function spawnAgents(){var t=this;De.forEach(function(i,r){var a=CreateCapsule("builder-agent-".concat(r),{"height":1.9,"radius":.45,"tessellation":8},t.scene);a.position.copyFrom(we[r]),a.checkCollisions=!0,a.ellipsoid=new x.P(.45,.95,.45),a.ellipsoidOffset=new x.P(0,.95,0);var o=new StandardMaterial("builder-agent-material-".concat(r),t.scene);o.diffuseColor=new V.Wo(.42,.76,.97),o.emissiveColor=new V.Wo(.03,.07,.11),o.specularColor=new V.Wo(.1,.2,.3),a.material=o;var h=t.createPatrolRoute(a.position),l={"agent":new Ie({"id":"agent-".concat(r+1),"name":i,"mesh":a,"buildingManager":t.buildingManager,"patrolRoute":h}),"label":Te(t.scene,"agent-".concat(r+1,"-label"),{"width":7,"height":3,"font":'bold 34px "Noto Sans SC", sans-serif',"textColor":"#EAF5FF","backgroundColor":"rgba(10, 20, 35, 0.62)","emissiveColor":new V.Wo(.82,.9,1),"offset":new x.P(0,3.3,0),"parent":a}),"nextTaskAtMs":Date.now()+Be(300,2600),"wasBusy":!1};t.updateAgentLabel(l),t.agents.push(l)})}},{"key":"createPatrolRoute","value":function createPatrolRoute(t){var i=Be(4,8);return[new x.P(t.x+i,1,t.z+i),new x.P(t.x-i,1,t.z+i),new x.P(t.x-i,1,t.z-i),new x.P(t.x+i,1,t.z-i)]}},{"key":"refillTaskQueue","value":function refillTaskQueue(t){for(;this.taskQueue.length<t;){var i=Fe[this.taskCounter%Fe.length],r=Oe[this.taskCounter%Oe.length];this.taskCounter+=1,this.taskQueue.push({"id":"build-task-".concat(this.taskCounter),"type":r,"name":"".concat(r,"-").concat(this.taskCounter),"position":i.clone(),"requestedBy":"system"})}}},{"key":"assignNextAvailableTask","value":function assignNextAvailableTask(t,i){for(;this.taskQueue.length>0;){var r=this.taskQueue.shift();if(!r)break;if(!this.buildingManager.isPositionOccupied(r.position,4))return t.agent.assignBuildTask(r),t.wasBusy=!0,t.nextTaskAtMs=Number.POSITIVE_INFINITY,void this.updateAgentLabel(t)}t.nextTaskAtMs=i+Be(2e3,3600)}},{"key":"updateAgentLabel","value":function updateAgentLabel(t){var i="".concat(t.agent.getDisplayName(),"\n").concat(t.agent.getStatusText());t.label.setText(i)}}])}(),Ne=r(7762);Mesh._GroundMeshParser=(t,i)=>GroundMesh.Parse(t,i);class GroundMesh extends Mesh{"constructor"(t,i){super(t,i),this.generateOctree=!1}"getClassName"(){return"GroundMesh"}get"subdivisions"(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get"subdivisionsX"(){return this._subdivisionsX}get"subdivisionsY"(){return this._subdivisionsY}"optimize"(t,i=32){this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);const r=this;r.createOrUpdateSubmeshesOctree&&r.createOrUpdateSubmeshesOctree(i)}"getHeightAtCoordinates"(t,i){const r=this.getWorldMatrix(),a=x.jp.Matrix[5];r.invertToRef(a);const o=x.jp.Vector3[8];if(x.P.TransformCoordinatesFromFloatsToRef(t,0,i,a,o),t=o.x,i=o.z,t<this._minX||t>=this._maxX||i<=this._minZ||i>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(t,i),l=-(h.x*t+h.z*i+h.w)/h.y;return x.P.TransformCoordinatesFromFloatsToRef(0,l,0,r,o),o.y}"getNormalAtCoordinates"(t,i){const r=new x.P(0,1,0);return this.getNormalAtCoordinatesToRef(t,i,r),r}"getNormalAtCoordinatesToRef"(t,i,r){const a=this.getWorldMatrix(),o=x.jp.Matrix[5];a.invertToRef(o);const h=x.jp.Vector3[8];if(x.P.TransformCoordinatesFromFloatsToRef(t,0,i,o,h),t=h.x,i=h.z,t<this._minX||t>this._maxX||i<this._minZ||i>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const l=this._getFacetAt(t,i);return x.P.TransformNormalFromFloatsToRef(l.x,l.y,l.z,a,r),this}"updateCoordinateHeights"(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}"_getFacetAt"(t,i){const r=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),a=Math.floor(-(i+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),o=this._heightQuads[a*this._subdivisionsX+r];let h;return h=i<o.slope.x*t+o.slope.y?o.facet1:o.facet2,h}"_initHeightQuads"(){const t=this._subdivisionsX,i=this._subdivisionsY;this._heightQuads=new Array;for(let r=0;r<i;r++)for(let i=0;i<t;i++){const a={"slope":x.FM.Zero(),"facet1":new x.Lt(0,0,0,0),"facet2":new x.Lt(0,0,0,0)};this._heightQuads[r*t+i]=a}return this}"_computeHeightQuads"(){const t=this.getVerticesData(G.o.PositionKind);if(!t)return this;const i=x.jp.Vector3[3],r=x.jp.Vector3[2],a=x.jp.Vector3[1],o=x.jp.Vector3[0],h=x.jp.Vector3[4],l=x.jp.Vector3[5],c=x.jp.Vector3[6],u=x.jp.Vector3[7],d=x.jp.Vector3[8];let _=0,g=0,p=0,m=0,T=0,y=0,M=0;const b=this._subdivisionsX,E=this._subdivisionsY;for(let R=0;R<E;R++)for(let E=0;E<b;E++){_=3*E,g=R*(b+1)*3,p=(R+1)*(b+1)*3,i.x=t[g+_],i.y=t[g+_+1],i.z=t[g+_+2],r.x=t[g+_+3],r.y=t[g+_+4],r.z=t[g+_+5],a.x=t[p+_],a.y=t[p+_+1],a.z=t[p+_+2],o.x=t[p+_+3],o.y=t[p+_+4],o.z=t[p+_+5],m=(o.z-i.z)/(o.x-i.x),T=i.z-m*i.x,r.subtractToRef(i,h),a.subtractToRef(i,l),o.subtractToRef(i,c),x.P.CrossToRef(c,l,u),x.P.CrossToRef(h,c,d),u.normalize(),d.normalize(),y=-(u.x*i.x+u.y*i.y+u.z*i.z),M=-(d.x*r.x+d.y*r.y+d.z*r.z);const A=this._heightQuads[R*b+E];A.slope.copyFromFloats(m,T),A.facet1.copyFromFloats(u.x,u.y,u.z,y),A.facet2.copyFromFloats(d.x,d.y,d.z,M)}return this}"serialize"(t){super.serialize(t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height}static"Parse"(t,i){const r=new GroundMesh(t.name,i);return r._subdivisionsX=t.subdivisionsX||1,r._subdivisionsY=t.subdivisionsY||1,r._minX=t.minX,r._maxX=t.maxX,r._minZ=t.minZ,r._maxZ=t.maxZ,r._width=t.width,r._height=t.height,r}}function groundBuilder_CreateGroundVertexData(t){const i=[],r=[],a=[],o=[];let h,l;const c=t.width||t.size||1,u=t.height||t.size||1,d=0|(t.subdivisionsX||t.subdivisions||1),_=0|(t.subdivisionsY||t.subdivisions||1);for(h=0;h<=_;h++)for(l=0;l<=d;l++){const t=new x.P(l*c/d-c/2,0,(_-h)*u/_-u/2),i=new x.P(0,1,0);r.push(t.x,t.y,t.z),a.push(i.x,i.y,i.z),o.push(l/d,oe.VJ?h/_:1-h/_)}for(h=0;h<_;h++)for(l=0;l<d;l++)i.push(l+1+(h+1)*(d+1)),i.push(l+1+h*(d+1)),i.push(l+h*(d+1)),i.push(l+(h+1)*(d+1)),i.push(l+1+(h+1)*(d+1)),i.push(l+h*(d+1));const g=new VertexData;return g.indices=i,g.positions=r,g.normals=a,g.uvs=o,g}function CreateTiledGroundVertexData(t){const i=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,r=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,a=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,o=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,h=t.subdivisions||{"w":1,"h":1},l=t.precision||{"w":1,"h":1},c=[],u=[],d=[],_=[];let g,p,m,T;h.h=h.h<1?1:h.h,h.w=h.w<1?1:h.w,l.w=l.w<1?1:l.w,l.h=l.h<1?1:l.h;const y=(a-i)/h.w,M=(o-r)/h.h;function applyTile(t,i,r,a){const o=u.length/3,h=l.w+1;for(g=0;g<l.h;g++)for(p=0;p<l.w;p++){const t=[o+p+g*h,o+(p+1)+g*h,o+(p+1)+(g+1)*h,o+p+(g+1)*h];c.push(t[1]),c.push(t[2]),c.push(t[3]),c.push(t[0]),c.push(t[1]),c.push(t[3])}const m=x.P.Zero(),T=new x.P(0,1,0);for(g=0;g<=l.h;g++)for(m.z=g*(a-i)/l.h+i,p=0;p<=l.w;p++)m.x=p*(r-t)/l.w+t,m.y=0,u.push(m.x,m.y,m.z),d.push(T.x,T.y,T.z),_.push(p/l.w,g/l.h)}for(m=0;m<h.h;m++)for(T=0;T<h.w;T++)applyTile(i+T*y,r+m*M,i+(T+1)*y,r+(m+1)*M);const b=new VertexData;return b.indices=c,b.positions=u,b.normals=d,b.uvs=_,b}function CreateGroundFromHeightMapVertexData(t){const i=[],r=[],a=[],o=[];let h,l;const c=t.colorFilter||new V.Wo(.3,.59,.11),u=t.alphaFilter||0;let d=!1;if(t.minHeight>t.maxHeight){d=!0;const i=t.maxHeight;t.maxHeight=t.minHeight,t.minHeight=i}for(h=0;h<=t.subdivisions;h++)for(l=0;l<=t.subdivisions;l++){const i=new x.P(l*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-h)*t.height/t.subdivisions-t.height/2),_=4*(((i.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(i.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth);let g=t.buffer[_]/255,p=t.buffer[_+1]/255,m=t.buffer[_+2]/255;const T=t.buffer[_+3]/255;d&&(g=1-g,p=1-p,m=1-m);const y=g*c.r+p*c.g+m*c.b;i.y=T>=u?t.minHeight+(t.maxHeight-t.minHeight)*y:t.minHeight-I.kn,t.heightBuffer&&(t.heightBuffer[h*(t.subdivisions+1)+l]=i.y),r.push(i.x,i.y,i.z),a.push(0,0,0),o.push(l/t.subdivisions,1-h/t.subdivisions)}for(h=0;h<t.subdivisions;h++)for(l=0;l<t.subdivisions;l++){const a=l+1+(h+1)*(t.subdivisions+1),o=l+1+h*(t.subdivisions+1),c=l+h*(t.subdivisions+1),u=l+(h+1)*(t.subdivisions+1),d=r[3*a+1]>=t.minHeight,_=r[3*o+1]>=t.minHeight,g=r[3*c+1]>=t.minHeight;d&&_&&g&&(i.push(a),i.push(o),i.push(c));r[3*u+1]>=t.minHeight&&d&&g&&(i.push(u),i.push(a),i.push(c))}VertexData.ComputeNormals(r,i,a);const _=new VertexData;return _.indices=i,_.positions=r,_.normals=a,_.uvs=o,_}function CreateGround(t,i={},r){const a=new GroundMesh(t,r);a._setReady(!1),a._subdivisionsX=i.subdivisionsX||i.subdivisions||1,a._subdivisionsY=i.subdivisionsY||i.subdivisions||1,a._width=i.width||1,a._height=i.height||1,a._maxX=a._width/2,a._maxZ=a._height/2,a._minX=-a._maxX,a._minZ=-a._maxZ;return groundBuilder_CreateGroundVertexData(i).applyToMesh(a,i.updatable),a._setReady(!0),a}function CreateTiledGround(t,i,r=null){const a=new Mesh(t,r);return CreateTiledGroundVertexData(i).applyToMesh(a,i.updatable),a}function CreateGroundFromHeightMap(t,i,r={},a=null){const o=r.width||10,h=r.height||10,l=r.subdivisions||1,c=r.minHeight||0,u=r.maxHeight||1,d=r.colorFilter||new V.Wo(.3,.59,.11),_=r.alphaFilter||0,g=r.updatable,p=r.onReady;a=a||E.l.LastCreatedScene;const m=new GroundMesh(t,a);let T;m._subdivisionsX=l,m._subdivisionsY=l,m._width=o,m._height=h,m._maxX=m._width/2,m._maxZ=m._height/2,m._minX=-m._maxX,m._minZ=-m._maxZ,m._setReady(!1),r.passHeightBufferInCallback&&(T=new Float32Array((l+1)*(l+1)));const onBufferLoaded=(t,i,r)=>{CreateGroundFromHeightMapVertexData({"width":o,"height":h,"subdivisions":l,"minHeight":c,"maxHeight":u,"colorFilter":d,"buffer":t,"bufferWidth":i,"bufferHeight":r,"alphaFilter":_,"heightBuffer":T}).applyToMesh(m,g),p&&p(m,T),m._setReady(!0)};if("string"==typeof i){const onload=t=>{const i=t.width,r=t.height;if(a.isDisposed)return;const o=a?.getEngine().resizeImageBitmap(t,i,r);onBufferLoaded(o,i,r)};M.w1.LoadImage(i,onload,r.onError?r.onError:()=>{},a.offlineProvider)}else onBufferLoaded(i.data,i.width,i.height);return m}function CreateBoxVertexData(t){let i=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const r=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],a=[];let o=[];const h=t.width||t.size||1,l=t.height||t.size||1,c=t.depth||t.size||1,u=t.wrap||!1;let d=void 0===t.topBaseAt?1:t.topBaseAt,_=void 0===t.bottomBaseAt?0:t.bottomBaseAt;d=(d+4)%4,_=(_+4)%4;let g=[2,0,3,1][d],p=[2,0,1,3][_],m=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(u){i=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],m=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let t=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],r=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const a=[17,18,19,16],o=[22,23,20,21];for(;g>0;)t.unshift(t.pop()),a.unshift(a.pop()),g--;for(;p>0;)r.unshift(r.pop()),o.unshift(o.pop()),p--;t=t.flat(),r=r.flat(),m=m.concat(t).concat(r),i.push(a[0],a[2],a[3],a[0],a[1],a[2]),i.push(o[0],o[2],o[3],o[0],o[1],o[2])}const T=[h/2,l/2,c/2];o=m.reduce((t,i,r)=>t.concat(i*T[r%3]),[]);const y=0===t.sideOrientation?0:t.sideOrientation||VertexData.DEFAULTSIDE,M=t.faceUV||new Array(6),b=t.faceColors,E=[];for(let t=0;t<6;t++)void 0===M[t]&&(M[t]=new x.Lt(0,0,1,1)),b&&void 0===b[t]&&(b[t]=new V.HE(1,1,1,1));for(let t=0;t<6;t++)if(a.push(M[t].z,oe.VJ?1-M[t].w:M[t].w),a.push(M[t].x,oe.VJ?1-M[t].w:M[t].w),a.push(M[t].x,oe.VJ?1-M[t].y:M[t].y),a.push(M[t].z,oe.VJ?1-M[t].y:M[t].y),b)for(let i=0;i<4;i++)E.push(b[t].r,b[t].g,b[t].b,b[t].a);VertexData._ComputeSides(y,o,i,r,a,t.frontUVs,t.backUVs);const R=new VertexData;if(R.indices=i,R.positions=o,R.normals=r,R.uvs=a,b){const t=y===VertexData.DOUBLESIDE?E.concat(E):E;R.colors=t}return R}function CreateBox(t,i={},r=null){const a=new Mesh(t,r);i.sideOrientation=Mesh._GetDefaultSideOrientation(i.sideOrientation),a._originalBuilderSideOrientation=i.sideOrientation;return CreateBoxVertexData(i).applyToMesh(a,i.updatable),a}VertexData.CreateGround=groundBuilder_CreateGroundVertexData,VertexData.CreateTiledGround=CreateTiledGroundVertexData,VertexData.CreateGroundFromHeightMap=CreateGroundFromHeightMapVertexData,Mesh.CreateGround=(t,i,r,a,o,h)=>CreateGround(t,{"width":i,"height":r,"subdivisions":a,"updatable":h},o),Mesh.CreateTiledGround=(t,i,r,a,o,h,l,c,u)=>CreateTiledGround(t,{"xmin":i,"zmin":r,"xmax":a,"zmax":o,"subdivisions":h,"precision":l,"updatable":u},c),Mesh.CreateGroundFromHeightMap=(t,i,r,a,o,h,l,c,u,d,_)=>CreateGroundFromHeightMap(t,i,{"width":r,"height":a,"subdivisions":o,"minHeight":h,"maxHeight":l,"updatable":u,"onReady":d,"alphaFilter":_},c);function CreateCylinderVertexData(t){const i=t.height||2;let r=0===t.diameterTop?0:t.diameterTop||t.diameter||1,a=0===t.diameterBottom?0:t.diameterBottom||t.diameter||1;r=r||1e-5,a=a||1e-5;const o=0|(t.tessellation||24),h=0|(t.subdivisions||1),l=!!t.hasRings,c=!!t.enclose,u=0===t.cap?0:t.cap||Mesh.CAP_ALL,d=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,_=0===t.sideOrientation?0:t.sideOrientation||VertexData.DEFAULTSIDE,g=t.faceUV||new Array(3),p=t.faceColors,m=2+(1+(1!==d&&c?2:0))*(l?h:1);let T;for(T=0;T<m;T++)p&&void 0===p[T]&&(p[T]=new V.HE(1,1,1,1));for(T=0;T<m;T++)g&&void 0===g[T]&&(g[T]=new x.Lt(0,0,1,1));const y=[],M=[],b=[],E=[],R=[],A=2*Math.PI*d/o;let C,v,P;const S=(a-r)/2/i,I=x.P.Zero(),D=x.P.Zero(),O=x.P.Zero(),w=x.P.Zero(),B=x.P.Zero(),L=ce.RD.Y;let N,U,k,G=1,z=1,W=0,H=0;for(N=0;N<=h;N++)for(v=N/h,P=(v*(r-a)+a)/2,G=l&&0!==N&&N!==h?2:1,k=0;k<G;k++){for(l&&(z+=k),c&&(z+=2*k),U=0;U<=o;U++)C=U*A,I.x=Math.cos(-C)*P,I.y=-i/2+v*i,I.z=Math.sin(-C)*P,0===r&&N===h?(D.x=b[b.length-3*(o+1)],D.y=b[b.length-3*(o+1)+1],D.z=b[b.length-3*(o+1)+2]):(D.x=I.x,D.z=I.z,D.y=Math.sqrt(D.x*D.x+D.z*D.z)*S,D.normalize()),0===U&&(O.copyFrom(I),w.copyFrom(D)),M.push(I.x,I.y,I.z),b.push(D.x,D.y,D.z),H=l?W!==z?g[z].y:g[z].w:g[z].y+(g[z].w-g[z].y)*v,E.push(g[z].x+(g[z].z-g[z].x)*U/o,oe.VJ?1-H:H),p&&R.push(p[z].r,p[z].g,p[z].b,p[z].a);1!==d&&c&&(M.push(I.x,I.y,I.z),M.push(0,I.y,0),M.push(0,I.y,0),M.push(O.x,O.y,O.z),x.P.CrossToRef(L,D,B),B.normalize(),b.push(B.x,B.y,B.z,B.x,B.y,B.z),x.P.CrossToRef(w,L,B),B.normalize(),b.push(B.x,B.y,B.z,B.x,B.y,B.z),H=l?W!==z?g[z+1].y:g[z+1].w:g[z+1].y+(g[z+1].w-g[z+1].y)*v,E.push(g[z+1].x,oe.VJ?1-H:H),E.push(g[z+1].z,oe.VJ?1-H:H),H=l?W!==z?g[z+2].y:g[z+2].w:g[z+2].y+(g[z+2].w-g[z+2].y)*v,E.push(g[z+2].x,oe.VJ?1-H:H),E.push(g[z+2].z,oe.VJ?1-H:H),p&&(R.push(p[z+1].r,p[z+1].g,p[z+1].b,p[z+1].a),R.push(p[z+1].r,p[z+1].g,p[z+1].b,p[z+1].a),R.push(p[z+2].r,p[z+2].g,p[z+2].b,p[z+2].a),R.push(p[z+2].r,p[z+2].g,p[z+2].b,p[z+2].a))),W!==z&&(W=z)}const X=1!==d&&c?o+4:o;for(N=0,z=0;z<h;z++){let t=0,i=0,r=0,a=0;for(U=0;U<o;U++)t=N*(X+1)+U,i=(N+1)*(X+1)+U,r=N*(X+1)+(U+1),a=(N+1)*(X+1)+(U+1),y.push(t,i,r),y.push(a,r,i);1!==d&&c&&(y.push(t+2,i+2,r+2),y.push(a+2,r+2,i+2),y.push(t+4,i+4,r+4),y.push(a+4,r+4,i+4)),N=l?N+2:N+1}const createCylinderCap=t=>{const h=t?r/2:a/2;if(0===h)return;let l,c,u;const _=t?g[m-1]:g[0];let T=null;p&&(T=t?p[m-1]:p[0]);const A=M.length/3,C=t?i/2:-i/2,v=new x.P(0,C,0);M.push(v.x,v.y,v.z),b.push(0,t?1:-1,0);const P=_.y+.5*(_.w-_.y);E.push(_.x+.5*(_.z-_.x),oe.VJ?1-P:P),T&&R.push(T.r,T.g,T.b,T.a);const S=new x.FM(.5,.5);for(u=0;u<=o;u++){l=2*Math.PI*u*d/o;const i=Math.cos(-l),r=Math.sin(-l);c=new x.P(i*h,C,r*h);const a=new x.FM(i*S.x+.5,r*S.y+.5);M.push(c.x,c.y,c.z),b.push(0,t?1:-1,0);const g=_.y+(_.w-_.y)*a.y;E.push(_.x+(_.z-_.x)*a.x,oe.VJ?1-g:g),T&&R.push(T.r,T.g,T.b,T.a)}for(u=0;u<o;u++)t?(y.push(A),y.push(A+(u+2)),y.push(A+(u+1))):(y.push(A),y.push(A+(u+1)),y.push(A+(u+2)))};u!==Mesh.CAP_START&&u!==Mesh.CAP_ALL||createCylinderCap(!1),u!==Mesh.CAP_END&&u!==Mesh.CAP_ALL||createCylinderCap(!0),VertexData._ComputeSides(_,M,y,b,E,t.frontUVs,t.backUVs);const K=new VertexData;return K.indices=y,K.positions=M,K.normals=b,K.uvs=E,p&&(K.colors=R),K}function CreateCylinder(t,i={},r){const a=new Mesh(t,r);i.sideOrientation=Mesh._GetDefaultSideOrientation(i.sideOrientation),a._originalBuilderSideOrientation=i.sideOrientation;return CreateCylinderVertexData(i).applyToMesh(a,i.updatable),a}VertexData.CreateBox=CreateBoxVertexData,Mesh.CreateBox=(t,i,r=null,a,o)=>CreateBox(t,{"size":i,"sideOrientation":o,"updatable":a},r);function CreateSphereVertexData(t){const i=0|(t.segments||32),r=t.diameterX||t.diameter||1,a=t.diameterY||t.diameter||1,o=t.diameterZ||t.diameter||1,h=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,l=t.slice&&t.slice<=0?1:t.slice||1,c=0===t.sideOrientation?0:t.sideOrientation||VertexData.DEFAULTSIDE,u=!!t.dedupTopBottomIndices,d=new x.P(r/2,a/2,o/2),_=2+i,g=2*_,p=[],m=[],T=[],y=[];for(let t=0;t<=_;t++){const i=t/_,r=i*Math.PI*l;for(let t=0;t<=g;t++){const a=t/g,o=a*Math.PI*2*h,l=x.y3.RotationZ(-r),c=x.y3.RotationY(o),u=x.P.TransformCoordinates(x.P.Up(),l),_=x.P.TransformCoordinates(u,c),p=_.multiply(d),M=_.divide(d).normalize();m.push(p.x,p.y,p.z),T.push(M.x,M.y,M.z),y.push(a,oe.VJ?1-i:i)}if(t>0){const i=m.length/3;for(let r=i-2*(g+1);r+g+2<i;r++)u?(t>1&&(p.push(r),p.push(r+1),p.push(r+g+1)),(t<_||l<1)&&(p.push(r+g+1),p.push(r+1),p.push(r+g+2))):(p.push(r),p.push(r+1),p.push(r+g+1),p.push(r+g+1),p.push(r+1),p.push(r+g+2))}}VertexData._ComputeSides(c,m,p,T,y,t.frontUVs,t.backUVs);const M=new VertexData;return M.indices=p,M.positions=m,M.normals=T,M.uvs=y,M}function CreateSphere(t,i={},r=null){const a=new Mesh(t,r);i.sideOrientation=Mesh._GetDefaultSideOrientation(i.sideOrientation),a._originalBuilderSideOrientation=i.sideOrientation;return CreateSphereVertexData(i).applyToMesh(a,i.updatable),a}VertexData.CreateCylinder=CreateCylinderVertexData,Mesh.CreateCylinder=(t,i,r,a,o,h,l,c,u)=>{void 0!==l&&l instanceof p.x||(void 0!==l&&(u=c||Mesh.DEFAULTSIDE,c=l),l=h,h=1);return CreateCylinder(t,{"height":i,"diameterTop":r,"diameterBottom":a,"tessellation":o,"subdivisions":h,"sideOrientation":u,"updatable":c},l)};VertexData.CreateSphere=CreateSphereVertexData,Mesh.CreateSphere=(t,i,r,a,o,h)=>CreateSphere(t,{"segments":i,"diameterX":r,"diameterY":r,"diameterZ":r,"sideOrientation":h,"updatable":o},a);var Ue=function createPartMaterial(t,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Wo(0,0,0),o=new StandardMaterial(i,t);return o.diffuseColor=r,o.emissiveColor=a,o.specularColor=new V.Wo(.1,.12,.15),o},ke=function createBuildingPrefab(t,i,r){var a,o=new TransformNode("".concat(r,"-root"),t);return a="monument"===i?function createMonumentPrefab(t,i,r){var a=CreateCylinder("".concat(r,"-base"),{"diameter":4.8,"height":1.2,"tessellation":8},t);a.position=new x.P(0,.6,0),a.parent=i,a.material=Ue(t,"".concat(r,"-base-material"),new V.Wo(.35,.47,.63));var o=CreateCylinder("".concat(r,"-pillar"),{"diameterTop":1.7,"diameterBottom":2.3,"height":5.6,"tessellation":8},t);o.position=new x.P(0,3.8,0),o.parent=i,o.material=Ue(t,"".concat(r,"-pillar-material"),new V.Wo(.48,.65,.86));var h=CreateSphere("".concat(r,"-top"),{"diameter":1.3,"segments":6},t);return h.position=new x.P(0,6.95,0),h.parent=i,h.material=Ue(t,"".concat(r,"-top-material"),new V.Wo(.82,.9,.99),new V.Wo(.08,.1,.14)),[a,o,h]}(t,o,r):"house"===i?function createHousePrefab(t,i,r){var a=CreateBox("".concat(r,"-foundation"),{"width":5.4,"depth":4.8,"height":.7},t);a.position=new x.P(0,.35,0),a.parent=i,a.material=Ue(t,"".concat(r,"-foundation-material"),new V.Wo(.25,.35,.45));var o=CreateBox("".concat(r,"-body"),{"width":4.6,"depth":4,"height":3.2},t);o.position=new x.P(0,2.3,0),o.parent=i,o.material=Ue(t,"".concat(r,"-body-material"),new V.Wo(.74,.86,.97));var h=CreateCylinder("".concat(r,"-roof"),{"diameterTop":.2,"diameterBottom":5.8,"height":2.2,"tessellation":4},t);return h.position=new x.P(0,4.9,0),h.rotation.y=Math.PI/4,h.parent=i,h.material=Ue(t,"".concat(r,"-roof-material"),new V.Wo(.91,.54,.49)),[a,o,h]}(t,o,r):function createGardenPrefab(t,i,r){var a=CreateCylinder("".concat(r,"-floor"),{"diameter":5.5,"height":.5,"tessellation":10},t);a.position=new x.P(0,.25,0),a.parent=i,a.material=Ue(t,"".concat(r,"-floor-material"),new V.Wo(.22,.42,.3));var o=CreateCylinder("".concat(r,"-statue"),{"diameterTop":.7,"diameterBottom":1.2,"height":3.2,"tessellation":8},t);o.position=new x.P(0,2.1,0),o.parent=i,o.material=Ue(t,"".concat(r,"-statue-material"),new V.Wo(.63,.82,.73));var h=CreateSphere("".concat(r,"-statue-top"),{"diameter":1.1,"segments":6},t);h.position=new x.P(0,3.95,0),h.parent=i,h.material=Ue(t,"".concat(r,"-statue-top-material"),new V.Wo(.78,.92,.84));var l=CreateCylinder("".concat(r,"-ring"),{"diameter":4.8,"height":.35,"tessellation":10},t);return l.position=new x.P(0,.7,0),l.parent=i,l.material=Ue(t,"".concat(r,"-ring-material"),new V.Wo(.38,.67,.5)),[a,o,h,l]}(t,o,r),function enableBuildingCollisions(t){t.forEach(function(t){t.checkCollisions=!0,t.isPickable=!0})}(a),{"root":o,"meshes":a}},Ve=function setMeshesAlpha(t,i){t.forEach(function(t){t.material instanceof StandardMaterial&&(t.material.alpha=i)})},Ge=function setMeshesEmissive(t,i){t.forEach(function(t){t.material instanceof StandardMaterial&&t.material.emissiveColor.copyFrom(i)})},ze=function formatProgressText(t,i){return"".concat(t,"\n").concat(Math.round(100*i),"%")},We=function(){return(0,_.Z)(function BuildingManager(t){(0,d.Z)(this,BuildingManager),(0,g.Z)(this,"scene",void 0),(0,g.Z)(this,"runtimes",new Map),(0,g.Z)(this,"idCounter",0),this.scene=t},[{"key":"createBuildingSite","value":function createBuildingSite(t){var i,r,a;this.idCounter+=1;var o="building-".concat(this.idCounter),h=ke(this.scene,t.type,o);h.root.position.copyFrom(t.position),h.root.rotation.y=null!==(i=t.rotationY)&&void 0!==i?i:0;var l=Te(this.scene,"".concat(o,"-label"),{"width":8,"height":3.2,"font":'bold 42px "Noto Sans SC", sans-serif',"textColor":"#ECF6FF","backgroundColor":"rgba(7, 16, 29, 0.65)","emissiveColor":new V.Wo(.85,.92,1),"offset":new x.P(0,8.2,0),"parent":h.root}),c={"id":o,"type":t.type,"name":t.name,"position":t.position.clone(),"rotationY":null!==(r=t.rotationY)&&void 0!==r?r:0,"progress":0,"status":"building","createdAtMs":Date.now(),"requestedBy":null!==(a=t.requestedBy)&&void 0!==a?a:"system"};return Ve(h.meshes,.36),l.setText(ze(c.name,0)),this.runtimes.set(o,{"data":c,"root":h.root,"meshes":h.meshes,"label":l,"completionFxRemainingSeconds":0}),o}},{"key":"setProgress","value":function setProgress(t,i){var r=this.runtimes.get(t);if(r){var a=function clampProgress(t){return t<0?0:t>1?1:t}(i);r.data.progress=a,"building"===r.data.status&&(r.label.setText(ze(r.data.name,a)),a>=1&&this.complete(t))}}},{"key":"complete","value":function complete(t){var i=this.runtimes.get(t);i&&"complete"!==i.data.status&&(i.data.status="complete",i.data.progress=1,Ve(i.meshes,1),Ge(i.meshes,new V.Wo(.35,.48,.62)),i.label.setText(i.data.name),i.completionFxRemainingSeconds=.45)}},{"key":"fixedTick","value":function fixedTick(t,i){var r=1+.15*Math.sin(i/220);this.runtimes.forEach(function(i){if(!(i.completionFxRemainingSeconds<=0)){i.completionFxRemainingSeconds=Math.max(0,i.completionFxRemainingSeconds-t);var a=i.completionFxRemainingSeconds/.45,o=new V.Wo((.12+.4*a)*r,(.16+.45*a)*r,(.2+.5*a)*r);Ge(i.meshes,o),i.completionFxRemainingSeconds<=0&&Ge(i.meshes,new V.Wo(0,0,0))}})}},{"key":"isPositionOccupied","value":function isPositionOccupied(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,a=r*r,o=(0,Ne.Z)(this.runtimes.values());try{for(o.s();!(i=o.n()).done;){var h=i.value,l=h.data.position.x-t.x,c=h.data.position.z-t.z;if(l*l+c*c<=a)return!0}}catch(t){o.e(t)}finally{o.f()}return!1}},{"key":"getSnapshots","value":function getSnapshots(){return Array.from(this.runtimes.values()).map(function(t){return{"id":t.data.id,"type":t.data.type,"name":t.data.name,"position":t.data.position.clone(),"rotationY":t.data.rotationY,"progress":t.data.progress,"status":t.data.status,"createdAtMs":t.data.createdAtMs,"requestedBy":t.data.requestedBy}})}},{"key":"dispose","value":function dispose(){this.runtimes.forEach(function(t){t.label.dispose(),t.root.dispose(!1,!0)}),this.runtimes.clear()}}])}(),He=function composeMoveInput(t,i,r){return function normalizeMoveVector(t){var i=Math.sqrt(t.x*t.x+t.z*t.z);return i<=1?t:{"x":t.x/i,"z":t.z/i}}({"x":t.x+(r?i.x:0),"z":t.z+(r?i.z:0)})},Xe=new Set(["w","arrowup"]),Ke=new Set(["s","arrowdown"]),qe=new Set(["a","arrowleft"]),Ye=new Set(["d","arrowright"]),je=function(){return(0,_.Z)(function KeyboardInput(){var t=this;(0,d.Z)(this,KeyboardInput),(0,g.Z)(this,"pressedKeys",new Set),(0,g.Z)(this,"started",!1),(0,g.Z)(this,"handleKeyDown",function(i){t.pressedKeys.add(i.key.toLowerCase())}),(0,g.Z)(this,"handleKeyUp",function(i){t.pressedKeys.delete(i.key.toLowerCase())})},[{"key":"start","value":function start(){this.started||"undefined"==typeof window||(window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),this.started=!0)}},{"key":"stop","value":function stop(){this.started&&"undefined"!=typeof window&&(window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.pressedKeys.clear(),this.started=!1)}},{"key":"getMoveVector","value":function getMoveVector(){var t=0,i=0;return this.hasAnyPressed(qe)&&(t-=1),this.hasAnyPressed(Ye)&&(t+=1),this.hasAnyPressed(Xe)&&(i+=1),this.hasAnyPressed(Ke)&&(i-=1),{"x":t,"z":i}}},{"key":"hasAnyPressed","value":function hasAnyPressed(t){var i,r=(0,Ne.Z)(t);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(this.pressedKeys.has(a))return!0}}catch(t){r.e(t)}finally{r.f()}return!1}}])}(),Ze=function updatePlayer(t){var i=t.camera,r=t.deltaSeconds,a=t.input,o=t.player,h=t.motionState,l=function getMovementDirection(t,i){var r=t.getTarget().subtract(t.position);r.y=0,r.lengthSquared()<1e-4&&r.copyFromFloats(0,0,1),r.normalize();var a=x.P.Cross(ce.RD.Y,r);a.normalize();var o=a.scale(i.x).add(r.scale(i.z));return o.lengthSquared()>1&&o.normalize(),o}(i,a),c=l.scale(6*r);h.verticalVelocity+=-24*r;var u=h.verticalVelocity*r;o.moveWithCollisions(new x.P(c.x,u,c.z)),o.position.y<1&&(o.position.y=1,h.verticalVelocity=0),o.position.x=Math.max(-96,Math.min(96,o.position.x)),o.position.z=Math.max(-96,Math.min(96,o.position.z)),l.lengthSquared()>1e-4&&(o.rotation.y=Math.atan2(l.x,l.z))},Qe=r(7143),$e=r(27),Je=r(9665);class AutoRotationBehavior{"constructor"(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get"name"(){return"AutoRotation"}set"zoomStopsAnimation"(t){this._zoomStopsAnimation=t}get"zoomStopsAnimation"(){return this._zoomStopsAnimation}set"idleRotationSpeed"(t){this._idleRotationSpeed=t}get"idleRotationSpeed"(){return this._idleRotationSpeed}set"idleRotationWaitTime"(t){this._idleRotationWaitTime=t}get"idleRotationWaitTime"(){return this._idleRotationWaitTime}set"idleRotationSpinupTime"(t){this._idleRotationSpinupTime=t}get"idleRotationSpinupTime"(){return this._idleRotationSpinupTime}get"rotationInProgress"(){return Math.abs(this._cameraRotationSpeed)>0}"init"(){}"attach"(t){this._attachedCamera=t;const i=this._attachedCamera.getScene();this._onPrePointerObservableObserver=i.onPrePointerObservable.add(t=>{t.type!==$e.kD.POINTERDOWN?t.type===$e.kD.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(()=>{if(this._reachTargetAlpha())return;const t=Je.F.Now;let i=0;null!=this._lastFrameTime&&(i=t-this._lastFrameTime),this._lastFrameTime=t,this._applyUserInteraction();const r=t-this._lastInteractionTime-this._idleRotationWaitTime,a=Math.max(Math.min(r/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*a,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(i/1e3))})}"detach"(){if(!this._attachedCamera)return;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}"resetLastInteractionTime"(t){this._lastInteractionTime=t??Je.F.Now}"_reachTargetAlpha"(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<I.kn}"_userIsZooming"(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}"_shouldAnimationStopForInteraction"(){if(!this._attachedCamera)return!1;let t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()}"_applyUserInteraction"(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Je.F.Now)}"_userIsMoving"(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}r(3118);class EasingFunction{"constructor"(){this._easingMode=EasingFunction.EASINGMODE_EASEIN}"setEasingMode"(t){const i=Math.min(Math.max(t,0),2);this._easingMode=i}"getEasingMode"(){return this._easingMode}"easeInCore"(t){throw new Error("You must implement this method")}"ease"(t){switch(this._easingMode){case EasingFunction.EASINGMODE_EASEIN:return this.easeInCore(t);case EasingFunction.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}EasingFunction.EASINGMODE_EASEIN=0,EasingFunction.EASINGMODE_EASEOUT=1,EasingFunction.EASINGMODE_EASEINOUT=2;class AnimationRange{"constructor"(t,i,r){this.name=t,this.from=i,this.to=r}"clone"(){return new AnimationRange(this.name,this.from,this.to)}}var et=r(3321),tt=r(4910);const it=Object.freeze(new x._f(0,0,0,0)),rt=Object.freeze(x.P.Zero()),st=Object.freeze(x.FM.Zero()),nt=Object.freeze(et.$.Zero()),at=Object.freeze(V.Wo.Black()),ot=Object.freeze(new V.HE(0,0,0,0)),ht={"key":0,"repeatCount":0,"loopMode":2};class Animation{static"_PrepareAnimation"(t,i,r,a,o,h,l,c){let u;if(!isNaN(parseFloat(o))&&isFinite(o)?u=Animation.ANIMATIONTYPE_FLOAT:o instanceof x._f?u=Animation.ANIMATIONTYPE_QUATERNION:o instanceof x.P?u=Animation.ANIMATIONTYPE_VECTOR3:o instanceof x.FM?u=Animation.ANIMATIONTYPE_VECTOR2:o instanceof V.Wo?u=Animation.ANIMATIONTYPE_COLOR3:o instanceof V.HE?u=Animation.ANIMATIONTYPE_COLOR4:o instanceof et.$&&(u=Animation.ANIMATIONTYPE_SIZE),null==u)return null;const d=new Animation(t,i,r,u,l),_=[{"frame":0,"value":o},{"frame":a,"value":h}];return d.setKeys(_),void 0!==c&&d.setEasingFunction(c),d}static"CreateAnimation"(t,i,r,a){const o=new Animation(t+"Animation",t,r,i,Animation.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(a),o}static"CreateAndStartAnimation"(t,i,r,a,o,h,l,c,u,d,_){const g=Animation._PrepareAnimation(t,r,a,o,h,l,c,u);return g?(i.getScene&&(_=i.getScene()),_?_.beginDirectAnimation(i,[g],0,o,g.loopMode!==Animation.ANIMATIONLOOPMODE_CONSTANT,1,d):null):null}static"CreateAndStartHierarchyAnimation"(t,i,r,a,o,h,l,c,u,d,_){const g=Animation._PrepareAnimation(t,a,o,h,l,c,u,d);if(!g)return null;return i.getScene().beginDirectHierarchyAnimation(i,r,[g],0,h,1===g.loopMode,1,_)}static"CreateMergeAndStartAnimation"(t,i,r,a,o,h,l,c,u,d){const _=Animation._PrepareAnimation(t,r,a,o,h,l,c,u);return _?(i.animations.push(_),i.getScene().beginAnimation(i,0,o,1===_.loopMode,1,d)):null}static"MakeAnimationAdditive"(t,i,r,a=!1,o){let h;h="object"==typeof i?i:{"referenceFrame":i??0,"range":r,"cloneOriginalAnimation":a,"clonedAnimationName":o};let l=t;if(h.cloneOriginalAnimation&&(l=t.clone(),l.name=h.clonedAnimationName||l.name),!l._keys.length)return l;const c=h.referenceFrame&&h.referenceFrame>=0?h.referenceFrame:0;let u=0;const d=l._keys[0];let _=l._keys.length-1;const g=l._keys[_],p={"referenceValue":d.value,"referencePosition":x.jp.Vector3[0],"referenceQuaternion":x.jp.Quaternion[0],"referenceScaling":x.jp.Vector3[1],"keyPosition":x.jp.Vector3[2],"keyQuaternion":x.jp.Quaternion[1],"keyScaling":x.jp.Vector3[3]};let m=d.frame,T=g.frame;if(h.range){const t=l.getRange(h.range);t&&(m=t.from,T=t.to)}else m=h.fromFrame??m,T=h.toFrame??T;if(m!==d.frame&&(u=l.createKeyForFrame(m)),T!==g.frame&&(_=l.createKeyForFrame(T)),1===l._keys.length){const t=l._getKeyValue(l._keys[0]);p.referenceValue=t.clone?t.clone():t}else if(c<=d.frame){const t=l._getKeyValue(d.value);p.referenceValue=t.clone?t.clone():t}else if(c>=g.frame){const t=l._getKeyValue(g.value);p.referenceValue=t.clone?t.clone():t}else{ht.key=0;const t=l._interpolate(c,ht);p.referenceValue=t.clone?t.clone():t}l.dataType===Animation.ANIMATIONTYPE_QUATERNION?p.referenceValue.normalize().conjugateInPlace():l.dataType===Animation.ANIMATIONTYPE_MATRIX&&(p.referenceValue.decompose(p.referenceScaling,p.referenceQuaternion,p.referencePosition),p.referenceQuaternion.normalize().conjugateInPlace());let y=Number.MAX_VALUE;const M=h.clipKeys?[]:null;for(let t=u;t<=_;t++){let i=l._keys[t];if((M||h.cloneOriginalAnimation)&&(i={"frame":i.frame,"value":i.value.clone?i.value.clone():i.value,"inTangent":i.inTangent,"outTangent":i.outTangent,"interpolation":i.interpolation,"lockedTangent":i.lockedTangent},M&&(y===Number.MAX_VALUE&&(y=i.frame),i.frame-=y,M.push(i))),!t||l.dataType===Animation.ANIMATIONTYPE_FLOAT||i.value!==d.value)switch(l.dataType){case Animation.ANIMATIONTYPE_MATRIX:i.value.decompose(p.keyScaling,p.keyQuaternion,p.keyPosition),p.keyPosition.subtractInPlace(p.referencePosition),p.keyScaling.divideInPlace(p.referenceScaling),p.referenceQuaternion.multiplyToRef(p.keyQuaternion,p.keyQuaternion),x.y3.ComposeToRef(p.keyScaling,p.keyQuaternion,p.keyPosition,i.value);break;case Animation.ANIMATIONTYPE_QUATERNION:p.referenceValue.multiplyToRef(i.value,i.value);break;case Animation.ANIMATIONTYPE_VECTOR2:case Animation.ANIMATIONTYPE_VECTOR3:case Animation.ANIMATIONTYPE_COLOR3:case Animation.ANIMATIONTYPE_COLOR4:i.value.subtractToRef(p.referenceValue,i.value);break;case Animation.ANIMATIONTYPE_SIZE:i.value.width-=p.referenceValue.width,i.value.height-=p.referenceValue.height;break;default:i.value-=p.referenceValue}}return M&&l.setKeys(M,!0),l}static"TransitionTo"(t,i,r,a,o,h,l,c=null){if(l<=0)return r[t]=i,c&&c(),null;const u=o*(l/1e3);h.setKeys([{"frame":0,"value":r[t].clone?r[t].clone():r[t]},{"frame":u,"value":i}]),r.animations||(r.animations=[]),r.animations.push(h);const d=a.beginAnimation(r,0,u,!1);return d.onAnimationEnd=c,d}get"runtimeAnimations"(){return this._runtimeAnimations}get"hasRunningRuntimeAnimations"(){for(const t of this._runtimeAnimations)if(!t.isStopped())return!0;return!1}"constructor"(t,i,r,a,o,h){this.name=t,this.targetProperty=i,this.framePerSecond=r,this.dataType=a,this.loopMode=o,this.enableBlending=h,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=i.split("."),this.dataType=a,this.loopMode=void 0===o?Animation.ANIMATIONLOOPMODE_CYCLE:o,this.uniqueId=Animation._UniqueIdGenerator++}"toString"(t){let i="Name: "+this.name+", property: "+this.targetProperty;if(i+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],i+=", nKeys: "+(this._keys?this._keys.length:"none"),i+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){i+=", Ranges: {";let t=!0;for(const r in this._ranges)t&&(i+=", ",t=!1),i+=r;i+="}"}return i}"addEvent"(t){this._events.push(t),this._events.sort((t,i)=>t.frame-i.frame)}"removeEvents"(t){for(let i=0;i<this._events.length;i++)this._events[i].frame===t&&(this._events.splice(i,1),i--)}"getEvents"(){return this._events}"createRange"(t,i,r){this._ranges[t]||(this._ranges[t]=new AnimationRange(t,i,r))}"deleteRange"(t,i=!0){const r=this._ranges[t];if(r){if(i){const t=r.from,i=r.to;for(let r=this._keys.length-1;r>=0;r--)this._keys[r].frame>=t&&this._keys[r].frame<=i&&this._keys.splice(r,1)}this._ranges[t]=null}}"getRange"(t){return this._ranges[t]}"getKeys"(){return this._keys}"getHighestFrame"(){let t=0;for(let i=0,r=this._keys.length;i<r;i++)t<this._keys[i].frame&&(t=this._keys[i].frame);return t}"getEasingFunction"(){return this._easingFunction}"setEasingFunction"(t){this._easingFunction=t}"floatInterpolateFunction"(t,i,r){return(0,Qe.EH)(t,i,r)}"floatInterpolateFunctionWithTangents"(t,i,r,a,o){return(0,Qe.Xv)(t,i,r,a,o)}"quaternionInterpolateFunction"(t,i,r){return x._f.Slerp(t,i,r)}"quaternionInterpolateFunctionWithTangents"(t,i,r,a,o){return x._f.Hermite(t,i,r,a,o).normalize()}"vector3InterpolateFunction"(t,i,r){return x.P.Lerp(t,i,r)}"vector3InterpolateFunctionWithTangents"(t,i,r,a,o){return x.P.Hermite(t,i,r,a,o)}"vector2InterpolateFunction"(t,i,r){return x.FM.Lerp(t,i,r)}"vector2InterpolateFunctionWithTangents"(t,i,r,a,o){return x.FM.Hermite(t,i,r,a,o)}"sizeInterpolateFunction"(t,i,r){return et.$.Lerp(t,i,r)}"color3InterpolateFunction"(t,i,r){return V.Wo.Lerp(t,i,r)}"color3InterpolateFunctionWithTangents"(t,i,r,a,o){return V.Wo.Hermite(t,i,r,a,o)}"color4InterpolateFunction"(t,i,r){return V.HE.Lerp(t,i,r)}"color4InterpolateFunctionWithTangents"(t,i,r,a,o){return V.HE.Hermite(t,i,r,a,o)}"_getKeyValue"(t){return"function"==typeof t?t():t}"evaluate"(t){return ht.key=0,this._interpolate(t,ht)}"_interpolate"(t,i,r=!1){if(i.loopMode===Animation.ANIMATIONLOOPMODE_CONSTANT&&i.repeatCount>0)return i.highLimitValue.clone?i.highLimitValue.clone():i.highLimitValue;const a=this._keys,o=a.length;let h=i.key;for(;h>=0&&t<a[h].frame;)--h;for(;h+1<=o-1&&t>=a[h+1].frame;)++h;if(i.key=h,h<0)return r?void 0:this._getKeyValue(a[0].value);if(h+1>o-1)return r?void 0:this._getKeyValue(a[o-1].value);const l=a[h],c=a[h+1];if(r&&(t===l.frame||t===c.frame))return;const u=this._getKeyValue(l.value),d=this._getKeyValue(c.value);if(1===l.interpolation)return c.frame>t?u:d;const _=void 0!==l.outTangent&&void 0!==c.inTangent,g=c.frame-l.frame;let p=(t-l.frame)/g;const m=l.easingFunction||this.getEasingFunction();switch(m&&(p=m.ease(p)),this.dataType){case Animation.ANIMATIONTYPE_FLOAT:{const t=_?this.floatInterpolateFunctionWithTangents(u,l.outTangent*g,d,c.inTangent*g,p):this.floatInterpolateFunction(u,d,p);switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return t;case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(i.offsetValue??0)*i.repeatCount+t}break}case Animation.ANIMATIONTYPE_QUATERNION:{const t=_?this.quaternionInterpolateFunctionWithTangents(u,l.outTangent.scale(g),d,c.inTangent.scale(g),p):this.quaternionInterpolateFunction(u,d,p);switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return t;case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.addInPlace((i.offsetValue||it).scale(i.repeatCount))}return t}case Animation.ANIMATIONTYPE_VECTOR3:{const t=_?this.vector3InterpolateFunctionWithTangents(u,l.outTangent.scale(g),d,c.inTangent.scale(g),p):this.vector3InterpolateFunction(u,d,p);switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return t;case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||rt).scale(i.repeatCount))}break}case Animation.ANIMATIONTYPE_VECTOR2:{const t=_?this.vector2InterpolateFunctionWithTangents(u,l.outTangent.scale(g),d,c.inTangent.scale(g),p):this.vector2InterpolateFunction(u,d,p);switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return t;case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||st).scale(i.repeatCount))}break}case Animation.ANIMATIONTYPE_SIZE:switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(u,d,p);case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(u,d,p).add((i.offsetValue||nt).scale(i.repeatCount))}break;case Animation.ANIMATIONTYPE_COLOR3:{const t=_?this.color3InterpolateFunctionWithTangents(u,l.outTangent.scale(g),d,c.inTangent.scale(g),p):this.color3InterpolateFunction(u,d,p);switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return t;case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||at).scale(i.repeatCount))}break}case Animation.ANIMATIONTYPE_COLOR4:{const t=_?this.color4InterpolateFunctionWithTangents(u,l.outTangent.scale(g),d,c.inTangent.scale(g),p):this.color4InterpolateFunction(u,d,p);switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return t;case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||ot).scale(i.repeatCount))}break}case Animation.ANIMATIONTYPE_MATRIX:switch(i.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:case Animation.ANIMATIONLOOPMODE_YOYO:return Animation.AllowMatricesInterpolation?this.matrixInterpolateFunction(u,d,p,i.workValue):u;case Animation.ANIMATIONLOOPMODE_RELATIVE:case Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u}}return 0}"matrixInterpolateFunction"(t,i,r,a){return Animation.AllowMatrixDecomposeForInterpolation?a?(x.y3.DecomposeLerpToRef(t,i,r,a),a):x.y3.DecomposeLerp(t,i,r):a?(x.y3.LerpToRef(t,i,r,a),a):x.y3.Lerp(t,i,r)}"clone"(){const t=new Animation(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(const i in this._ranges){const r=this._ranges[i];r&&(t._ranges[i]=r.clone())}}return t}"setKeys"(t,i=!1){this._keys=i?t:t.slice(0)}"createKeyForFrame"(t){ht.key=0;const i=this._interpolate(t,ht,!0);if(!i)return this._keys[ht.key].frame===t?ht.key:ht.key+1;const r={"frame":t,"value":i.clone?i.clone():i};return this._keys.splice(ht.key+1,0,r),ht.key+1}"serialize"(){const t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;const i=this.dataType;t.keys=[];const r=this.getKeys();for(let a=0;a<r.length;a++){const o=r[a],h={};switch(h.frame=o.frame,i){case Animation.ANIMATIONTYPE_FLOAT:h.values=[o.value],void 0!==o.inTangent&&h.values.push(o.inTangent),void 0!==o.outTangent&&(void 0===o.inTangent&&h.values.push(void 0),h.values.push(o.outTangent)),void 0!==o.interpolation&&(void 0===o.inTangent&&h.values.push(void 0),void 0===o.outTangent&&h.values.push(void 0),h.values.push(o.interpolation));break;case Animation.ANIMATIONTYPE_QUATERNION:case Animation.ANIMATIONTYPE_MATRIX:case Animation.ANIMATIONTYPE_VECTOR3:case Animation.ANIMATIONTYPE_COLOR3:case Animation.ANIMATIONTYPE_COLOR4:h.values=o.value.asArray(),null!=o.inTangent&&h.values.push(o.inTangent.asArray()),null!=o.outTangent&&(void 0===o.inTangent&&h.values.push(void 0),h.values.push(o.outTangent.asArray())),void 0!==o.interpolation&&(void 0===o.inTangent&&h.values.push(void 0),void 0===o.outTangent&&h.values.push(void 0),h.values.push(o.interpolation))}t.keys.push(h)}t.ranges=[];for(const i in this._ranges){const r=this._ranges[i];if(!r)continue;const a={};a.name=i,a.from=r.from,a.to=r.to,t.ranges.push(a)}return t}static"_UniversalLerp"(t,i,r){const a=t.constructor;return a.Lerp?a.Lerp(t,i,r):a.Slerp?a.Slerp(t,i,r):t.toFixed?t*(1-r)+r*i:i}static"Parse"(t){const i=new Animation(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),r=t.dataType,a=[];let o,h;for(t.enableBlending&&(i.enableBlending=t.enableBlending),t.blendingSpeed&&(i.blendingSpeed=t.blendingSpeed),h=0;h<t.keys.length;h++){const i=t.keys[h];let l,c,u;switch(r){case Animation.ANIMATIONTYPE_FLOAT:o=i.values[0],i.values.length>=2&&(l=i.values[1]),i.values.length>=3&&(c=i.values[2]),i.values.length>=4&&(u=i.values[3]);break;case Animation.ANIMATIONTYPE_QUATERNION:if(o=x._f.FromArray(i.values),i.values.length>=8){const t=x._f.FromArray(i.values.slice(4,8));t.equals(x._f.Zero())||(l=t)}if(i.values.length>=12){const t=x._f.FromArray(i.values.slice(8,12));t.equals(x._f.Zero())||(c=t)}i.values.length>=13&&(u=i.values[12]);break;case Animation.ANIMATIONTYPE_MATRIX:o=x.y3.FromArray(i.values),i.values.length>=17&&(u=i.values[16]);break;case Animation.ANIMATIONTYPE_COLOR3:o=V.Wo.FromArray(i.values),i.values[3]&&(l=V.Wo.FromArray(i.values[3])),i.values[4]&&(c=V.Wo.FromArray(i.values[4])),i.values[5]&&(u=i.values[5]);break;case Animation.ANIMATIONTYPE_COLOR4:o=V.HE.FromArray(i.values),i.values[4]&&(l=V.HE.FromArray(i.values[4])),i.values[5]&&(c=V.HE.FromArray(i.values[5])),i.values[6]&&(u=V.HE.FromArray(i.values[6]));break;case Animation.ANIMATIONTYPE_VECTOR3:default:o=x.P.FromArray(i.values),i.values[3]&&(l=x.P.FromArray(i.values[3])),i.values[4]&&(c=x.P.FromArray(i.values[4])),i.values[5]&&(u=i.values[5])}const d={};d.frame=i.frame,d.value=o,null!=l&&(d.inTangent=l),null!=c&&(d.outTangent=c),null!=u&&(d.interpolation=u),a.push(d)}if(i.setKeys(a),t.ranges)for(h=0;h<t.ranges.length;h++)o=t.ranges[h],i.createRange(o.name,o.from,o.to);return i}static"AppendSerializedAnimations"(t,i){A.p.AppendSerializedAnimations(t,i)}static"ParseFromFileAsync"(t,i){return new Promise((r,a)=>{const o=new tt.g;o.addEventListener("readystatechange",()=>{if(4==o.readyState)if(200==o.status){let i=JSON.parse(o.responseText);if(i.animations&&(i=i.animations),i.length){const t=[];for(const r of i)t.push(this.Parse(r));r(t)}else{const a=this.Parse(i);t&&(a.name=t),r(a)}}else a("Unable to load the animation")}),o.open("GET",i),o.send()})}static"ParseFromSnippetAsync"(t){return new Promise((i,r)=>{const a=new tt.g;a.addEventListener("readystatechange",()=>{if(4==a.readyState)if(200==a.status){const r=JSON.parse(JSON.parse(a.responseText).jsonPayload);if(r.animations){const a=JSON.parse(r.animations),o=[];for(const i of a.animations){const r=this.Parse(i);r.snippetId=t,o.push(r)}i(o)}else{const a=JSON.parse(r.animation),o=this.Parse(a);o.snippetId=t,i(o)}}else r("Unable to load the snippet "+t)}),a.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),a.send()})}}Animation._UniqueIdGenerator=0,Animation.AllowMatricesInterpolation=!1,Animation.AllowMatrixDecomposeForInterpolation=!0,Animation.SnippetUrl="https://snippet.babylonjs.com",Animation.ANIMATIONTYPE_FLOAT=0,Animation.ANIMATIONTYPE_VECTOR3=1,Animation.ANIMATIONTYPE_QUATERNION=2,Animation.ANIMATIONTYPE_MATRIX=3,Animation.ANIMATIONTYPE_COLOR3=4,Animation.ANIMATIONTYPE_COLOR4=7,Animation.ANIMATIONTYPE_VECTOR2=5,Animation.ANIMATIONTYPE_SIZE=6,Animation.ANIMATIONLOOPMODE_RELATIVE=0,Animation.ANIMATIONLOOPMODE_CYCLE=1,Animation.ANIMATIONLOOPMODE_CONSTANT=2,Animation.ANIMATIONLOOPMODE_YOYO=4,Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,Animation.CreateFromSnippetAsync=Animation.ParseFromSnippetAsync,(0,v.H7)("BABYLON.Animation",Animation),Node._AnimationRangeFactory=(t,i,r)=>new AnimationRange(t,i,r);class BouncingBehavior{"constructor"(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get"name"(){return"Bouncing"}get"autoTransitionRange"(){return this._autoTransitionRange}set"autoTransitionRange"(t){if(this._autoTransitionRange===t)return;this._autoTransitionRange=t;const i=this._attachedCamera;i&&(t?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add(t=>{if(t&&(t.computeWorldMatrix(!0),t.getBoundingInfo)){const i=t.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*i,this.upperRadiusTransitionRange=.05*i}}):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}"init"(){}"attach"(t){this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))})}"detach"(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}"_isRadiusAtLimit"(t){return!!this._attachedCamera&&(this._attachedCamera.radius===t&&!this._radiusIsAnimating)}"_applyBoundRadiusAnimation"(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(BouncingBehavior.EasingFunction.setEasingMode(BouncingBehavior.EasingMode),this._radiusBounceTransition=Animation.CreateAnimation("radius",Animation.ANIMATIONTYPE_FLOAT,60,BouncingBehavior.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const i=Animation.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,()=>this._clearAnimationLocks());i&&this._animatables.push(i)}"_clearAnimationLocks"(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}"stopAllAnimations"(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}BouncingBehavior.EasingFunction=new class BackEase extends EasingFunction{"constructor"(t=1){super(),this.amplitude=t}"easeInCore"(t){const i=Math.max(0,this.amplitude);return Math.pow(t,3)-t*i*Math.sin(3.141592653589793*t)}}(.3),BouncingBehavior.EasingMode=EasingFunction.EASINGMODE_EASEOUT;class FramingBehavior{"constructor"(){this.onTargetFramingAnimationEndObservable=new b.y$,this._mode=FramingBehavior.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get"name"(){return"Framing"}set"mode"(t){this._mode=t}get"mode"(){return this._mode}set"radiusScale"(t){this._radiusScale=t}get"radiusScale"(){return this._radiusScale}set"positionScale"(t){this._positionScale=t}get"positionScale"(){return this._positionScale}set"defaultElevation"(t){this._defaultElevation=t}get"defaultElevation"(){return this._defaultElevation}set"elevationReturnTime"(t){this._elevationReturnTime=t}get"elevationReturnTime"(){return this._elevationReturnTime}set"elevationReturnWaitTime"(t){this._elevationReturnWaitTime=t}get"elevationReturnWaitTime"(){return this._elevationReturnWaitTime}set"zoomStopsAnimation"(t){this._zoomStopsAnimation=t}get"zoomStopsAnimation"(){return this._zoomStopsAnimation}set"framingTime"(t){this._framingTime=t}get"framingTime"(){return this._framingTime}"init"(){}"attach"(t){this._attachedCamera=t;const i=this._attachedCamera.getScene();FramingBehavior.EasingFunction.setEasingMode(FramingBehavior.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add(t=>{t.type!==$e.kD.POINTERDOWN?t.type===$e.kD.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(t=>{t&&t.getBoundingInfo&&this.zoomOnMesh(t,void 0,()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()})}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()})}"detach"(){if(!this._attachedCamera)return;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}"zoomOnMesh"(t,i=!1,r=null){t.computeWorldMatrix(!0);const a=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(a.minimumWorld,a.maximumWorld,i,r)}"zoomOnMeshHierarchy"(t,i=!1,r=null){t.computeWorldMatrix(!0);const a=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(a.min,a.max,i,r)}"zoomOnMeshesHierarchy"(t,i=!1,r=null){const a=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new x.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<t.length;i++){const r=t[i].getHierarchyBoundingVectors(!0);x.P.CheckExtends(r.min,a,o),x.P.CheckExtends(r.max,a,o)}this.zoomOnBoundingInfo(a,o,i,r)}"zoomOnBoundingInfo"(t,i,r=!1,a=null){let o;if(!this._attachedCamera)return!1;const h=t.y,l=h+(i.y-h)*this._positionScale,c=i.subtract(t).scale(.5);if(!isFinite(l))return!1;if(r)o=new x.P(0,l,0);else{const i=t.add(c);o=new x.P(i.x,l,i.z)}this._vectorTransition||(this._vectorTransition=Animation.CreateAnimation("target",Animation.ANIMATIONTYPE_VECTOR3,60,FramingBehavior.EasingFunction)),this._betaIsAnimating=!0;let u=Animation.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);u&&this._animatables.push(u);let d=0;if(this._mode===FramingBehavior.FitFrustumSidesMode){const r=this._calculateLowerRadiusFromModelBoundingSphere(t,i);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.minZ),d=r}else this._mode===FramingBehavior.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(t,i),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const r=i.subtract(t).length();this._attachedCamera.panningSensibility=5e3/r,this._attachedCamera.wheelPrecision=100/d}return this._radiusTransition||(this._radiusTransition=Animation.CreateAnimation("radius",Animation.ANIMATIONTYPE_FLOAT,60,FramingBehavior.EasingFunction)),u=Animation.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,()=>{this.stopAllAnimations(),a&&a(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()}),u&&this._animatables.push(u),!0}"_calculateLowerRadiusFromModelBoundingSphere"(t,i){const r=this._attachedCamera;if(!r)return 0;let a=r._calculateLowerRadiusFromModelBoundingSphere(t,i,this._radiusScale);return r.lowerRadiusLimit&&this._mode===FramingBehavior.IgnoreBoundsSizeMode&&(a=a<r.lowerRadiusLimit?r.lowerRadiusLimit:a),r.upperRadiusLimit&&(a=a>r.upperRadiusLimit?r.upperRadiusLimit:a),a}"_maintainCameraAboveGround"(){if(this._elevationReturnTime<0)return;const t=Je.F.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,r=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Animation.CreateAnimation("beta",Animation.ANIMATIONTYPE_FLOAT,60,FramingBehavior.EasingFunction));const t=Animation.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,()=>{this._clearAnimationLocks(),this.stopAllAnimations()});t&&this._animatables.push(t)}}"_clearAnimationLocks"(){this._betaIsAnimating=!1}"_applyUserInteraction"(){this.isUserIsMoving&&(this._lastInteractionTime=Je.F.Now,this.stopAllAnimations(),this._clearAnimationLocks())}"stopAllAnimations"(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get"isUserIsMoving"(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}FramingBehavior.EasingFunction=new class ExponentialEase extends EasingFunction{"constructor"(t=2){super(),this.exponent=t}"easeInCore"(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)}},FramingBehavior.EasingMode=EasingFunction.EASINGMODE_EASEINOUT,FramingBehavior.IgnoreBoundsSizeMode=0,FramingBehavior.FitFrustumSidesMode=1,Node.AddNodeConstructor("TargetCamera",(t,i)=>()=>new TargetCamera(t,x.P.Zero(),i));class TargetCamera extends Camera{"constructor"(t,i,r,a=!0){super(t,i,r,a),this._tmpUpVector=x.P.Zero(),this._tmpTargetVector=x.P.Zero(),this.cameraDirection=new x.P(0,0,0),this.cameraRotation=new x.FM(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new x._f,this.rotation=new x.P(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=x.P.Zero(),this._initialFocalDistance=1,this._viewMatrix=x.y3.Zero(),this._camMatrix=x.y3.Zero(),this._cameraTransformMatrix=x.y3.Zero(),this._cameraRotationMatrix=x.y3.Zero(),this._referencePoint=new x.P(0,0,1),this._transformedReferencePoint=x.P.Zero(),this._deferredPositionUpdate=new x.P,this._deferredRotationQuaternionUpdate=new x._f,this._deferredRotationUpdate=new x.P,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=x.P.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}"getFrontPosition"(t){this.getWorldMatrix();const i=x.jp.Vector3[0],r=x.jp.Vector3[1];return r.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(r,i),i.scaleInPlace(t),this.globalPosition.add(i)}"_getLockedTargetPosition"(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const t=this.lockedTarget;t.computeWorldMatrix().getTranslationToRef(t.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}"storeState"(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}"_restoreStateValues"(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}"_initCache"(){super._initCache(),this._cache.lockedTarget=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new x._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}"_updateCache"(t){t||super._updateCache();const i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}"_isSynchronizedViewMatrix"(){if(!super._isSynchronizedViewMatrix())return!1;const t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}"_computeLocalCameraSpeed"(){const t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))}"setTarget"(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=I.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),x.y3.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const i=t.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&x._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get"target"(){return this.getTarget()}set"target"(t){this.setTarget(t)}"getTarget"(){return this._currentTarget}"_decideIfNeedsToMove"(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}"_updatePosition"(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(x.jp.Matrix[0]),x.P.TransformNormalToRef(this.cameraDirection,x.jp.Matrix[0],x.jp.Vector3[0]),this._deferredPositionUpdate.addInPlace(x.jp.Vector3[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}"_checkInputs"(){const t=this.invertRotation?-this.inverseRotationSpeed:1,i=this._decideIfNeedsToMove(),r=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),i&&this._updatePosition(),r){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*t,this._deferredRotationUpdate.y+=this.cameraRotation.y*t,!this.noRotationConstraint){const t=1.570796;this._deferredRotationUpdate.x>t&&(this._deferredRotationUpdate.x=t),this._deferredRotationUpdate.x<-t&&(this._deferredRotationUpdate.x=-t)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(x._f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))}}i&&(Math.abs(this.cameraDirection.x)<this.speed*I.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*I.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*I.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<this.speed*I.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*I.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}"_updateCameraRotationMatrix"(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):x.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}"_rotateUpVectorWithCameraRotationMatrix"(){return x.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}"_getViewMatrix"(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),x.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?ce.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(x._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),ce.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}"_computeViewMatrix"(t,i,r){if(this.ignoreParentScaling){if(this.parent){const a=this.parent.getWorldMatrix();x.P.TransformCoordinatesToRef(t,a,this._globalPosition),x.P.TransformCoordinatesToRef(i,a,this._tmpTargetVector),x.P.TransformNormalToRef(r,a,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._tmpTargetVector.copyFrom(i),this._tmpUpVector.copyFrom(r);this.getScene().useRightHandedSystem?x.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):x.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?x.y3.LookAtRHToRef(t,i,r,this._viewMatrix):x.y3.LookAtLHToRef(t,i,r,this._viewMatrix),this.parent){const t=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(t,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t)}"createRigCamera"(t,i){if(this.cameraRigMode!==Camera.RIG_MODE_NONE){const i=new TargetCamera(t,this.position.clone(),this.getScene());return i.isRigCamera=!0,i.rigParent=this,this.cameraRigMode===Camera.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new x._f),i._cameraRigParams={},i.rotationQuaternion=new x._f),i.mode=this.mode,i.orthoLeft=this.orthoLeft,i.orthoRight=this.orthoRight,i.orthoTop=this.orthoTop,i.orthoBottom=this.orthoBottom,i}return null}"_updateRigCameras"(){const t=this._rigCameras[0],i=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:{const r=this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,a=this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,i);break}case Camera.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),i.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),i.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),i.position.copyFrom(this.position)}super._updateRigCameras()}"_getRigCamPositionAndTarget"(t,i){this.getTarget().subtractToRef(this.position,TargetCamera._TargetFocalPoint),TargetCamera._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const r=TargetCamera._TargetFocalPoint.addInPlace(this.position);x.y3.TranslationToRef(-r.x,-r.y,-r.z,TargetCamera._TargetTransformMatrix),TargetCamera._TargetTransformMatrix.multiplyToRef(x.y3.RotationAxis(i.upVector,t),TargetCamera._RigCamTransformMatrix),x.y3.TranslationToRef(r.x,r.y,r.z,TargetCamera._TargetTransformMatrix),TargetCamera._RigCamTransformMatrix.multiplyToRef(TargetCamera._TargetTransformMatrix,TargetCamera._RigCamTransformMatrix),x.P.TransformCoordinatesToRef(this.position,TargetCamera._RigCamTransformMatrix,i.position),i.setTarget(r)}"getClassName"(){return"TargetCamera"}}TargetCamera._RigCamTransformMatrix=new x.y3,TargetCamera._TargetTransformMatrix=new x.y3,TargetCamera._TargetFocalPoint=new x.P,(0,m.gn)([(0,T.qC)()],TargetCamera.prototype,"ignoreParentScaling",void 0),(0,m.gn)([(0,T.qC)()],TargetCamera.prototype,"updateUpVectorFromRotation",void 0),(0,m.gn)([(0,T.hd)()],TargetCamera.prototype,"rotation",void 0),(0,m.gn)([(0,T.qC)()],TargetCamera.prototype,"speed",void 0),(0,m.gn)([(0,T.RR)("lockedTargetId")],TargetCamera.prototype,"lockedTarget",void 0);var lt={};class CameraInputsManager{"constructor"(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}"add"(t){const i=t.getSimpleName();this.attached[i]?C.Y.Warn("camera input of type "+i+" already exists on camera"):(this.attached[i]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}"remove"(t){for(const i in this.attached){const r=this.attached[i];if(r===t)return r.detachControl(),r.camera=null,delete this.attached[i],void this.rebuildInputCheck()}}"removeByType"(t){for(const i in this.attached){const r=this.attached[i];r.getClassName()===t&&(r.detachControl(),r.camera=null,delete this.attached[i],this.rebuildInputCheck())}}"_addCheckInputs"(t){const i=this.checkInputs;return()=>{i(),t()}}"attachInput"(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}"attachElement"(t=!1){if(!this.attachedToElement){t=!Camera.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const i in this.attached)this.attached[i].attachControl(t)}}"detachElement"(t=!1){for(const i in this.attached)this.attached[i].detachControl(),t&&(this.attached[i].camera=null);this.attachedToElement=!1}"rebuildInputCheck"(){this.checkInputs=()=>{};for(const t in this.attached){const i=this.attached[t];i.checkInputs&&(this.checkInputs=this._addCheckInputs(i.checkInputs.bind(i)))}}"clear"(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}"serialize"(t){const i={};for(const t in this.attached){const r=this.attached[t],a=A.p.Serialize(r);i[r.getClassName()]=a}t.inputsmgr=i}"parse"(t){const i=t.inputsmgr;if(i){this.clear();for(const t in i){const r=lt[t];if(r){const a=i[t],o=A.p.Parse(()=>new r,a,null);this.add(o)}}}else for(const i in this.attached){const r=lt[this.attached[i].getClassName()];if(r){const a=A.p.Parse(()=>new r,t,null);this.remove(this.attached[i]),this.add(a)}}}}class BaseCameraPointersInput{"constructor"(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}"attachControl"(t){t=M.w1.BackCompatCameraNoPreventDefault(arguments);const i=this.camera.getEngine(),r=i.getInputElement();let a=0,o=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=h=>{const l=h.event,c="touch"===l.pointerType;if(h.type!==$e.kD.POINTERMOVE&&-1===this.buttons.indexOf(l.button))return;const u=l.target;if(this._altKey=l.altKey,this._ctrlKey=l.ctrlKey,this._metaKey=l.metaKey,this._shiftKey=l.shiftKey,this._buttonsPressed=l.buttons,i.isPointerLock){const t=l.movementX,i=l.movementY;this.onTouch(null,t,i),this._pointA=null,this._pointB=null}else{if(h.type!==$e.kD.POINTERDOWN&&h.type!==$e.kD.POINTERDOUBLETAP&&c&&this._pointA?.pointerId!==l.pointerId&&this._pointB?.pointerId!==l.pointerId)return;if(h.type!==$e.kD.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!c)if(h.type===$e.kD.POINTERDOUBLETAP)this.onDoubleTap(l.pointerType);else if(h.type!==$e.kD.POINTERUP||this._currentMousePointerIdDown!==l.pointerId&&!c){if(h.type===$e.kD.POINTERMOVE)if(t||l.preventDefault(),this._pointA&&null===this._pointB){const t=l.clientX-this._pointA.x,i=l.clientY-this._pointA.y;this._pointA.x=l.clientX,this._pointA.y=l.clientY,this.onTouch(this._pointA,t,i)}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===l.pointerId?this._pointA:this._pointB;t.x=l.clientX,t.y=l.clientY;const i=this._pointA.x-this._pointB.x,r=this._pointA.y-this._pointB.y,c=i*i+r*r,u={"x":(this._pointA.x+this._pointB.x)/2,"y":(this._pointA.y+this._pointB.y)/2,"pointerId":l.pointerId,"type":h.type};this.onMultiTouch(this._pointA,this._pointB,a,c,o,u),o=u,a=c}}else{try{u?.releasePointerCapture(l.pointerId)}catch(t){}c||(this._pointB=null),i._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==l.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==l.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==a||o)&&(this.onMultiTouch(this._pointA,this._pointB,a,0,o,null),a=0,o=null),this._currentMousePointerIdDown=-1,this.onButtonUp(l),t||l.preventDefault()}else{try{u?.setPointerCapture(l.pointerId)}catch(t){}if(null===this._pointA)this._pointA={"x":l.clientX,"y":l.clientY,"pointerId":l.pointerId,"type":l.pointerType};else{if(null!==this._pointB)return;this._pointB={"x":l.clientX,"y":l.clientY,"pointerId":l.pointerId,"type":l.pointerType}}-1!==this._currentMousePointerIdDown||c||(this._currentMousePointerIdDown=l.pointerId),this.onButtonDown(l),t||(l.preventDefault(),r&&r.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,$e.kD.POINTERDOWN|$e.kD.POINTERUP|$e.kD.POINTERMOVE|$e.kD.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,a=0,o=null,this.onLostFocus()},this._contextMenuBind=t=>this.onContextMenu(t),r&&r.addEventListener("contextmenu",this._contextMenuBind,!1);const h=this.camera.getScene().getEngine().getHostWindow();h&&M.w1.RegisterTopRootEvents(h,[{"name":"blur","handler":this._onLostFocus}])}"detachControl"(){if(this._onLostFocus){const t=this.camera.getScene().getEngine().getHostWindow();t&&M.w1.UnregisterTopRootEvents(t,[{"name":"blur","handler":this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}"getClassName"(){return"BaseCameraPointersInput"}"getSimpleName"(){return"pointers"}"onDoubleTap"(t){}"onTouch"(t,i,r){}"onMultiTouch"(t,i,r,a,o,h){}"onContextMenu"(t){t.preventDefault()}"onButtonDown"(t){}"onButtonUp"(t){}"onLostFocus"(){}}(0,m.gn)([(0,T.qC)()],BaseCameraPointersInput.prototype,"buttons",void 0);class ArcRotateCameraPointersInput extends BaseCameraPointersInput{"constructor"(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}"getClassName"(){return"ArcRotateCameraPointersInput"}"_computeMultiTouchPanning"(t,i){if(0!==this.panningSensibility&&t&&i){const r=i.x-t.x,a=i.y-t.y;this.camera.inertialPanningX+=-r/this.panningSensibility,this.camera.inertialPanningY+=a/this.panningSensibility}}"_computePinchZoom"(t,i){const r=this.camera.radius||ArcRotateCameraPointersInput.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=r*Math.sqrt(t)/Math.sqrt(i):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(i-t)*r*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(i-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}"onTouch"(t,i,r){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=r/this.panningSensibility):(this.camera.inertialAlphaOffset-=i/this.angularSensibilityX,this.camera.inertialBetaOffset-=r/this.angularSensibilityY)}"onDoubleTap"(){this.camera.useInputToRestoreState&&this.camera.restoreState()}"onMultiTouch"(t,i,r,a,o,h){0===r&&null===o||0===a&&null===h||(this.multiTouchPanAndZoom?(this._computePinchZoom(r,a),this._computeMultiTouchPanning(o,h)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(a)-Math.sqrt(r))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(r,a),this._isPinching=!0):this._computeMultiTouchPanning(o,h)):this.multiTouchPanning?this._computeMultiTouchPanning(o,h):this.pinchZoom&&this._computePinchZoom(r,a))}"onButtonDown"(t){this._isPanClick=t.button===this.camera._panningMouseButton}"onButtonUp"(t){this._twoFingerActivityCount=0,this._isPinching=!1}"onLostFocus"(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}ArcRotateCameraPointersInput.MinimumRadiusForPinch=.001,(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"buttons",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"angularSensibilityX",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"angularSensibilityY",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"pinchPrecision",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"pinchDeltaPercentage",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"useNaturalPinchZoom",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"pinchZoom",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"panningSensibility",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"multiTouchPanning",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraPointersInput.prototype,"multiTouchPanAndZoom",void 0),lt.ArcRotateCameraPointersInput=ArcRotateCameraPointersInput;var ct=r(6081);class ArcRotateCameraKeyboardMoveInput{"constructor"(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}"attachControl"(t){t=M.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(()=>{this._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(i=>{const r=i.event;if(!r.metaKey)if(i.type===ct.OG.KEYDOWN){if(this._ctrlPressed=r.ctrlKey,this._altPressed=r.altKey,-1!==this.keysUp.indexOf(r.keyCode)||-1!==this.keysDown.indexOf(r.keyCode)||-1!==this.keysLeft.indexOf(r.keyCode)||-1!==this.keysRight.indexOf(r.keyCode)||-1!==this.keysReset.indexOf(r.keyCode)){-1===this._keys.indexOf(r.keyCode)&&this._keys.push(r.keyCode),r.preventDefault&&(t||r.preventDefault())}}else if(-1!==this.keysUp.indexOf(r.keyCode)||-1!==this.keysDown.indexOf(r.keyCode)||-1!==this.keysLeft.indexOf(r.keyCode)||-1!==this.keysRight.indexOf(r.keyCode)||-1!==this.keysReset.indexOf(r.keyCode)){const i=this._keys.indexOf(r.keyCode);i>=0&&this._keys.splice(i,1),r.preventDefault&&(t||r.preventDefault())}}))}"detachControl"(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}"checkInputs"(){if(this._onKeyboardObserver){const t=this.camera;for(let i=0;i<this._keys.length;i++){const r=this._keys[i];-1!==this.keysLeft.indexOf(r)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(r)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(r)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(r)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(r)&&t.useInputToRestoreState&&t.restoreState()}}}"getClassName"(){return"ArcRotateCameraKeyboardMoveInput"}"getSimpleName"(){return"keyboard"}}(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"keysUp",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"keysDown",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"keysLeft",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"keysRight",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"keysReset",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"panningSensibility",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"zoomingSensibility",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"useAltToZoom",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraKeyboardMoveInput.prototype,"angularSpeed",void 0),lt.ArcRotateCameraKeyboardMoveInput=ArcRotateCameraKeyboardMoveInput;var ut=r(1318);class ArcRotateCameraMouseWheelInput{"constructor"(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new x.P(0,0,0),this._globalOffset=new x.P(0,0,0),this._inertialPanning=x.P.Zero()}"_computeDeltaFromMouseWheelLegacyEvent"(t,i){let r=0;const a=.01*t*this.wheelDeltaPercentage*i;return r=t>0?a/(1+this.wheelDeltaPercentage):a*(1+this.wheelDeltaPercentage),r}"attachControl"(t){t=M.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=i=>{if(i.type!==$e.kD.POINTERWHEEL)return;const r=i.event;let a=0;const o=r.deltaMode===ut.G.DOM_DELTA_LINE?40:1,h=-r.deltaY*o;if(this.customComputeDeltaFromMouseWheel)a=this.customComputeDeltaFromMouseWheel(h,this,r);else if(this.wheelDeltaPercentage){if(a=this._computeDeltaFromMouseWheelLegacyEvent(h,this.camera.radius),a>0){let t=this.camera.radius,i=this.camera.inertialRadiusOffset+a;for(let r=0;r<20&&Math.abs(i)>.001;r++)t-=i,i*=this.camera.inertia;t=(0,Qe.Lh)(t,0,Number.MAX_VALUE),a=this._computeDeltaFromMouseWheelLegacyEvent(h,t)}}else a=h/(40*this.wheelPrecision);a&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(a)):this.camera.inertialRadiusOffset+=a),r.preventDefault&&(t||r.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,$e.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}"detachControl"(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}"checkInputs"(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}"getClassName"(){return"ArcRotateCameraMouseWheelInput"}"getSimpleName"(){return"mousewheel"}"_updateHitPlane"(){const t=this.camera,i=t.target.subtract(t.position);this._hitPlane=L.J.FromPositionAndNormal(t.target,i)}"_getPosition"(){const t=this.camera,i=t.getScene(),r=i.createPickingRay(i.pointerX,i.pointerY,x.y3.Identity(),t,!1);0===t.targetScreenOffset.x&&0===t.targetScreenOffset.y||(this._viewOffset.set(t.targetScreenOffset.x,t.targetScreenOffset.y,0),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),this._globalOffset=x.P.TransformNormal(this._viewOffset,t._cameraTransformMatrix),r.origin.addInPlace(this._globalOffset));let a=0;return this._hitPlane&&(a=r.intersectsPlane(this._hitPlane)??0),r.origin.addInPlace(r.direction.scaleInPlace(a))}"_zoomToMouse"(t){const i=this.camera,r=1-i.inertia;if(i.lowerRadiusLimit){const a=i.lowerRadiusLimit??0;i.radius-(i.inertialRadiusOffset+t)/r<a&&(t=(i.radius-a)*r-i.inertialRadiusOffset)}if(i.upperRadiusLimit){const a=i.upperRadiusLimit??0;i.radius-(i.inertialRadiusOffset+t)/r>a&&(t=(i.radius-a)*r-i.inertialRadiusOffset)}const a=t/r/i.radius,o=this._getPosition(),h=x.jp.Vector3[6];o.subtractToRef(i.target,h),h.scaleInPlace(a),h.scaleInPlace(r),this._inertialPanning.addInPlace(h),i.inertialRadiusOffset+=t}"_zeroIfClose"(t){Math.abs(t.x)<I.kn&&(t.x=0),Math.abs(t.y)<I.kn&&(t.y=0),Math.abs(t.z)<I.kn&&(t.z=0)}}(0,m.gn)([(0,T.qC)()],ArcRotateCameraMouseWheelInput.prototype,"wheelPrecision",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraMouseWheelInput.prototype,"zoomToMouseLocation",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCameraMouseWheelInput.prototype,"wheelDeltaPercentage",void 0),lt.ArcRotateCameraMouseWheelInput=ArcRotateCameraMouseWheelInput;class ArcRotateCameraInputsManager extends CameraInputsManager{"constructor"(t){super(t)}"addMouseWheel"(){return this.add(new ArcRotateCameraMouseWheelInput),this}"addPointers"(){return this.add(new ArcRotateCameraPointersInput),this}"addKeyboard"(){return this.add(new ArcRotateCameraKeyboardMoveInput),this}}Node.AddNodeConstructor("ArcRotateCamera",(t,i)=>()=>new ArcRotateCamera(t,0,0,1,x.P.Zero(),i));class ArcRotateCamera extends TargetCamera{get"target"(){return this._target}set"target"(t){this.setTarget(t)}get"targetHost"(){return this._targetHost}set"targetHost"(t){t&&this.setTarget(t)}"getTarget"(){return this.target}get"position"(){return this._position}set"position"(t){this.setPosition(t)}set"upVector"(t){this._upToYMatrix||(this._yToUpMatrix=new x.y3,this._upToYMatrix=new x.y3,this._upVector=x.P.Zero()),t.normalize(),this._upVector.copyFrom(t),this.setMatUp()}get"upVector"(){return this._upVector}"setMatUp"(){x.y3.RotationAlignToRef(x.P.UpReadOnly,this._upVector,this._yToUpMatrix),x.y3.RotationAlignToRef(this._upVector,x.P.UpReadOnly,this._upToYMatrix)}get"angularSensibilityX"(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set"angularSensibilityX"(t){const i=this.inputs.attached.pointers;i&&(i.angularSensibilityX=t)}get"angularSensibilityY"(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set"angularSensibilityY"(t){const i=this.inputs.attached.pointers;i&&(i.angularSensibilityY=t)}get"pinchPrecision"(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set"pinchPrecision"(t){const i=this.inputs.attached.pointers;i&&(i.pinchPrecision=t)}get"pinchDeltaPercentage"(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set"pinchDeltaPercentage"(t){const i=this.inputs.attached.pointers;i&&(i.pinchDeltaPercentage=t)}get"useNaturalPinchZoom"(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set"useNaturalPinchZoom"(t){const i=this.inputs.attached.pointers;i&&(i.useNaturalPinchZoom=t)}get"panningSensibility"(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set"panningSensibility"(t){const i=this.inputs.attached.pointers;i&&(i.panningSensibility=t)}get"keysUp"(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set"keysUp"(t){const i=this.inputs.attached.keyboard;i&&(i.keysUp=t)}get"keysDown"(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set"keysDown"(t){const i=this.inputs.attached.keyboard;i&&(i.keysDown=t)}get"keysLeft"(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set"keysLeft"(t){const i=this.inputs.attached.keyboard;i&&(i.keysLeft=t)}get"keysRight"(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set"keysRight"(t){const i=this.inputs.attached.keyboard;i&&(i.keysRight=t)}get"wheelPrecision"(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set"wheelPrecision"(t){const i=this.inputs.attached.mousewheel;i&&(i.wheelPrecision=t)}get"zoomToMouseLocation"(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set"zoomToMouseLocation"(t){const i=this.inputs.attached.mousewheel;i&&(i.zoomToMouseLocation=t)}get"wheelDeltaPercentage"(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set"wheelDeltaPercentage"(t){const i=this.inputs.attached.mousewheel;i&&(i.wheelDeltaPercentage=t)}get"bouncingBehavior"(){return this._bouncingBehavior}get"useBouncingBehavior"(){return null!=this._bouncingBehavior}set"useBouncingBehavior"(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get"framingBehavior"(){return this._framingBehavior}get"useFramingBehavior"(){return null!=this._framingBehavior}set"useFramingBehavior"(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get"autoRotationBehavior"(){return this._autoRotationBehavior}get"useAutoRotationBehavior"(){return null!=this._autoRotationBehavior}set"useAutoRotationBehavior"(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}"constructor"(t,i,r,a,o,h,l=!0){super(t,x.P.Zero(),h,l),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=x.P.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=x.FM.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new x.y3,this.panningAxis=new x.P(1,1,0),this._transformedDirection=new x.P,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new b.y$,this.checkCollisions=!1,this.collisionRadius=new x.P(.5,.5,.5),this._previousPosition=x.P.Zero(),this._collisionVelocity=x.P.Zero(),this._newPosition=x.P.Zero(),this._computationVector=x.P.Zero(),this._onCollisionPositionChange=(t,i,r=null)=>{r?(this.setPosition(i),this.onCollide&&this.onCollide(r)):this._previousPosition.copyFrom(this._position);const a=Math.cos(this.alpha),o=Math.sin(this.alpha),h=Math.cos(this.beta);let l=Math.sin(this.beta);0===l&&(l=1e-4);const c=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*a*l,this.radius*h,this.radius*o*l),c.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let u=this.upVector;this.allowUpsideDown&&this.beta<0&&(u=u.clone(),u=u.negate()),this._computeViewMatrix(this._position,c,u),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=x.P.Zero(),o&&this.setTarget(o),this.alpha=i,this.beta=r,this.radius=a,this.getViewMatrix(),this.inputs=new ArcRotateCameraInputsManager(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}"_initCache"(){super._initCache(),this._cache._target=new x.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=x.FM.Zero()}"_updateCache"(t){t||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}"_getTargetPosition"(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}const t=this._getLockedTargetPosition();return t||this._target}"storeState"(){return this._storedAlpha=this._goalAlpha=this.alpha,this._storedBeta=this._goalBeta=this.beta,this._storedRadius=this._goalRadius=this.radius,this._storedTarget=this._goalTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this._goalTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}"_restoreStateValues"(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>I.kn&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}"interpolateTo"(t=this.alpha,i=this.beta,r=this.radius,a=this.target,o=this.targetScreenOffset,h){this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=h?this._currentInterpolationFactor=h:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,t=(0,Qe.Lh)(t,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),i=(0,Qe.Lh)(i,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),r=(0,Qe.Lh)(r,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),a.y=(0,Qe.Lh)(a.y,this.lowerTargetYLimit??-1/0,1/0),this._goalAlpha=t,this._goalBeta=i,this._goalRadius=r,this._goalTarget=a,this._goalTargetScreenOffset=o}"_isSynchronizedViewMatrix"(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}"attachControl"(t,i,r=!0,a=2){const o=arguments;i=M.w1.BackCompatCameraNoPreventDefault(o),this._useCtrlForPanning=r,this._panningMouseButton=a,"boolean"==typeof o[0]&&(o.length>1&&(this._useCtrlForPanning=o[1]),o.length>2&&(this._panningMouseButton=o[2])),this.inputs.attachElement(i),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}"detachControl"(){this.inputs.detachElement(),this._reset&&this._reset()}"_checkInputs"(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const t=this._scene.getEngine().getDeltaTime()/1e3,i=1-Math.pow(2,-t/this._currentInterpolationFactor);this.setTarget(x.P.Lerp(this.getTarget(),this._goalTarget,i)),x._f.RotationAlphaBetaGammaToRef(this._goalAlpha,this._goalBeta,0,x.jp.Quaternion[0]),x._f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,x.jp.Quaternion[1]),x._f.SlerpToRef(x.jp.Quaternion[1],x.jp.Quaternion[0],i,x.jp.Quaternion[2]),x.jp.Quaternion[2].normalize(),x.jp.Quaternion[2].toAlphaBetaGammaToRef(x.jp.Vector3[0]),this.alpha=x.jp.Vector3[0].x,this.beta=x.jp.Vector3[0].y,this.radius+=(this._goalRadius-this.radius)*i,x.FM.LerpToRef(this.targetScreenOffset,this._goalTargetScreenOffset,i,this.targetScreenOffset),(x.P.DistanceSquared(this.getTarget(),this._goalTarget)<I.kn&&x.jp.Quaternion[2].isApprox(x.jp.Quaternion[0])&&Math.pow(this._goalRadius-this.radius,2)<I.kn&&x.FM.Distance(this.targetScreenOffset,this._goalTargetScreenOffset)<I.kn||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const t=this.invertRotation?-1:1,i=this._calculateHandednessMultiplier();let r=this.inertialAlphaOffset*i;this.beta<0&&(r*=-1),this.alpha+=r*t,this.beta+=this.inertialBetaOffset*t,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<I.kn&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<I.kn&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*I.kn&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const t=new x.P(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),t.multiplyInPlace(this.panningAxis),x.P.TransformNormalToRef(t,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const t=this.upVector,i=x.P.CrossToRef(this._transformedDirection,t,this._transformedDirection);x.P.CrossToRef(t,i,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);x.P.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else{if(this.parent){const t=x.jp.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.transposeToRef(t),x.P.TransformCoordinatesToRef(this._transformedDirection,t,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*I.kn&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*I.kn&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}"_checkLimits"(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}"rebuildAnglesAndRadius"(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||x.P.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const t=this.alpha;this.alpha=function ComputeAlpha(t){let i=Math.PI/2;return 0===t.x&&0===t.z||(i=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2)))),t.z<0&&(i=2*Math.PI-i),i}(this._computationVector),this.beta=function ComputeBeta(t,i){return Math.acos(t/i)}(this._computationVector.y,this.radius);const i=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*i*Math.PI,this._checkLimits()}"setPosition"(t){this._position.equals(t)||(this._position.copyFrom(t),this.rebuildAnglesAndRadius())}"setTarget"(t,i=!1,r=!1,a=!1){if(a=this.overrideCloneAlphaBetaRadius??a,t.computeWorldMatrix)i&&t.getBoundingInfo?this._targetBoundingCenter=t.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,t.computeWorldMatrix(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const i=t,a=this._getTargetPosition();if(a&&!r&&a.equals(i))return;this._targetHost=null,this._target=i,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}a||this.rebuildAnglesAndRadius()}"_getViewMatrix"(){const t=Math.cos(this.alpha),i=Math.sin(this.alpha),r=Math.cos(this.beta);let a=Math.sin(this.beta);0===a&&(a=1e-4),0===this.radius&&(this.radius=1e-4);const o=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*a,this.radius*r,this.radius*i*a),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||x.P.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),o.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let t=this.upVector;this.allowUpsideDown&&a<0&&(t=t.negate()),this._computeViewMatrix(this._position,o,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=o,this._viewMatrix}"zoomOn"(t,i=!1){t=t||this.getScene().meshes;const r=Mesh.MinMax(t);let a=this._calculateLowerRadiusFromModelBoundingSphere(r.min,r.max);a=Math.max(Math.min(a,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=a*this.zoomOnFactor,this.focusOn({"min":r.min,"max":r.max,"distance":a},i)}"focusOn"(t,i=!1){let r,a;if(void 0===t.min){const i=t||this.getScene().meshes;r=Mesh.MinMax(i),a=x.P.Distance(r.min,r.max)}else{r=t,a=t.distance}this._target=Mesh.Center(r),i||(this.maxZ=2*a)}"createRigCamera"(t,i){let r=0;switch(this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:case Camera.RIG_MODE_VR:r=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);break;case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:r=this._cameraRigParams.stereoHalfAngle*(0===i?-1:1)}const a=new ArcRotateCamera(t,this.alpha+r,this.beta,this.radius,this._target,this.getScene());return a._cameraRigParams={},a.isRigCamera=!0,a.rigParent=this,a.upVector=this.upVector,a.mode=this.mode,a.orthoLeft=this.orthoLeft,a.orthoRight=this.orthoRight,a.orthoBottom=this.orthoBottom,a.orthoTop=this.orthoTop,a}"_updateRigCameras"(){const t=this._rigCameras[0],i=this._rigCameras[1];switch(t.beta=i.beta=this.beta,this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:case Camera.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}"_calculateLowerRadiusFromModelBoundingSphere"(t,i,r=1){const a=x.P.Distance(t,i),o=this.getScene().getEngine().getAspectRatio(this),h=Math.tan(this.fov/2),l=h*o,c=.5*a*r,u=c*Math.sqrt(1+1/(l*l)),d=c*Math.sqrt(1+1/(h*h));return Math.max(u,d)}"dispose"(){this.inputs.clear(),super.dispose()}"getClassName"(){return"ArcRotateCamera"}}(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"alpha",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"beta",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"radius",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,m.gn)([(0,T.hd)("target")],ArcRotateCamera.prototype,"_target",void 0),(0,m.gn)([(0,T.RR)("targetHost")],ArcRotateCamera.prototype,"_targetHost",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"inertialAlphaOffset",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"inertialBetaOffset",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"inertialRadiusOffset",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"lowerAlphaLimit",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"upperAlphaLimit",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"lowerBetaLimit",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"upperBetaLimit",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"lowerRadiusLimit",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"upperRadiusLimit",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"lowerTargetYLimit",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"inertialPanningX",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"inertialPanningY",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"pinchToPanMaxDistance",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"panningDistanceLimit",void 0),(0,m.gn)([(0,T.hd)()],ArcRotateCamera.prototype,"panningOriginTarget",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"panningInertia",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"zoomToMouseLocation",null),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"zoomOnFactor",void 0),(0,m.gn)([(0,T.QC)()],ArcRotateCamera.prototype,"targetScreenOffset",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"allowUpsideDown",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"useInputToRestoreState",void 0),(0,m.gn)([(0,T.qC)()],ArcRotateCamera.prototype,"restoreStateInterpolationFactor",void 0),(0,v.H7)("BABYLON.ArcRotateCamera",ArcRotateCamera);class Light extends Node{get"range"(){return this._range}set"range"(t){this._range=t,this._inverseSquaredRange=1/(this.range*this.range)}get"intensityMode"(){return this._intensityMode}set"intensityMode"(t){this._intensityMode=t,this._computePhotometricScale()}get"radius"(){return this._radius}set"radius"(t){this._radius=t,this._computePhotometricScale()}get"shadowEnabled"(){return this._shadowEnabled}set"shadowEnabled"(t){this._shadowEnabled!==t&&(this._shadowEnabled=t,this._markMeshesAsLightDirty())}get"includedOnlyMeshes"(){return this._includedOnlyMeshes}set"includedOnlyMeshes"(t){this._includedOnlyMeshes=t,this._hookArrayForIncludedOnly(t)}get"excludedMeshes"(){return this._excludedMeshes}set"excludedMeshes"(t){this._excludedMeshes=t,this._hookArrayForExcluded(t)}get"excludeWithLayerMask"(){return this._excludeWithLayerMask}set"excludeWithLayerMask"(t){this._excludeWithLayerMask=t,this._resyncMeshes()}get"includeOnlyWithLayerMask"(){return this._includeOnlyWithLayerMask}set"includeOnlyWithLayerMask"(t){this._includeOnlyWithLayerMask=t,this._resyncMeshes()}get"lightmapMode"(){return this._lightmapMode}set"lightmapMode"(t){this._lightmapMode!==t&&(this._lightmapMode=t,this._markMeshesAsLightDirty())}"getViewMatrix"(t){return null}"getProjectionMatrix"(t,i){return null}"constructor"(t,i){super(t,i,!1),this.diffuse=new V.Wo(1,1,1),this.specular=new V.Wo(1,1,1),this.falloffType=Light.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=Light.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new K.M(this.getScene().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}"transferTexturesToEffect"(t,i){return this}"_bindLight"(t,i,r,a,o=!0){const h=t.toString();let l=!1;if(this._uniformBuffer.bindToEffect(r,"Light"+h),this._renderId!==i.getRenderId()||this._lastUseSpecular!==a||!this._uniformBuffer.useUbo){this._renderId=i.getRenderId(),this._lastUseSpecular=a;const t=this.getScaledIntensity();this.transferToEffect(r,h),this.diffuse.scaleToRef(t,V.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",V.zZ.Color3[0],this.range,h),a&&(this.specular.scaleToRef(t,V.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",V.zZ.Color3[1],this.radius,h)),l=!0}if(this.transferTexturesToEffect(r,h),i.shadowsEnabled&&this.shadowEnabled&&o){const t=this.getShadowGenerator(i.activeCamera)??this.getShadowGenerator();t&&(t.bindShadowLight(h,r),l=!0)}l?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}"getClassName"(){return"Light"}"toString"(t){let i="Name: "+this.name;if(i+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let r=0;r<this.animations.length;r++)i+=", animation[0]: "+this.animations[r].toString(t);return i}"_syncParentEnabledState"(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}"setEnabled"(t){super.setEnabled(t),this._resyncMeshes()}"getShadowGenerator"(t=null){return null===this._shadowGenerators?null:this._shadowGenerators.get(t)??null}"getShadowGenerators"(){return this._shadowGenerators}"getAbsolutePosition"(){return x.P.Zero()}"canAffectMesh"(t){return!t||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(t))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(t))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&t.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&t.layerMask)))}"dispose"(t,i=!1){if(this._shadowGenerators){const t=this._shadowGenerators.values();for(let i=t.next();!0!==i.done;i=t.next()){i.value.dispose()}this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const t=this._parentContainer.lights.indexOf(this);t>-1&&this._parentContainer.lights.splice(t,1),this._parentContainer=null}for(const t of this.getScene().meshes)t._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(t,i)}"getTypeID"(){return 0}"getScaledIntensity"(){return this._photometricScale*this.intensity}"clone"(t,i=null){const r=Light.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!r)return null;const a=A.p.Clone(r,this);return t&&(a.name=t),i&&(a.parent=i),a.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(a),a}"serialize"(){const t=A.p.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(t),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach(i=>{t.excludedMeshesIds.push(i.id)})),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(i=>{t.includedOnlyMeshesIds.push(i.id)})),A.p.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}static"GetConstructorFromName"(t,i,r){const a=Node.Construct("Light_Type_"+t,i,r);return a||null}static"Parse"(t,i){const r=Light.GetConstructorFromName(t.type,t.name,i);if(!r)return null;const a=A.p.Parse(r,t,i);if(t.excludedMeshesIds&&(a._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(a._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(a._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(a._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(a.falloffType=t.falloffType),void 0!==t.lightmapMode&&(a.lightmapMode=t.lightmapMode),t.animations){for(let i=0;i<t.animations.length;i++){const r=t.animations[i],o=(0,v.qw)("BABYLON.Animation");o&&a.animations.push(o.Parse(r))}Node.ParseAnimationRanges(a,t,i)}return t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&a.setEnabled(t.isEnabled),a}"_hookArrayForExcluded"(t){const i=t.push;t.push=(...r)=>{const a=i.apply(t,r);for(const t of r)t._resyncLightSource(this);return a};const r=t.splice;t.splice=(i,a)=>{const o=r.apply(t,[i,a]);for(const t of o)t._resyncLightSource(this);return o};for(const i of t)i._resyncLightSource(this)}"_hookArrayForIncludedOnly"(t){const i=t.push;t.push=(...r)=>{const a=i.apply(t,r);return this._resyncMeshes(),a};const r=t.splice;t.splice=(i,a)=>{const o=r.apply(t,[i,a]);return this._resyncMeshes(),o},this._resyncMeshes()}"_resyncMeshes"(){for(const t of this.getScene().meshes)t._resyncLightSource(this)}"_markMeshesAsLightDirty"(){for(const t of this.getScene().meshes)-1!==t.lightSources.indexOf(this)&&t._markSubMeshesAsLightDirty()}"_computePhotometricScale"(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}"_getPhotometricScale"(){let t=0;const i=this.getTypeID();let r=this.intensityMode;switch(r===Light.INTENSITYMODE_AUTOMATIC&&(r=i===Light.LIGHTTYPEID_DIRECTIONALLIGHT?Light.INTENSITYMODE_ILLUMINANCE:Light.INTENSITYMODE_LUMINOUSINTENSITY),i){case Light.LIGHTTYPEID_POINTLIGHT:case Light.LIGHTTYPEID_SPOTLIGHT:switch(r){case Light.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case Light.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case Light.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case Light.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case Light.INTENSITYMODE_ILLUMINANCE:t=1;break;case Light.INTENSITYMODE_LUMINANCE:{let i=this.radius;i=Math.max(i,.001);t=2*Math.PI*(1-Math.cos(i));break}}break;case Light.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}"_reorderLightsInScene"(){const t=this.getScene();0!=this._renderPriority&&(t.requireLightSorting=!0),this.getScene().sortLightsByPriority()}"_isReady"(){return!0}}Light.FALLOFF_DEFAULT=q.m.FALLOFF_DEFAULT,Light.FALLOFF_PHYSICAL=q.m.FALLOFF_PHYSICAL,Light.FALLOFF_GLTF=q.m.FALLOFF_GLTF,Light.FALLOFF_STANDARD=q.m.FALLOFF_STANDARD,Light.LIGHTMAP_DEFAULT=q.m.LIGHTMAP_DEFAULT,Light.LIGHTMAP_SPECULAR=q.m.LIGHTMAP_SPECULAR,Light.LIGHTMAP_SHADOWSONLY=q.m.LIGHTMAP_SHADOWSONLY,Light.INTENSITYMODE_AUTOMATIC=q.m.INTENSITYMODE_AUTOMATIC,Light.INTENSITYMODE_LUMINOUSPOWER=q.m.INTENSITYMODE_LUMINOUSPOWER,Light.INTENSITYMODE_LUMINOUSINTENSITY=q.m.INTENSITYMODE_LUMINOUSINTENSITY,Light.INTENSITYMODE_ILLUMINANCE=q.m.INTENSITYMODE_ILLUMINANCE,Light.INTENSITYMODE_LUMINANCE=q.m.INTENSITYMODE_LUMINANCE,Light.LIGHTTYPEID_POINTLIGHT=q.m.LIGHTTYPEID_POINTLIGHT,Light.LIGHTTYPEID_DIRECTIONALLIGHT=q.m.LIGHTTYPEID_DIRECTIONALLIGHT,Light.LIGHTTYPEID_SPOTLIGHT=q.m.LIGHTTYPEID_SPOTLIGHT,Light.LIGHTTYPEID_HEMISPHERICLIGHT=q.m.LIGHTTYPEID_HEMISPHERICLIGHT,Light.LIGHTTYPEID_RECT_AREALIGHT=q.m.LIGHTTYPEID_RECT_AREALIGHT,(0,m.gn)([(0,T.n9)()],Light.prototype,"diffuse",void 0),(0,m.gn)([(0,T.n9)()],Light.prototype,"specular",void 0),(0,m.gn)([(0,T.qC)()],Light.prototype,"falloffType",void 0),(0,m.gn)([(0,T.qC)()],Light.prototype,"intensity",void 0),(0,m.gn)([(0,T.qC)()],Light.prototype,"range",null),(0,m.gn)([(0,T.qC)()],Light.prototype,"intensityMode",null),(0,m.gn)([(0,T.qC)()],Light.prototype,"radius",null),(0,m.gn)([(0,T.qC)()],Light.prototype,"_renderPriority",void 0),(0,m.gn)([(0,T.wz)("_reorderLightsInScene")],Light.prototype,"renderPriority",void 0),(0,m.gn)([(0,T.qC)("shadowEnabled")],Light.prototype,"_shadowEnabled",void 0),(0,m.gn)([(0,T.qC)("excludeWithLayerMask")],Light.prototype,"_excludeWithLayerMask",void 0),(0,m.gn)([(0,T.qC)("includeOnlyWithLayerMask")],Light.prototype,"_includeOnlyWithLayerMask",void 0),(0,m.gn)([(0,T.qC)("lightmapMode")],Light.prototype,"_lightmapMode",void 0);class ShadowLight extends Light{"constructor"(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=x.y3.Identity(),this._projectionMatrix=x.y3.Identity()}"_setPosition"(t){this._position=t}get"position"(){return this._position}set"position"(t){this._setPosition(t)}"_setDirection"(t){this._direction=t}get"direction"(){return this._direction}set"direction"(t){this._setDirection(t)}get"shadowMinZ"(){return this._shadowMinZ}set"shadowMinZ"(t){this._shadowMinZ=t,this.forceProjectionMatrixCompute()}get"shadowMaxZ"(){return this._shadowMaxZ}set"shadowMaxZ"(t){this._shadowMaxZ=t,this.forceProjectionMatrixCompute()}"computeTransformedInformation"(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=x.P.Zero()),x.P.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=x.P.Zero()),x.P.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}"getDepthScale"(){return 50}"getShadowDirection"(t){return this.transformedDirection?this.transformedDirection:this.direction}"getAbsolutePosition"(){return this.transformedPosition?this.transformedPosition:this.position}"setDirectionToTarget"(t){return this.direction=x.P.Normalize(t.subtract(this.position)),this.direction}"getRotation"(){this.direction.normalize();const t=x.P.Cross(this.direction,ce.RD.Y),i=x.P.Cross(t,this.direction);return x.P.RotationFromAxis(t,i,this.direction)}"needCube"(){return!1}"needProjectionMatrixCompute"(){return this._needProjectionMatrixCompute}"forceProjectionMatrixCompute"(){this._needProjectionMatrixCompute=!0}"_initCache"(){super._initCache(),this._cache.position=x.P.Zero()}"_isSynchronized"(){return!!this._cache.position.equals(this.position)}"computeWorldMatrix"(t){return!t&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=x.y3.Identity()),x.y3.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}"getDepthMinZ"(t){return void 0!==this.shadowMinZ?this.shadowMinZ:t?.minZ||0}"getDepthMaxZ"(t){return void 0!==this.shadowMaxZ?this.shadowMaxZ:t?.maxZ||1e4}"setShadowProjectionMatrix"(t,i,r){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(i,r,t):this._setDefaultShadowProjectionMatrix(t,i,r),this}"_syncParentEnabledState"(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}"getViewMatrix"(t){const i=x.jp.Vector3[0];let r=this.position;this.computeTransformedInformation()&&(r=this.transformedPosition),x.P.NormalizeToRef(this.getShadowDirection(t),i),1===Math.abs(x.P.Dot(i,x.P.Up()))&&(i.z=1e-13);const a=x.jp.Vector3[1];return r.addToRef(i,a),x.y3.LookAtLHToRef(r,a,x.P.Up(),this._viewMatrix),this._viewMatrix}"getProjectionMatrix"(t,i){return this.setShadowProjectionMatrix(this._projectionMatrix,t??this._viewMatrix,i??[]),this._projectionMatrix}}(0,m.gn)([(0,T.hd)()],ShadowLight.prototype,"position",null),(0,m.gn)([(0,T.hd)()],ShadowLight.prototype,"direction",null),(0,m.gn)([(0,T.qC)()],ShadowLight.prototype,"shadowMinZ",null),(0,m.gn)([(0,T.qC)()],ShadowLight.prototype,"shadowMaxZ",null),Node.AddNodeConstructor("Light_Type_1",(t,i)=>()=>new DirectionalLight(t,x.P.Zero(),i));class DirectionalLight extends ShadowLight{get"shadowFrustumSize"(){return this._shadowFrustumSize}set"shadowFrustumSize"(t){this._shadowFrustumSize=t,this.forceProjectionMatrixCompute()}get"shadowOrthoScale"(){return this._shadowOrthoScale}set"shadowOrthoScale"(t){this._shadowOrthoScale=t,this.forceProjectionMatrixCompute()}get"orthoLeft"(){return this._orthoLeft}set"orthoLeft"(t){this._orthoLeft=t}get"orthoRight"(){return this._orthoRight}set"orthoRight"(t){this._orthoRight=t}get"orthoTop"(){return this._orthoTop}set"orthoTop"(t){this._orthoTop=t}get"orthoBottom"(){return this._orthoBottom}set"orthoBottom"(t){this._orthoBottom=t}"constructor"(t,i,r){super(t,r),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=i.scale(-1),this.direction=i}"getClassName"(){return"DirectionalLight"}"getTypeID"(){return Light.LIGHTTYPEID_DIRECTIONALLIGHT}"_setDefaultShadowProjectionMatrix"(t,i,r){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(t):this._setDefaultAutoExtendShadowProjectionMatrix(t,i,r)}"_setDefaultFixedFrustumShadowProjectionMatrix"(t){const i=this.getScene().activeCamera;i&&x.y3.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:i.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,t,this.getScene().getEngine().isNDCHalfZRange)}"_setDefaultAutoExtendShadowProjectionMatrix"(t,i,r){const a=this.getScene().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const t=x.P.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let a=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let h=0;h<r.length;h++){const l=r[h];if(!l)continue;const c=l.getBoundingInfo().boundingBox;for(let r=0;r<c.vectorsWorld.length;r++)x.P.TransformCoordinatesToRef(c.vectorsWorld[r],i,t),t.x<this._orthoLeft&&(this._orthoLeft=t.x),t.y<this._orthoBottom&&(this._orthoBottom=t.y),t.x>this._orthoRight&&(this._orthoRight=t.x),t.y>this._orthoTop&&(this._orthoTop=t.y),this.autoCalcShadowZBounds&&(t.z<a&&(a=t.z),t.z>o&&(o=t.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=a,this._shadowMaxZ=o)}const o=this._orthoRight-this._orthoLeft,h=this._orthoTop-this._orthoBottom,l=void 0!==this.shadowMinZ?this.shadowMinZ:a?.minZ||0,c=void 0!==this.shadowMaxZ?this.shadowMaxZ:a?.maxZ||1e4,u=this.getScene().getEngine().useReverseDepthBuffer;x.y3.OrthoOffCenterLHToRef(this._orthoLeft-o*this.shadowOrthoScale,this._orthoRight+o*this.shadowOrthoScale,this._orthoBottom-h*this.shadowOrthoScale,this._orthoTop+h*this.shadowOrthoScale,u?c:l,u?l:c,t,this.getScene().getEngine().isNDCHalfZRange)}"_buildUniformLayout"(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}"transferToEffect"(t,i){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,i),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,i),this)}"transferToNodeMaterialEffect"(t,i){return this.computeTransformedInformation()?(t.setFloat3(i,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(t.setFloat3(i,this.direction.x,this.direction.y,this.direction.z),this)}"getDepthMinZ"(t){const i=this._scene.getEngine();return!i.useReverseDepthBuffer&&i.isNDCHalfZRange?0:1}"getDepthMaxZ"(t){const i=this._scene.getEngine();return i.useReverseDepthBuffer&&i.isNDCHalfZRange?0:1}"prepareLightSpecificDefines"(t,i){t["DIRLIGHT"+i]=!0}}(0,m.gn)([(0,T.qC)()],DirectionalLight.prototype,"shadowFrustumSize",null),(0,m.gn)([(0,T.qC)()],DirectionalLight.prototype,"shadowOrthoScale",null),(0,m.gn)([(0,T.qC)()],DirectionalLight.prototype,"autoUpdateExtends",void 0),(0,m.gn)([(0,T.qC)()],DirectionalLight.prototype,"autoCalcShadowZBounds",void 0),(0,m.gn)([(0,T.qC)("orthoLeft")],DirectionalLight.prototype,"_orthoLeft",void 0),(0,m.gn)([(0,T.qC)("orthoRight")],DirectionalLight.prototype,"_orthoRight",void 0),(0,m.gn)([(0,T.qC)("orthoTop")],DirectionalLight.prototype,"_orthoTop",void 0),(0,m.gn)([(0,T.qC)("orthoBottom")],DirectionalLight.prototype,"_orthoBottom",void 0),(0,v.H7)("BABYLON.DirectionalLight",DirectionalLight),Node.AddNodeConstructor("Light_Type_3",(t,i)=>()=>new HemisphericLight(t,x.P.Zero(),i));class HemisphericLight extends Light{"constructor"(t,i,r){super(t,r),this.groundColor=new V.Wo(0,0,0),this.direction=i||x.P.Up()}"_buildUniformLayout"(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}"getClassName"(){return"HemisphericLight"}"setDirectionToTarget"(t){return this.direction=x.P.Normalize(t.subtract(x.P.Zero())),this.direction}"getShadowGenerator"(){return null}"transferToEffect"(t,i){const r=x.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",r.x,r.y,r.z,0,i),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),i),this}"transferToNodeMaterialEffect"(t,i){const r=x.P.Normalize(this.direction);return t.setFloat3(i,r.x,r.y,r.z),this}"computeWorldMatrix"(){return this._worldMatrix||(this._worldMatrix=x.y3.Identity()),this._worldMatrix}"getTypeID"(){return Light.LIGHTTYPEID_HEMISPHERICLIGHT}"prepareLightSpecificDefines"(t,i){t["HEMILIGHT"+i]=!0}}(0,m.gn)([(0,T.n9)()],HemisphericLight.prototype,"groundColor",void 0),(0,m.gn)([(0,T.hd)()],HemisphericLight.prototype,"direction",void 0),(0,v.H7)("BABYLON.HemisphericLight",HemisphericLight);var dt=function createBaseScene(t,i){var r=new p.x(t);r.collisionsEnabled=!0,r.clearColor=new V.HE(.03,.05,.12,1),function createLighting(t){var i=new HemisphericLight("world-hemi-light",new x.P(0,1,0),t);i.intensity=.95,i.diffuse=new V.Wo(.62,.76,.96),i.groundColor=new V.Wo(.1,.16,.22);var r=new DirectionalLight("world-directional-light",new x.P(-.4,-1,-.35),t);r.position=new x.P(30,60,30),r.intensity=.8,r.diffuse=new V.Wo(.95,.98,1)}(r),function createSky(t){var i=CreateBox("world-skybox",{"size":650},t),r=new StandardMaterial("world-skybox-material",t);r.backFaceCulling=!1,r.disableLighting=!0,r.diffuseColor=new V.Wo(.03,.05,.13),r.emissiveColor=new V.Wo(.05,.08,.18),r.specularColor=V.Wo.Black(),i.material=r,i.isPickable=!1;var a=new StandardMaterial("world-star-material",t);a.disableLighting=!0,a.emissiveColor=new V.Wo(.95,.97,1),a.specularColor=V.Wo.Black();for(var o=0;o<120;o+=1){var h=CreateSphere("world-star-".concat(o),{"diameter":.4,"segments":4},t),l=180+140*Math.random(),c=Math.random()*Math.PI*2,u=Math.random()*Math.PI*.7;h.position=new x.P(Math.cos(c)*Math.cos(u)*l,35+Math.sin(u)*l*.4,Math.sin(c)*Math.cos(u)*l),h.material=a,h.isPickable=!1}}(r),function createGround(t){var i=CreateGround("world-ground",{"width":Me,"height":Me,"subdivisions":16},t),r=new StandardMaterial("world-ground-material",t);r.diffuseColor=new V.Wo(.15,.29,.44),r.specularColor=new V.Wo(.03,.05,.08),i.material=r,i.checkCollisions=!0}(r),function createBoundaryWalls(t){[{"width":202,"depth":2,"x":0,"z":be},{"width":202,"depth":2,"x":0,"z":-100},{"width":2,"depth":202,"x":be,"z":0},{"width":2,"depth":202,"x":-100,"z":0}].forEach(function(i,r){var a=CreateBox("world-boundary-wall-".concat(r),{"width":i.width,"height":8,"depth":i.depth},t);a.position=new x.P(i.x,4,i.z),a.checkCollisions=!0,a.isVisible=!1})}(r),function createWorldObstacles(t){var i=new StandardMaterial("world-obstacle-material",t);i.diffuseColor=new V.Wo(.2,.35,.55),i.specularColor=new V.Wo(.02,.04,.06),[{"width":6,"depth":6,"height":4,"x":20,"z":-12},{"width":8,"depth":5,"height":3,"x":-24,"z":15},{"width":5,"depth":7,"height":5,"x":6,"z":24},{"width":9,"depth":4,"height":3.5,"x":-8,"z":-20}].forEach(function(r,a){var o=CreateBox("world-obstacle-".concat(a),{"width":r.width,"depth":r.depth,"height":r.height},t);o.position=new x.P(r.x,r.height/2,r.z),o.material=i,o.checkCollisions=!0})}(r);var a=function createPlayer(t){var i=CreateCapsule("world-player",{"height":1.8,"radius":Ee,"tessellation":8},t),r=new StandardMaterial("world-player-material",t);return r.diffuseColor=new V.Wo(.25,.58,.9),r.emissiveColor=new V.Wo(.04,.1,.2),r.specularColor=new V.Wo(.1,.2,.3),i.material=r,i.position=new x.P(0,1,0),i.checkCollisions=!0,i.ellipsoid=new x.P(Ee,.9,Ee),i.ellipsoidOffset=new x.P(0,.9,0),i}(r),o=function createCamera(t,i,r){var a=new ArcRotateCamera("world-camera",-Math.PI/2,1.05,12,r,t);return a.lowerRadiusLimit=6,a.upperRadiusLimit=18,a.lowerBetaLimit=.6,a.upperBetaLimit=1.35,a.panningSensibility=0,a.wheelDeltaPercentage=.01,a.inertia=.65,a.attachControl(i,!0),a}(r,i,a.position.clone().add(new x.P(0,1.1,0)));return{"camera":o,"player":a,"scene":r}},_t=function toVector3JSON(t){return{"x":t.x,"y":t.y,"z":t.z}},ft=function cloneAgentState(t){return(0,ye.Z)((0,ye.Z)({},t),{},{"position":(0,ye.Z)({},t.position)})},gt=function cloneBuildingState(t){return(0,ye.Z)((0,ye.Z)({},t),{},{"position":(0,ye.Z)({},t.position)})},pt=function(){return(0,_.Z)(function WorldState(t){(0,d.Z)(this,WorldState),(0,g.Z)(this,"state",{"version":1,"agents":[],"buildings":[]}),t&&this.fromJSON(t)},[{"key":"sync","value":function sync(t,i){this.state={"version":1,"agents":t.map(function(t){var i={"id":t.id,"name":t.name,"position":_t(t.position),"rotationY":t.rotationY,"mode":t.mode,"statusText":t.statusText};return t.taskId&&(i.taskId=t.taskId),"number"==typeof t.buildProgress&&(i.buildProgress=t.buildProgress),i}),"buildings":i.map(function(t){return{"id":t.id,"type":t.type,"name":t.name,"position":_t(t.position),"rotationY":t.rotationY,"progress":t.progress,"status":t.status,"createdAtMs":t.createdAtMs,"requestedBy":t.requestedBy}})}}},{"key":"toJSON","value":function toJSON(){return{"version":1,"agents":this.state.agents.map(ft),"buildings":this.state.buildings.map(gt)}}},{"key":"fromJSON","value":function fromJSON(t){this.state={"version":1,"agents":t.agents.map(ft),"buildings":t.buildings.map(gt)}}}])}(),mt=new x.P(0,1.1,0),Tt=function(){return(0,_.Z)(function WorldRuntime(t){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,d.Z)(this,WorldRuntime),(0,g.Z)(this,"container",void 0),(0,g.Z)(this,"options",void 0),(0,g.Z)(this,"keyboardInput",new je),(0,g.Z)(this,"playerMotionState",{"verticalVelocity":0}),(0,g.Z)(this,"canvas",null),(0,g.Z)(this,"engine",null),(0,g.Z)(this,"scene",null),(0,g.Z)(this,"camera",null),(0,g.Z)(this,"player",null),(0,g.Z)(this,"buildingManager",null),(0,g.Z)(this,"agentManager",null),(0,g.Z)(this,"worldState",null),(0,g.Z)(this,"worldTickAccumulatorSeconds",0),(0,g.Z)(this,"joystickInput",{"x":0,"z":0}),(0,g.Z)(this,"joystickActive",!1),(0,g.Z)(this,"started",!1),(0,g.Z)(this,"resizeObserver",null),(0,g.Z)(this,"resizeEngineToContainer",function(){if(i.engine){var t=Math.max(1,i.container.clientWidth||window.innerWidth||1),r=Math.max(1,i.container.clientHeight||window.innerHeight||1);i.engine.setSize(t,r)}}),(0,g.Z)(this,"renderLoop",function(){if(i.engine&&i.scene&&i.camera&&i.player){var t=Math.min(i.engine.getDeltaTime()/1e3,.05),r=i.keyboardInput.getMoveVector(),a=He(r,i.joystickInput,i.joystickActive);Ze({"camera":i.camera,"deltaSeconds":t,"input":a,"player":i.player,"motionState":i.playerMotionState});var o=i.player.position.add(mt),h=i.camera.getTarget(),l=1-Math.exp(-7*t),c=x.P.Lerp(h,o,l);if(i.camera.setTarget(c),i.agentManager&&i.buildingManager&&i.worldState){i.worldTickAccumulatorSeconds+=t;for(var u=Date.now(),d=0;i.worldTickAccumulatorSeconds>=xe&&d<5;)i.agentManager.fixedTick(xe,u),i.buildingManager.fixedTick(xe,u),i.worldState.sync(i.agentManager.getSnapshots(),i.buildingManager.getSnapshots()),i.worldTickAccumulatorSeconds-=xe,d+=1;d>=5&&i.worldTickAccumulatorSeconds>=xe&&(i.worldTickAccumulatorSeconds=0),i.agentManager.frameUpdate(t)}i.scene.render()}}),this.container=t,this.options=r},[{"key":"start","value":function start(){var t,i,r=this;if(!this.started&&"undefined"!=typeof document&&"undefined"!=typeof window){this.canvas=document.createElement("canvas"),this.canvas.className="world-runtime-canvas",this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.touchAction="none",this.container.appendChild(this.canvas);var a=window.innerWidth>768;this.engine=new k.D(this.canvas,a,{"preserveDrawingBuffer":!1,"stencil":!0},!0);var o=dt(this.engine,this.canvas);this.scene=o.scene,this.camera=o.camera,this.player=o.player,this.buildingManager=new We(this.scene),this.agentManager=new Le(this.scene,this.buildingManager),this.worldState=new pt,this.worldState.sync(this.agentManager.getSnapshots(),this.buildingManager.getSnapshots()),this.worldTickAccumulatorSeconds=0,this.keyboardInput.start(),this.resizeEngineToContainer(),"undefined"!=typeof ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.resizeEngineToContainer),this.resizeObserver.observe(this.container)),window.addEventListener("resize",this.resizeEngineToContainer),this.engine.runRenderLoop(this.renderLoop),window.requestAnimationFrame(function(){r.resizeEngineToContainer()}),this.started=!0,null===(t=(i=this.options).onLoaded)||void 0===t||t.call(i)}}},{"key":"stop","value":function stop(){this.started&&"undefined"!=typeof window&&(this.keyboardInput.stop(),window.removeEventListener("resize",this.resizeEngineToContainer),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.engine&&this.engine.stopRenderLoop(this.renderLoop),this.agentManager&&(this.agentManager.dispose(),this.agentManager=null),this.buildingManager&&(this.buildingManager.dispose(),this.buildingManager=null),this.scene&&this.scene.dispose(),this.engine&&this.engine.dispose(),this.canvas&&this.container.contains(this.canvas)&&this.container.removeChild(this.canvas),this.scene=null,this.camera=null,this.player=null,this.worldState=null,this.worldTickAccumulatorSeconds=0,this.engine=null,this.canvas=null,this.started=!1)}},{"key":"dispose","value":function dispose(){this.stop()}},{"key":"setJoystickInput","value":function setJoystickInput(t,i){this.joystickInput=t,this.joystickActive=i}}])}(),yt=function WorldViewport(t){var i=t.onLoaded,r=(0,o.useRef)(null),l=(0,o.useRef)(null),d=(0,o.useState)(!1),_=(0,a.Z)(d,2),g=_[0],p=_[1],m=(0,o.useCallback)(function(t){r.current=t instanceof HTMLElement?t:null},[]);(0,o.useEffect)(function(){if("undefined"!=typeof window&&"function"==typeof window.matchMedia){var t=window.matchMedia("(pointer: coarse)"),i=function syncJoystickVisibility(){p(t.matches)};return i(),"function"==typeof t.addEventListener?(t.addEventListener("change",i),function(){t.removeEventListener("change",i)}):(t.addListener(i),function(){t.removeListener(i)})}},[]),(0,o.useEffect)(function(){var t=r.current;if(t){var a=new Tt(t,{"onLoaded":i});return a.start(),l.current=a,function(){a.dispose(),l.current=null}}},[i]);var T=(0,o.useCallback)(function(t){var i;null===(i=l.current)||void 0===i||i.setJoystickInput(t,!0)},[]),y=(0,o.useCallback)(function(){var t;null===(t=l.current)||void 0===t||t.setJoystickInput({"x":0,"z":0},!1)},[]);return(0,c.jsxs)(h.G7,{"className":"world-viewport","children":[(0,c.jsx)(h.G7,{"className":"world-viewport__canvas","ref":m}),g&&(0,c.jsx)(u,{"onChange":T,"onEnd":y})]})},Mt=function World(){var t=(0,o.useState)(!0),i=(0,a.Z)(t,2),r=i[0],u=i[1];return(0,c.jsxs)(h.G7,{"className":"world-page","children":[(0,c.jsx)(h.G7,{"className":"world-page__header","children":(0,c.jsx)(h.G7,{"className":"back-btn","onClick":function handleBack(){l.ZP.switchTab({"url":"/pages/starlight/index","fail":function fail(t){console.error("Navigation back to starlight failed:",t),l.ZP.navigateTo({"url":"/pages/starlight/index","fail":function fail(t){console.error("Fallback navigateTo starlight failed:",t),l.ZP.reLaunch({"url":"/pages/starlight/index"})}})}})},"children":(0,c.jsx)(h.xv,{"className":"back-btn__text","children":"< Back to Starlight"})})}),(0,c.jsx)(yt,{"onLoaded":function handleLoaded(){u(!1)}}),r&&(0,c.jsxs)(h.G7,{"className":"world-page__loading","children":[(0,c.jsx)(h.xv,{"className":"loading-text","children":"Loading SharkStar..."}),(0,c.jsx)(h.G7,{"className":"loading-spinner"})]})]})}},"7762":function(t,i,r){r.d(i,{"Z":function(){return _createForOfIteratorHelper}});var a=r(181);function _createForOfIteratorHelper(t,i){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=(0,a.Z)(t))||i&&t&&"number"==typeof t.length){r&&(t=r);var o=0,h=function F(){};return{"s":h,"n":function n(){return o>=t.length?{"done":!0}:{"done":!1,"value":t[o++]}},"e":function e(t){throw t},"f":h}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{"s":function s(){r=r.call(t)},"n":function n(){var t=r.next();return c=t.done,t},"e":function e(t){u=!0,l=t},"f":function f(){try{c||null==r.return||r.return()}finally{if(u)throw l}}}}},"2186":function(t,i,r){r.d(i,{"l":function(){return Buffer},"o":function(){return VertexBuffer}});var a=r(1545),o=r(658),h=r(6791);class Buffer{get"isDisposed"(){return this._isDisposed}"constructor"(t,i,r,o=0,h=!1,l=!1,c=!1,u,d){this._isAlreadyOwned=!1,this._isDisposed=!1,t&&t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._instanced=l,this._divisor=u||1,this._label=d,i instanceof a.h?(this._data=null,this._buffer=i):(this._data=i,this._buffer=null),this.byteStride=c?o:o*Float32Array.BYTES_PER_ELEMENT,h||this.create()}"createVertexBuffer"(t,i,r,a,o,h=!1,l){const c=h?i:i*Float32Array.BYTES_PER_ELEMENT,u=a?h?a:a*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new VertexBuffer(this._engine,this,t,this._updatable,!0,u,void 0===o?this._instanced:o,c,r,void 0,void 0,!0,this._divisor||l)}"isUpdatable"(){return this._updatable}"getData"(){return this._data}"getBuffer"(){return this._buffer}"getStrideSize"(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}"create"(t=null){!t&&this._buffer||(t=t||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t,this._label),this._data=t):this._buffer=this._engine.createVertexBuffer(t,void 0,this._label))}"_rebuild"(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label));o.Y.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}"update"(t){this.create(t)}"updateDirectly"(t,i,r,a=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,a?i:i*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=0===i&&void 0===r?t:null)}"_increaseReferences"(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}"dispose"(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class VertexBuffer{get"isDisposed"(){return this._isDisposed}get"instanceDivisor"(){return this._instanceDivisor}set"instanceDivisor"(t){const i=0!=t;this._instanceDivisor=t,i!==this._instanced&&(this._instanced=i,this._computeHashCode())}get"_maxVerticesCount"(){const t=this.getData();return t?Array.isArray(t)?t.length/(this.byteStride/4)-this.byteOffset/4:(t.byteLength-this.byteOffset)/this.byteStride:0}"constructor"(t,i,r,a,o,l,c,u,d,_,g=!1,p=!1,m=1,T=!1){this._isDisposed=!1;let y=!1;if(this.engine=t,"object"==typeof a&&null!==a?(y=a.updatable??!1,o=a.postponeInternalCreation,l=a.stride,c=a.instanced,u=a.offset,d=a.size,_=a.type,g=a.normalized??!1,p=a.useBytes??!1,m=a.divisor??1,T=a.takeBufferOwnership??!1,this._label=a.label):y=!!a,i instanceof Buffer?(this._buffer=i,this._ownsBuffer=T):(this._buffer=new Buffer(t,i,y,l,o,c,p,m,this._label),this._ownsBuffer=!0),this.uniqueId=VertexBuffer._Counter++,this._kind=r,void 0===_){const t=this.getData();this.type=t?VertexBuffer.GetDataType(t):VertexBuffer.FLOAT}else this.type=_;const M=(0,h.N1)(this.type);p?(this._size=d||(l?l/M:VertexBuffer.DeduceStride(r)),this.byteStride=l||this._buffer.byteStride||this._size*M,this.byteOffset=u||0):(this._size=d||l||VertexBuffer.DeduceStride(r),this.byteStride=l?l*M:this._buffer.byteStride||this._size*M,this.byteOffset=(u||0)*M),this.normalized=g,this._instanced=void 0!==c&&c,this._instanceDivisor=c?m:0,this._alignBuffer(),this._computeHashCode()}"_computeHashCode"(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}"_rebuild"(){this._buffer?._rebuild()}"getKind"(){return this._kind}"isUpdatable"(){return this._buffer.isUpdatable()}"getData"(){return this._buffer.getData()}"getFloatData"(t,i){const r=this.getData();return r?(0,h.pm)(r,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,i):null}"getBuffer"(){return this._buffer.getBuffer()}"getWrapperBuffer"(){return this._buffer}"getStrideSize"(){return this.byteStride/(0,h.N1)(this.type)}"getOffset"(){return this.byteOffset/(0,h.N1)(this.type)}"getSize"(t=!1){return t?this._size*(0,h.N1)(this.type):this._size}"getIsInstanced"(){return this._instanced}"getInstanceDivisor"(){return this._instanceDivisor}"create"(t){this._buffer.create(t),this._alignBuffer()}"update"(t){this._buffer.update(t),this._alignBuffer()}"updateDirectly"(t,i,r=!1){this._buffer.updateDirectly(t,i,void 0,r),this._alignBuffer()}"dispose"(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}"forEach"(t,i){(0,h.X)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,(t,r)=>{for(let a=0;a<this._size;a++)i(t[a],r+a)})}"_alignBuffer"(){}static"DeduceStride"(t){switch(t){case VertexBuffer.UVKind:case VertexBuffer.UV2Kind:case VertexBuffer.UV3Kind:case VertexBuffer.UV4Kind:case VertexBuffer.UV5Kind:case VertexBuffer.UV6Kind:return 2;case VertexBuffer.NormalKind:case VertexBuffer.PositionKind:return 3;case VertexBuffer.ColorKind:case VertexBuffer.ColorInstanceKind:case VertexBuffer.MatricesIndicesKind:case VertexBuffer.MatricesIndicesExtraKind:case VertexBuffer.MatricesWeightsKind:case VertexBuffer.MatricesWeightsExtraKind:case VertexBuffer.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static"GetDataType"(t){return t instanceof Int8Array?VertexBuffer.BYTE:t instanceof Uint8Array?VertexBuffer.UNSIGNED_BYTE:t instanceof Int16Array?VertexBuffer.SHORT:t instanceof Uint16Array?VertexBuffer.UNSIGNED_SHORT:t instanceof Int32Array?VertexBuffer.INT:t instanceof Uint32Array?VertexBuffer.UNSIGNED_INT:VertexBuffer.FLOAT}static"GetTypeByteLength"(t){return(0,h.N1)(t)}static"ForEach"(t,i,r,a,o,l,c,u){(0,h.X)(t,i,r,a,o,l,c,(t,i)=>{for(let r=0;r<a;r++)u(t[r],i+r)})}static"GetFloatData"(t,i,r,a,o,l,c,u){return(0,h.pm)(t,i,r,a,o,l,c,u)}}VertexBuffer._Counter=0,VertexBuffer.BYTE=5120,VertexBuffer.UNSIGNED_BYTE=5121,VertexBuffer.SHORT=5122,VertexBuffer.UNSIGNED_SHORT=5123,VertexBuffer.INT=5124,VertexBuffer.UNSIGNED_INT=5125,VertexBuffer.FLOAT=5126,VertexBuffer.PositionKind="position",VertexBuffer.NormalKind="normal",VertexBuffer.TangentKind="tangent",VertexBuffer.UVKind="uv",VertexBuffer.UV2Kind="uv2",VertexBuffer.UV3Kind="uv3",VertexBuffer.UV4Kind="uv4",VertexBuffer.UV5Kind="uv5",VertexBuffer.UV6Kind="uv6",VertexBuffer.ColorKind="color",VertexBuffer.ColorInstanceKind="instanceColor",VertexBuffer.MatricesIndicesKind="matricesIndices",VertexBuffer.MatricesWeightsKind="matricesWeights",VertexBuffer.MatricesIndicesExtraKind="matricesIndicesExtra",VertexBuffer.MatricesWeightsExtraKind="matricesWeightsExtra"},"6791":function(t,i,r){r.d(i,{"N1":function(){return GetTypeByteLength},"X":function(){return EnumerateFloatValues},"pm":function(){return GetFloatData},"tQ":function(){return CopyFloatData}});var a=r(658);function GetFloatValue(t,i,r,a){switch(i){case 5120:{let i=t.getInt8(r);return a&&(i=Math.max(i/127,-1)),i}case 5121:{let i=t.getUint8(r);return a&&(i/=255),i}case 5122:{let i=t.getInt16(r,!0);return a&&(i=Math.max(i/32767,-1)),i}case 5123:{let i=t.getUint16(r,!0);return a&&(i/=65535),i}case 5124:return t.getInt32(r,!0);case 5125:return t.getUint32(r,!0);case 5126:return t.getFloat32(r,!0);default:throw new Error(`Invalid component type ${i}`)}}function SetFloatValue(t,i,r,a,o){switch(i){case 5120:a&&(o=Math.round(127*o)),t.setInt8(r,o);break;case 5121:a&&(o=Math.round(255*o)),t.setUint8(r,o);break;case 5122:a&&(o=Math.round(32767*o)),t.setInt16(r,o,!0);break;case 5123:a&&(o=Math.round(65535*o)),t.setUint16(r,o,!0);break;case 5124:t.setInt32(r,o,!0);break;case 5125:t.setUint32(r,o,!0);break;case 5126:t.setFloat32(r,o,!0);break;default:throw new Error(`Invalid component type ${i}`)}}function GetTypeByteLength(t){switch(t){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${t}'`)}}function EnumerateFloatValues(t,i,r,a,o,h,l,c){const u=new Array(a),d=new Array(a);if(t instanceof Array){let o=i/4;const l=r/4;for(let i=0;i<h;i+=a){for(let i=0;i<a;i++)u[i]=d[i]=t[o+i];c(d,i);for(let i=0;i<a;i++)u[i]!==d[i]&&(t[o+i]=d[i]);o+=l}}else{const _=ArrayBuffer.isView(t)?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(t),g=GetTypeByteLength(o);for(let t=0;t<h;t+=a){for(let t=0,r=i;t<a;t++,r+=g)u[t]=d[t]=GetFloatValue(_,o,r,l);c(d,t);for(let t=0,r=i;t<a;t++,r+=g)u[t]!==d[t]&&SetFloatValue(_,o,r,l,d[t]);i+=r}}}function GetFloatData(t,i,r,o,h,l,c,u){const d=i*GetTypeByteLength(r),_=c*i;if(5126!==r||h!==d){const a=new Float32Array(_);return EnumerateFloatValues(t,o,h,i,r,_,l,(t,r)=>{for(let o=0;o<i;o++)a[r+o]=t[o]}),a}if(!(t instanceof Array||t instanceof Float32Array)||0!==o||t.length!==_){if(t instanceof Array){const i=o/4;return t.slice(i,i+_)}if(t instanceof ArrayBuffer)return new Float32Array(t,o,_);{const i=t.byteOffset+o;return 3&i&&(a.Y.Warn("Float array must be aligned to 4-bytes border"),u=!0),u?new Float32Array(t.buffer.slice(i,i+_*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(t.buffer,i,_)}}return u?t.slice():t}function CopyFloatData(t,i,r,o,h,l,c,u){const d=i*GetTypeByteLength(r),_=c*i;if(u.length!==_)throw new Error("Output length is not valid");if(5126===r&&h===d)if(t instanceof Array){const i=o/4;u.set(t,i)}else if(t instanceof ArrayBuffer){const i=new Float32Array(t,o,_);u.set(i)}else{const i=t.byteOffset+o;if(3&i)return a.Y.Warn("Float array must be aligned to 4-bytes border"),void u.set(new Float32Array(t.buffer.slice(i,i+_*Float32Array.BYTES_PER_ELEMENT)));const r=new Float32Array(t.buffer,i,_);u.set(r)}else EnumerateFloatValues(t,o,h,i,r,_,l,(t,r)=>{for(let a=0;a<i;a++)u[r+a]=t[a]})}},"1545":function(t,i,r){r.d(i,{"h":function(){return DataBuffer}});class DataBuffer{get"underlyingResource"(){return null}"constructor"(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=DataBuffer._Counter++}}DataBuffer._Counter=0},"318":function(t,i,r){r.d(i,{"p":function(){return PickingInfo}});var a=r(5412),o=r(2186);class PickingInfo{"constructor"(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}"getNormal"(t=!1,i=!0){if(!this.pickedMesh||i&&!this.pickedMesh.isVerticesDataPresent(o.o.NormalKind))return null;let r,h=this.pickedMesh.getIndices();0===h?.length&&(h=null);const l=a.jp.Vector3[0],c=a.jp.Vector3[1],u=a.jp.Vector3[2];if(i){const t=this.pickedMesh.getVerticesData(o.o.NormalKind);let i=h?a.P.FromArrayToRef(t,3*h[3*this.faceId],l):l.copyFromFloats(t[3*this.faceId*3],t[3*this.faceId*3+1],t[3*this.faceId*3+2]),d=h?a.P.FromArrayToRef(t,3*h[3*this.faceId+1],c):c.copyFromFloats(t[3*(3*this.faceId+1)],t[3*(3*this.faceId+1)+1],t[3*(3*this.faceId+1)+2]),_=h?a.P.FromArrayToRef(t,3*h[3*this.faceId+2],u):u.copyFromFloats(t[3*(3*this.faceId+2)],t[3*(3*this.faceId+2)+1],t[3*(3*this.faceId+2)+2]);i=i.scale(this.bu),d=d.scale(this.bv),_=_.scale(1-this.bu-this.bv),r=new a.P(i.x+d.x+_.x,i.y+d.y+_.y,i.z+d.z+_.z)}else{const t=this.pickedMesh.getVerticesData(o.o.PositionKind),i=h?a.P.FromArrayToRef(t,3*h[3*this.faceId],l):l.copyFromFloats(t[3*this.faceId*3],t[3*this.faceId*3+1],t[3*this.faceId*3+2]),d=h?a.P.FromArrayToRef(t,3*h[3*this.faceId+1],c):c.copyFromFloats(t[3*(3*this.faceId+1)],t[3*(3*this.faceId+1)+1],t[3*(3*this.faceId+1)+2]),_=h?a.P.FromArrayToRef(t,3*h[3*this.faceId+2],u):u.copyFromFloats(t[3*(3*this.faceId+2)],t[3*(3*this.faceId+2)+1],t[3*(3*this.faceId+2)+2]),g=i.subtract(d),p=_.subtract(d);r=a.P.Cross(g,p)}const transformNormalToWorld=(t,i)=>{if(-1!==this.thinInstanceIndex){const r=t.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];r&&a.P.TransformNormalToRef(i,r,i)}let r=t.getWorldMatrix();t.nonUniformScaling&&(a.jp.Matrix[0].copyFrom(r),r=a.jp.Matrix[0],r.setTranslationFromFloats(0,0,0),r.invert(),r.transposeToRef(a.jp.Matrix[1]),r=a.jp.Matrix[1]),a.P.TransformNormalToRef(i,r,i)};if(t&&transformNormalToWorld(this.pickedMesh,r),this.ray){const i=a.jp.Vector3[0].copyFrom(r);t||transformNormalToWorld(this.pickedMesh,i),a.P.Dot(i,this.ray.direction)>0&&r.negateInPlace()}return r.normalize(),r}"getTextureCoordinates"(t=o.o.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t))return null;const i=this.pickedMesh.getIndices();if(!i)return null;const r=this.pickedMesh.getVerticesData(t);if(!r)return null;let h=a.FM.FromArray(r,2*i[3*this.faceId]),l=a.FM.FromArray(r,2*i[3*this.faceId+1]),c=a.FM.FromArray(r,2*i[3*this.faceId+2]);return h=h.scale(this.bu),l=l.scale(this.bv),c=c.scale(1-this.bu-this.bv),new a.FM(h.x+l.x+c.x,h.y+l.y+c.y)}}},"6629":function(t,i,r){r.d(i,{"VJ":function(){return a}});let a=!1},"3525":function(t,i,r){r.d(i,{"Ku":function(){return Finalize},"wz":function(){return Initialize},"An":function(){return Process},"xd":function(){return _ProcessIncludes},"PM":function(){return m}});class ShaderCodeNode{"constructor"(){this.children=[]}"isValid"(t){return!0}"process"(t,i){let r="";if(this.line){let a=this.line;const o=i.processor;if(o){o.lineProcessor&&(a=o.lineProcessor(a,i.isFragment,i.processingContext));const r=i.processor?.attributeKeywordName??"attribute",h=i.isFragment&&i.processor?.varyingFragmentKeywordName?i.processor?.varyingFragmentKeywordName:!i.isFragment&&i.processor?.varyingVertexKeywordName?i.processor?.varyingVertexKeywordName:"varying";if(!i.isFragment&&o.attributeProcessor&&this.line.startsWith(r))a=o.attributeProcessor(this.line,t,i.processingContext);else if(o.varyingProcessor&&(o.varyingCheck?.(this.line,i.isFragment)||!o.varyingCheck&&this.line.startsWith(h)))a=o.varyingProcessor(this.line,i.isFragment,t,i.processingContext);else if(o.uniformProcessor&&o.uniformRegexp&&o.uniformRegexp.test(this.line))i.lookForClosingBracketForUniformBuffer||(a=o.uniformProcessor(this.line,i.isFragment,t,i.processingContext));else if(o.uniformBufferProcessor&&o.uniformBufferRegexp&&o.uniformBufferRegexp.test(this.line))i.lookForClosingBracketForUniformBuffer||(a=o.uniformBufferProcessor(this.line,i.isFragment,i.processingContext),i.lookForClosingBracketForUniformBuffer=!0);else if(o.textureProcessor&&o.textureRegexp&&o.textureRegexp.test(this.line))a=o.textureProcessor(this.line,i.isFragment,t,i.processingContext);else if((o.uniformProcessor||o.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!i.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?o.uniformProcessor&&(a=o.uniformProcessor(this.line,i.isFragment,t,i.processingContext)):o.uniformBufferProcessor&&(a=o.uniformBufferProcessor(this.line,i.isFragment,i.processingContext),i.lookForClosingBracketForUniformBuffer=!0)}i.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(i.lookForClosingBracketForUniformBuffer=!1,o.endOfUniformBufferProcessor&&(a=o.endOfUniformBufferProcessor(this.line,i.isFragment,i.processingContext)))}r+=a+"\n"}return this.children.forEach(a=>{r+=a.process(t,i)}),this.additionalDefineKey&&(t[this.additionalDefineKey]=this.additionalDefineValue||"true"),r}}class ShaderCodeCursor{"constructor"(){this._lines=[]}get"currentLine"(){return this._lines[this.lineIndex]}get"canRead"(){return this.lineIndex<this._lines.length-1}set"lines"(t){this._lines.length=0;for(const i of t){if(!i||"\r"===i)continue;if("#"===i[0]){this._lines.push(i);continue}const t=i.trim();if(!t)continue;if(t.startsWith("//")){this._lines.push(i);continue}const r=t.indexOf(";");if(-1===r)this._lines.push(t);else if(r===t.length-1)t.length>1&&this._lines.push(t);else{const t=i.split(";");for(let i=0;i<t.length;i++){let r=t[i];r&&(r=r.trim(),r&&this._lines.push(r+(i!==t.length-1?";":"")))}}}}}class ShaderCodeConditionNode extends ShaderCodeNode{"process"(t,i){for(let r=0;r<this.children.length;r++){const a=this.children[r];if(a.isValid(t))return a.process(t,i)}return""}}class ShaderCodeTestNode extends ShaderCodeNode{"isValid"(t){return this.testExpression.isTrue(t)}}class ShaderDefineExpression{"isTrue"(t){return!0}static"postfixToInfix"(t){const i=[];for(const r of t)if(void 0===ShaderDefineExpression._OperatorPriority[r])i.push(r);else{const t=i[i.length-1],a=i[i.length-2];i.length-=2,i.push(`(${a}${r}${t})`)}return i[i.length-1]}static"infixToPostfix"(t){const i=ShaderDefineExpression._InfixToPostfixCache.get(t);if(i)return i.accessTime=Date.now(),i.result;if(!(t.includes("&&")||t.includes("||")||t.includes(")")||t.includes("(")))return[t];const r=[];let a=-1;const pushOperand=()=>{h=h.trim(),""!==h&&(r.push(h),h="")},push=t=>{a<ShaderDefineExpression._Stack.length-1&&(ShaderDefineExpression._Stack[++a]=t)},peek=()=>ShaderDefineExpression._Stack[a],pop=()=>-1===a?"!!INVALID EXPRESSION!!":ShaderDefineExpression._Stack[a--];let o=0,h="";for(;o<t.length;){const i=t.charAt(o),l=o<t.length-1?t.substring(o,2+o):"";if("("===i)h="",push(i);else if(")"===i){for(pushOperand();-1!==a&&"("!==peek();)r.push(pop());pop()}else if(ShaderDefineExpression._OperatorPriority[l]>1){for(pushOperand();-1!==a&&ShaderDefineExpression._OperatorPriority[peek()]>=ShaderDefineExpression._OperatorPriority[l];)r.push(pop());push(l),o++}else h+=i;o++}for(pushOperand();-1!==a;)"("===peek()?pop():r.push(pop());return ShaderDefineExpression._InfixToPostfixCache.size>=ShaderDefineExpression.InfixToPostfixCacheLimitSize&&ShaderDefineExpression.ClearCache(),ShaderDefineExpression._InfixToPostfixCache.set(t,{"result":r,"accessTime":Date.now()}),r}static"ClearCache"(){const t=Array.from(ShaderDefineExpression._InfixToPostfixCache.entries()).sort((t,i)=>t[1].accessTime-i[1].accessTime);for(let i=0;i<ShaderDefineExpression.InfixToPostfixCacheCleanupSize;i++)ShaderDefineExpression._InfixToPostfixCache.delete(t[i][0])}}ShaderDefineExpression.InfixToPostfixCacheLimitSize=5e4,ShaderDefineExpression.InfixToPostfixCacheCleanupSize=25e3,ShaderDefineExpression._InfixToPostfixCache=new Map,ShaderDefineExpression._OperatorPriority={")":0,"(":1,"||":2,"&&":3},ShaderDefineExpression._Stack=["","","","","","","","","","","","","","","","","","","",""];class ShaderDefineIsDefinedOperator extends ShaderDefineExpression{"constructor"(t,i=!1){super(),this.define=t,this.not=i}"isTrue"(t){let i=void 0!==t[this.define];return this.not&&(i=!i),i}}class ShaderDefineOrOperator extends ShaderDefineExpression{"isTrue"(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)}}class ShaderDefineAndOperator extends ShaderDefineExpression{"isTrue"(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)}}class ShaderDefineArithmeticOperator extends ShaderDefineExpression{"constructor"(t,i,r){super(),this.define=t,this.operand=i,this.testValue=r}"isTrue"(t){let i=t[this.define];void 0===i&&(i=this.define);let r=!1;const a=parseInt(i),o=parseInt(this.testValue);switch(this.operand){case">":r=a>o;break;case"<":r=a<o;break;case"<=":r=a<=o;break;case">=":r=a>=o;break;case"==":r=a===o;break;case"!=":r=a!==o}return r}}var a=r(9069),o=r(6443);const h=/defined\s*?\((.+?)\)/g,l=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,u=/__decl__/,d=/light\{X\}.(\w*)/g,_=/\{X\}/g,g=[],p=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function Initialize(t){t.processor&&t.processor.initializeShaders&&t.processor.initializeShaders(t.processingContext)}function Process(t,i,r,a){i.processor?.preProcessShaderCode&&(t=i.processor.preProcessShaderCode(t,i.isFragment)),_ProcessIncludes(t,i,t=>{i.processCodeAfterIncludes&&(t=i.processCodeAfterIncludes(i.isFragment?"fragment":"vertex",t,i.defines));const o=function _ProcessShaderConversion(t,i,r){let a=function _ProcessPrecision(t,i){if(i.processor?.noPrecision)return t;const r=i.shouldUseHighPrecisionShader;-1===t.indexOf("precision highp float")?t=r?"precision highp float;\n"+t:"precision mediump float;\n"+t:r||(t=t.replace("precision highp float","precision mediump float"));return t}(t,i);if(!i.processor)return a;if(0===i.processor.shaderLanguage&&-1!==a.indexOf("#version 3")&&(a=a.replace("#version 300 es",""),!i.processor.parseGLES3))return a;const o=i.defines,h=_PreparePreProcessors(i,r);i.processor.preProcessor&&(a=i.processor.preProcessor(a,o,h,i.isFragment,i.processingContext));a=_EvaluatePreProcessors(a,h,i),i.processor.postProcessor&&(a=i.processor.postProcessor(a,o,i.isFragment,i.processingContext,r?{"drawBuffersExtensionDisabled":!r.getCaps().drawBuffersExtension}:{}));r?._features.needShaderCodeInlining&&(a=r.inlineShaderCode(a));return a}(t,i,a);r(o,t)})}function Finalize(t,i,r){return r.processor&&r.processor.finalizeShaders?r.processor.finalizeShaders(t,i,r.processingContext):{"vertexCode":t,"fragmentCode":i}}function _ExtractOperation(t){const i=/defined\((.+)\)/.exec(t);if(i&&i.length)return new ShaderDefineIsDefinedOperator(i[1].trim(),"!"===t[0]);const r=["==","!=",">=","<=","<",">"];let a="",o=0;for(a of r)if(o=t.indexOf(a),o>-1)break;if(-1===o)return new ShaderDefineIsDefinedOperator(t);const h=t.substring(0,o).trim(),l=t.substring(o+a.length).trim();return new ShaderDefineArithmeticOperator(h,a,l)}function _BuildExpression(t,i){const r=new ShaderCodeTestNode,a=t.substring(0,i);let o=t.substring(i);return o=o.substring(0,(o.indexOf("//")+1||o.length+1)-1).trim(),r.testExpression="#ifdef"===a?new ShaderDefineIsDefinedOperator(o):"#ifndef"===a?new ShaderDefineIsDefinedOperator(o,!0):function _BuildSubExpression(t){t=t.replace(h,"defined[$1]");const i=ShaderDefineExpression.infixToPostfix(t),r=[];for(const t of i)if("||"!==t&&"&&"!==t)r.push(t);else if(r.length>=2){let i=r[r.length-1],a=r[r.length-2];r.length-=2;const o="&&"==t?new ShaderDefineAndOperator:new ShaderDefineOrOperator;"string"==typeof i&&(i=i.replace(l,"defined($1)")),"string"==typeof a&&(a=a.replace(l,"defined($1)")),o.leftOperand="string"==typeof a?_ExtractOperation(a):a,o.rightOperand="string"==typeof i?_ExtractOperation(i):i,r.push(o)}let a=r[r.length-1];return"string"==typeof a&&(a=a.replace(l,"defined($1)")),"string"==typeof a?_ExtractOperation(a):a}(o),r}function _MoveCursorWithinIf(t,i,r){let a=t.currentLine;for(;_MoveCursor(t,r);){a=t.currentLine;const o=a.substring(0,5).toLowerCase();if("#else"===o){const r=new ShaderCodeNode;return i.children.push(r),void _MoveCursor(t,r)}if("#elif"===o){const t=_BuildExpression(a,5);i.children.push(t),r=t}}}function _MoveCursor(t,i){for(;t.canRead;){t.lineIndex++;const r=t.currentLine;if(r.indexOf("#")>=0){const a=p.exec(r);if(a&&a.length){switch(a[0]){case"#ifdef":{const a=new ShaderCodeConditionNode;i.children.push(a);const o=_BuildExpression(r,6);a.children.push(o),_MoveCursorWithinIf(t,a,o);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const a=new ShaderCodeConditionNode;i.children.push(a);const o=_BuildExpression(r,7);a.children.push(o),_MoveCursorWithinIf(t,a,o);break}case"#if":{const a=new ShaderCodeConditionNode,o=_BuildExpression(r,3);i.children.push(a),a.children.push(o),_MoveCursorWithinIf(t,a,o);break}}continue}}const a=new ShaderCodeNode;if(a.line=r,i.children.push(a),"#"===r[0]&&"d"===r[1]){const t=r.replace(";","").split(" ");a.additionalDefineKey=t[1],3===t.length&&(a.additionalDefineValue=t[2])}}return!1}function _EvaluatePreProcessors(t,i,r){const a=new ShaderCodeNode,o=new ShaderCodeCursor;return o.lineIndex=-1,o.lines=t.split("\n"),_MoveCursor(o,a),a.process(i,r)}function _PreparePreProcessors(t,i){const r=t.defines,a={};for(const t of r){const i=t.replace("#define","").replace(";","").trim().split(" ");a[i[0]]=i.length>1?i[1]:""}return 0===t.processor?.shaderLanguage&&(a.GL_ES="true"),a.__VERSION__=t.version,a[t.platformName]="true",(0,o.sk)(a,i?.isNDCHalfZRange,i?.useReverseDepthBuffer,i?.useExactSrgbConversions),a}function _ProcessIncludes(t,i,r){let a;for(g.length=0;null!==(a=c.exec(t));)g.push(a);let o=String(t),h=[t],l=!1;for(const t of g){let a=t[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(u,""),i.supportsUniformBuffers&&(a=a.replace("Vertex","Ubo").replace("Fragment","Ubo")),a+="Declaration"),!i.includesShadersStore[a]){const t=i.shadersRepository+"ShadersInclude/"+a+".fx";return void m.loadFile(t,t=>{i.includesShadersStore[a]=t,_ProcessIncludes(h.join(""),i,r)})}{let r=i.includesShadersStore[a];if(t[2]){const i=t[3].split(",");for(let t=0;t<i.length;t+=2){const a=new RegExp(i[t],"g"),o=i[t+1];r=r.replace(a,o)}}if(t[4]){const a=t[5];if(-1!==a.indexOf("..")){const t=a.split(".."),o=parseInt(t[0]);let h=parseInt(t[1]),l=r.slice(0);r="",isNaN(h)&&(h=i.indexParameters[t[1]]);for(let t=o;t<h;t++)i.supportsUniformBuffers||(l=l.replace(d,(t,i)=>i+"{X}")),r+=l.replace(_,t.toString())+"\n"}else i.supportsUniformBuffers||(r=r.replace(d,(t,i)=>i+"{X}")),r=r.replace(_,a)}const o=[];for(const i of h){const a=i.split(t[0]);for(let t=0;t<a.length-1;t++)o.push(a[t]),o.push(r);o.push(a[a.length-1])}h=o,l=l||r.indexOf("#include<")>=0||r.indexOf("#include <")>=0}}g.length=0,o=h.join(""),l?_ProcessIncludes(o.toString(),i,r):r(o)}const m={"loadFile":(t,i,r,o,h,l)=>{throw(0,a.S)("FileTools")}}},"8449":function(t,i,r){r.d(i,{"B":function(){return WebGLHardwareTexture}});class WebGLHardwareTexture{get"underlyingResource"(){return this._webGLTexture}"constructor"(t=null,i){if(this._MSAARenderBuffers=null,this._context=i,!t&&!(t=i.createTexture()))throw new Error("Unable to create webGL texture");this.set(t)}"setUsage"(){}"set"(t){this._webGLTexture=t}"reset"(){this._webGLTexture=null,this._MSAARenderBuffers=null}"addMSAARenderBuffer"(t){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(t)}"releaseMSAARenderBuffers"(){if(this._MSAARenderBuffers){for(const t of this._MSAARenderBuffers)this._context.deleteRenderbuffer(t);this._MSAARenderBuffers=null}}"getMSAARenderBuffer"(t=0){return this._MSAARenderBuffers?.[t]??null}"release"(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},"6443":function(t,i,r){r.d(i,{"A8":function(){return allocateAndCopyTypedBuffer},"Gb":function(){return _ConcatenateShader},"an":function(){return o},"sk":function(){return _getGlobalDefines},"wv":function(){return _loadFile}});var a=r(9069);r(1102);const o={};function _ConcatenateShader(t,i,r=""){return r+(i?i+"\n":"")+t}function _loadFile(t,i,r,h,l,c,u){const d=u||o.loadFile;if(d){return d(t,i,r,h,l,c)}throw(0,a.S)("FileTools")}function _getGlobalDefines(t,i,r,a){if(t)return i?t.IS_NDC_HALF_ZRANGE="":delete t.IS_NDC_HALF_ZRANGE,r?t.USE_REVERSE_DEPTHBUFFER="":delete t.USE_REVERSE_DEPTHBUFFER,void(a?t.USE_EXACT_SRGB_CONVERSIONS="":delete t.USE_EXACT_SRGB_CONVERSIONS);{let t="";return i&&(t+="#define IS_NDC_HALF_ZRANGE"),r&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),a&&(t&&(t+="\n"),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}function allocateAndCopyTypedBuffer(t,i,r=!1,a){switch(t){case 3:{const t=(ArrayBuffer,new Int8Array(i));return a&&t.set(new Int8Array(a)),t}case 0:{const t=(ArrayBuffer,new Uint8Array(i));return a&&t.set(new Uint8Array(a)),t}case 4:{const t=i instanceof ArrayBuffer?new Int16Array(i):new Int16Array(r?i/2:i);return a&&t.set(new Int16Array(a)),t}case 5:case 8:case 9:case 10:case 2:{const t=i instanceof ArrayBuffer?new Uint16Array(i):new Uint16Array(r?i/2:i);return a&&t.set(new Uint16Array(a)),t}case 6:{const t=i instanceof ArrayBuffer?new Int32Array(i):new Int32Array(r?i/4:i);return a&&t.set(new Int32Array(a)),t}case 7:case 11:case 12:case 13:case 14:case 15:{const t=i instanceof ArrayBuffer?new Uint32Array(i):new Uint32Array(r?i/4:i);return a&&t.set(new Uint32Array(a)),t}case 1:{const t=i instanceof ArrayBuffer?new Float32Array(i):new Float32Array(r?i/4:i);return a&&t.set(new Float32Array(a)),t}}const o=(ArrayBuffer,new Uint8Array(i));return a&&o.set(new Uint8Array(a)),o}},"9204":function(t,i,r){r.d(i,{"a":function(){return AbstractEngine}});var a=r(5953),o=r(658),h=r(4442),l=r(1716),c=r(9665);class DepthCullingState{"constructor"(t=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,t&&this.reset()}get"isDirty"(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get"zOffset"(){return this._zOffset}set"zOffset"(t){this._zOffset!==t&&(this._zOffset=t,this._isZOffsetDirty=!0)}get"zOffsetUnits"(){return this._zOffsetUnits}set"zOffsetUnits"(t){this._zOffsetUnits!==t&&(this._zOffsetUnits=t,this._isZOffsetDirty=!0)}get"cullFace"(){return this._cullFace}set"cullFace"(t){this._cullFace!==t&&(this._cullFace=t,this._isCullFaceDirty=!0)}get"cull"(){return this._cull}set"cull"(t){this._cull!==t&&(this._cull=t,this._isCullDirty=!0)}get"depthFunc"(){return this._depthFunc}set"depthFunc"(t){this._depthFunc!==t&&(this._depthFunc=t,this._isDepthFuncDirty=!0)}get"depthMask"(){return this._depthMask}set"depthMask"(t){this._depthMask!==t&&(this._depthMask=t,this._isDepthMaskDirty=!0)}get"depthTest"(){return this._depthTest}set"depthTest"(t){this._depthTest!==t&&(this._depthTest=t,this._isDepthTestDirty=!0)}get"frontFace"(){return this._frontFace}set"frontFace"(t){this._frontFace!==t&&(this._frontFace=t,this._isFrontFaceDirty=!0)}"reset"(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}"apply"(t){this.isDirty&&(this._isCullDirty&&(this.cull?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(t.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(t.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(t.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(this.zOffset,this.zOffsetUnits)):t.disable(t.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(t.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class StencilStateComposer{get"isDirty"(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get"func"(){return this._func}set"func"(t){this._func!==t&&(this._func=t,this._isStencilFuncDirty=!0)}get"funcRef"(){return this._funcRef}set"funcRef"(t){this._funcRef!==t&&(this._funcRef=t,this._isStencilFuncDirty=!0)}get"funcMask"(){return this._funcMask}set"funcMask"(t){this._funcMask!==t&&(this._funcMask=t,this._isStencilFuncDirty=!0)}get"opStencilFail"(){return this._opStencilFail}set"opStencilFail"(t){this._opStencilFail!==t&&(this._opStencilFail=t,this._isStencilOpDirty=!0)}get"opDepthFail"(){return this._opDepthFail}set"opDepthFail"(t){this._opDepthFail!==t&&(this._opDepthFail=t,this._isStencilOpDirty=!0)}get"opStencilDepthPass"(){return this._opStencilDepthPass}set"opStencilDepthPass"(t){this._opStencilDepthPass!==t&&(this._opStencilDepthPass=t,this._isStencilOpDirty=!0)}get"mask"(){return this._mask}set"mask"(t){this._mask!==t&&(this._mask=t,this._isStencilMaskDirty=!0)}get"enabled"(){return this._enabled}set"enabled"(t){this._enabled!==t&&(this._enabled=t,this._isStencilTestDirty=!0)}"constructor"(t=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,t&&this.reset()}"reset"(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}"apply"(t){if(!t)return;const i=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=i?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=i?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=i?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=i?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=i?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=i?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=i?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=i?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(t.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(t.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(t.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class StencilState{"constructor"(){this.reset()}"reset"(){this.enabled=!1,this.mask=255,this.func=StencilState.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=StencilState.KEEP,this.opDepthFail=StencilState.KEEP,this.opStencilDepthPass=StencilState.REPLACE}get"stencilFunc"(){return this.func}set"stencilFunc"(t){this.func=t}get"stencilFuncRef"(){return this.funcRef}set"stencilFuncRef"(t){this.funcRef=t}get"stencilFuncMask"(){return this.funcMask}set"stencilFuncMask"(t){this.funcMask=t}get"stencilOpStencilFail"(){return this.opStencilFail}set"stencilOpStencilFail"(t){this.opStencilFail=t}get"stencilOpDepthFail"(){return this.opDepthFail}set"stencilOpDepthFail"(t){this.opDepthFail=t}get"stencilOpStencilDepthPass"(){return this.opStencilDepthPass}set"stencilOpStencilDepthPass"(t){this.opStencilDepthPass=t}get"stencilMask"(){return this.mask}set"stencilMask"(t){this.mask=t}get"stencilTest"(){return this.enabled}set"stencilTest"(t){this.enabled=t}}StencilState.ALWAYS=519,StencilState.KEEP=7680,StencilState.REPLACE=7681;class AlphaState{"constructor"(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get"isDirty"(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get"alphaBlend"(){return this._alphaBlend}set"alphaBlend"(t){this._alphaBlend!==t&&(this._alphaBlend=t,this._isAlphaBlendDirty=!0)}"setAlphaBlendConstants"(t,i,r,a){this._blendConstants[0]===t&&this._blendConstants[1]===i&&this._blendConstants[2]===r&&this._blendConstants[3]===a||(this._blendConstants[0]=t,this._blendConstants[1]=i,this._blendConstants[2]=r,this._blendConstants[3]=a,this._isBlendConstantsDirty=!0)}"setAlphaBlendFunctionParameters"(t,i,r,a){this._blendFunctionParameters[0]===t&&this._blendFunctionParameters[1]===i&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===a||(this._blendFunctionParameters[0]=t,this._blendFunctionParameters[1]=i,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=a,this._isBlendFunctionParametersDirty=!0)}"setAlphaEquationParameters"(t,i){this._blendEquationParameters[0]===t&&this._blendEquationParameters[1]===i||(this._blendEquationParameters[0]=t,this._blendEquationParameters[1]=i,this._isBlendEquationParametersDirty=!0)}"reset"(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}"apply"(t){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?t.enable(t.BLEND):t.disable(t.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(t.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(t.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(t.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var u=r(9069),d=r(3369),_=r(1102),g=r(8139),p=r(6443),m=r(5126);function QueueNewFrame(t,i){if((0,_.CG)()){const{"requestAnimationFrame":r}=i||window;if("function"==typeof r)return r(t)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(t);return setTimeout(t,16)}class AbstractEngine{get"frameId"(){return this._frameId}get"isWebGPU"(){return this._isWebGPU}"_getShaderProcessor"(t){return this._shaderProcessor}get"shaderPlatformName"(){return this._shaderPlatformName}"_clearEmptyResources"(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get"useReverseDepthBuffer"(){return this._useReverseDepthBuffer}set"useReverseDepthBuffer"(t){t!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=t,this._depthCullingState.depthFunc=t?518:515)}"setColorWrite"(t){t!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=t)}"getColorWrite"(){return this._colorWrite}get"depthCullingState"(){return this._depthCullingState}get"alphaState"(){return this._alphaState}get"stencilState"(){return this._stencilState}get"stencilStateComposer"(){return this._stencilStateComposer}"_getGlobalDefines"(t){if(t)return this.isNDCHalfZRange?t.IS_NDC_HALF_ZRANGE="":delete t.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?t.USE_REVERSE_DEPTHBUFFER="":delete t.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?t.USE_EXACT_SRGB_CONVERSIONS="":delete t.USE_EXACT_SRGB_CONVERSIONS);{let t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(t&&(t+="\n"),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}"_rebuildInternalTextures"(){const t=this._internalTexturesCache.slice();for(const i of t)i._rebuild()}"_rebuildRenderTargetWrappers"(){const t=this._renderTargetWrapperCache.slice();for(const i of t)i._rebuild()}"_rebuildEffects"(){for(const t in this._compiledEffects){const i=this._compiledEffects[t];i._pipelineContext=null,i._prepareEffect()}h.Q.ResetCache()}"_rebuildGraphicsResources"(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}"_flagContextRestored"(){o.Y.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}"_restoreEngineAfterContextLost"(t){setTimeout(async()=>{this._clearEmptyResources();const i=this._depthCullingState.depthTest,r=this._depthCullingState.depthFunc,a=this._depthCullingState.depthMask,o=this._stencilState.stencilTest;await t(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=i,this._depthCullingState.depthFunc=r,this._depthCullingState.depthMask=a,this._stencilState.stencilTest=o,this._flagContextRestored()},0)}get"isDisposed"(){return this._isDisposed}get"snapshotRendering"(){return!1}set"snapshotRendering"(t){}get"snapshotRenderingMode"(){return 0}set"snapshotRenderingMode"(t){}"getClassName"(){return"AbstractEngine"}get"emptyTexture"(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get"emptyTexture3D"(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get"emptyTexture2DArray"(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get"emptyCubeTexture"(){if(!this._emptyCubeTexture){const t=new Uint8Array(4),i=[t,t,t,t,t,t];this._emptyCubeTexture=this.createRawCubeTexture(i,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get"activeRenderLoops"(){return this._activeRenderLoops}"stopRenderLoop"(t){if(!t)return this._activeRenderLoops.length=0,void this._cancelFrame();const i=this._activeRenderLoops.indexOf(t);i>=0&&(this._activeRenderLoops.splice(i,1),0==this._activeRenderLoops.length&&this._cancelFrame())}"_cancelFrame"(){if(0!==this._frameHandler){const t=this._frameHandler;if(this._frameHandler=0,(0,_.CG)()){const{"cancelAnimationFrame":i}=this.getHostWindow()||window;if("function"==typeof i)return i(t)}else if("function"==typeof cancelAnimationFrame)return cancelAnimationFrame(t);return clearTimeout(t)}}"beginFrame"(){this.onBeginFrameObservable.notifyObservers(this)}"endFrame"(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get"maxFPS"(){return this._maxFPS}set"maxFPS"(t){this._maxFPS=t,void 0!==t&&(this._minFrameTime=t<=0?Number.MAX_VALUE:1e3/(t+1))}"_isOverFrameTime"(t){if(!t)return!1;const i=t-this._lastFrameTime;return!(void 0===this._maxFPS||i>=this._minFrameTime)||(this._lastFrameTime=t,!1)}"_processFrame"(t){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(t)){let t=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(t=!1),t&&(this.beginFrame(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.endFrame())}}"_renderLoop"(t){this._processFrame(t),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}"_renderFrame"(){for(let t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}}"_renderViews"(){return!1}"_queueNewFrame"(t,i){return QueueNewFrame(t,i)}"runRenderLoop"(t){-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}"getDepthBuffer"(){return this._depthCullingState.depthTest}"setDepthBuffer"(t){this._depthCullingState.depthTest=t}"setZOffset"(t){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-t:t}"getZOffset"(){const t=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-t:t}"setZOffsetUnits"(t){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-t:t}"getZOffsetUnits"(){const t=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-t:t}"getHostWindow"(){return(0,_.CG)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get"compatibilityMode"(){return this._compatibilityMode}set"compatibilityMode"(t){this._compatibilityMode=!0}"_rebuildTextures"(){for(const t of this.scenes)t._rebuildTextures();for(const t of this._virtualScenes)t._rebuildTextures()}"_releaseRenderTargetWrapper"(t){const i=this._renderTargetWrapperCache.indexOf(t);-1!==i&&this._renderTargetWrapperCache.splice(i,1)}get"currentViewport"(){return this._cachedViewport}"setViewport"(t,i,r){const a=i||this.getRenderWidth(),o=r||this.getRenderHeight(),h=t.x||0,l=t.y||0;this._cachedViewport=t,this._viewport(h*a,l*o,a*t.width,o*t.height)}"createCanvasImage"(){return document.createElement("img")}"createCanvasPath2D"(t){return new Path2D(t)}get"description"(){let t=this.name+this.version;return this._caps.parallelShaderCompile&&(t+=" - Parallel shader compilation"),t}"_createTextureBase"(t,i,r,h,l=3,c=null,u=null,_,g,p=null,T=null,y=null,M=null,b,x,E){const R="data:"===(t=t||"").substr(0,5),A="blob:"===t.substr(0,5),C=R&&-1!==t.indexOf(";base64,"),v=T||new d.l(this,1);v!==T&&(v.label=t.substring(0,60));const P=t;!this._transformTextureUrl||C||T||p||(t=this._transformTextureUrl(t)),P!==t&&(v._originalUrl=P);const S=t.lastIndexOf(".");let I=M||(S>-1?t.substring(S).toLowerCase():"");I.indexOf("?")>-1&&(I=I.split("?")[0]);const D=(0,m.qr)(I,b);h&&h.addPendingData(v),v.url=t,v.generateMipMaps=!i,v.samplingMode=l,v.invertY=r,v._useSRGBBuffer=this._getUseSRGBBuffer(!!E,i),this._doNotHandleContextLost||(v._buffer=p);let O=null;c&&!T&&(O=v.onLoadedObservable.add(c)),T||this._internalTexturesCache.push(v);const onInternalError=(r,d)=>{h&&h.removePendingData(v),t===P?(O&&v.onLoadedObservable.remove(O),a.l.UseFallbackTexture&&t!==a.l.FallbackTexture&&this._createTextureBase(a.l.FallbackTexture,i,v.invertY,h,l,null,u,_,g,p,v),r=(r||"Unknown error")+(a.l.UseFallbackTexture?" - Fallback texture was used":""),v.onErrorObservable.notifyObservers({"message":r,"exception":d}),u&&u(r,d)):(o.Y.Warn(`Failed to load ${t}, falling back to ${P}`),this._createTextureBase(P,i,v.invertY,h,l,c,u,_,g,p,v,y,M,b,x,E))};if(D){const callback=async t=>{(await D).loadData(t,v,(t,i,r,a,o,c)=>{c?onInternalError("TextureLoader failed to load data"):_(v,I,h,{"width":t,"height":i},v.invertY,!r,a,()=>(o(),!1),l)},x)};p?p instanceof ArrayBuffer?callback(new Uint8Array(p)):ArrayBuffer.isView(p)?callback(p):u&&u("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,t=>callback(new Uint8Array(t)),void 0,h?h.offlineProvider:void 0,!0,(t,i)=>{onInternalError("Unable to load "+(t&&t.responseURL,i))})}else{const onload=t=>{A&&!this._doNotHandleContextLost&&(v._buffer=t),_(v,I,h,t,v.invertY,i,!1,g,l)};!R||C?p&&("string"==typeof p.decoding||p.close)?onload(p):AbstractEngine._FileToolsLoadImage(t||"",onload,onInternalError,h?h.offlineProvider:null,b,v.invertY&&this._features.needsInvertingBitmap?{"imageOrientation":"flipY"}:void 0,this):"string"==typeof p||p instanceof ArrayBuffer||ArrayBuffer.isView(p)||p instanceof Blob?AbstractEngine._FileToolsLoadImage(p,onload,onInternalError,h?h.offlineProvider:null,b,v.invertY&&this._features.needsInvertingBitmap?{"imageOrientation":"flipY"}:void 0,this):p&&onload(p)}return v}"_rebuildBuffers"(){for(const t of this._uniformBuffers)t._rebuildAfterContextLost()}get"_shouldUseHighPrecisionShader"(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}"getHostDocument"(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,_.n5)()?document:null}"getLoadedTexturesCache"(){return this._internalTexturesCache}"clearInternalTexturesCache"(){this._internalTexturesCache.length=0}"getCaps"(){return this._caps}"resetTextureCache"(){for(const t in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,t)&&(this._boundTexturesCache[t]=null);this._currentTextureChannel=-1}get"name"(){return this._name}set"name"(t){this._name=t}static get"NpmPackage"(){return"babylonjs@7.54.3"}static get"Version"(){return"7.54.3"}"getRenderingCanvas"(){return this._renderingCanvas}"getAudioContext"(){return this._audioContext}"getAudioDestination"(){return this._audioDestination}"setHardwareScalingLevel"(t){this._hardwareScalingLevel=t,this.resize()}"getHardwareScalingLevel"(){return this._hardwareScalingLevel}get"doNotHandleContextLost"(){return this._doNotHandleContextLost}set"doNotHandleContextLost"(t){this._doNotHandleContextLost=t}get"isStencilEnable"(){return this._isStencilEnable}"getCreationOptions"(){return this._creationOptions}"constructor"(t,i,r){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new DepthCullingState,this._stencilStateComposer=new StencilStateComposer,this._stencilState=new StencilState,this._alphaState=new AlphaState,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={"x":0,"y":0,"z":0,"w":0},this._isWebGPU=!1,this.onCanvasBlurObservable=new g.y$,this.onCanvasFocusObservable=new g.y$,this.onNewSceneAddedObservable=new g.y$,this.onResizeObservable=new g.y$,this.onCanvasPointerOutObservable=new g.y$,this.onEffectErrorObservable=new g.y$,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={"isMobile":!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new g.y$,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=t=>this._renderLoop(t),this._lastFrameTime=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new g.y$,this.onAfterShaderCompilationObservable=new g.y$,this.onBeginFrameObservable=new g.y$,this.onEndFrameObservable=new g.y$,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new g.y$,this.onContextRestoredObservable=new g.y$,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new g.y$,this.onReleaseEffectsObservable=new g.y$,a.l.Instances.push(this),this.startTime=c.F.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,l.Z.SetMatrixPrecision(!!i.useHighPrecisionMatrix),(0,_.up)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=r??!1,i.antialias=t??i.antialias,i.deterministicLockstep=i.deterministicLockstep??!1,i.lockstepMaxSteps=i.lockstepMaxSteps??4,i.timeStep=i.timeStep??1/60,i.stencil=i.stencil??!0,this._audioContext=i.audioEngineOptions?.audioContext??null,this._audioDestination=i.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=i.premultipliedAlpha??!0,this._doNotHandleContextLost=!!i.doNotHandleContextLost,this._isStencilEnable=!!i.stencil,this.useExactSrgbConversions=i.useExactSrgbConversions??!1;const o=(0,_.CG)()&&window.devicePixelRatio||1,h=i.limitDeviceRatio||o;r=r||i.adaptToDeviceRatio||!1,this._hardwareScalingLevel=r?1/Math.min(h,o):1,this._lastDevicePixelRatio=o,this._creationOptions=i}"resize"(t=!1){let i,r;if(this.adaptToDeviceRatio){const t=(0,_.CG)()&&window.devicePixelRatio||1,i=this._lastDevicePixelRatio/t;this._lastDevicePixelRatio=t,this._hardwareScalingLevel*=i}if((0,_.CG)()&&(0,_.n5)())if(this._renderingCanvas){const t=this._renderingCanvas.getBoundingClientRect?.();i=this._renderingCanvas.clientWidth||t?.width||this._renderingCanvas.width*this._hardwareScalingLevel||100,r=this._renderingCanvas.clientHeight||t?.height||this._renderingCanvas.height*this._hardwareScalingLevel||100}else i=window.innerWidth,r=window.innerHeight;else i=this._renderingCanvas?this._renderingCanvas.width:100,r=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(i/this._hardwareScalingLevel,r/this._hardwareScalingLevel,t)}"setSize"(t,i,r=!1){if(!this._renderingCanvas)return!1;if(t|=0,i|=0,!r&&this._renderingCanvas.width===t&&this._renderingCanvas.height===i)return!1;if(this._renderingCanvas.width=t,this._renderingCanvas.height=i,this.scenes){for(let t=0;t<this.scenes.length;t++){const i=this.scenes[t];for(let t=0;t<i.cameras.length;t++){i.cameras[t]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}"createRawTexture"(t,i,r,a,o,h,l,c,d,_,g){throw(0,u.S)("engine.rawTexture")}"createRawCubeTexture"(t,i,r,a,o,h,l,c){throw(0,u.S)("engine.rawTexture")}"createRawTexture3D"(t,i,r,a,o,h,l,c,d,_,g){throw(0,u.S)("engine.rawTexture")}"createRawTexture2DArray"(t,i,r,a,o,h,l,c,d,_,g){throw(0,u.S)("engine.rawTexture")}"_sharedInit"(t){this._renderingCanvas=t}"_setupMobileChecks"(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const t=navigator.userAgent;this.hostInformation.isMobile=-1!==t.indexOf("Mobile")||-1!==t.indexOf("Mac")&&(0,_.n5)()&&"ontouchend"in document},this._checkForMobile(),(0,_.CG)()&&window.addEventListener("resize",this._checkForMobile))}"createVideoElement"(t){return document.createElement("video")}"_reportDrawCall"(t=1){this._drawCalls?.addCount(t,!1)}"getFps"(){return this._fps}"getDeltaTime"(){return this._deltaTime}"isDeterministicLockStep"(){return this._deterministicLockstep}"getLockstepMaxSteps"(){return this._lockstepMaxSteps}"getTimeStep"(){return 1e3*this._timeStep}"_createImageBitmapFromSource"(t,i){throw new Error("createImageBitmapFromSource is not implemented")}"createImageBitmap"(t,i){return createImageBitmap(t,i)}"resizeImageBitmap"(t,i,r){throw new Error("resizeImageBitmap is not implemented")}"getFontOffset"(t){throw new Error("getFontOffset is not implemented")}static"_CreateCanvas"(t,i){if("undefined"==typeof document)return new OffscreenCanvas(t,i);const r=document.createElement("canvas");return r.width=t,r.height=i,r}"createCanvas"(t,i){return AbstractEngine._CreateCanvas(t,i)}static"_FileToolsLoadImage"(t,i,r,a,o,h,l){throw(0,u.S)("FileTools")}"_loadFile"(t,i,r,a,o,h){const l=(0,p.wv)(t,i,r,a,o,h);return this._activeRequests.push(l),l.onCompleteObservable.add(()=>{const t=this._activeRequests.indexOf(l);-1!==t&&this._activeRequests.splice(t,1)}),l}static"_FileToolsLoadFile"(t,i,r,a,o,h){if(p.an.loadFile)return p.an.loadFile(t,i,r,a,o,h);throw(0,u.S)("FileTools")}"dispose"(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),h.Q.ResetCache();for(const t of this._activeRequests)t.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,_.CG)()&&window.removeEventListener("resize",this._checkForMobile);const t=a.l.Instances.indexOf(this);t>=0&&a.l.Instances.splice(t,1),a.l.Instances.length||(a.l.OnEnginesDisposedObservable.notifyObservers(this),a.l.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static"DefaultLoadingScreenFactory"(t){throw(0,u.S)("LoadingScreen")}static"MarkAllMaterialsAsDirty"(t,i){for(let r=0;r<a.l.Instances.length;r++){const o=a.l.Instances[r];for(let r=0;r<o.scenes.length;r++)o.scenes[r].markAllMaterialsAsDirty(t,i)}}}AbstractEngine._RenderPassIdCounter=0,AbstractEngine._RescalePostProcessFactory=null,AbstractEngine.CollisionsEpsilon=.001,AbstractEngine.QueueNewFrame=QueueNewFrame},"6230":function(t,i,r){r.d(i,{"D":function(){return Engine}});var a=r(3369),o=r(5953),h=r(5459),l=r(9665);class PerformanceMonitor{"constructor"(t=30){this._enabled=!0,this._rollingFrameTime=new RollingAverage(t)}"sampleFrame"(t=l.F.Now){if(this._enabled){if(null!=this._lastFrameTimeMs){const i=t-this._lastFrameTimeMs;this._rollingFrameTime.add(i)}this._lastFrameTimeMs=t}}get"averageFrameTime"(){return this._rollingFrameTime.average}get"averageFrameTimeVariance"(){return this._rollingFrameTime.variance}get"instantaneousFrameTime"(){return this._rollingFrameTime.history(0)}get"averageFPS"(){return 1e3/this._rollingFrameTime.average}get"instantaneousFPS"(){const t=this._rollingFrameTime.history(0);return 0===t?0:1e3/t}get"isSaturated"(){return this._rollingFrameTime.isSaturated()}"enable"(){this._enabled=!0}"disable"(){this._enabled=!1,this._lastFrameTimeMs=null}get"isEnabled"(){return this._enabled}"reset"(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class RollingAverage{"constructor"(t){this._samples=new Array(t),this.reset()}"add"(t){let i;if(this.isSaturated()){const t=this._samples[this._pos];i=t-this.average,this.average-=i/(this._sampleCount-1),this._m2-=i*(t-this.average)}else this._sampleCount++;i=t-this.average,this.average+=i/this._sampleCount,this._m2+=i*(t-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=t,this._pos++,this._pos%=this._samples.length}"history"(t){if(t>=this._sampleCount||t>=this._samples.length)return 0;const i=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(i-t)]}"isSaturated"(){return this._sampleCount>=this._samples.length}"reset"(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}"_wrapPosition"(t){const i=this._samples.length;return(t%i+i)%i}}var c=r(4081),u=r(658),d=r(8449);h.ThinEngine.prototype.setAlphaMode=function(t,i=!1){if(this._alphaMode!==t){switch(t){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}i||(this.depthCullingState.depthMask=0===t),this._alphaMode=t}else if(!i){const i=0===t;this.depthCullingState.depthMask!==i&&(this.depthCullingState.depthMask=i)}};var _=r(5336);function _convertRGBtoRGBATextureData(t,i,r,a){let o,h=1;1===a?o=new Float32Array(i*r*4):2===a?(o=new Uint16Array(i*r*4),h=15360):o=7===a?new Uint32Array(i*r*4):new Uint8Array(i*r*4);for(let a=0;a<i;a++)for(let l=0;l<r;l++){const r=3*(l*i+a),c=4*(l*i+a);o[c+0]=t[r+0],o[c+1]=t[r+1],o[c+2]=t[r+2],o[c+3]=h}return o}function _makeCreateRawTextureFunction(t){return function(i,r,o,h,l,c,u,d,_=null,g=0){const p=t?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,m=t?10:11,T=new a.l(this,m);T.baseWidth=r,T.baseHeight=o,T.baseDepth=h,T.width=r,T.height=o,T.depth=h,T.format=l,T.type=g,T.generateMipMaps=c,T.samplingMode=d,t?T.is3D=!0:T.is2DArray=!0,this._doNotHandleContextLost||(T._bufferView=i),t?this.updateRawTexture3D(T,i,l,u,_,g):this.updateRawTexture2DArray(T,i,l,u,_,g),this._bindTextureDirectly(p,T,!0);const y=this._getSamplingParameters(d,c);return this._gl.texParameteri(p,this._gl.TEXTURE_MAG_FILTER,y.mag),this._gl.texParameteri(p,this._gl.TEXTURE_MIN_FILTER,y.min),c&&this._gl.generateMipmap(p),this._bindTextureDirectly(p,null),this._internalTexturesCache.push(T),T}}function _makeUpdateRawTextureFunction(t){return function(i,r,a,o,h=null,l=0){const c=t?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,u=this._getWebGLTextureType(l),d=this._getInternalFormat(a),_=this._getRGBABufferInternalSizedFormat(l,a);this._bindTextureDirectly(c,i,!0),this._unpackFlipY(void 0===o||!!o),this._doNotHandleContextLost||(i._bufferView=r,i.format=a,i.invertY=o,i._compression=h),i.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),h&&r?this._gl.compressedTexImage3D(c,0,this.getCaps().s3tc[h],i.width,i.height,i.depth,0,r):this._gl.texImage3D(c,0,_,i.width,i.height,i.depth,0,d,u,r),i.generateMipMaps&&this._gl.generateMipmap(c),this._bindTextureDirectly(c,null),i.isReady=!0}}h.ThinEngine.prototype.updateRawTexture=function(t,i,r,a,o=null,h=0,l=!1){if(!t)return;const c=this._getRGBABufferInternalSizedFormat(h,r,l),u=this._getInternalFormat(r),d=this._getWebGLTextureType(h);this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===a||!!a),this._doNotHandleContextLost||(t._bufferView=i,t.format=r,t.type=h,t.invertY=a,t._compression=o),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&i?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[o],t.width,t.height,0,i):this._gl.texImage2D(this._gl.TEXTURE_2D,0,c,t.width,t.height,0,u,d,i),t.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),t.isReady=!0},h.ThinEngine.prototype.createRawTexture=function(t,i,r,o,h,l,c,u=null,d=0,_=0,g=!1){const p=new a.l(this,3);p.baseWidth=i,p.baseHeight=r,p.width=i,p.height=r,p.format=o,p.generateMipMaps=h,p.samplingMode=c,p.invertY=l,p._compression=u,p.type=d,p._useSRGBBuffer=this._getUseSRGBBuffer(g,!h),this._doNotHandleContextLost||(p._bufferView=t),this.updateRawTexture(p,t,o,l,u,d,p._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,p,!0);const m=this._getSamplingParameters(c,h);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,m.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,m.min),h&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(p),p},h.ThinEngine.prototype.createRawCubeTexture=function(t,i,r,o,h,l,c,d=null){const g=this._gl,p=new a.l(this,8);p.isCube=!0,p.format=r,p.type=o,this._doNotHandleContextLost||(p._bufferViewArray=t);const m=this._getWebGLTextureType(o);let T=this._getInternalFormat(r);T===g.RGB&&(T=g.RGBA),m!==g.FLOAT||this._caps.textureFloatLinearFiltering?m!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?m!==g.FLOAT||this._caps.textureFloatRender?m!==g.HALF_FLOAT||this._caps.colorBufferFloat||(h=!1,u.Y.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(h=!1,u.Y.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(h=!1,c=1,u.Y.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(h=!1,c=1,u.Y.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const y=i,M=y;p.width=y,p.height=M,p.invertY=l,p._compression=d;if(!this.needPOTTextures||(0,_.lP)(p.width)&&(0,_.lP)(p.height)||(h=!1),t)this.updateRawCubeTexture(p,t,r,o,l,d);else{const t=this._getRGBABufferInternalSizedFormat(o),i=0;this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,p,!0);for(let r=0;r<6;r++)d?g.compressedTexImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+r,i,this.getCaps().s3tc[d],p.width,p.height,0,void 0):g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+r,i,t,p.width,p.height,0,T,m,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,p,!0),t&&h&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const b=this._getSamplingParameters(c,h);return g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MAG_FILTER,b.mag),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MIN_FILTER,b.min),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,null),p.generateMipMaps=h,p.samplingMode=c,p.isReady=!0,p},h.ThinEngine.prototype.updateRawCubeTexture=function(t,i,r,a,o,h=null,l=0){t._bufferViewArray=i,t.format=r,t.type=a,t.invertY=o,t._compression=h;const c=this._gl,u=this._getWebGLTextureType(a);let d=this._getInternalFormat(r);const g=this._getRGBABufferInternalSizedFormat(a);let p=!1;d===c.RGB&&(d=c.RGBA,p=!0),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,t,!0),this._unpackFlipY(void 0===o||!!o),t.width%4!=0&&c.pixelStorei(c.UNPACK_ALIGNMENT,1);for(let r=0;r<6;r++){let o=i[r];h?c.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+r,l,this.getCaps().s3tc[h],t.width,t.height,0,o):(p&&(o=_convertRGBtoRGBATextureData(o,t.width,t.height,a)),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+r,l,g,t.width,t.height,0,d,u,o))}(!this.needPOTTextures||(0,_.lP)(t.width)&&(0,_.lP)(t.height))&&t.generateMipMaps&&0===l&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),t.isReady=!0},h.ThinEngine.prototype.createRawCubeTextureFromUrl=function(t,i,r,a,o,h,l,c,u=null,d=null,_=3,g=!1){const p=this._gl,m=this.createRawCubeTexture(null,r,a,o,!h,g,_,null);i?.addPendingData(m),m.url=t,m.isReady=!1,this._internalTexturesCache.push(m);const internalCallback=t=>{if(!m._hardwareTexture)return;const r=m.width,h=l(t);if(h){if(c){const t=this._getWebGLTextureType(o);let i=this._getInternalFormat(a);const l=this._getRGBABufferInternalSizedFormat(o);let u=!1;i===p.RGB&&(i=p.RGBA,u=!0),this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,m,!0),this._unpackFlipY(!1);const d=c(h);for(let a=0;a<d.length;a++){const h=r>>a;for(let r=0;r<6;r++){let c=d[a][r];u&&(c=_convertRGBtoRGBATextureData(c,h,h,o)),p.texImage2D(r,a,l,h,h,0,i,t,c)}}this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(m,h,a,o,g);m.isReady=!0,i?.removePendingData(m),m.onLoadedObservable.notifyObservers(m),m.onLoadedObservable.clear(),u&&u()}};return this._loadFile(t,t=>{internalCallback(t)},void 0,i?.offlineProvider,!0,(t,r)=>{i?.removePendingData(m),d&&t&&d(t.status+" "+t.statusText,r)}),m},h.ThinEngine.prototype.createRawTexture2DArray=_makeCreateRawTextureFunction(!1),h.ThinEngine.prototype.createRawTexture3D=_makeCreateRawTextureFunction(!0),h.ThinEngine.prototype.updateRawTexture2DArray=_makeUpdateRawTextureFunction(!1),h.ThinEngine.prototype.updateRawTexture3D=_makeUpdateRawTextureFunction(!0);var g=r(6443);h.ThinEngine.prototype._readTexturePixelsSync=function(t,i,r,a=-1,o=0,h=null,l=!0,c=!1,u=0,d=0){const _=this._gl;if(!_)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const t=_.createFramebuffer();if(!t)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=t}_.bindFramebuffer(_.FRAMEBUFFER,this._dummyFramebuffer),a>-1?_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+a,t._hardwareTexture?.underlyingResource,o):_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,t._hardwareTexture?.underlyingResource,o);let p=void 0!==t.type?this._getWebGLTextureType(t.type):_.UNSIGNED_BYTE;if(c)h||(h=(0,g.A8)(t.type,4*i*r));else if(p===_.UNSIGNED_BYTE)h||(h=new Uint8Array(4*i*r)),p=_.UNSIGNED_BYTE;else h||(h=new Float32Array(4*i*r)),p=_.FLOAT;return l&&this.flushFramebuffer(),_.readPixels(u,d,i,r,_.RGBA,p,h),_.bindFramebuffer(_.FRAMEBUFFER,this._currentFramebuffer),h},h.ThinEngine.prototype._readTexturePixels=function(t,i,r,a=-1,o=0,h=null,l=!0,c=!1,u=0,d=0){return Promise.resolve(this._readTexturePixelsSync(t,i,r,a,o,h,l,c,u,d))},h.ThinEngine.prototype.updateDynamicIndexBuffer=function(t,i,r=0){let a;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(t),a=t.is32Bits?i instanceof Uint32Array?i:new Uint32Array(i):i instanceof Uint16Array?i:new Uint16Array(i),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,a,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},h.ThinEngine.prototype.updateDynamicVertexBuffer=function(t,i,r,a){this.bindArrayBuffer(t),void 0===r&&(r=0);const o=i.byteLength||i.length;void 0===a||a>=o&&0===r?i instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(i)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,i):i instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(i).subarray(0,a/4)):(i=i instanceof ArrayBuffer?new Uint8Array(i,0,a):new Uint8Array(i.buffer,i.byteOffset,a),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,i)),this._resetVertexBufferBinding()},h.ThinEngine.prototype._createDepthStencilCubeTexture=function(t,i){const r=new a.l(this,12);if(r.isCube=!0,1===this.webGLVersion)return u.Y.Error("Depth cube texture is not supported by WebGL 1."),r;const o={"bilinearFiltering":!1,"comparisonFunction":0,"generateStencil":!1,...i},h=this._gl;this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,r,!0),this._setupDepthStencilTexture(r,t,o.bilinearFiltering,o.comparisonFunction);for(let i=0;i<6;i++)o.generateStencil?h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,h.DEPTH24_STENCIL8,t,t,0,h.DEPTH_STENCIL,h.UNSIGNED_INT_24_8,null):h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,h.DEPTH_COMPONENT24,t,t,0,h.DEPTH_COMPONENT,h.UNSIGNED_INT,null);return this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(r),r},h.ThinEngine.prototype._setCubeMapTextureParams=function(t,i,r){const a=this._gl;a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,i?a.LINEAR_MIPMAP_LINEAR:a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),t.samplingMode=i?3:2,i&&this.getCaps().textureMaxLevel&&void 0!==r&&r>0&&(a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAX_LEVEL,r),t._maxLodLevel=r),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null)},h.ThinEngine.prototype.createCubeTexture=function(t,i,r,a,o=null,h=null,l,c=null,d=!1,g=0,p=0,m=null,T,y=!1,M=null){const b=this._gl;return this.createCubeTextureBase(t,i,r,!!a,o,h,l,c,d,g,p,m,t=>this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,t,!0),(t,i)=>{const r=this.needPOTTextures?(0,_.p7)(i[0].width,this._caps.maxCubemapTextureSize):i[0].width,h=r,c=[b.TEXTURE_CUBE_MAP_POSITIVE_X,b.TEXTURE_CUBE_MAP_POSITIVE_Y,b.TEXTURE_CUBE_MAP_POSITIVE_Z,b.TEXTURE_CUBE_MAP_NEGATIVE_X,b.TEXTURE_CUBE_MAP_NEGATIVE_Y,b.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,t,!0),this._unpackFlipY(!1);const d=l?this._getInternalFormat(l,t._useSRGBBuffer):t._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:b.RGBA;let g=l?this._getInternalFormat(l):b.RGBA;t._useSRGBBuffer&&1===this.webGLVersion&&(g=d);for(let t=0;t<c.length;t++)if(i[t].width!==r||i[t].height!==h){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void u.Y.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=r,this._workingCanvas.height=h,this._workingContext.drawImage(i[t],0,0,i[t].width,i[t].height,0,0,r,h),b.texImage2D(c[t],0,d,g,b.UNSIGNED_BYTE,this._workingCanvas)}else b.texImage2D(c[t],0,d,g,b.UNSIGNED_BYTE,i[t]);a||b.generateMipmap(b.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(t,!a),t.width=r,t.height=h,t.isReady=!0,l&&(t.format=l),t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),o&&o()},!!y,M)},h.ThinEngine.prototype.generateMipMapsForCubemap=function(t,i=!0){if(t.generateMipMaps){const r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,t,!0),r.generateMipmap(r.TEXTURE_CUBE_MAP),i&&this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)}};var p=r(2628);class RenderTargetWrapper{get"depthStencilTexture"(){return this._depthStencilTexture}"setDepthStencilTexture"(t,i=!0){i&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=t,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,t&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,p.QF)(t.format))}get"depthStencilTextureWithStencil"(){return this._depthStencilTextureWithStencil}get"isCube"(){return this._isCube}get"isMulti"(){return this._isMulti}get"is2DArray"(){return this.layers>0}get"is3D"(){return this.depth>0}get"size"(){return this.width}get"width"(){return this._size.width??this._size}get"height"(){return this._size.height??this._size}get"layers"(){return this._size.layers||0}get"depth"(){return this._size.depth||0}get"texture"(){return this._textures?.[0]??null}get"textures"(){return this._textures}get"faceIndices"(){return this._faceIndices}get"layerIndices"(){return this._layerIndices}"getBaseArrayLayer"(t){if(!this._textures)return-1;const i=this._textures[t],r=this._layerIndices?.[t]??0,a=this._faceIndices?.[t]??0;return i.isCube?6*r+a:i.is3D?0:r}get"samples"(){return this._samples}"setSamples"(t,i=!0,r=!1){if(this.samples===t&&!r)return t;const a=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,t,i):this._engine.updateRenderTargetTextureSampleCount(this,t);return this._samples=t,a}"resolveMSAATextures"(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}"generateMipMaps"(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}"constructor"(t,i,r,a,o){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=t,this._isCube=i,this._size=r,this._engine=a,this._depthStencilTexture=null,this.label=o}"setTextures"(t){Array.isArray(t)?this._textures=t:this._textures=t?[t]:null}"setTexture"(t,i=0,r=!0){this._textures||(this._textures=[]),this._textures[i]!==t&&(this._textures[i]&&r&&this._textures[i].dispose(),this._textures[i]=t)}"setLayerAndFaceIndices"(t,i){this._layerIndices=t,this._faceIndices=i}"setLayerAndFaceIndex"(t=0,i,r){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==i&&i>=0&&(this._layerIndices[t]=i),void 0!==r&&r>=0&&(this._faceIndices[t]=r)}"createDepthStencilTexture"(t=0,i=!0,r=!1,a=1,o=14,h){return this._depthStencilTexture?.dispose(),this._depthStencilTextureWithStencil=r,this._depthStencilTextureLabel=h,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{"bilinearFiltering":i,"comparisonFunction":t,"generateStencil":r,"isCube":this._isCube,"samples":a,"depthTextureFormat":o,"label":h},this),this._depthStencilTexture}"_shareDepth"(t){this.shareDepth(t)}"shareDepth"(t){this._depthStencilTexture&&(t._depthStencilTexture&&t._depthStencilTexture.dispose(),t._depthStencilTexture=this._depthStencilTexture,t._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}"_swapAndDie"(t){this.texture&&this.texture._swapAndDie(t),this._textures=null,this.dispose(!0)}"_cloneRenderTargetWrapper"(){let t=null;if(this._isMulti){const i=this.textures;if(i&&i.length>0){let r=!1,a=i.length,o=-1;const h=i[i.length-1]._source;14!==h&&12!==h||(r=!0,o=i[i.length-1].format,a--);const l=[],c=[],u=[],d=[],_=[],g=[],p=[],m={};for(let t=0;t<a;++t){const r=i[t];l.push(r.samplingMode),c.push(r.type),u.push(r.format);void 0!==m[r.uniqueId]?(d.push(-1),p.push(0)):(m[r.uniqueId]=t,r.is2DArray?(d.push(35866),p.push(r.depth)):r.isCube?(d.push(34067),p.push(0)):r.is3D?(d.push(32879),p.push(r.depth)):(d.push(3553),p.push(0))),this._faceIndices&&_.push(this._faceIndices[t]??0),this._layerIndices&&g.push(this._layerIndices[t]??0)}const T={"samplingModes":l,"generateMipMaps":i[0].generateMipMaps,"generateDepthBuffer":this._generateDepthBuffer,"generateStencilBuffer":this._generateStencilBuffer,"generateDepthTexture":r,"depthTextureFormat":o,"types":c,"formats":u,"textureCount":a,"targetTypes":d,"faceIndex":_,"layerIndex":g,"layerCounts":p,"label":this.label},y={"width":this.width,"height":this.height,"depth":this.depth};t=this._engine.createMultipleRenderTarget(y,T);for(let r=0;r<a;++r){if(-1!==d[r])continue;const a=m[i[r].uniqueId];t.setTexture(t.textures[a],r)}}}else{const i={};if(i.generateDepthBuffer=this._generateDepthBuffer,i.generateMipMaps=this.texture?.generateMipMaps??!1,i.generateStencilBuffer=this._generateStencilBuffer,i.samplingMode=this.texture?.samplingMode,i.type=this.texture?.type,i.format=this.texture?.format,i.noColorAttachment=!this._textures,i.label=this.label,this.isCube)t=this._engine.createRenderTargetCubeTexture(this.width,i);else{const r={"width":this.width,"height":this.height,"layers":this.is2DArray||this.is3D?this.texture?.depth:void 0};t=this._engine.createRenderTargetTexture(r,i)}t.texture&&(t.texture.isReady=!0)}return t}"_swapRenderTargetWrapper"(t){if(this._textures&&t._textures)for(let i=0;i<this._textures.length;++i)this._textures[i]._swapAndDie(t._textures[i],!1),t._textures[i].isReady=!0;this._depthStencilTexture&&t._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(t._depthStencilTexture),t._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}"_rebuild"(){const t=this._cloneRenderTargetWrapper();if(t){if(this._depthStencilTexture){const i=this._depthStencilTexture.samplingMode,r=this._depthStencilTexture.format,a=2===i||3===i||11===i;t.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,a,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,r,this._depthStencilTextureLabel)}this.samples>1&&t.setSamples(this.samples),t._swapRenderTargetWrapper(this),t.dispose()}}"releaseTextures"(){if(this._textures)for(let t=0;t<this._textures.length;++t)this._textures[t].dispose();this._textures=null}"dispose"(t=!1){t||(this._depthStencilTexture?.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}}class WebGLRenderTargetWrapper extends RenderTargetWrapper{"setDepthStencilTexture"(t,i=!0){if(super.setDepthStencilTexture(t,i),!t)return;const r=this._engine,a=this._context,o=t._hardwareTexture;if(o&&t._autoMSAAManagement&&this._MSAAFramebuffer){const i=r._currentFramebuffer;r._bindUnboundFramebuffer(this._MSAAFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,(0,p.QF)(t.format)?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,a.RENDERBUFFER,o.getMSAARenderBuffer()),r._bindUnboundFramebuffer(i)}}"constructor"(t,i,r,a,o){super(t,i,r,a),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=o}"_cloneRenderTargetWrapper"(){let t=null;return this._colorTextureArray&&this._depthStencilTextureArray?(t=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),t.texture.isReady=!0):t=super._cloneRenderTargetWrapper(),t}"_swapRenderTargetWrapper"(t){super._swapRenderTargetWrapper(t),t._framebuffer=this._framebuffer,t._depthStencilBuffer=this._depthStencilBuffer,t._MSAAFramebuffer=this._MSAAFramebuffer,t._colorTextureArray=this._colorTextureArray,t._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}"createDepthStencilTexture"(t=0,i=!0,r=!1,a=1,o=14,h){if(this._depthStencilBuffer){const t=this._engine,i=t._currentFramebuffer,r=this._context;t._bindUnboundFramebuffer(this._framebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,null),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,null),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,null),t._bindUnboundFramebuffer(i),r.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(t,i,r,a,o,h)}"shareDepth"(t){super.shareDepth(t);const i=this._context,r=this._depthStencilBuffer,a=t._MSAAFramebuffer||t._framebuffer,o=this._engine;t._depthStencilBuffer&&t._depthStencilBuffer!==r&&i.deleteRenderbuffer(t._depthStencilBuffer),t._depthStencilBuffer=r;const h=t._generateStencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;o._bindUnboundFramebuffer(a),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,r),o._bindUnboundFramebuffer(null)}"_bindTextureRenderTarget"(t,i=0,r,a=0){const o=t._hardwareTexture;if(!o)return;const h=this._framebuffer,l=this._engine,c=l._currentFramebuffer;let u;if(l._bindUnboundFramebuffer(h),l.webGLVersion>1){const h=this._context;u=h["COLOR_ATTACHMENT"+i],t.is2DArray||t.is3D?(r=r??this.layerIndices?.[i]??0,h.framebufferTextureLayer(h.FRAMEBUFFER,u,o.underlyingResource,a,r)):t.isCube?(r=r??this.faceIndices?.[i]??0,h.framebufferTexture2D(h.FRAMEBUFFER,u,h.TEXTURE_CUBE_MAP_POSITIVE_X+r,o.underlyingResource,a)):h.framebufferTexture2D(h.FRAMEBUFFER,u,h.TEXTURE_2D,o.underlyingResource,a)}else{const t=this._context;u=t["COLOR_ATTACHMENT"+i+"_WEBGL"];const h=void 0!==r?t.TEXTURE_CUBE_MAP_POSITIVE_X+r:t.TEXTURE_2D;t.framebufferTexture2D(t.FRAMEBUFFER,u,h,o.underlyingResource,a)}if(t._autoMSAAManagement&&this._MSAAFramebuffer){const t=this._context;l._bindUnboundFramebuffer(this._MSAAFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,u,t.RENDERBUFFER,o.getMSAARenderBuffer())}l._bindUnboundFramebuffer(c)}"setTexture"(t,i=0,r=!0){super.setTexture(t,i,r),this._bindTextureRenderTarget(t,i)}"setLayerAndFaceIndices"(t,i){if(super.setLayerAndFaceIndices(t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;const r=this._attachments?.length??this.textures.length;for(let t=0;t<r;t++){const i=this.textures[t];i&&(i.is2DArray||i.is3D?this._bindTextureRenderTarget(i,t,this.layerIndices[t]):i.isCube?this._bindTextureRenderTarget(i,t,this.faceIndices[t]):this._bindTextureRenderTarget(i,t))}}"setLayerAndFaceIndex"(t=0,i,r){if(super.setLayerAndFaceIndex(t,i,r),!this.textures||!this.layerIndices||!this.faceIndices)return;const a=this.textures[t];a.is2DArray||a.is3D?this._bindTextureRenderTarget(this.textures[t],t,this.layerIndices[t]):a.isCube&&this._bindTextureRenderTarget(this.textures[t],t,this.faceIndices[t])}"resolveMSAATextures"(){const t=this._engine,i=t._currentFramebuffer;t._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),t._bindUnboundFramebuffer(i)}"dispose"(t=this._disposeOnlyFramebuffers){const i=this._context;t||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(i.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(i.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(i.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(t)}}var m=r(9204);m.a.prototype.createDepthStencilTexture=function(t,i,r){if(i.isCube){const r=t.width||t;return this._createDepthStencilCubeTexture(r,i)}return this._createDepthStencilTexture(t,i,r)},h.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(t,i,r){const a=new WebGLRenderTargetWrapper(t,i,r,this,this._gl);return this._renderTargetWrapperCache.push(a),a},h.ThinEngine.prototype.createRenderTargetTexture=function(t,i){const r=this._createHardwareRenderTargetWrapper(!1,!1,t);let a,o,h=!0,l=!1,c=!1,u=1;void 0!==i&&"object"==typeof i&&(h=i.generateDepthBuffer??!0,l=!!i.generateStencilBuffer,c=!!i.noColorAttachment,a=i.colorAttachment,u=i.samples??1,o=i.label);const d=a||(c?null:this._createInternalTexture(t,i,!0,5)),_=t.width||t,g=t.height||t,p=this._currentFramebuffer,m=this._gl,T=m.createFramebuffer();if(this._bindUnboundFramebuffer(T),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(l,h,_,g),!d||d.is2DArray||d.is3D||m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,d._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(p),r.label=o??"RenderTargetWrapper",r._framebuffer=T,r._generateDepthBuffer=h,r._generateStencilBuffer=l,r.setTextures(d),a){if(r._samples=a.samples,a.samples>1){const t=a._hardwareTexture.getMSAARenderBuffer(0);r._MSAAFramebuffer=m.createFramebuffer(),this._bindUnboundFramebuffer(r._MSAAFramebuffer),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.RENDERBUFFER,t),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(r,u);return r},h.ThinEngine.prototype._createDepthStencilTexture=function(t,i,r){const o=this._gl,h=t.layers||0,l=t.depth||0;let c=o.TEXTURE_2D;0!==h?c=o.TEXTURE_2D_ARRAY:0!==l&&(c=o.TEXTURE_3D);const d=new a.l(this,12);if(d.label=i.label,!this._caps.depthTextureExtension)return u.Y.Error("Depth texture is not supported by your browser or hardware."),d;const _={"bilinearFiltering":!1,"comparisonFunction":0,"generateStencil":!1,...i};if(this._bindTextureDirectly(c,d,!0),this._setupDepthStencilTexture(d,t,0!==_.comparisonFunction&&_.bilinearFiltering,_.comparisonFunction,_.samples),void 0!==_.depthTextureFormat){if(15!==_.depthTextureFormat&&16!==_.depthTextureFormat&&17!==_.depthTextureFormat&&13!==_.depthTextureFormat&&14!==_.depthTextureFormat&&18!==_.depthTextureFormat)return u.Y.Error(`Depth texture ${_.depthTextureFormat} format is not supported.`),d;d.format=_.depthTextureFormat}else d.format=_.generateStencil?13:16;const g=(0,p.QF)(d.format),m=this._getWebGLTextureTypeFromDepthTextureFormat(d.format),T=g?o.DEPTH_STENCIL:o.DEPTH_COMPONENT,y=this._getInternalFormatFromDepthTextureFormat(d.format,!0,g);return d.is2DArray?o.texImage3D(c,0,y,d.width,d.height,h,0,T,m,null):d.is3D?o.texImage3D(c,0,y,d.width,d.height,l,0,T,m,null):o.texImage2D(c,0,y,d.width,d.height,0,T,m,null),this._bindTextureDirectly(c,null),this._internalTexturesCache.push(d),r._depthStencilBuffer&&(o.deleteRenderbuffer(r._depthStencilBuffer),r._depthStencilBuffer=null),this._bindUnboundFramebuffer(r._MSAAFramebuffer??r._framebuffer),r._generateStencilBuffer=g,r._depthStencilTextureWithStencil=g,r._depthStencilBuffer=this._setupFramebufferDepthAttachments(r._generateStencilBuffer,r._generateDepthBuffer,r.width,r.height,r.samples,d.format),this._bindUnboundFramebuffer(null),d},h.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(t,i){if(this.webGLVersion<2||!t)return 1;if(t.samples===i)return i;const r=this._gl;i=Math.min(i,this.getCaps().maxMSAASamples),t._depthStencilBuffer&&(r.deleteRenderbuffer(t._depthStencilBuffer),t._depthStencilBuffer=null),t._MSAAFramebuffer&&(r.deleteFramebuffer(t._MSAAFramebuffer),t._MSAAFramebuffer=null);const a=t.texture?._hardwareTexture;if(a?.releaseMSAARenderBuffers(),t.texture&&i>1&&"function"==typeof r.renderbufferStorageMultisample){const o=r.createFramebuffer();if(!o)throw new Error("Unable to create multi sampled framebuffer");t._MSAAFramebuffer=o,this._bindUnboundFramebuffer(t._MSAAFramebuffer);const h=this._createRenderBuffer(t.texture.width,t.texture.height,i,-1,this._getRGBABufferInternalSizedFormat(t.texture.type,t.texture.format,t.texture._useSRGBBuffer),r.COLOR_ATTACHMENT0,!1);if(!h)throw new Error("Unable to create multi sampled framebuffer");a?.addMSAARenderBuffer(h)}this._bindUnboundFramebuffer(t._MSAAFramebuffer??t._framebuffer),t.texture&&(t.texture.samples=i),t._samples=i;const o=t._depthStencilTexture?t._depthStencilTexture.format:void 0;return t._depthStencilBuffer=this._setupFramebufferDepthAttachments(t._generateStencilBuffer,t._generateDepthBuffer,t.width,t.height,i,o),this._bindUnboundFramebuffer(null),i},h.ThinEngine.prototype._setupDepthStencilTexture=function(t,i,r,a,o=1){const h=i.width??i,l=i.height??i,c=i.layers||0,u=i.depth||0;t.baseWidth=h,t.baseHeight=l,t.width=h,t.height=l,t.is2DArray=c>0,t.depth=c||u,t.isReady=!0,t.samples=o,t.generateMipMaps=!1,t.samplingMode=r?2:1,t.type=0,t._comparisonFunction=a;const d=this._gl,_=this._getTextureTarget(t),g=this._getSamplingParameters(t.samplingMode,!1);d.texParameteri(_,d.TEXTURE_MAG_FILTER,g.mag),d.texParameteri(_,d.TEXTURE_MIN_FILTER,g.min),d.texParameteri(_,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(_,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===a?(d.texParameteri(_,d.TEXTURE_COMPARE_FUNC,515),d.texParameteri(_,d.TEXTURE_COMPARE_MODE,d.NONE)):(d.texParameteri(_,d.TEXTURE_COMPARE_FUNC,a),d.texParameteri(_,d.TEXTURE_COMPARE_MODE,d.COMPARE_REF_TO_TEXTURE)))},h.ThinEngine.prototype.setDepthStencilTexture=function(t,i,r,a){void 0!==t&&(i&&(this._boundUniforms[t]=i),r&&r.depthStencilTexture?this._setTexture(t,r,!1,!0,a):this._setTexture(t,null,void 0,void 0,a))},h.ThinEngine.prototype.createRenderTargetCubeTexture=function(t,i){const r=this._createHardwareRenderTargetWrapper(!1,!0,t),o={"generateMipMaps":!0,"generateDepthBuffer":!0,"generateStencilBuffer":!1,"type":0,"samplingMode":3,"format":5,...i};o.generateStencilBuffer=o.generateDepthBuffer&&o.generateStencilBuffer,(1!==o.type||this._caps.textureFloatLinearFiltering)&&(2!==o.type||this._caps.textureHalfFloatLinearFiltering)||(o.samplingMode=1);const h=this._gl,l=new a.l(this,5);this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,l,!0);const c=this._getSamplingParameters(o.samplingMode,o.generateMipMaps);1!==o.type||this._caps.textureFloat||(o.type=0,u.Y.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,c.mag),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,c.min),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);for(let i=0;i<6;i++)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,this._getRGBABufferInternalSizedFormat(o.type,o.format),t,t,0,this._getInternalFormat(o.format),this._getWebGLTextureType(o.type),null);const d=h.createFramebuffer();return this._bindUnboundFramebuffer(d),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(o.generateStencilBuffer,o.generateDepthBuffer,t,t),o.generateMipMaps&&h.generateMipmap(h.TEXTURE_CUBE_MAP),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),r._framebuffer=d,r._generateDepthBuffer=o.generateDepthBuffer,r._generateStencilBuffer=o.generateStencilBuffer,l.width=t,l.height=t,l.isReady=!0,l.isCube=!0,l.samples=1,l.generateMipMaps=o.generateMipMaps,l.samplingMode=o.samplingMode,l.type=o.type,l.format=o.format,this._internalTexturesCache.push(l),r.setTextures(l),r};var T=r(6298),y=r(7728);h.ThinEngine.prototype.createPrefilteredCubeTexture=function(t,i,o,h,l=null,c=null,d,_=null,g=!0){return this.createCubeTexture(t,i,null,!1,async t=>{if(!t)return void(l&&l(null));const c=t.texture;if(g?t.info.sphericalPolynomial&&(c._sphericalPolynomial=t.info.sphericalPolynomial):c._sphericalPolynomial=new T.i,c._source=9,this.getCaps().textureLOD)return void(l&&l(c));const d=this._gl,_=t.width;if(!_)return;const{"DDSTools":p}=await r.e(895).then(r.bind(r,895)),m=[];for(let r=0;r<3;r++){const l=1-r/2,g=h,T=Math.log2(_)*o+h,M=g+(T-g)*l,b=Math.round(Math.min(Math.max(M,0),T)),x=new a.l(this,2);if(x.type=c.type,x.format=c.format,x.width=Math.pow(2,Math.max(Math.log2(_)-b,0)),x.height=x.width,x.isCube=!0,x._cachedWrapU=0,x._cachedWrapV=0,this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,x,!0),x.samplingMode=2,d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),t.isDDS){const i=t.info,r=t.data;this._unpackFlipY(i.isCompressed),p.UploadDDSLevels(this,x,r,i,!0,6,b)}else u.Y.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null);const E=new y.V(i);E._isCube=!0,E._texture=x,x.isReady=!0,m.push(E)}c._lodTextureHigh=m[2],c._lodTextureMid=m[1],c._lodTextureLow=m[0],l&&l(c)},c,d,_,g,o,h)},h.ThinEngine.prototype.createUniformBuffer=function(t,i){const r=this._gl.createBuffer();if(!r)throw new Error("Unable to create uniform buffer");const a=new c.M(r);return this.bindUniformBuffer(a),t instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,t,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(t),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),a.references=1,a},h.ThinEngine.prototype.createDynamicUniformBuffer=function(t,i){const r=this._gl.createBuffer();if(!r)throw new Error("Unable to create dynamic uniform buffer");const a=new c.M(r);return this.bindUniformBuffer(a),t instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,t,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(t),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),a.references=1,a},h.ThinEngine.prototype.updateUniformBuffer=function(t,i,r,a){this.bindUniformBuffer(t),void 0===r&&(r=0),void 0===a?i instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,i):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,new Float32Array(i)):i instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,i.subarray(r,r+a)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(i).subarray(r,r+a)),this.bindUniformBuffer(null)},h.ThinEngine.prototype.bindUniformBuffer=function(t){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,t?t.underlyingResource:null)},h.ThinEngine.prototype.bindUniformBufferBase=function(t,i,r){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,i,t?t.underlyingResource:null)},h.ThinEngine.prototype.bindUniformBlock=function(t,i,r){const a=t.program,o=this._gl.getUniformBlockIndex(a,i);4294967295!==o&&this._gl.uniformBlockBinding(a,o,r)};var M=r(1102);function RequestPointerlock(t){if(t.requestPointerLock){const i=t.requestPointerLock();i instanceof Promise?i.then(()=>{t.focus()}).catch(()=>{}):t.focus()}}m.a.prototype.displayLoadingUI=function(){if(!(0,M.CG)())return;const t=this.loadingScreen;t&&t.displayLoadingUI()},m.a.prototype.hideLoadingUI=function(){if(!(0,M.CG)())return;const t=this._loadingScreen;t&&t.hideLoadingUI()},Object.defineProperty(m.a.prototype,"loadingScreen",{"get":function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=m.a.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},"set":function(t){this._loadingScreen=t},"enumerable":!0,"configurable":!0}),Object.defineProperty(m.a.prototype,"loadingUIText",{"set":function(t){this.loadingScreen.loadingUIText=t},"enumerable":!0,"configurable":!0}),Object.defineProperty(m.a.prototype,"loadingUIBackgroundColor",{"set":function(t){this.loadingScreen.loadingUIBackgroundColor=t},"enumerable":!0,"configurable":!0}),m.a.prototype.getInputElement=function(){return this._renderingCanvas},m.a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},m.a.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},m.a.prototype.getAspectRatio=function(t,i=!1){const r=t.viewport;return this.getRenderWidth(i)*r.width/(this.getRenderHeight(i)*r.height)},m.a.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},m.a.prototype._verifyPointerLock=function(){this._onPointerLockChange?.()},m.a.prototype.setAlphaEquation=function(t){if(this._alphaEquation!==t){switch(t){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=t}},m.a.prototype.getInputElement=function(){return this._renderingCanvas},m.a.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},m.a.prototype.setDepthFunction=function(t){this._depthCullingState.depthFunc=t},m.a.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},m.a.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},m.a.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},m.a.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},m.a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},m.a.prototype.setDepthWrite=function(t){this._depthCullingState.depthMask=t},m.a.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},m.a.prototype.setStencilBuffer=function(t){this._stencilState.stencilTest=t},m.a.prototype.getStencilMask=function(){return this._stencilState.stencilMask},m.a.prototype.setStencilMask=function(t){this._stencilState.stencilMask=t},m.a.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},m.a.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},m.a.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},m.a.prototype.setStencilFunction=function(t){this._stencilState.stencilFunc=t},m.a.prototype.setStencilFunctionReference=function(t){this._stencilState.stencilFuncRef=t},m.a.prototype.setStencilFunctionMask=function(t){this._stencilState.stencilFuncMask=t},m.a.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},m.a.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},m.a.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},m.a.prototype.setStencilOperationFail=function(t){this._stencilState.stencilOpStencilFail=t},m.a.prototype.setStencilOperationDepthFail=function(t){this._stencilState.stencilOpDepthFail=t},m.a.prototype.setStencilOperationPass=function(t){this._stencilState.stencilOpStencilDepthPass=t},m.a.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},m.a.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},m.a.prototype.setAlphaConstants=function(t,i,r,a){this._alphaState.setAlphaBlendConstants(t,i,r,a)},m.a.prototype.getAlphaMode=function(){return this._alphaMode},m.a.prototype.getAlphaEquation=function(){return this._alphaEquation},m.a.prototype.getRenderPassNames=function(){return this._renderPassNames},m.a.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},m.a.prototype.createRenderPassId=function(t){const i=++m.a._RenderPassIdCounter;return this._renderPassNames[i]=t??"NONAME",i},m.a.prototype.releaseRenderPassId=function(t){this._renderPassNames[t]=void 0;for(let i=0;i<this.scenes.length;++i){const r=this.scenes[i];for(let i=0;i<r.meshes.length;++i){const a=r.meshes[i];if(a.subMeshes)for(let i=0;i<a.subMeshes.length;++i){a.subMeshes[i]._removeDrawWrapper(t)}}}};var b=r(8482),x=r(9447);class Engine extends h.ThinEngine{static get"NpmPackage"(){return m.a.NpmPackage}static get"Version"(){return m.a.Version}static get"Instances"(){return o.l.Instances}static get"LastCreatedEngine"(){return o.l.LastCreatedEngine}static get"LastCreatedScene"(){return o.l.LastCreatedScene}static"DefaultLoadingScreenFactory"(t){return m.a.DefaultLoadingScreenFactory(t)}get"_supportsHardwareTextureRescaling"(){return!!Engine._RescalePostProcessFactory}"_measureFps"(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get"performanceMonitor"(){return this._performanceMonitor}"constructor"(t,i,r,a=!1){super(t,i,r,a),this.customAnimationFrameRequester=null,this._performanceMonitor=new PerformanceMonitor,this._drawCalls=new b.z,t&&(this._features.supportRenderPasses=!0,r=this._creationOptions)}"_initGLContext"(){super._initGLContext(),this._rescalePostProcess=null}"_sharedInit"(t){super._sharedInit(t),function _CommonInit(t,i,r){t._onCanvasFocus=()=>{t.onCanvasFocusObservable.notifyObservers(t)},t._onCanvasBlur=()=>{t.onCanvasBlurObservable.notifyObservers(t)},t._onCanvasContextMenu=i=>{t.disableContextMenu&&i.preventDefault()},i.addEventListener("focus",t._onCanvasFocus),i.addEventListener("blur",t._onCanvasBlur),i.addEventListener("contextmenu",t._onCanvasContextMenu),t._onBlur=()=>{t.disablePerformanceMonitorInBackground&&t.performanceMonitor.disable(),t._windowIsBackground=!0},t._onFocus=()=>{t.disablePerformanceMonitorInBackground&&t.performanceMonitor.enable(),t._windowIsBackground=!1},t._onCanvasPointerOut=r=>{document.elementFromPoint(r.clientX,r.clientY)!==i&&t.onCanvasPointerOutObservable.notifyObservers(r)};const a=t.getHostWindow();a&&"function"==typeof a.addEventListener&&(a.addEventListener("blur",t._onBlur),a.addEventListener("focus",t._onFocus)),i.addEventListener("pointerout",t._onCanvasPointerOut),r.doNotHandleTouchAction||function _DisableTouchAction(t){t&&t.setAttribute&&(t.setAttribute("touch-action","none"),t.style.touchAction="none",t.style.webkitTapHighlightColor="transparent")}(i),!m.a.audioEngine&&r.audioEngine&&m.a.AudioEngineFactory&&(m.a.audioEngine=m.a.AudioEngineFactory(t.getRenderingCanvas(),t.getAudioContext(),t.getAudioDestination())),(0,M.n5)()&&(t._onFullscreenChange=()=>{t.isFullscreen=!!document.fullscreenElement,t.isFullscreen&&t._pointerLockRequested&&i&&RequestPointerlock(i)},document.addEventListener("fullscreenchange",t._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",t._onFullscreenChange,!1),t._onPointerLockChange=()=>{t.isPointerLock=document.pointerLockElement===i},document.addEventListener("pointerlockchange",t._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",t._onPointerLockChange,!1)),t.enableOfflineSupport=void 0!==m.a.OfflineProviderFactory,t._deterministicLockstep=!!r.deterministicLockstep,t._lockstepMaxSteps=r.lockstepMaxSteps||0,t._timeStep=r.timeStep||1/60}(this,t,this._creationOptions)}"resizeImageBitmap"(t,i,r){return function ResizeImageBitmap(t,i,r,a){const o=t.createCanvas(r,a).getContext("2d");if(!o)throw new Error("Unable to get 2d context for resizeImageBitmap");return o.drawImage(i,0,0),o.getImageData(0,0,r,a).data}(this,t,i,r)}"_createImageBitmapFromSource"(t,i){return function CreateImageBitmapFromSource(t,i,r){return new Promise((a,o)=>{const h=new Image;h.onload=()=>{h.decode().then(()=>{t.createImageBitmap(h,r).then(t=>{a(t)})})},h.onerror=()=>{o(`Error loading image ${h.src}`)},h.src=i})}(this,t,i)}"switchFullscreen"(t){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(t)}"enterFullscreen"(t){this.isFullscreen||(this._pointerLockRequested=t,this._renderingCanvas&&function RequestFullscreen(t){const i=t.requestFullscreen||t.webkitRequestFullscreen;i&&i.call(t)}(this._renderingCanvas))}"exitFullscreen"(){this.isFullscreen&&function ExitFullscreen(){const t=document;document.exitFullscreen?document.exitFullscreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()}()}"setDitheringState"(t){t?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}"setRasterizerState"(t){t?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}"setDirectViewport"(t,i,r,a){const o=this._cachedViewport;return this._cachedViewport=null,this._viewport(t,i,r,a),o}"scissorClear"(t,i,r,a,o){this.enableScissor(t,i,r,a),this.clear(o,!0,!0,!0),this.disableScissor()}"enableScissor"(t,i,r,a){const o=this._gl;o.enable(o.SCISSOR_TEST),o.scissor(t,i,r,a)}"disableScissor"(){const t=this._gl;t.disable(t.SCISSOR_TEST)}"_loadFileAsync"(t,i,r){return new Promise((a,o)=>{this._loadFile(t,t=>{a(t)},void 0,i,r,(t,i)=>{o(i)})})}"getVertexShaderSource"(t){const i=this._gl.getAttachedShaders(t);return i?this._gl.getShaderSource(i[0]):null}"getFragmentShaderSource"(t){const i=this._gl.getAttachedShaders(t);return i?this._gl.getShaderSource(i[1]):null}set"framebufferDimensionsObject"(t){this._framebufferDimensionsObject=t,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}"_rebuildBuffers"(){for(const t of this.scenes)t.resetCachedMaterial(),t._rebuildGeometries();for(const t of this._virtualScenes)t.resetCachedMaterial(),t._rebuildGeometries();super._rebuildBuffers()}"getFontOffset"(t){return function GetFontOffset(t){const i=document.createElement("span");i.textContent="Hg",i.style.font=t;const r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";const a=document.createElement("div");a.style.whiteSpace="nowrap",a.appendChild(i),a.appendChild(r),document.body.appendChild(a);let o=0,h=0;try{h=r.getBoundingClientRect().top-i.getBoundingClientRect().top,r.style.verticalAlign="baseline",o=r.getBoundingClientRect().top-i.getBoundingClientRect().top}finally{document.body.removeChild(a)}return{"ascent":o,"height":h,"descent":h-o}}(t)}"_cancelFrame"(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{"cancelAnimationFrame":t}=this.customAnimationFrameRequester;t&&t(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}"_renderLoop"(t){this._processFrame(t),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}"enterPointerlock"(){this._renderingCanvas&&RequestPointerlock(this._renderingCanvas)}"exitPointerlock"(){!function ExitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}()}"beginFrame"(){this._measureFps(),super.beginFrame()}"_deletePipelineContext"(t){const i=t;i&&i.program&&i.transformFeedback&&(this.deleteTransformFeedback(i.transformFeedback),i.transformFeedback=null),super._deletePipelineContext(t)}"createShaderProgram"(t,i,r,a,o,h=null){o=o||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const l=super.createShaderProgram(t,i,r,a,o,h);return this.onAfterShaderCompilationObservable.notifyObservers(this),l}"_createShaderProgram"(t,i,r,a,o=null){const h=a.createProgram();if(t.program=h,!h)throw new Error("Unable to create program");if(a.attachShader(h,i),a.attachShader(h,r),this.webGLVersion>1&&o){const i=this.createTransformFeedback();this.bindTransformFeedback(i),this.setTranformFeedbackVaryings(h,o),t.transformFeedback=i}return a.linkProgram(h),this.webGLVersion>1&&o&&this.bindTransformFeedback(null),t.context=a,t.vertexShader=i,t.fragmentShader=r,t.isParallelCompiled||this._finalizePipelineContext(t),h}"_releaseTexture"(t){super._releaseTexture(t)}"_releaseRenderTargetWrapper"(t){super._releaseRenderTargetWrapper(t),this.scenes.forEach(i=>{i.postProcesses.forEach(i=>{i._outputTexture===t&&(i._outputTexture=null)}),i.cameras.forEach(i=>{i._postProcesses.forEach(i=>{i&&i._outputTexture===t&&(i._outputTexture=null)})})})}"_rescaleTexture"(t,i,r,a,o){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const h=this.createRenderTargetTexture({"width":i.width,"height":i.height},{"generateMipMaps":!1,"type":0,"samplingMode":2,"generateDepthBuffer":!1,"generateStencilBuffer":!1});if(!this._rescalePostProcess&&Engine._RescalePostProcessFactory&&(this._rescalePostProcess=Engine._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const onCompiled=()=>{this._rescalePostProcess.onApply=function(i){i._bindTexture("textureSampler",t)};let l=r;l||(l=this.scenes[this.scenes.length-1]),l.postProcessManager.directRender([this._rescalePostProcess],h,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,a,0,0,i.width,i.height,0),this.unBindFramebuffer(h),h.dispose(),o&&o()},l=this._rescalePostProcess.getEffect();l?l.executeWhenCompiled(onCompiled):this._rescalePostProcess.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(onCompiled)})}}"wrapWebGLTexture"(t,i=!1,r=3,o=0,h=0){const l=new d.B(t,this._gl),c=new a.l(this,0,!0);return c._hardwareTexture=l,c.baseWidth=o,c.baseHeight=h,c.width=o,c.height=h,c.isReady=!0,c.useMipMaps=i,this.updateTextureSamplingMode(r,c),c}"_uploadImageToTexture"(t,i,r=0,a=0){const o=this._gl,h=this._getWebGLTextureType(t.type),l=this._getInternalFormat(t.format),c=this._getRGBABufferInternalSizedFormat(t.type,l),u=t.isCube?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D;this._bindTextureDirectly(u,t,!0),this._unpackFlipY(t.invertY);let d=o.TEXTURE_2D;t.isCube&&(d=o.TEXTURE_CUBE_MAP_POSITIVE_X+r),o.texImage2D(d,a,c,l,h,i),this._bindTextureDirectly(u,null,!0)}"updateTextureComparisonFunction"(t,i){if(1===this.webGLVersion)return void u.Y.Error("WebGL 1 does not support texture comparison.");const r=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),0===i?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,i),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),0===i?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=i}"createInstancesBuffer"(t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create instance buffer");const r=new c.M(i);return r.capacity=t,this.bindArrayBuffer(r),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.DYNAMIC_DRAW),r.references=1,r}"deleteInstancesBuffer"(t){this._gl.deleteBuffer(t)}"_clientWaitAsync"(t,i=0,r=10){const a=this._gl;return new Promise((o,h)=>{(0,x.r)(()=>{const r=a.clientWaitSync(t,i,0);if(r==a.WAIT_FAILED)throw new Error("clientWaitSync failed");return r!=a.TIMEOUT_EXPIRED},o,h,r)})}"_readPixelsAsync"(t,i,r,a,o,h,l){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const c=this._gl,u=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,u),c.bufferData(c.PIXEL_PACK_BUFFER,l.byteLength,c.STREAM_READ),c.readPixels(t,i,r,a,o,h,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const d=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);return d?(c.flush(),this._clientWaitAsync(d,0,10).then(()=>(c.deleteSync(d),c.bindBuffer(c.PIXEL_PACK_BUFFER,u),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteBuffer(u),l))):null}"dispose"(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function _CommonDispose(t,i){1===o.l.Instances.length&&m.a.audioEngine&&(m.a.audioEngine.dispose(),m.a.audioEngine=null);const r=t.getHostWindow();r&&"function"==typeof r.removeEventListener&&(r.removeEventListener("blur",t._onBlur),r.removeEventListener("focus",t._onFocus)),i&&(i.removeEventListener("focus",t._onCanvasFocus),i.removeEventListener("blur",t._onCanvasBlur),i.removeEventListener("pointerout",t._onCanvasPointerOut),i.removeEventListener("contextmenu",t._onCanvasContextMenu)),(0,M.n5)()&&(document.removeEventListener("fullscreenchange",t._onFullscreenChange),document.removeEventListener("mozfullscreenchange",t._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",t._onFullscreenChange),document.removeEventListener("msfullscreenchange",t._onFullscreenChange),document.removeEventListener("pointerlockchange",t._onPointerLockChange),document.removeEventListener("mspointerlockchange",t._onPointerLockChange),document.removeEventListener("mozpointerlockchange",t._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",t._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}Engine.ALPHA_DISABLE=0,Engine.ALPHA_ADD=1,Engine.ALPHA_COMBINE=2,Engine.ALPHA_SUBTRACT=3,Engine.ALPHA_MULTIPLY=4,Engine.ALPHA_MAXIMIZED=5,Engine.ALPHA_ONEONE=6,Engine.ALPHA_PREMULTIPLIED=7,Engine.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Engine.ALPHA_INTERPOLATE=9,Engine.ALPHA_SCREENMODE=10,Engine.DELAYLOADSTATE_NONE=0,Engine.DELAYLOADSTATE_LOADED=1,Engine.DELAYLOADSTATE_LOADING=2,Engine.DELAYLOADSTATE_NOTLOADED=4,Engine.NEVER=512,Engine.ALWAYS=519,Engine.LESS=513,Engine.EQUAL=514,Engine.LEQUAL=515,Engine.GREATER=516,Engine.GEQUAL=518,Engine.NOTEQUAL=517,Engine.KEEP=7680,Engine.REPLACE=7681,Engine.INCR=7682,Engine.DECR=7683,Engine.INVERT=5386,Engine.INCR_WRAP=34055,Engine.DECR_WRAP=34056,Engine.TEXTURE_CLAMP_ADDRESSMODE=0,Engine.TEXTURE_WRAP_ADDRESSMODE=1,Engine.TEXTURE_MIRROR_ADDRESSMODE=2,Engine.TEXTUREFORMAT_ALPHA=0,Engine.TEXTUREFORMAT_LUMINANCE=1,Engine.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Engine.TEXTUREFORMAT_RGB=4,Engine.TEXTUREFORMAT_RGBA=5,Engine.TEXTUREFORMAT_RED=6,Engine.TEXTUREFORMAT_R=6,Engine.TEXTUREFORMAT_R16_UNORM=33322,Engine.TEXTUREFORMAT_RG16_UNORM=33324,Engine.TEXTUREFORMAT_RGB16_UNORM=32852,Engine.TEXTUREFORMAT_RGBA16_UNORM=32859,Engine.TEXTUREFORMAT_R16_SNORM=36760,Engine.TEXTUREFORMAT_RG16_SNORM=36761,Engine.TEXTUREFORMAT_RGB16_SNORM=36762,Engine.TEXTUREFORMAT_RGBA16_SNORM=36763,Engine.TEXTUREFORMAT_RG=7,Engine.TEXTUREFORMAT_RED_INTEGER=8,Engine.TEXTUREFORMAT_R_INTEGER=8,Engine.TEXTUREFORMAT_RG_INTEGER=9,Engine.TEXTUREFORMAT_RGB_INTEGER=10,Engine.TEXTUREFORMAT_RGBA_INTEGER=11,Engine.TEXTURETYPE_UNSIGNED_BYTE=0,Engine.TEXTURETYPE_UNSIGNED_INT=0,Engine.TEXTURETYPE_FLOAT=1,Engine.TEXTURETYPE_HALF_FLOAT=2,Engine.TEXTURETYPE_BYTE=3,Engine.TEXTURETYPE_SHORT=4,Engine.TEXTURETYPE_UNSIGNED_SHORT=5,Engine.TEXTURETYPE_INT=6,Engine.TEXTURETYPE_UNSIGNED_INTEGER=7,Engine.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Engine.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Engine.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Engine.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Engine.TEXTURETYPE_UNSIGNED_INT_24_8=12,Engine.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Engine.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Engine.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Engine.TEXTURE_NEAREST_SAMPLINGMODE=1,Engine.TEXTURE_BILINEAR_SAMPLINGMODE=2,Engine.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Engine.TEXTURE_NEAREST_LINEAR=7,Engine.TEXTURE_NEAREST_NEAREST=1,Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Engine.TEXTURE_LINEAR_LINEAR=2,Engine.TEXTURE_LINEAR_NEAREST=12,Engine.TEXTURE_EXPLICIT_MODE=0,Engine.TEXTURE_SPHERICAL_MODE=1,Engine.TEXTURE_PLANAR_MODE=2,Engine.TEXTURE_CUBIC_MODE=3,Engine.TEXTURE_PROJECTION_MODE=4,Engine.TEXTURE_SKYBOX_MODE=5,Engine.TEXTURE_INVCUBIC_MODE=6,Engine.TEXTURE_EQUIRECTANGULAR_MODE=7,Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Engine.SCALEMODE_FLOOR=1,Engine.SCALEMODE_NEAREST=2,Engine.SCALEMODE_CEILING=3},"5953":function(t,i,r){r.d(i,{"l":function(){return EngineStore}});var a=r(8139);class EngineStore{static get"LastCreatedEngine"(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get"LastCreatedScene"(){return this._LastCreatedScene}}EngineStore.Instances=[],EngineStore.OnEnginesDisposedObservable=new a.y$,EngineStore._LastCreatedScene=null,EngineStore.UseFallbackTexture=!0,EngineStore.FallbackTexture=""},"1716":function(t,i,r){r.d(i,{"Z":function(){return PerformanceConfigurator}});class PerformanceConfigurator{static"SetMatrixPrecision"(t){if(PerformanceConfigurator.MatrixTrackPrecisionChange=!1,t&&!PerformanceConfigurator.MatrixUse64Bits&&PerformanceConfigurator.MatrixTrackedMatrices)for(let t=0;t<PerformanceConfigurator.MatrixTrackedMatrices.length;++t){const i=PerformanceConfigurator.MatrixTrackedMatrices[t],r=i._m;i._m=new Array(16);for(let t=0;t<16;++t)i._m[t]=r[t]}PerformanceConfigurator.MatrixUse64Bits=t,PerformanceConfigurator.MatrixCurrentType=PerformanceConfigurator.MatrixUse64Bits?Array:Float32Array,PerformanceConfigurator.MatrixTrackedMatrices=null}}PerformanceConfigurator.MatrixUse64Bits=!1,PerformanceConfigurator.MatrixTrackPrecisionChange=!0,PerformanceConfigurator.MatrixCurrentType=Float32Array,PerformanceConfigurator.MatrixTrackedMatrices=[]},"1206":function(t,i,r){r.d(i,{"v":function(){return ShaderStore}});class ShaderStore{static"GetShadersRepository"(t=0){return 0===t?ShaderStore.ShadersRepository:ShaderStore.ShadersRepositoryWGSL}static"GetShadersStore"(t=0){return 0===t?ShaderStore.ShadersStore:ShaderStore.ShadersStoreWGSL}static"GetIncludesShadersStore"(t=0){return 0===t?ShaderStore.IncludesShadersStore:ShaderStore.IncludesShadersStoreWGSL}}ShaderStore.ShadersRepository="src/Shaders/",ShaderStore.ShadersStore={},ShaderStore.IncludesShadersStore={},ShaderStore.ShadersRepositoryWGSL="src/ShadersWGSL/",ShaderStore.ShadersStoreWGSL={},ShaderStore.IncludesShadersStoreWGSL={}},"7625":function(t,i,r){r.d(i,{"s5":function(){return _createShaderProgram},"PR":function(){return _executeWhenRenderingStateIsCompiled},"HN":function(){return _finalizePipelineContext},"gt":function(){return _isRenderingStateCompiled},"KG":function(){return _preparePipelineContext},"Q":function(){return _setProgram},"H6":function(){return createPipelineContext},"AM":function(){return createRawShaderProgram},"tQ":function(){return createShaderProgram},"tY":function(){return deleteStateObject},"iU":function(){return getStateObject}});class WebGLPipelineContext{"constructor"(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get"isAsync"(){return this.isParallelCompiled}get"isReady"(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}"_handlesSpectorRebuildCallback"(t){t&&this.program&&t(this.program)}"setEngine"(t){this.engine=t}"_fillEffectInformation"(t,i,r,a,o,h,l,c){const u=this.engine;if(u.supportsUniformBuffers)for(const r in i)t.bindUniformBlock(r,i[r]);let d;for(this.engine.getUniforms(this,r).forEach((t,i)=>{a[r[i]]=t}),this._uniforms=a,d=0;d<o.length;d++){null==t.getUniform(o[d])&&(o.splice(d,1),d--)}o.forEach((t,i)=>{h[t]=i});for(const t of u.getAttributes(this,l))c.push(t)}"dispose"(){this._uniforms={},this._isDisposed=!0}"_cacheMatrix"(t,i){const r=this._valueCache[t],a=i.updateFlag;return(void 0===r||r!==a)&&(this._valueCache[t]=a,!0)}"_cacheFloat2"(t,i,r){let a=this._valueCache[t];if(!a||2!==a.length)return a=[i,r],this._valueCache[t]=a,!0;let o=!1;return a[0]!==i&&(a[0]=i,o=!0),a[1]!==r&&(a[1]=r,o=!0),o}"_cacheFloat3"(t,i,r,a){let o=this._valueCache[t];if(!o||3!==o.length)return o=[i,r,a],this._valueCache[t]=o,!0;let h=!1;return o[0]!==i&&(o[0]=i,h=!0),o[1]!==r&&(o[1]=r,h=!0),o[2]!==a&&(o[2]=a,h=!0),h}"_cacheFloat4"(t,i,r,a,o){let h=this._valueCache[t];if(!h||4!==h.length)return h=[i,r,a,o],this._valueCache[t]=h,!0;let l=!1;return h[0]!==i&&(h[0]=i,l=!0),h[1]!==r&&(h[1]=r,l=!0),h[2]!==a&&(h[2]=a,l=!0),h[3]!==o&&(h[3]=o,l=!0),l}"setInt"(t,i){const r=this._valueCache[t];void 0!==r&&r===i||this.engine.setInt(this._uniforms[t],i)&&(this._valueCache[t]=i)}"setInt2"(t,i,r){this._cacheFloat2(t,i,r)&&(this.engine.setInt2(this._uniforms[t],i,r)||(this._valueCache[t]=null))}"setInt3"(t,i,r,a){this._cacheFloat3(t,i,r,a)&&(this.engine.setInt3(this._uniforms[t],i,r,a)||(this._valueCache[t]=null))}"setInt4"(t,i,r,a,o){this._cacheFloat4(t,i,r,a,o)&&(this.engine.setInt4(this._uniforms[t],i,r,a,o)||(this._valueCache[t]=null))}"setIntArray"(t,i){this._valueCache[t]=null,this.engine.setIntArray(this._uniforms[t],i)}"setIntArray2"(t,i){this._valueCache[t]=null,this.engine.setIntArray2(this._uniforms[t],i)}"setIntArray3"(t,i){this._valueCache[t]=null,this.engine.setIntArray3(this._uniforms[t],i)}"setIntArray4"(t,i){this._valueCache[t]=null,this.engine.setIntArray4(this._uniforms[t],i)}"setUInt"(t,i){const r=this._valueCache[t];void 0!==r&&r===i||this.engine.setUInt(this._uniforms[t],i)&&(this._valueCache[t]=i)}"setUInt2"(t,i,r){this._cacheFloat2(t,i,r)&&(this.engine.setUInt2(this._uniforms[t],i,r)||(this._valueCache[t]=null))}"setUInt3"(t,i,r,a){this._cacheFloat3(t,i,r,a)&&(this.engine.setUInt3(this._uniforms[t],i,r,a)||(this._valueCache[t]=null))}"setUInt4"(t,i,r,a,o){this._cacheFloat4(t,i,r,a,o)&&(this.engine.setUInt4(this._uniforms[t],i,r,a,o)||(this._valueCache[t]=null))}"setUIntArray"(t,i){this._valueCache[t]=null,this.engine.setUIntArray(this._uniforms[t],i)}"setUIntArray2"(t,i){this._valueCache[t]=null,this.engine.setUIntArray2(this._uniforms[t],i)}"setUIntArray3"(t,i){this._valueCache[t]=null,this.engine.setUIntArray3(this._uniforms[t],i)}"setUIntArray4"(t,i){this._valueCache[t]=null,this.engine.setUIntArray4(this._uniforms[t],i)}"setArray"(t,i){this._valueCache[t]=null,this.engine.setArray(this._uniforms[t],i)}"setArray2"(t,i){this._valueCache[t]=null,this.engine.setArray2(this._uniforms[t],i)}"setArray3"(t,i){this._valueCache[t]=null,this.engine.setArray3(this._uniforms[t],i)}"setArray4"(t,i){this._valueCache[t]=null,this.engine.setArray4(this._uniforms[t],i)}"setMatrices"(t,i){i&&(this._valueCache[t]=null,this.engine.setMatrices(this._uniforms[t],i))}"setMatrix"(t,i){this._cacheMatrix(t,i)&&(this.engine.setMatrices(this._uniforms[t],i.asArray())||(this._valueCache[t]=null))}"setMatrix3x3"(t,i){this._valueCache[t]=null,this.engine.setMatrix3x3(this._uniforms[t],i)}"setMatrix2x2"(t,i){this._valueCache[t]=null,this.engine.setMatrix2x2(this._uniforms[t],i)}"setFloat"(t,i){const r=this._valueCache[t];void 0!==r&&r===i||this.engine.setFloat(this._uniforms[t],i)&&(this._valueCache[t]=i)}"setVector2"(t,i){this._cacheFloat2(t,i.x,i.y)&&(this.engine.setFloat2(this._uniforms[t],i.x,i.y)||(this._valueCache[t]=null))}"setFloat2"(t,i,r){this._cacheFloat2(t,i,r)&&(this.engine.setFloat2(this._uniforms[t],i,r)||(this._valueCache[t]=null))}"setVector3"(t,i){this._cacheFloat3(t,i.x,i.y,i.z)&&(this.engine.setFloat3(this._uniforms[t],i.x,i.y,i.z)||(this._valueCache[t]=null))}"setFloat3"(t,i,r,a){this._cacheFloat3(t,i,r,a)&&(this.engine.setFloat3(this._uniforms[t],i,r,a)||(this._valueCache[t]=null))}"setVector4"(t,i){this._cacheFloat4(t,i.x,i.y,i.z,i.w)&&(this.engine.setFloat4(this._uniforms[t],i.x,i.y,i.z,i.w)||(this._valueCache[t]=null))}"setQuaternion"(t,i){this._cacheFloat4(t,i.x,i.y,i.z,i.w)&&(this.engine.setFloat4(this._uniforms[t],i.x,i.y,i.z,i.w)||(this._valueCache[t]=null))}"setFloat4"(t,i,r,a,o){this._cacheFloat4(t,i,r,a,o)&&(this.engine.setFloat4(this._uniforms[t],i,r,a,o)||(this._valueCache[t]=null))}"setColor3"(t,i){this._cacheFloat3(t,i.r,i.g,i.b)&&(this.engine.setFloat3(this._uniforms[t],i.r,i.g,i.b)||(this._valueCache[t]=null))}"setColor4"(t,i,r){this._cacheFloat4(t,i.r,i.g,i.b,r)&&(this.engine.setFloat4(this._uniforms[t],i.r,i.g,i.b,r)||(this._valueCache[t]=null))}"setDirectColor4"(t,i){this._cacheFloat4(t,i.r,i.g,i.b,i.a)&&(this.engine.setFloat4(this._uniforms[t],i.r,i.g,i.b,i.a)||(this._valueCache[t]=null))}"_getVertexShaderCode"(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}"_getFragmentShaderCode"(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}var a=r(6443);const o=new WeakMap,h={"_webGLVersion":2,"cachedPipelines":{}};function getStateObject(t){let i=o.get(t);if(!i){if(!t)return h;i={"_webGLVersion":t.TEXTURE_BINDING_3D?2:1,"_context":t,"parallelShaderCompile":t.getExtension("KHR_parallel_shader_compile")||void 0,"cachedPipelines":{}},o.set(t,i)}return i}function deleteStateObject(t){o.delete(t)}function createRawShaderProgram(t,i,r,a,o,h){const l=getStateObject(a);h||(h=l._createShaderProgramInjection??_createShaderProgram);return h(t,_compileRawShader(i,"vertex",a,l._contextWasLost),_compileRawShader(r,"fragment",a,l._contextWasLost),a,o,l.validateShaderPrograms)}function createShaderProgram(t,i,r,a,o,h=null,l){const c=getStateObject(o);l||(l=c._createShaderProgramInjection??_createShaderProgram);const u=c._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return l(t,_compileShader(i,"vertex",a,u,o,c._contextWasLost),_compileShader(r,"fragment",a,u,o,c._contextWasLost),o,h,c.validateShaderPrograms)}function createPipelineContext(t,i){const r=new WebGLPipelineContext,a=getStateObject(t);return a.parallelShaderCompile&&!a.disableParallelShaderCompile&&(r.isParallelCompiled=!0),r.context=a._context,r}function _createShaderProgram(t,i,r,a,o=null,h){const l=a.createProgram();if(t.program=l,!l)throw new Error("Unable to create program");return a.attachShader(l,i),a.attachShader(l,r),a.linkProgram(l),t.context=a,t.vertexShader=i,t.fragmentShader=r,t.isParallelCompiled||_finalizePipelineContext(t,a,h),l}function _isRenderingStateCompiled(t,i,r){const a=t;if(a._isDisposed)return!1;const o=getStateObject(i);return!!(o&&o.parallelShaderCompile&&o.parallelShaderCompile.COMPLETION_STATUS_KHR&&a.program&&i.getProgramParameter(a.program,o.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(_finalizePipelineContext(a,i,r),!0)}function _finalizePipelineContext(t,i,r){const a=t.context,o=t.vertexShader,h=t.fragmentShader,l=t.program;if(!a.getProgramParameter(l,a.LINK_STATUS)){if(!i.getShaderParameter(o,i.COMPILE_STATUS)){const r=i.getShaderInfoLog(o);if(r)throw t.vertexCompilationError=r,new Error("VERTEX SHADER "+r)}if(!i.getShaderParameter(h,i.COMPILE_STATUS)){const r=i.getShaderInfoLog(h);if(r)throw t.fragmentCompilationError=r,new Error("FRAGMENT SHADER "+r)}const r=a.getProgramInfoLog(l);if(r)throw t.programLinkError=r,new Error(r)}if(r){a.validateProgram(l);if(!a.getProgramParameter(l,a.VALIDATE_STATUS)){const i=a.getProgramInfoLog(l);if(i)throw t.programValidationError=i,new Error(i)}}a.deleteShader(o),a.deleteShader(h),t.vertexShader=void 0,t.fragmentShader=void 0,t.onCompiled&&(t.onCompiled(),t.onCompiled=void 0)}function _preparePipelineContext(t,i,r,a,o,h,l,c,u,d="",_,g,p){const m=getStateObject(t.context);g||(g=m.createRawShaderProgramInjection??createRawShaderProgram),p||(p=m.createShaderProgramInjection??createShaderProgram);const T=t;T.program=a?g(T,i,r,T.context,u):p(T,i,r,c,T.context,u),T.program.__SPECTOR_rebuildProgram=l,_()}function _compileShader(t,i,r,o,h,l){return _compileRawShader((0,a.Gb)(t,r,o),i,h,l)}function _compileRawShader(t,i,r,a){const o=r.createShader("vertex"===i?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!o){let t=r.NO_ERROR,o=r.NO_ERROR;for(;(o=r.getError())!==r.NO_ERROR;)t=o;throw new Error(`Something went wrong while creating a gl ${i} shader object. gl error=${t}, gl isContextLost=${r.isContextLost()}, _contextWasLost=${a}`)}return r.shaderSource(o,t),r.compileShader(o),o}function _setProgram(t,i){i.useProgram(t)}function _executeWhenRenderingStateIsCompiled(t,i){const r=t;if(!r.isParallelCompiled)return void i(t);const a=r.onCompiled;r.onCompiled=()=>{a?.(),i(t)}}},"5459":function(t,i,r){r.r(i),r.d(i,{"ThinEngine":function(){return ThinEngine}});var a=r(7625);var o=r(658),h=r(1102);class WebGLShaderProcessor{"constructor"(){this.shaderLanguage=0}"postProcessor"(t,i,r,a,o){if(o.drawBuffersExtensionDisabled){const i=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;t=t.replace(i,"")}return t}}const l=/(flat\s)?\s*varying\s*.*/;class WebGL2ShaderProcessor{"constructor"(){this.shaderLanguage=0}"attributeProcessor"(t){return t.replace("attribute","in")}"varyingCheck"(t,i){return l.test(t)}"varyingProcessor"(t,i){return t.replace("varying",i?"in":"out")}"postProcessor"(t,i,r){const a=-1!==t.search(/#extension.+GL_EXT_draw_buffers.+require/);if(t=(t=t.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r){const i=-1!==t.search(/layout *\(location *= *0\) *out/g);t=(t=(t=(t=(t=(t=(t=t.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(a||i?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==i.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+t}return t}}var c=r(4081),u=r(5336),d=r(9204),_=r(8449),g=r(3369),p=r(4442),m=r(6443),T=r(5881),y=r(2628);class BufferPointer{}class ThinEngine extends d.a{get"name"(){return this._name}set"name"(t){this._name=t}get"version"(){return this._webGLVersion}static get"ShadersRepository"(){return p.Q.ShadersRepository}static set"ShadersRepository"(t){p.Q.ShadersRepository=t}get"supportsUniformBuffers"(){return this.webGLVersion>1&&!this.disableUniformBuffers}get"needPOTTextures"(){return this._webGLVersion<2||this.forcePOTTextures}get"_supportsHardwareTextureRescaling"(){return!1}set"framebufferDimensionsObject"(t){this._framebufferDimensionsObject=t}"snapshotRenderingReset"(){this.snapshotRendering=!1}"constructor"(t,i,r,h){if(r=r||{},super(i??r.antialias,r,h),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!t)return;let l=null;if(t.getContext){if(l=t,void 0===r.preserveDrawingBuffer&&(r.preserveDrawingBuffer=!1),void 0===r.xrCompatible&&(r.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const t=navigator.userAgent;for(const i of ThinEngine.ExceptionList){const a=i.key,o=i.targets;if(new RegExp(a).test(t)){if(i.capture&&i.captureConstraint){const r=i.capture,a=i.captureConstraint,o=new RegExp(r).exec(t);if(o&&o.length>0){if(parseInt(o[o.length-1])>=a)continue}}for(const t of o)switch(t){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":r.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,a.tY)(this._gl)}:(this._onContextLost=t=>{t.preventDefault(),this._contextWasLost=!0,(0,a.tY)(this._gl),o.Y.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost(()=>this._initGLContext())},l.addEventListener("webglcontextrestored",this._onContextRestored,!1),r.powerPreference=r.powerPreference||"high-performance"),l.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(r.xrCompatible=!1),!r.disableWebGL2Support)try{this._gl=l.getContext("webgl2",r)||l.getContext("experimental-webgl2",r),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(t){}if(!this._gl){if(!l)throw new Error("The provided canvas is null or undefined.");try{this._gl=l.getContext("webgl",r)||l.getContext("experimental-webgl",r)}catch(t){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,l=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const i=this._gl.getContextAttributes();i&&(r.stencil=i.stencil)}this._sharedInit(l),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==r.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=r.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let t=0;t<this._caps.maxVertexAttribs;t++)this._currentBufferPointers[t]=new BufferPointer;this._shaderProcessor=this.webGLVersion>1?new WebGL2ShaderProcessor:new WebGLShaderProcessor;const c=`Babylon.js v${ThinEngine.Version}`;o.Y.Log(c+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",c);const u=(0,a.iU)(this._gl);u.validateShaderPrograms=this.validateShaderPrograms,u.parallelShaderCompile=this._caps.parallelShaderCompile}"_clearEmptyResources"(){this._dummyFramebuffer=null,super._clearEmptyResources()}"_getShaderProcessingContext"(t){return null}"areAllEffectsReady"(){for(const t in this._compiledEffects){if(!this._compiledEffects[t].isReady())return!1}return!0}"_initGLContext"(){this._caps={"maxTexturesImageUnits":this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),"maxCombinedTexturesImageUnits":this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),"maxVertexTextureImageUnits":this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),"maxTextureSize":this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),"maxSamples":this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,"maxCubemapTextureSize":this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),"maxRenderTextureSize":this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),"maxVertexAttribs":this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),"maxVaryingVectors":this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),"maxFragmentUniformVectors":this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),"maxVertexUniformVectors":this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),"parallelShaderCompile":this._gl.getExtension("KHR_parallel_shader_compile")||void 0,"standardDerivatives":this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),"maxAnisotropy":1,"astc":this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),"bptc":this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),"s3tc":this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),"s3tc_srgb":this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),"pvrtc":this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),"etc1":this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),"etc2":this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),"textureAnisotropicFilterExtension":this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),"uintIndices":this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),"fragmentDepthSupported":this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),"highPrecisionShaderSupported":!1,"timerQuery":this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),"supportOcclusionQuery":this._webGLVersion>1,"canUseTimestampForTimerQuery":!1,"drawBuffersExtension":!1,"maxMSAASamples":1,"colorBufferFloat":!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),"supportFloatTexturesResolve":!1,"rg11b10ufColorRenderable":!1,"colorBufferHalfFloat":!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),"textureFloat":!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),"textureHalfFloat":!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),"textureHalfFloatRender":!1,"textureFloatLinearFiltering":!1,"textureFloatRender":!1,"textureHalfFloatLinearFiltering":!1,"vertexArrayObject":!1,"instancedArrays":!1,"textureLOD":!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),"texelFetch":1!==this._webGLVersion,"blendMinMax":!1,"multiview":this._gl.getExtension("OVR_multiview2"),"oculusMultiview":this._gl.getExtension("OCULUS_multiview"),"depthTextureExtension":!1,"canUseGLInstanceID":this._webGLVersion>1,"canUseGLVertexID":this._webGLVersion>1,"supportComputeShaders":!1,"supportSRGBBuffers":!1,"supportTransformFeedbacks":this._webGLVersion>1,"textureMaxLevel":this._webGLVersion>1,"texture2DArrayMaxLayerCount":this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,"disableMorphTargetTexture":!1,"textureNorm16":!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const t=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=t&&(this._glRenderer=this._gl.getParameter(t.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(t.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._caps.maxDrawBuffers=this._gl.getParameter(t.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const t=this._gl.getExtension("WEBGL_depth_texture");null!=t&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=t.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const t=this._gl.getExtension("OES_vertex_array_object");null!=t&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=t.createVertexArrayOES.bind(t),this._gl.bindVertexArray=t.bindVertexArrayOES.bind(t),this._gl.deleteVertexArray=t.deleteVertexArrayOES.bind(t))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const t=this._gl.getExtension("ANGLE_instanced_arrays");null!=t?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=t.drawArraysInstancedANGLE.bind(t),this._gl.drawElementsInstanced=t.drawElementsInstancedANGLE.bind(t),this._gl.vertexAttribDivisor=t.vertexAttribDivisorANGLE.bind(t)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const t=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),i=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);t&&i&&(this._caps.highPrecisionShaderSupported=0!==t.precision&&0!==i.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const t=this._gl.getExtension("EXT_blend_minmax");null!=t&&(this._caps.blendMinMax=!0,this._gl.MAX=t.MAX_EXT,this._gl.MIN=t.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={"SRGB":WebGL2RenderingContext.SRGB,"SRGB8":WebGL2RenderingContext.SRGB8,"SRGB8_ALPHA8":WebGL2RenderingContext.SRGB8_ALPHA8};else{const t=this._gl.getExtension("EXT_sRGB");null!=t&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={"SRGB":t.SRGB_EXT,"SRGB8":t.SRGB_ALPHA_EXT,"SRGB8_ALPHA8":t.SRGB_ALPHA_EXT})}if(this._creationOptions){const t=this._creationOptions.forceSRGBBufferSupportState;void 0!==t&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&t)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let t=0;t<this._maxSimultaneousTextures;t++)this._nextFreeTextureSlots.push(t);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}"_initFeatures"(){this._features={"forceBitmapOverHTMLImageElement":"undefined"==typeof HTMLImageElement,"supportRenderAndCopyToLodForFloatTextures":1!==this._webGLVersion,"supportDepthStencilTexture":1!==this._webGLVersion,"supportShadowSamplers":1!==this._webGLVersion,"uniformBufferHardCheckMatrix":!1,"allowTexturePrefiltering":1!==this._webGLVersion,"trackUbosInFrame":!1,"checkUbosContentBeforeUpload":!1,"supportCSM":1!==this._webGLVersion,"basisNeedsPOT":1===this._webGLVersion,"support3DTextures":1!==this._webGLVersion,"needTypeSuffixInShaderConstants":1!==this._webGLVersion,"supportMSAA":1!==this._webGLVersion,"supportSSAO2":1!==this._webGLVersion,"supportIBLShadows":1!==this._webGLVersion,"supportExtendedTextureFormats":1!==this._webGLVersion,"supportSwitchCaseInShader":1!==this._webGLVersion,"supportSyncTextureRead":!0,"needsInvertingBitmap":!0,"useUBOBindingCache":!0,"needShaderCodeInlining":!1,"needToAlwaysBindUniformBuffers":!1,"supportRenderPasses":!1,"supportSpriteInstancing":!0,"forceVertexBufferStrideAndOffsetMultiple4Bytes":!1,"_checkNonFloatVertexBuffersDontRecreatePipelineContext":!1,"_collectUbosUpdatedInFrame":!1}}get"webGLVersion"(){return this._webGLVersion}"getClassName"(){return"ThinEngine"}"_prepareWorkingCanvas"(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const t=this._workingCanvas.getContext("2d");t&&(this._workingContext=t)}"getInfo"(){return this.getGlInfo()}"getGlInfo"(){return{"vendor":this._glVendor,"renderer":this._glRenderer,"version":this._glVersion}}"extractDriverInfo"(){const t=this.getGlInfo();return t&&t.renderer?t.renderer:""}"getRenderWidth"(t=!1){return!t&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}"getRenderHeight"(t=!1){return!t&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}"clear"(t,i,r,a=!1){const o=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=o;let h=0;if(i&&t){let i=!0;if(this._currentRenderTarget){const r=this._currentRenderTarget.texture?.format;if(8===r||9===r||10===r||11===r){const r=this._currentRenderTarget.texture?.type;7===r||5===r?(ThinEngine._TempClearColorUint32[0]=255*t.r,ThinEngine._TempClearColorUint32[1]=255*t.g,ThinEngine._TempClearColorUint32[2]=255*t.b,ThinEngine._TempClearColorUint32[3]=255*t.a,this._gl.clearBufferuiv(this._gl.COLOR,0,ThinEngine._TempClearColorUint32),i=!1):(ThinEngine._TempClearColorInt32[0]=255*t.r,ThinEngine._TempClearColorInt32[1]=255*t.g,ThinEngine._TempClearColorInt32[2]=255*t.b,ThinEngine._TempClearColorInt32[3]=255*t.a,this._gl.clearBufferiv(this._gl.COLOR,0,ThinEngine._TempClearColorInt32),i=!1)}}i&&(this._gl.clearColor(t.r,t.g,t.b,void 0!==t.a?t.a:1),h|=this._gl.COLOR_BUFFER_BIT)}r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),h|=this._gl.DEPTH_BUFFER_BIT),a&&(this._gl.clearStencil(0),h|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(h)}"_viewport"(t,i,r,a){t===this._viewportCached.x&&i===this._viewportCached.y&&r===this._viewportCached.z&&a===this._viewportCached.w||(this._viewportCached.x=t,this._viewportCached.y=i,this._viewportCached.z=r,this._viewportCached.w=a,this._gl.viewport(t,i,r,a))}"endFrame"(){super.endFrame(),this._badOS&&this.flushFramebuffer()}get"performanceMonitor"(){throw new Error("Not Supported by ThinEngine")}"bindFramebuffer"(t,i=0,r,a,h,l=0,c=0){const u=t;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=t,this._bindUnboundFramebuffer(u._framebuffer);const d=this._gl;t.isMulti||(t.is2DArray||t.is3D?(d.framebufferTextureLayer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,t.texture._hardwareTexture?.underlyingResource,l,c),u._currentLOD=l):t.isCube?d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+i,t.texture._hardwareTexture?.underlyingResource,l):u._currentLOD!==l&&(d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,t.texture._hardwareTexture?.underlyingResource,l),u._currentLOD=l));const _=t._depthStencilTexture;if(_){t.is3D&&(t.texture.width===_.width&&t.texture.height===_.height&&t.texture.depth===_.depth||o.Y.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const r=t._depthStencilTextureWithStencil?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;t.is2DArray||t.is3D?d.framebufferTextureLayer(d.FRAMEBUFFER,r,_._hardwareTexture?.underlyingResource,l,c):t.isCube?d.framebufferTexture2D(d.FRAMEBUFFER,r,d.TEXTURE_CUBE_MAP_POSITIVE_X+i,_._hardwareTexture?.underlyingResource,l):d.framebufferTexture2D(d.FRAMEBUFFER,r,d.TEXTURE_2D,_._hardwareTexture?.underlyingResource,l)}u._MSAAFramebuffer&&this._bindUnboundFramebuffer(u._MSAAFramebuffer),this._cachedViewport&&!h?this.setViewport(this._cachedViewport,r,a):(r||(r=t.width,l&&(r/=Math.pow(2,l))),a||(a=t.height,l&&(a/=Math.pow(2,l))),this._viewport(0,0,r,a)),this.wipeCaches()}"setStateCullFaceType"(t,i){const r=this.cullBackFaces??t??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==r||i)&&(this._depthCullingState.cullFace=r)}"setState"(t,i=0,r,a=!1,o,h,l=0){(this._depthCullingState.cull!==t||r)&&(this._depthCullingState.cull=t),this.setStateCullFaceType(o,r),this.setZOffset(i),this.setZOffsetUnits(l);const c=a?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==c||r)&&(this._depthCullingState.frontFace=c),this._stencilStateComposer.stencilMaterial=h}"_bindUnboundFramebuffer"(t){this._currentFramebuffer!==t&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,t),this._currentFramebuffer=t)}"_currentFrameBufferIsDefaultFrameBuffer"(){return null===this._currentFramebuffer}"generateMipmaps"(t){const i=this._getTextureTarget(t);this._bindTextureDirectly(i,t,!0),this._gl.generateMipmap(i),this._bindTextureDirectly(i,null)}"unBindFramebuffer"(t,i=!1,r){const a=t;this._currentRenderTarget=null,a.disableAutomaticMSAAResolve||(t.isMulti?this.resolveMultiFramebuffer(t):this.resolveFramebuffer(t)),i||(t.isMulti?this.generateMipMapsMultiFramebuffer(t):this.generateMipMapsFramebuffer(t)),r&&(a._MSAAFramebuffer&&this._bindUnboundFramebuffer(a._framebuffer),r()),this._bindUnboundFramebuffer(null)}"generateMipMapsFramebuffer"(t){t.isMulti||!t.texture?.generateMipMaps||t.isCube||this.generateMipmaps(t.texture)}"resolveFramebuffer"(t){const i=t,r=this._gl;if(!i._MSAAFramebuffer||i.isMulti)return;let a=i.resolveMSAAColors?r.COLOR_BUFFER_BIT:0;a|=i._generateDepthBuffer&&i.resolveMSAADepth?r.DEPTH_BUFFER_BIT:0,a|=i._generateStencilBuffer&&i.resolveMSAAStencil?r.STENCIL_BUFFER_BIT:0,r.bindFramebuffer(r.READ_FRAMEBUFFER,i._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,i._framebuffer),r.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,a,r.NEAREST)}"flushFramebuffer"(){this._gl.flush()}"restoreDefaultFramebuffer"(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}"_resetVertexBufferBinding"(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}"createVertexBuffer"(t,i,r){return this._createVertexBuffer(t,this._gl.STATIC_DRAW)}"_createVertexBuffer"(t,i){const r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");const a=new c.M(r);return this.bindArrayBuffer(a),"number"!=typeof t?t instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(t),i),a.capacity=4*t.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,t,i),a.capacity=t.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(t),i),a.capacity=t),this._resetVertexBufferBinding(),a.references=1,a}"createDynamicVertexBuffer"(t,i){return this._createVertexBuffer(t,this._gl.DYNAMIC_DRAW)}"_resetIndexBufferBinding"(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}"createIndexBuffer"(t,i,r){const a=this._gl.createBuffer(),o=new c.M(a);if(!a)throw new Error("Unable to create index buffer");this.bindIndexBuffer(o);const h=this._normalizeIndexData(t);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,h,i?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),o.references=1,o.is32Bits=4===h.BYTES_PER_ELEMENT,o}"_normalizeIndexData"(t){if(2===t.BYTES_PER_ELEMENT)return t;if(this._caps.uintIndices){if(t instanceof Uint32Array)return t;for(let i=0;i<t.length;i++)if(t[i]>=65535)return new Uint32Array(t);return new Uint16Array(t)}return new Uint16Array(t)}"bindArrayBuffer"(t){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(t,this._gl.ARRAY_BUFFER)}"bindUniformBlock"(t,i,r){const a=t.program,o=this._gl.getUniformBlockIndex(a,i);this._gl.uniformBlockBinding(a,o,r)}"bindIndexBuffer"(t){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(t,this._gl.ELEMENT_ARRAY_BUFFER)}"_bindBuffer"(t,i){(this._vaoRecordInProgress||this._currentBoundBuffer[i]!==t)&&(this._gl.bindBuffer(i,t?t.underlyingResource:null),this._currentBoundBuffer[i]=t)}"updateArrayBuffer"(t){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)}"_vertexAttribPointer"(t,i,r,a,o,h,l){const c=this._currentBufferPointers[i];if(!c)return;let u=!1;c.active?(c.buffer!==t&&(c.buffer=t,u=!0),c.size!==r&&(c.size=r,u=!0),c.type!==a&&(c.type=a,u=!0),c.normalized!==o&&(c.normalized=o,u=!0),c.stride!==h&&(c.stride=h,u=!0),c.offset!==l&&(c.offset=l,u=!0)):(u=!0,c.active=!0,c.index=i,c.size=r,c.type=a,c.normalized=o,c.stride=h,c.offset=l,c.buffer=t),(u||this._vaoRecordInProgress)&&(this.bindArrayBuffer(t),a===this._gl.UNSIGNED_INT||a===this._gl.INT?this._gl.vertexAttribIPointer(i,r,a,h,l):this._gl.vertexAttribPointer(i,r,a,o,h,l))}"_bindIndexBufferWithCache"(t){null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this.bindIndexBuffer(t),this._uintIndicesCurrentlySet=t.is32Bits)}"_bindVertexBuffersAttributes"(t,i,r){const a=i.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let o=0;o<a.length;o++){const h=i.getAttributeLocation(o);if(h>=0){const i=a[o];let l=null;if(r&&(l=r[i]),l||(l=t[i]),!l)continue;this._gl.enableVertexAttribArray(h),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[h]=!0);const c=l.getBuffer();c&&(this._vertexAttribPointer(c,h,l.getSize(),l.type,l.normalized,l.byteStride,l.byteOffset),l.getIsInstanced()&&(this._gl.vertexAttribDivisor(h,l.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(h),this._currentInstanceBuffers.push(c))))}}}"recordVertexArrayObject"(t,i,r,a){const o=this._gl.createVertexArray();if(!o)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(o),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(t,r,a),this.bindIndexBuffer(i),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),o}"bindVertexArrayObject"(t,i){this._cachedVertexArrayObject!==t&&(this._cachedVertexArrayObject=t,this._gl.bindVertexArray(t),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=i&&i.is32Bits,this._mustWipeVertexAttributes=!0)}"bindBuffersDirectly"(t,i,r,a,o){if(this._cachedVertexBuffers!==t||this._cachedEffectForVertexBuffers!==o){this._cachedVertexBuffers=t,this._cachedEffectForVertexBuffers=o;const i=o.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let h=0;for(let l=0;l<i;l++)if(l<r.length){const i=o.getAttributeLocation(l);i>=0&&(this._gl.enableVertexAttribArray(i),this._vertexAttribArraysEnabled[i]=!0,this._vertexAttribPointer(t,i,r[l],this._gl.FLOAT,!1,a,h)),h+=4*r[l]}}this._bindIndexBufferWithCache(i)}"_unbindVertexArrayObject"(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}"bindBuffers"(t,i,r,a){this._cachedVertexBuffers===t&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=t,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(t,r,a)),this._bindIndexBufferWithCache(i)}"unbindInstanceAttributes"(){let t;for(let i=0,r=this._currentInstanceLocations.length;i<r;i++){const r=this._currentInstanceBuffers[i];t!=r&&r.references&&(t=r,this.bindArrayBuffer(r));const a=this._currentInstanceLocations[i];this._gl.vertexAttribDivisor(a,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}"releaseVertexArrayObject"(t){this._gl.deleteVertexArray(t)}"_releaseBuffer"(t){return t.references--,0===t.references&&(this._deleteBuffer(t),!0)}"_deleteBuffer"(t){this._gl.deleteBuffer(t.underlyingResource)}"updateAndBindInstancesBuffer"(t,i,r){if(this.bindArrayBuffer(t),i&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,i),void 0!==r[0].index)this.bindInstancesBuffer(t,r,!0);else for(let i=0;i<4;i++){const a=r[i];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this._vertexAttribPointer(t,a,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(t)}}"bindInstancesBuffer"(t,i,r=!0){this.bindArrayBuffer(t);let a=0;if(r)for(let t=0;t<i.length;t++){a+=4*i[t].attributeSize}for(let r=0;r<i.length;r++){const o=i[r];void 0===o.index&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),o.index<0||(this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(t,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,a,o.offset),this._gl.vertexAttribDivisor(o.index,void 0===o.divisor?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(t))}}"disableInstanceAttributeByName"(t){if(!this._currentEffect)return;const i=this._currentEffect.getAttributeLocationByName(t);this.disableInstanceAttribute(i)}"disableInstanceAttribute"(t){let i,r=!1;for(;-1!==(i=this._currentInstanceLocations.indexOf(t));)this._currentInstanceLocations.splice(i,1),this._currentInstanceBuffers.splice(i,1),r=!0,i=this._currentInstanceLocations.indexOf(t);r&&(this._gl.vertexAttribDivisor(t,0),this.disableAttributeByIndex(t))}"disableAttributeByIndex"(t){this._gl.disableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!1,this._currentBufferPointers[t].active=!1}"draw"(t,i,r,a){this.drawElementsType(t?0:1,i,r,a)}"drawPointClouds"(t,i,r){this.drawArraysType(2,t,i,r)}"drawUnIndexed"(t,i,r,a){this.drawArraysType(t?0:1,i,r,a)}"drawElementsType"(t,i,r,a){this.applyStates(),this._reportDrawCall();const o=this._drawMode(t),h=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,l=this._uintIndicesCurrentlySet?4:2;a?this._gl.drawElementsInstanced(o,r,h,i*l,a):this._gl.drawElements(o,r,h,i*l)}"drawArraysType"(t,i,r,a){this.applyStates(),this._reportDrawCall();const o=this._drawMode(t);a?this._gl.drawArraysInstanced(o,i,r,a):this._gl.drawArrays(o,i,r)}"_drawMode"(t){switch(t){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}"_releaseEffect"(t){this._compiledEffects[t._key]&&delete this._compiledEffects[t._key];const i=t.getPipelineContext();i&&this._deletePipelineContext(i)}"_deletePipelineContext"(t){const i=t;i&&i.program&&(i.program.__SPECTOR_rebuildProgram=null,(0,T.ZI)(i),this._gl&&this._gl.deleteProgram(i.program))}"_getGlobalDefines"(t){return(0,m.sk)(t,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}"createEffect"(t,i,r,o,h,l,c,u,d,_=0,g){const m="string"==typeof t?t:t.vertexToken||t.vertexSource||t.vertexElement||t.vertex,T="string"==typeof t?t:t.fragmentToken||t.fragmentSource||t.fragmentElement||t.fragment,y=this._getGlobalDefines(),M=void 0!==i.attributes;let b=h??i.defines??"";y&&(b+=y);const x=m+"+"+T+"@"+b;if(this._compiledEffects[x]){const t=this._compiledEffects[x];return c&&t.isReady()&&c(t),t._refCount++,t}this._gl&&(0,a.iU)(this._gl);const E=new p.Q(t,i,M?this:r,o,this,h,l,c,u,d,x,i.shaderLanguage??_,i.extraInitializationsAsync??g);return this._compiledEffects[x]=E,E}"_getShaderSource"(t){return this._gl.getShaderSource(t)}"createRawShaderProgram"(t,i,r,o,h=null){const l=(0,a.iU)(this._gl);return l._contextWasLost=this._contextWasLost,l.validateShaderPrograms=this.validateShaderPrograms,(0,a.AM)(t,i,r,o||this._gl,h)}"createShaderProgram"(t,i,r,o,h,l=null){const c=(0,a.iU)(this._gl);return c._contextWasLost=this._contextWasLost,c.validateShaderPrograms=this.validateShaderPrograms,(0,a.tQ)(t,i,r,o,h||this._gl,l)}"inlineShaderCode"(t){return t}"createPipelineContext"(t){if(this._gl){(0,a.iU)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const i=(0,a.H6)(this._gl,t);return i.engine=this,i}"createMaterialContext"(){}"createDrawContext"(){}"_finalizePipelineContext"(t){return(0,a.HN)(t,this._gl,this.validateShaderPrograms)}"_preparePipelineContext"(t,i,r,o,h,l,c,u,d,_,g){const p=(0,a.iU)(this._gl);return p._contextWasLost=this._contextWasLost,p.validateShaderPrograms=this.validateShaderPrograms,p._createShaderProgramInjection=this._createShaderProgram.bind(this),p.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),p.createShaderProgramInjection=this.createShaderProgram.bind(this),p.loadFileInjection=this._loadFile.bind(this),(0,a.KG)(t,i,r,o,h,l,c,u,d,_,g)}"_createShaderProgram"(t,i,r,o,h=null){return(0,a.s5)(t,i,r,o,h)}"_isRenderingStateCompiled"(t){return!this._isDisposed&&(0,a.gt)(t,this._gl,this.validateShaderPrograms)}"_executeWhenRenderingStateIsCompiled"(t,i){(0,a.PR)(t,i)}"getUniforms"(t,i){const r=new Array,a=t;for(let t=0;t<i.length;t++)r.push(this._gl.getUniformLocation(a.program,i[t]));return r}"getAttributes"(t,i){const r=[],a=t;for(let t=0;t<i.length;t++)try{r.push(this._gl.getAttribLocation(a.program,i[t]))}catch(t){r.push(-1)}return r}"enableEffect"(t){(t=null!==t&&function IsWrapper(t){return void 0===t.getPipelineContext}(t)?t.effect:t)&&t!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(t),this._currentEffect=t,t.onBind&&t.onBind(t),t._onBindObservable&&t._onBindObservable.notifyObservers(t))}"setInt"(t,i){return!!t&&(this._gl.uniform1i(t,i),!0)}"setInt2"(t,i,r){return!!t&&(this._gl.uniform2i(t,i,r),!0)}"setInt3"(t,i,r,a){return!!t&&(this._gl.uniform3i(t,i,r,a),!0)}"setInt4"(t,i,r,a,o){return!!t&&(this._gl.uniform4i(t,i,r,a,o),!0)}"setIntArray"(t,i){return!!t&&(this._gl.uniform1iv(t,i),!0)}"setIntArray2"(t,i){return!(!t||i.length%2!=0)&&(this._gl.uniform2iv(t,i),!0)}"setIntArray3"(t,i){return!(!t||i.length%3!=0)&&(this._gl.uniform3iv(t,i),!0)}"setIntArray4"(t,i){return!(!t||i.length%4!=0)&&(this._gl.uniform4iv(t,i),!0)}"setUInt"(t,i){return!!t&&(this._gl.uniform1ui(t,i),!0)}"setUInt2"(t,i,r){return!!t&&(this._gl.uniform2ui(t,i,r),!0)}"setUInt3"(t,i,r,a){return!!t&&(this._gl.uniform3ui(t,i,r,a),!0)}"setUInt4"(t,i,r,a,o){return!!t&&(this._gl.uniform4ui(t,i,r,a,o),!0)}"setUIntArray"(t,i){return!!t&&(this._gl.uniform1uiv(t,i),!0)}"setUIntArray2"(t,i){return!(!t||i.length%2!=0)&&(this._gl.uniform2uiv(t,i),!0)}"setUIntArray3"(t,i){return!(!t||i.length%3!=0)&&(this._gl.uniform3uiv(t,i),!0)}"setUIntArray4"(t,i){return!(!t||i.length%4!=0)&&(this._gl.uniform4uiv(t,i),!0)}"setArray"(t,i){return!!t&&(!(i.length<1)&&(this._gl.uniform1fv(t,i),!0))}"setArray2"(t,i){return!(!t||i.length%2!=0)&&(this._gl.uniform2fv(t,i),!0)}"setArray3"(t,i){return!(!t||i.length%3!=0)&&(this._gl.uniform3fv(t,i),!0)}"setArray4"(t,i){return!(!t||i.length%4!=0)&&(this._gl.uniform4fv(t,i),!0)}"setMatrices"(t,i){return!!t&&(this._gl.uniformMatrix4fv(t,!1,i),!0)}"setMatrix3x3"(t,i){return!!t&&(this._gl.uniformMatrix3fv(t,!1,i),!0)}"setMatrix2x2"(t,i){return!!t&&(this._gl.uniformMatrix2fv(t,!1,i),!0)}"setFloat"(t,i){return!!t&&(this._gl.uniform1f(t,i),!0)}"setFloat2"(t,i,r){return!!t&&(this._gl.uniform2f(t,i,r),!0)}"setFloat3"(t,i,r,a){return!!t&&(this._gl.uniform3f(t,i,r,a),!0)}"setFloat4"(t,i,r,a,o){return!!t&&(this._gl.uniform4f(t,i,r,a,o),!0)}"applyStates"(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const t=this._colorWrite;this._gl.colorMask(t,t,t,t)}}"wipeCaches"(t){this.preventCacheWipeBetweenFrames&&!t||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),t&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}"_getSamplingParameters"(t,i){const r=this._gl;let a=r.NEAREST,o=r.NEAREST;switch(t){case 11:a=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:a=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:a=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:a=r.NEAREST,o=i?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:a=r.NEAREST,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:a=r.NEAREST,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:a=r.NEAREST,o=r.LINEAR;break;case 1:a=r.NEAREST,o=r.NEAREST;break;case 9:a=r.LINEAR,o=i?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:a=r.LINEAR,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:a=r.LINEAR,o=r.LINEAR;break;case 12:a=r.LINEAR,o=r.NEAREST}return{"min":o,"mag":a}}"_createTexture"(){const t=this._gl.createTexture();if(!t)throw new Error("Unable to create texture");return t}"_createHardwareTexture"(){return new _.B(this._createTexture(),this._gl)}"_createInternalTexture"(t,i,r=!0,a=0){let h,l=!1,c=!1,u=0,d=3,_=5,p=!1,m=1,T=!1,M=0;void 0!==i&&"object"==typeof i?(l=!!i.generateMipMaps,c=!!i.createMipMaps,u=void 0===i.type?0:i.type,d=void 0===i.samplingMode?3:i.samplingMode,_=void 0===i.format?5:i.format,p=void 0!==i.useSRGBBuffer&&i.useSRGBBuffer,m=i.samples??1,h=i.label,T=!!i.createMSAATexture,M=i.comparisonFunction||0):l=!!i,p&&(p=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==u||this._caps.textureFloatLinearFiltering)&&(2!==u||this._caps.textureHalfFloatLinearFiltering)||(d=1),1!==u||this._caps.textureFloat||(u=0,o.Y.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const b=(0,y.Ab)(_),x=(0,y.QF)(_),E=this._gl,R=new g.l(this,a),A=t.width||t,C=t.height||t,v=t.depth||0,P=t.layers||0,S=this._getSamplingParameters(d,(l||c)&&!b),I=0!==P?E.TEXTURE_2D_ARRAY:0!==v?E.TEXTURE_3D:E.TEXTURE_2D,D=b?this._getInternalFormatFromDepthTextureFormat(_,!0,x):this._getRGBABufferInternalSizedFormat(u,_,p),O=b?x?E.DEPTH_STENCIL:E.DEPTH_COMPONENT:this._getInternalFormat(_),w=b?this._getWebGLTextureTypeFromDepthTextureFormat(_):this._getWebGLTextureType(u);if(this._bindTextureDirectly(I,R),0!==P?(R.is2DArray=!0,E.texImage3D(I,0,D,A,C,P,0,O,w,null)):0!==v?(R.is3D=!0,E.texImage3D(I,0,D,A,C,v,0,O,w,null)):E.texImage2D(I,0,D,A,C,0,O,w,null),E.texParameteri(I,E.TEXTURE_MAG_FILTER,S.mag),E.texParameteri(I,E.TEXTURE_MIN_FILTER,S.min),E.texParameteri(I,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(I,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),b&&this.webGLVersion>1&&(0===M?(E.texParameteri(I,E.TEXTURE_COMPARE_FUNC,515),E.texParameteri(I,E.TEXTURE_COMPARE_MODE,E.NONE)):(E.texParameteri(I,E.TEXTURE_COMPARE_FUNC,M),E.texParameteri(I,E.TEXTURE_COMPARE_MODE,E.COMPARE_REF_TO_TEXTURE))),(l||c)&&this._gl.generateMipmap(I),this._bindTextureDirectly(I,null),R._useSRGBBuffer=p,R.baseWidth=A,R.baseHeight=C,R.width=A,R.height=C,R.depth=P||v,R.isReady=!0,R.samples=m,R.generateMipMaps=l,R.samplingMode=d,R.type=u,R.format=_,R.label=h,R.comparisonFunction=M,this._internalTexturesCache.push(R),T){let t=null;if(t=(0,y.Ab)(R.format)?this._setupFramebufferDepthAttachments((0,y.QF)(R.format),19!==R.format,R.width,R.height,m,R.format,!0):this._createRenderBuffer(R.width,R.height,m,-1,this._getRGBABufferInternalSizedFormat(R.type,R.format,R._useSRGBBuffer),-1),!t)throw new Error("Unable to create render buffer");R._autoMSAAManagement=!0;let i=R._hardwareTexture;i||(i=R._hardwareTexture=this._createHardwareTexture()),i.addMSAARenderBuffer(t)}return R}"_getUseSRGBBuffer"(t,i){return t&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||i)}"createTexture"(t,i,r,a,o=3,h=null,l=null,c=null,u=null,d=null,_=null,p,m,T,y){return this._createTextureBase(t,i,r,a,o,h,l,(...t)=>this._prepareWebGLTexture(...t,d),(t,i,r,o,h,l)=>{const c=this._gl,u=r.width===t&&r.height===i;h._creationFlags=T??0;const d=this._getTexImageParametersForCreateTexture(h.format,h._useSRGBBuffer);if(u)return c.texImage2D(c.TEXTURE_2D,0,d.internalFormat,d.format,d.type,r),!1;const _=this._caps.maxTextureSize;if(r.width>_||r.height>_||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=t,this._workingCanvas.height=i,this._workingContext.drawImage(r,0,0,r.width,r.height,0,0,t,i),c.texImage2D(c.TEXTURE_2D,0,d.internalFormat,d.format,d.type,this._workingCanvas),h.width=t,h.height=i,!1);{const t=new g.l(this,2);this._bindTextureDirectly(c.TEXTURE_2D,t,!0),c.texImage2D(c.TEXTURE_2D,0,d.internalFormat,d.format,d.type,r),this._rescaleTexture(t,h,a,d.format,()=>{this._releaseTexture(t),this._bindTextureDirectly(c.TEXTURE_2D,h,!0),l()})}return!0},c,u,d,_,p,m,y)}"_getTexImageParametersForCreateTexture"(t,i){let r,a;return 1===this.webGLVersion?(r=this._getInternalFormat(t,i),a=r):(r=this._getInternalFormat(t,!1),a=this._getRGBABufferInternalSizedFormat(0,t,i)),{"internalFormat":a,"format":r,"type":this._gl.UNSIGNED_BYTE}}"_rescaleTexture"(t,i,r,a,o){}"_unpackFlipY"(t){this._unpackFlipYCached!==t&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,t?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=t))}"_getUnpackAlignement"(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}"_getTextureTarget"(t){return t.isCube?this._gl.TEXTURE_CUBE_MAP:t.is3D?this._gl.TEXTURE_3D:t.is2DArray||t.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}"updateTextureSamplingMode"(t,i,r=!1){const a=this._getTextureTarget(i),o=this._getSamplingParameters(t,i.useMipMaps||r);this._setTextureParameterInteger(a,this._gl.TEXTURE_MAG_FILTER,o.mag,i),this._setTextureParameterInteger(a,this._gl.TEXTURE_MIN_FILTER,o.min),r&&(i.generateMipMaps=!0,this._gl.generateMipmap(a)),this._bindTextureDirectly(a,null),i.samplingMode=t}"updateTextureDimensions"(t,i,r,a=1){}"updateTextureWrappingMode"(t,i,r=null,a=null){const o=this._getTextureTarget(t);null!==i&&(this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(i),t),t._cachedWrapU=i),null!==r&&(this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),t),t._cachedWrapV=r),(t.is2DArray||t.is3D)&&null!==a&&(this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(a),t),t._cachedWrapR=a),this._bindTextureDirectly(o,null)}"_uploadCompressedDataToTextureDirectly"(t,i,r,a,o,h=0,l=0){const c=this._gl;let u=c.TEXTURE_2D;if(t.isCube&&(u=c.TEXTURE_CUBE_MAP_POSITIVE_X+h),t._useSRGBBuffer)switch(i){case 37492:case 36196:this._caps.etc2?i=c.COMPRESSED_SRGB8_ETC2:t._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?i=c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:t._useSRGBBuffer=!1;break;case 36492:i=c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:i=c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?i=c.COMPRESSED_SRGB_S3TC_DXT1_EXT:t._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?i=c.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:t._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?i=c.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:t._useSRGBBuffer=!1;break;default:t._useSRGBBuffer=!1}this._gl.compressedTexImage2D(u,l,i,r,a,0,o)}"_uploadDataToTextureDirectly"(t,i,r=0,a=0,o,h=!1){const l=this._gl,c=this._getWebGLTextureType(t.type),u=this._getInternalFormat(t.format),d=void 0===o?this._getRGBABufferInternalSizedFormat(t.type,t.format,t._useSRGBBuffer):this._getInternalFormat(o,t._useSRGBBuffer);this._unpackFlipY(t.invertY);let _=l.TEXTURE_2D;t.isCube&&(_=l.TEXTURE_CUBE_MAP_POSITIVE_X+r);const g=Math.round(Math.log(t.width)*Math.LOG2E),p=Math.round(Math.log(t.height)*Math.LOG2E),m=h?t.width:Math.pow(2,Math.max(g-a,0)),T=h?t.height:Math.pow(2,Math.max(p-a,0));l.texImage2D(_,a,d,m,T,0,u,c,i)}"updateTextureData"(t,i,r,a,o,h,l=0,c=0,u=!1){const d=this._gl,_=this._getWebGLTextureType(t.type),g=this._getInternalFormat(t.format);this._unpackFlipY(t.invertY);let p=d.TEXTURE_2D,m=d.TEXTURE_2D;t.isCube&&(m=d.TEXTURE_CUBE_MAP_POSITIVE_X+l,p=d.TEXTURE_CUBE_MAP),this._bindTextureDirectly(p,t,!0),d.texSubImage2D(m,c,r,a,o,h,g,_,i),u&&this._gl.generateMipmap(m),this._bindTextureDirectly(p,null)}"_uploadArrayBufferViewToTexture"(t,i,r=0,a=0){const o=this._gl,h=t.isCube?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D;this._bindTextureDirectly(h,t,!0),this._uploadDataToTextureDirectly(t,i,r,a),this._bindTextureDirectly(h,null,!0)}"_prepareWebGLTextureContinuation"(t,i,r,a,o){const h=this._gl;if(!h)return;const l=this._getSamplingParameters(o,!r);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,l.mag),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,l.min),r||a||h.generateMipmap(h.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null),i&&i.removePendingData(t),t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear()}"_prepareWebGLTexture"(t,i,r,a,o,h,l,c,d,_){const g=this.getCaps().maxTextureSize,p=Math.min(g,this.needPOTTextures?(0,u.p7)(a.width,g):a.width),m=Math.min(g,this.needPOTTextures?(0,u.p7)(a.height,g):a.height),T=this._gl;T&&(t._hardwareTexture?(this._bindTextureDirectly(T.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===o||!!o),t.baseWidth=a.width,t.baseHeight=a.height,t.width=p,t.height=m,t.isReady=!0,t.type=-1!==t.type?t.type:0,t.format=-1!==t.format?t.format:_??(".jpg"!==i||t._useSRGBBuffer?5:4),c(p,m,a,i,t,()=>{this._prepareWebGLTextureContinuation(t,r,h,l,d)})||this._prepareWebGLTextureContinuation(t,r,h,l,d)):r&&r.removePendingData(t))}"_getInternalFormatFromDepthTextureFormat"(t,i,r){const a=this._gl;if(!i)return a.STENCIL_INDEX8;let o=r?a.DEPTH_STENCIL:a.DEPTH_COMPONENT;return this.webGLVersion>1?15===t?o=a.DEPTH_COMPONENT16:16===t?o=a.DEPTH_COMPONENT24:17===t||13===t?o=r?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT24:14===t?o=a.DEPTH_COMPONENT32F:18===t&&(o=r?a.DEPTH32F_STENCIL8:a.DEPTH_COMPONENT32F):o=a.DEPTH_COMPONENT16,o}"_getWebGLTextureTypeFromDepthTextureFormat"(t){const i=this._gl;let r=i.UNSIGNED_INT;return 15===t?r=i.UNSIGNED_SHORT:17===t||13===t?r=i.UNSIGNED_INT_24_8:14===t?r=i.FLOAT:18===t?r=i.FLOAT_32_UNSIGNED_INT_24_8_REV:19===t&&(r=i.UNSIGNED_BYTE),r}"_setupFramebufferDepthAttachments"(t,i,r,a,o=1,h,l=!1){const c=this._gl;h=h??(t?13:14);const u=this._getInternalFormatFromDepthTextureFormat(h,i,t);return t&&i?this._createRenderBuffer(r,a,o,c.DEPTH_STENCIL,u,l?-1:c.DEPTH_STENCIL_ATTACHMENT):i?this._createRenderBuffer(r,a,o,u,u,l?-1:c.DEPTH_ATTACHMENT):t?this._createRenderBuffer(r,a,o,u,u,l?-1:c.STENCIL_ATTACHMENT):null}"_createRenderBuffer"(t,i,r,a,o,h,l=!0){const c=this._gl.createRenderbuffer();return this._updateRenderBuffer(c,t,i,r,a,o,h,l)}"_updateRenderBuffer"(t,i,r,a,o,h,l,c=!0){const u=this._gl;return u.bindRenderbuffer(u.RENDERBUFFER,t),a>1&&u.renderbufferStorageMultisample?u.renderbufferStorageMultisample(u.RENDERBUFFER,a,h,i,r):u.renderbufferStorage(u.RENDERBUFFER,o,i,r),-1!==l&&u.framebufferRenderbuffer(u.FRAMEBUFFER,l,u.RENDERBUFFER,t),c&&u.bindRenderbuffer(u.RENDERBUFFER,null),t}"_releaseTexture"(t){this._deleteTexture(t._hardwareTexture),this.unbindAllTextures();const i=this._internalTexturesCache.indexOf(t);-1!==i&&this._internalTexturesCache.splice(i,1),t._lodTextureHigh&&t._lodTextureHigh.dispose(),t._lodTextureMid&&t._lodTextureMid.dispose(),t._lodTextureLow&&t._lodTextureLow.dispose(),t._irradianceTexture&&t._irradianceTexture.dispose()}"_deleteTexture"(t){t?.release()}"_setProgram"(t){this._currentProgram!==t&&((0,a.Q)(t,this._gl),this._currentProgram=t)}"bindSamplers"(t){const i=t.getPipelineContext();this._setProgram(i.program);const r=t.getSamplers();for(let i=0;i<r.length;i++){const a=t.getUniform(r[i]);a&&(this._boundUniforms[i]=a)}this._currentEffect=null}"_activateCurrentTexture"(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}"_bindTextureDirectly"(t,i,r=!1,a=!1){let h=!1;const l=i&&i._associatedChannel>-1;r&&l&&(this._activeChannel=i._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==i||a){if(this._activateCurrentTexture(),i&&i.isMultiview)throw o.Y.Error(["_bindTextureDirectly called with a multiview texture!",t,i]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(t,i?._hardwareTexture?.underlyingResource??null),this._boundTexturesCache[this._activeChannel]=i,i&&(i._associatedChannel=this._activeChannel)}else r&&(h=!0,this._activateCurrentTexture());return l&&!r&&this._bindSamplerUniformToChannel(i._associatedChannel,this._activeChannel),h}"_bindTexture"(t,i,r){if(void 0===t)return;i&&(i._associatedChannel=t),this._activeChannel=t;const a=i?this._getTextureTarget(i):this._gl.TEXTURE_2D;this._bindTextureDirectly(a,i)}"unbindAllTextures"(){for(let t=0;t<this._maxSimultaneousTextures;t++)this._activeChannel=t,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}"setTexture"(t,i,r,a){void 0!==t&&(i&&(this._boundUniforms[t]=i),this._setTexture(t,r))}"_bindSamplerUniformToChannel"(t,i){const r=this._boundUniforms[t];r&&r._currentState!==i&&(this._gl.uniform1i(r,i),r._currentState=i)}"_getTextureWrapMode"(t){switch(t){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}"_setTexture"(t,i,r=!1,a=!1,o=""){if(!i)return null!=this._boundTexturesCache[t]&&(this._activeChannel=t,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(i.video){this._activeChannel=t;const r=i.getInternalTexture();r&&(r._associatedChannel=t),i.update()}else if(4===i.delayLoadState)return i.delayLoad(),!1;let h;h=a?i.depthStencilTexture:i.isReady()?i.getInternalTexture():i.isCube?this.emptyCubeTexture:i.is3D?this.emptyTexture3D:i.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&h&&(h._associatedChannel=t);let l=!0;this._boundTexturesCache[t]===h&&(r||this._bindSamplerUniformToChannel(h._associatedChannel,t),l=!1),this._activeChannel=t;const c=this._getTextureTarget(h);if(l&&this._bindTextureDirectly(c,h,r),h&&!h.isMultiview){if(h.isCube&&h._cachedCoordinatesMode!==i.coordinatesMode){h._cachedCoordinatesMode=i.coordinatesMode;const t=3!==i.coordinatesMode&&5!==i.coordinatesMode?1:0;i.wrapU=t,i.wrapV=t}h._cachedWrapU!==i.wrapU&&(h._cachedWrapU=i.wrapU,this._setTextureParameterInteger(c,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(i.wrapU),h)),h._cachedWrapV!==i.wrapV&&(h._cachedWrapV=i.wrapV,this._setTextureParameterInteger(c,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i.wrapV),h)),h.is3D&&h._cachedWrapR!==i.wrapR&&(h._cachedWrapR=i.wrapR,this._setTextureParameterInteger(c,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i.wrapR),h)),this._setAnisotropicLevel(c,h,i.anisotropicFilteringLevel)}return!0}"setTextureArray"(t,i,r,a){if(void 0!==t&&i){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(let i=0;i<r.length;i++){const a=r[i].getInternalTexture();a?(this._textureUnits[i]=t+i,a._associatedChannel=t+i):this._textureUnits[i]=-1}this._gl.uniform1iv(i,this._textureUnits);for(let t=0;t<r.length;t++)this._setTexture(this._textureUnits[t],r[t],!0)}}"_setAnisotropicLevel"(t,i,r){const a=this._caps.textureAnisotropicFilterExtension;11!==i.samplingMode&&3!==i.samplingMode&&2!==i.samplingMode&&(r=1),a&&i._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(t,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),i),i._cachedAnisotropicFilteringLevel=r)}"_setTextureParameterFloat"(t,i,r,a){this._bindTextureDirectly(t,a,!0,!0),this._gl.texParameterf(t,i,r)}"_setTextureParameterInteger"(t,i,r,a){a&&this._bindTextureDirectly(t,a,!0,!0),this._gl.texParameteri(t,i,r)}"unbindAllAttributes"(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let t=0;t<this._caps.maxVertexAttribs;t++)this.disableAttributeByIndex(t)}else for(let t=0,i=this._vertexAttribArraysEnabled.length;t<i;t++)t>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[t]||this.disableAttributeByIndex(t)}"releaseEffects"(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}"dispose"(){(0,h.CG)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&this._gl.getExtension("WEBGL_lose_context")?.loseContext(),(0,a.tY)(this._gl)}"attachContextLostEvent"(t){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",t,!1)}"attachContextRestoredEvent"(t){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",t,!1)}"getError"(){return this._gl.getError()}"_canRenderToFloatFramebuffer"(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}"_canRenderToHalfFloatFramebuffer"(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}"_canRenderToFramebuffer"(t){const i=this._gl;for(;i.getError()!==i.NO_ERROR;);let r=!0;const a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(t),1,1,0,i.RGBA,this._getWebGLTextureType(t),null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);const o=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,o),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0);const h=i.checkFramebufferStatus(i.FRAMEBUFFER);if(r=r&&h===i.FRAMEBUFFER_COMPLETE,r=r&&i.getError()===i.NO_ERROR,r&&(i.clear(i.COLOR_BUFFER_BIT),r=r&&i.getError()===i.NO_ERROR),r){i.bindFramebuffer(i.FRAMEBUFFER,null);const t=i.RGBA,a=i.UNSIGNED_BYTE,o=new Uint8Array(4);i.readPixels(0,0,1,1,t,a,o),r=r&&i.getError()===i.NO_ERROR}for(i.deleteTexture(a),i.deleteFramebuffer(o),i.bindFramebuffer(i.FRAMEBUFFER,null);!r&&i.getError()!==i.NO_ERROR;);return r}"_getWebGLTextureType"(t){if(1===this._webGLVersion){switch(t){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(t){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}"_getInternalFormat"(t,i=!1){let r=i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(t){case 0:r=this._gl.ALPHA;break;case 1:r=this._gl.LUMINANCE;break;case 2:r=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:r=this._gl.RED;break;case 7:case 33324:case 36761:r=this._gl.RG;break;case 4:case 32852:case 36762:r=i?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:r=i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(t){case 8:r=this._gl.RED_INTEGER;break;case 9:r=this._gl.RG_INTEGER;break;case 10:r=this._gl.RGB_INTEGER;break;case 11:r=this._gl.RGBA_INTEGER}return r}"_getRGBABufferInternalSizedFormat"(t,i,r=!1){if(1===this._webGLVersion){if(void 0!==i)switch(i){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return r?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(t){case 3:switch(i){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(i){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return r?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return r?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(i){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(i){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(i){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(i){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(i){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(i){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(i){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return r?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}"readPixels"(t,i,r,a,h=!0,l=!0,c=null){const u=h?4:3,d=h?this._gl.RGBA:this._gl.RGB,_=r*a*u;if(c){if(c.length<_)return o.Y.Error(`Data buffer is too small to store the read pixels (${c.length} should be more than ${_})`),Promise.resolve(c)}else c=new Uint8Array(_);return l&&this.flushFramebuffer(),this._gl.readPixels(t,i,r,a,d,this._gl.UNSIGNED_BYTE,c),Promise.resolve(c)}static get"IsSupportedAsync"(){return Promise.resolve(this.isSupported())}static get"IsSupported"(){return this.isSupported()}static"isSupported"(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const t=d.a._CreateCanvas(1,1),i=t.getContext("webgl")||t.getContext("experimental-webgl");this._IsSupported=null!=i&&!!window.WebGLRenderingContext}catch(t){this._IsSupported=!1}return this._IsSupported}static get"HasMajorPerformanceCaveat"(){if(null===this._HasMajorPerformanceCaveat)try{const t=d.a._CreateCanvas(1,1),i=t.getContext("webgl",{"failIfMajorPerformanceCaveat":!0})||t.getContext("experimental-webgl",{"failIfMajorPerformanceCaveat":!0});this._HasMajorPerformanceCaveat=!i}catch(t){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}ThinEngine._TempClearColorUint32=new Uint32Array(4),ThinEngine._TempClearColorInt32=new Int32Array(4),ThinEngine.ExceptionList=[{"key":"Chrome/63.0","capture":"63\\.0\\.3239\\.(\\d+)","captureConstraint":108,"targets":["uniformBuffer"]},{"key":"Firefox/58","capture":null,"captureConstraint":null,"targets":["uniformBuffer"]},{"key":"Firefox/59","capture":null,"captureConstraint":null,"targets":["uniformBuffer"]},{"key":"Chrome/72.+?Mobile","capture":null,"captureConstraint":null,"targets":["vao"]},{"key":"Chrome/73.+?Mobile","capture":null,"captureConstraint":null,"targets":["vao"]},{"key":"Chrome/74.+?Mobile","capture":null,"captureConstraint":null,"targets":["vao"]},{"key":"Mac OS.+Chrome/71","capture":null,"captureConstraint":null,"targets":["vao"]},{"key":"Mac OS.+Chrome/72","capture":null,"captureConstraint":null,"targets":["vao"]},{"key":"Mac OS.+Chrome","capture":null,"captureConstraint":null,"targets":["uniformBuffer"]},{"key":"Chrome/12\\d\\..+?Mobile","capture":null,"captureConstraint":null,"targets":["uniformBuffer"]},{"key":".*AppleWebKit.*(15.4).*Safari","capture":null,"captureConstraint":null,"targets":["antialias","maxMSAASamples"]},{"key":".*(15.4).*AppleWebKit.*Safari","capture":null,"captureConstraint":null,"targets":["antialias","maxMSAASamples"]}],ThinEngine._ConcatenateShader=m.Gb,ThinEngine._IsSupported=null,ThinEngine._HasMajorPerformanceCaveat=null},"1318":function(t,i,r){var a;r.d(i,{"G":function(){return EventConstants}}),function(t){t[t.PointerMove=0]="PointerMove",t[t.PointerDown=1]="PointerDown",t[t.PointerUp=2]="PointerUp"}(a||(a={}));class EventConstants{}EventConstants.DOM_DELTA_PIXEL=0,EventConstants.DOM_DELTA_LINE=1,EventConstants.DOM_DELTA_PAGE=2},"6081":function(t,i,r){r.d(i,{"NG":function(){return KeyboardInfo},"OG":function(){return KeyboardEventTypes},"WZ":function(){return KeyboardInfoPre}});class KeyboardEventTypes{}KeyboardEventTypes.KEYDOWN=1,KeyboardEventTypes.KEYUP=2;class KeyboardInfo{"constructor"(t,i){this.type=t,this.event=i}}class KeyboardInfoPre extends KeyboardInfo{get"skipOnPointerObservable"(){return this.skipOnKeyboardObservable}set"skipOnPointerObservable"(t){this.skipOnKeyboardObservable=t}"constructor"(t,i){super(t,i),this.type=t,this.event=i,this.skipOnKeyboardObservable=!1}}},"27":function(t,i,r){r.d(i,{"FV":function(){return PointerInfoPre},"R5":function(){return PointerInfo},"kD":function(){return PointerEventTypes}});var a=r(5412);class PointerEventTypes{}PointerEventTypes.POINTERDOWN=1,PointerEventTypes.POINTERUP=2,PointerEventTypes.POINTERMOVE=4,PointerEventTypes.POINTERWHEEL=8,PointerEventTypes.POINTERPICK=16,PointerEventTypes.POINTERTAP=32,PointerEventTypes.POINTERDOUBLETAP=64;class PointerInfoBase{"constructor"(t,i){this.type=t,this.event=i}}class PointerInfoPre extends PointerInfoBase{"constructor"(t,i,r,o){super(t,i),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new a.FM(r,o)}}class PointerInfo extends PointerInfoBase{get"pickInfo"(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}"constructor"(t,i,r,a=null){super(t,i),this._pickInfo=r,this._inputManager=a}"_generatePickInfo"(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},"183":function(t,i,r){r.d(i,{"m":function(){return LightConstants}});class LightConstants{static"CompareLightsPriority"(t,i){return t.shadowEnabled!==i.shadowEnabled?(i.shadowEnabled?1:0)-(t.shadowEnabled?1:0):i.renderPriority-t.renderPriority}}LightConstants.FALLOFF_DEFAULT=0,LightConstants.FALLOFF_PHYSICAL=1,LightConstants.FALLOFF_GLTF=2,LightConstants.FALLOFF_STANDARD=3,LightConstants.LIGHTMAP_DEFAULT=0,LightConstants.LIGHTMAP_SPECULAR=1,LightConstants.LIGHTMAP_SHADOWSONLY=2,LightConstants.INTENSITYMODE_AUTOMATIC=0,LightConstants.INTENSITYMODE_LUMINOUSPOWER=1,LightConstants.INTENSITYMODE_LUMINOUSINTENSITY=2,LightConstants.INTENSITYMODE_ILLUMINANCE=3,LightConstants.INTENSITYMODE_LUMINANCE=4,LightConstants.LIGHTTYPEID_POINTLIGHT=0,LightConstants.LIGHTTYPEID_DIRECTIONALLIGHT=1,LightConstants.LIGHTTYPEID_SPOTLIGHT=2,LightConstants.LIGHTTYPEID_HEMISPHERICLIGHT=3,LightConstants.LIGHTTYPEID_RECT_AREALIGHT=4},"5126":function(t,i,r){r.d(i,{"qr":function(){return _GetCompatibleTextureLoader}});var a=r(658);const o=new Map;function registerTextureLoader(t,i){(function unregisterTextureLoader(t){return o.delete(t)})(t)&&a.Y.Warn(`Extension with the name '${name}' already exists`),o.set(t,i)}function _GetCompatibleTextureLoader(t,i){"image/ktx"!==i&&"image/ktx2"!==i||(t=".ktx"),o.has(t)||(t.endsWith(".ies")&&registerTextureLoader(".ies",()=>r.e(597).then(r.bind(r,5597)).then(t=>new t._IESTextureLoader)),t.endsWith(".dds")&&registerTextureLoader(".dds",()=>r.e(439).then(r.bind(r,6439)).then(t=>new t._DDSTextureLoader)),t.endsWith(".basis")&&registerTextureLoader(".basis",()=>r.e(164).then(r.bind(r,6164)).then(t=>new t._BasisTextureLoader)),t.endsWith(".env")&&registerTextureLoader(".env",()=>r.e(515).then(r.bind(r,7515)).then(t=>new t._ENVTextureLoader)),t.endsWith(".hdr")&&registerTextureLoader(".hdr",()=>r.e(941).then(r.bind(r,6941)).then(t=>new t._HDRTextureLoader)),(t.endsWith(".ktx")||t.endsWith(".ktx2"))&&(registerTextureLoader(".ktx",()=>r.e(971).then(r.bind(r,5971)).then(t=>new t._KTXTextureLoader)),registerTextureLoader(".ktx2",()=>r.e(971).then(r.bind(r,5971)).then(t=>new t._KTXTextureLoader))),t.endsWith(".tga")&&registerTextureLoader(".tga",()=>r.e(149).then(r.bind(r,4149)).then(t=>new t._TGATextureLoader)),t.endsWith(".exr")&&registerTextureLoader(".exr",()=>r.e(356).then(r.bind(r,5356)).then(t=>new t._ExrTextureLoader)));const a=o.get(t);return a?Promise.resolve(a(i)):null}},"7728":function(t,i,r){r.d(i,{"V":function(){return BaseTexture}});var a=r(1069),o=r(8137),h=r(8139),l=r(5412),c=r(5953),u=r(3706),d=(r(9485),r(3321));class ThinTexture{get"wrapU"(){return this._wrapU}set"wrapU"(t){this._wrapU=t}get"wrapV"(){return this._wrapV}set"wrapV"(t){this._wrapV=t}get"coordinatesMode"(){return 0}get"isCube"(){return!!this._texture&&this._texture.isCube}set"isCube"(t){this._texture&&(this._texture.isCube=t)}get"is3D"(){return!!this._texture&&this._texture.is3D}set"is3D"(t){this._texture&&(this._texture.is3D=t)}get"is2DArray"(){return!!this._texture&&this._texture.is2DArray}set"is2DArray"(t){this._texture&&(this._texture.is2DArray=t)}"getClassName"(){return"ThinTexture"}static"_IsRenderTargetWrapper"(t){return void 0!==t?.shareDepth}"constructor"(t){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=d.$.Zero(),this._cachedBaseSize=d.$.Zero(),this._initialSamplingMode=2,this._texture=ThinTexture._IsRenderTargetWrapper(t)?t.texture:t,this._texture&&(this._engine=this._texture.getEngine())}"isReady"(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}"delayLoad"(){}"getInternalTexture"(){return this._texture}"getSize"(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}"getBaseSize"(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get"samplingMode"(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}"updateSamplingMode"(t){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(t,this._texture)}"releaseInternalTexture"(){this._texture&&(this._texture.dispose(),this._texture=null)}"dispose"(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var _=r(8113);class BaseTexture extends ThinTexture{set"hasAlpha"(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get"hasAlpha"(){return this._hasAlpha}set"getAlphaFromRGB"(t){this._getAlphaFromRGB!==t&&(this._getAlphaFromRGB=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get"getAlphaFromRGB"(){return this._getAlphaFromRGB}set"coordinatesIndex"(t){this._coordinatesIndex!==t&&(this._coordinatesIndex=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get"coordinatesIndex"(){return this._coordinatesIndex}set"coordinatesMode"(t){this._coordinatesMode!==t&&(this._coordinatesMode=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get"coordinatesMode"(){return this._coordinatesMode}get"wrapU"(){return this._wrapU}set"wrapU"(t){this._wrapU=t}get"wrapV"(){return this._wrapV}set"wrapV"(t){this._wrapV=t}get"isCube"(){return this._texture?this._texture.isCube:this._isCube}set"isCube"(t){this._texture?this._texture.isCube=t:this._isCube=t}get"is3D"(){return!!this._texture&&this._texture.is3D}set"is3D"(t){this._texture&&(this._texture.is3D=t)}get"is2DArray"(){return!!this._texture&&this._texture.is2DArray}set"is2DArray"(t){this._texture&&(this._texture.is2DArray=t)}get"gammaSpace"(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set"gammaSpace"(t){if(this._texture){if(this._texture._gammaSpace===t)return;this._texture._gammaSpace=t}else{if(this._gammaSpace===t)return;this._gammaSpace=t}this.getScene()?.markAllMaterialsAsDirty(1,t=>t.hasTexture(this))}get"isRGBD"(){return null!=this._texture&&this._texture._isRGBD}set"isRGBD"(t){t!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=t),this.getScene()?.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get"noMipmap"(){return!1}get"lodGenerationOffset"(){return this._texture?this._texture._lodGenerationOffset:0}set"lodGenerationOffset"(t){this._texture&&(this._texture._lodGenerationOffset=t)}get"lodGenerationScale"(){return this._texture?this._texture._lodGenerationScale:0}set"lodGenerationScale"(t){this._texture&&(this._texture._lodGenerationScale=t)}get"linearSpecularLOD"(){return!!this._texture&&this._texture._linearSpecularLOD}set"linearSpecularLOD"(t){this._texture&&(this._texture._linearSpecularLOD=t)}get"irradianceTexture"(){return this._texture?this._texture._irradianceTexture:null}set"irradianceTexture"(t){this._texture&&(this._texture._irradianceTexture=t)}get"uid"(){return this._uid||(this._uid=(0,u.f)()),this._uid}"toString"(){return this.name}"getClassName"(){return"BaseTexture"}set"onDispose"(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}get"isBlocking"(){return!0}get"loadingError"(){return this._loadingError}get"errorObject"(){return this._errorObject}"constructor"(t,i=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=BaseTexture.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new h.y$,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,t?BaseTexture._IsScene(t)?this._scene=t:this._engine=t:this._scene=c.l.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=i,this._uid=null}"getScene"(){return this._scene}"_getEngine"(){return this._engine}"getTextureMatrix"(){return l.y3.IdentityReadOnly}"getReflectionTextureMatrix"(){return l.y3.IdentityReadOnly}"getRefractionTextureMatrix"(){return this.getReflectionTextureMatrix()}"isReadyOrNotBlocking"(){return!this.isBlocking||this.isReady()||this.loadingError}"scale"(t){}get"canRescale"(){return!1}"_getFromCache"(t,i,r,a,o,h){const l=this._getEngine();if(!l)return null;const c=l._getUseSRGBBuffer(!!o,i),u=l.getLoadedTexturesCache();for(let l=0;l<u.length;l++){const d=u[l];if(!(void 0!==o&&c!==d._useSRGBBuffer||void 0!==a&&a!==d.invertY||d.url!==t||d.generateMipMaps!==!i||r&&r!==d.samplingMode||void 0!==h&&h!==d.isCube))return d.incrementReferences(),d}return null}"_rebuild"(t=!1){}"clone"(){return null}get"textureType"(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get"textureFormat"(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}"_markAllSubMeshesAsTexturesDirty"(){const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}"readPixels"(t=0,i=0,r=null,a=!0,o=!1,h=0,l=0,c=Number.MAX_VALUE,u=Number.MAX_VALUE){if(!this._texture)return null;const d=this._getEngine();if(!d)return null;const _=this.getSize();let g=_.width,p=_.height;0!==i&&(g/=Math.pow(2,i),p/=Math.pow(2,i),g=Math.round(g),p=Math.round(p)),c=Math.min(g,c),u=Math.min(p,u);try{return this._texture.isCube?d._readTexturePixels(this._texture,c,u,t,i,r,a,o,h,l):d._readTexturePixels(this._texture,c,u,-1,i,r,a,o,h,l)}catch(t){return null}}"_readPixelsSync"(t=0,i=0,r=null,a=!0,o=!1){if(!this._texture)return null;const h=this.getSize();let l=h.width,c=h.height;const u=this._getEngine();if(!u)return null;0!=i&&(l/=Math.pow(2,i),c/=Math.pow(2,i),l=Math.round(l),c=Math.round(c));try{return this._texture.isCube?u._readTexturePixelsSync(this._texture,l,c,t,i,r,a,o):u._readTexturePixelsSync(this._texture,l,c,-1,i,r,a,o)}catch(t){return null}}get"_lodTextureHigh"(){return this._texture?this._texture._lodTextureHigh:null}get"_lodTextureMid"(){return this._texture?this._texture._lodTextureMid:null}get"_lodTextureLow"(){return this._texture?this._texture._lodTextureLow:null}"dispose"(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const t=this._scene.textures.indexOf(this);if(t>=0&&this._scene.textures.splice(t,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}"serialize"(t=!1){if(!this.name&&!t)return null;const i=_.p.Serialize(this);return _.p.AppendSerializedAnimations(this,i),i}static"WhenAllReady"(t,i){let r=t.length;if(0!==r)for(let a=0;a<t.length;a++){const o=t[a];if(o.isReady())0===--r&&i();else{const t=o.onLoadObservable;t?t.addOnce(()=>{0===--r&&i()}):0===--r&&i()}}else i()}static"_IsScene"(t){return"Scene"===t.getClassName()}}BaseTexture.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"uniqueId",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"name",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"displayName",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"metadata",void 0),(0,a.gn)([(0,o.qC)("hasAlpha")],BaseTexture.prototype,"_hasAlpha",void 0),(0,a.gn)([(0,o.qC)("getAlphaFromRGB")],BaseTexture.prototype,"_getAlphaFromRGB",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"level",void 0),(0,a.gn)([(0,o.qC)("coordinatesIndex")],BaseTexture.prototype,"_coordinatesIndex",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"optimizeUVAllocation",void 0),(0,a.gn)([(0,o.qC)("coordinatesMode")],BaseTexture.prototype,"_coordinatesMode",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"wrapU",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"wrapV",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"wrapR",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"anisotropicFilteringLevel",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"isCube",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"is3D",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"is2DArray",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"gammaSpace",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"invertZ",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"lodLevelInAlpha",void 0),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"lodGenerationOffset",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"lodGenerationScale",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"linearSpecularLOD",null),(0,a.gn)([(0,o.oU)()],BaseTexture.prototype,"irradianceTexture",null),(0,a.gn)([(0,o.qC)()],BaseTexture.prototype,"isRenderTarget",void 0)},"3369":function(t,i,r){r.d(i,{"l":function(){return InternalTexture}});var a,o=r(8139);class TextureSampler{get"wrapU"(){return this._cachedWrapU}set"wrapU"(t){this._cachedWrapU=t}get"wrapV"(){return this._cachedWrapV}set"wrapV"(t){this._cachedWrapV=t}get"wrapR"(){return this._cachedWrapR}set"wrapR"(t){this._cachedWrapR=t}get"anisotropicFilteringLevel"(){return this._cachedAnisotropicFilteringLevel}set"anisotropicFilteringLevel"(t){this._cachedAnisotropicFilteringLevel=t}get"comparisonFunction"(){return this._comparisonFunction}set"comparisonFunction"(t){this._comparisonFunction=t}get"useMipMaps"(){return this._useMipMaps}set"useMipMaps"(t){this._useMipMaps=t}"constructor"(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}"setParameters"(t=1,i=1,r=1,a=1,o=2,h=0){return this._cachedWrapU=t,this._cachedWrapV=i,this._cachedWrapR=r,this._cachedAnisotropicFilteringLevel=a,this.samplingMode=o,this._comparisonFunction=h,this}"compareSampler"(t){return this._cachedWrapU===t._cachedWrapU&&this._cachedWrapV===t._cachedWrapV&&this._cachedWrapR===t._cachedWrapR&&this._cachedAnisotropicFilteringLevel===t._cachedAnisotropicFilteringLevel&&this.samplingMode===t.samplingMode&&this._comparisonFunction===t._comparisonFunction&&this._useMipMaps===t._useMipMaps}}!function(t){t[t.Unknown=0]="Unknown",t[t.Url=1]="Url",t[t.Temp=2]="Temp",t[t.Raw=3]="Raw",t[t.Dynamic=4]="Dynamic",t[t.RenderTarget=5]="RenderTarget",t[t.MultiRenderTarget=6]="MultiRenderTarget",t[t.Cube=7]="Cube",t[t.CubeRaw=8]="CubeRaw",t[t.CubePrefiltered=9]="CubePrefiltered",t[t.Raw3D=10]="Raw3D",t[t.Raw2DArray=11]="Raw2DArray",t[t.DepthStencil=12]="DepthStencil",t[t.CubeRawRGBD=13]="CubeRawRGBD",t[t.Depth=14]="Depth"}(a||(a={}));class InternalTexture extends TextureSampler{get"useMipMaps"(){return this.generateMipMaps}set"useMipMaps"(t){this.generateMipMaps=t}get"uniqueId"(){return this._uniqueId}"_setUniqueId"(t){this._uniqueId=t}"getEngine"(){return this._engine}get"source"(){return this._source}"constructor"(t,i,r=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new o.y$,this.onErrorObservable=new o.y$,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=t,this._source=i,this._uniqueId=InternalTexture._Counter++,r||(this._hardwareTexture=t._createHardwareTexture())}"incrementReferences"(){this._references++}"updateSize"(t,i,r=1){this._engine.updateTextureDimensions(this,t,i,r),this.width=t,this.height=i,this.depth=r,this.baseWidth=t,this.baseHeight=i,this.baseDepth=r,this._size=t*i*r}"_rebuild"(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const t=this.onRebuildCallback(this),swapAndSetIsReady=i=>{i._swapAndDie(this,!1),this.isReady=t.isReady};return void(t.isAsync?t.proxy.then(swapAndSetIsReady):swapAndSetIsReady(t.proxy))}let t;switch(this.source){case 2:case 12:case 14:break;case 1:return void(t=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,t=>{t._swapAndDie(this,!1),this.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:t=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),t._swapAndDie(this,!1),this.isReady=!0;break;case 10:t=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),t._swapAndDie(this,!1),this.isReady=!0;break;case 11:t=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),t._swapAndDie(this,!1),this.isReady=!0;break;case 4:t=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),t._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(t=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,()=>{t._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:t=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),t._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return t=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,t=>{t&&t._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension),void(t._sphericalPolynomial=this._sphericalPolynomial)}}"_swapAndDie"(t,i=!0){this._hardwareTexture?.setUsage(t._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),t._hardwareTexture=this._hardwareTexture,i&&(t._isRGBD=this._isRGBD),this._lodTextureHigh&&(t._lodTextureHigh&&t._lodTextureHigh.dispose(),t._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(t._lodTextureMid&&t._lodTextureMid.dispose(),t._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(t._lodTextureLow&&t._lodTextureLow.dispose(),t._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(t._irradianceTexture&&t._irradianceTexture.dispose(),t._irradianceTexture=this._irradianceTexture);const r=this._engine.getLoadedTexturesCache();let a=r.indexOf(this);-1!==a&&r.splice(a,1),a=r.indexOf(t),-1===a&&r.push(t)}"dispose"(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}InternalTexture._Counter=0},"5187":function(t,i,r){r.d(i,{"x":function(){return Texture}});var a=r(1069),o=r(8137),h=r(8139),l=r(5412),c=r(7728),u=r(646),d=r(9069),_=r(9447),g=r(6448),p=r(6504),m=r(8661);function GenerateBase64StringFromPixelData(t,i,r=!1){const a=i.width,o=i.height;if(t instanceof Float32Array){let i=t.byteLength/t.BYTES_PER_ELEMENT;const r=new Uint8Array(i);for(;--i>=0;){let a=t[i];a<0?a=0:a>1&&(a=1),r[i]=255*a}t=r}const h=document.createElement("canvas");h.width=a,h.height=o;const l=h.getContext("2d");if(!l)return null;const c=l.createImageData(a,o);if(c.data.set(t),l.putImageData(c,0,0),r){const t=document.createElement("canvas");t.width=a,t.height=o;const i=t.getContext("2d");return i?(i.translate(0,o),i.scale(1,-1),i.drawImage(h,0,0),t.toDataURL("image/png")):null}return h.toDataURL("image/png")}function GenerateBase64StringFromTexture(t,i=0,r=0){const a=t.getInternalTexture();if(!a)return null;const o=t._readPixelsSync(i,r);return o?GenerateBase64StringFromPixelData(o,t.getSize(),a.invertY):null}async function GenerateBase64StringFromTextureAsync(t,i=0,r=0){const a=t.getInternalTexture();if(!a)return null;const o=await t.readPixels(i,r);return o?GenerateBase64StringFromPixelData(o,t.getSize(),a.invertY):null}var T=r(6629),y=r(8113);class Texture extends c.V{static"_CreateVideoTexture"(t,i,r,a=!1,o=!1,h=Texture.TRILINEAR_SAMPLINGMODE,l={},c,u=5){throw(0,d.S)("VideoTexture")}get"noMipmap"(){return this._noMipmap}get"mimeType"(){return this._mimeType}set"isBlocking"(t){this._isBlocking=t}get"isBlocking"(){return this._isBlocking}get"invertY"(){return this._invertY}"constructor"(t,i,r,a,o=Texture.TRILINEAR_SAMPLINGMODE,l=null,c=null,u=null,d=!1,g,p,m,y,M){let b;super(i),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new h.y$,this._isBlocking=!0,this.name=t||"",this.url=t;let x=!1,E=null,R=!0;"object"==typeof r&&null!==r?(b=r.noMipmap??!1,a=r.invertY??!T.VJ,o=r.samplingMode??Texture.TRILINEAR_SAMPLINGMODE,l=r.onLoad??null,c=r.onError??null,u=r.buffer??null,d=r.deleteBuffer??!1,g=r.format,p=r.mimeType,m=r.loaderOptions,y=r.creationFlags,x=r.useSRGBBuffer??!1,E=r.internalTexture??null,R=r.gammaSpace??R,M=r.forcedExtension??M):b=!!r,this._gammaSpace=R,this._noMipmap=b,this._invertY=void 0===a?!T.VJ:a,this._initialSamplingMode=o,this._buffer=u,this._deleteBuffer=d,this._mimeType=p,this._loaderOptions=m,this._creationFlags=y,this._useSRGBBuffer=x,this._forcedExtension=M,g&&(this._format=g);const A=this.getScene(),C=this._getEngine();if(!C)return;C.onBeforeTextureInitObservable.notifyObservers(this);const load=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),l&&l(),!this.isBlocking&&A&&A.resetCachedMaterial()},errorHandler=(t,i)=>{this._loadingError=!0,this._errorObject={"message":t,"exception":i},c&&c(t,i),Texture.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!E)return this._delayedOnLoad=load,void(this._delayedOnError=errorHandler);if(this._texture=E??this._getFromCache(this.url,b,o,this._invertY,x,this.isCube),this._texture)if(this._texture.isReady)_.Q.SetImmediate(()=>load());else{const t=this._texture.onLoadedObservable.add(load);this._texture.onErrorObservable.add(i=>{errorHandler(i.message,i.exception),this._texture?.onLoadedObservable.remove(t)})}else if(A&&A.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=load,this._delayedOnError=errorHandler;else{try{this._texture=C.createTexture(this.url,b,this._invertY,A,o,load,errorHandler,this._buffer,void 0,this._format,this._forcedExtension,p,m,y,x)}catch(t){throw errorHandler("error loading",t),t}d&&(this._buffer=null)}}"updateURL"(t,i=null,r,a){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,t=>t.hasTexture(this))),this.name&&!this.name.startsWith("data:")||(this.name=t),this.url=t,this._buffer=i,this._forcedExtension=a,this.delayLoadState=4,r&&(this._delayedOnLoad=r),this.delayLoad()}"delayLoad"(){if(4!==this.delayLoadState)return;const t=this.getScene();t&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?_.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=t.getEngine().createTexture(this.url,this._noMipmap,this._invertY,t,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}"_prepareRowForTextureGeneration"(t,i,r,a){t*=this._cachedUScale,i*=this._cachedVScale,t-=this.uRotationCenter*this._cachedUScale,i-=this.vRotationCenter*this._cachedVScale,r-=this.wRotationCenter,l.P.TransformCoordinatesFromFloatsToRef(t,i,r,this._rowGenerationMatrix,a),a.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,a.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,a.z+=this.wRotationCenter}"getTextureMatrix"(t=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*t===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*t,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=l.y3.Zero(),this._rowGenerationMatrix=new l.y3,this._t0=l.P.Zero(),this._t1=l.P.Zero(),this._t2=l.P.Zero()),l.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(l.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,l.jp.Matrix[0]),l.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,l.jp.Matrix[1]),l.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,l.jp.Matrix[2]),l.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,l.jp.Matrix[3]),l.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(l.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(l.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(l.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),l.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const i=this.getScene();if(!i)return this._cachedTextureMatrix;const r=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&r!==this._cachedIdentity3x2&&i.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)),this._cachedTextureMatrix}"getReflectionTextureMatrix"(){const t=this.getScene();if(!t)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==Texture.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=l.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=l.y3.Zero());const i=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case Texture.PLANAR_MODE:l.y3.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case Texture.PROJECTION_MODE:{l.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const i=t.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:l.y3.IdentityToRef(this._cachedReflectionTextureMatrix)}return i&&t.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)),this._cachedReflectionTextureMatrix}"clone"(){const t={"noMipmap":this._noMipmap,"invertY":this._invertY,"samplingMode":this.samplingMode,"onLoad":void 0,"onError":void 0,"buffer":this._texture?this._texture._buffer:void 0,"deleteBuffer":this._deleteBuffer,"format":this.textureFormat,"mimeType":this.mimeType,"loaderOptions":this._loaderOptions,"creationFlags":this._creationFlags,"useSRGBBuffer":this._useSRGBBuffer};return y.p.Clone(()=>new Texture(this._texture?this._texture.url:null,this.getScene(),t),this)}"serialize"(){const t=this.name;Texture.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const i=super.serialize(Texture._SerializeInternalTextureUniqueId);return i?((Texture.SerializeBuffers||Texture.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+(0,m.Gh)(this._buffer):(Texture.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(i.base64String=!this._engine||this._engine._features.supportSyncTextureRead?GenerateBase64StringFromTexture(this):GenerateBase64StringFromTextureAsync(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i._creationFlags=this._creationFlags,i._useSRGBBuffer=this._useSRGBBuffer,Texture._SerializeInternalTextureUniqueId&&(i.internalTextureUniqueId=this._texture?.uniqueId),i.internalTextureLabel=this._texture?.label,i.noMipmap=this._noMipmap,this.name=t,i):null}"getClassName"(){return"Texture"}"dispose"(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static"Parse"(t,i,r){if(t.customType){const a=g.K.Instantiate(t.customType).Parse(t,i,r);return t.samplingMode&&a.updateSamplingMode&&a._samplingMode&&a._samplingMode!==t.samplingMode&&a.updateSamplingMode(t.samplingMode),a}if(t.isCube&&!t.isRenderTarget)return Texture._CubeTextureParser(t,i,r);const a=void 0!==t.internalTextureUniqueId;if(!t.name&&!t.isRenderTarget&&!a)return null;let o;if(a){const r=i.getEngine().getLoadedTexturesCache();for(const i of r)if(i.uniqueId===t.internalTextureUniqueId){o=i;break}}const onLoaded=i=>{if(i&&i._texture&&(i._texture._cachedWrapU=null,i._texture._cachedWrapV=null,i._texture._cachedWrapR=null),t.samplingMode){const r=t.samplingMode;i&&i.samplingMode!==r&&i.updateSamplingMode(r)}if(i&&t.animations)for(let r=0;r<t.animations.length;r++){const a=t.animations[r],o=(0,u.qw)("BABYLON.Animation");o&&i.animations.push(o.Parse(a))}i&&i._texture&&(a&&!o&&i._texture._setUniqueId(t.internalTextureUniqueId),i._texture.label=t.internalTextureLabel)};return y.p.Parse(()=>{let a=!0;if(t.noMipmap&&(a=!1),t.mirrorPlane){const r=Texture._CreateMirror(t.name,t.renderTargetSize,i,a);return r._waitingRenderList=t.renderList,r.mirrorPlane=p.J.FromArray(t.mirrorPlane),onLoaded(r),r}if(t.isRenderTarget){let r=null;if(t.isCube){if(i.reflectionProbes)for(let r=0;r<i.reflectionProbes.length;r++){const a=i.reflectionProbes[r];if(a.name===t.name)return a.cubeTexture}}else r=Texture._CreateRenderTargetTexture(t.name,t.renderTargetSize,i,a,t._creationFlags??0),r._waitingRenderList=t.renderList;return onLoaded(r),r}if(t.isVideo){const o=Texture._CreateVideoTexture(r+(t.url||t.name),r+(t.src||t.url),i,a,t.invertY,t.samplingMode,t.settings||{});return onLoaded(o),o}{let h;if(t.base64String&&!o)h=Texture.CreateFromBase64String(t.base64String,t.base64String,i,!a,t.invertY,t.samplingMode,()=>{onLoaded(h)},t._creationFlags??0,t._useSRGBBuffer??!1),h.name=t.name;else{let l;l=t.name&&(t.name.indexOf("://")>0||t.name.startsWith("data:"))?t.name:r+t.name,t.url&&(t.url.startsWith("data:")||Texture.UseSerializedUrlIfAny)&&(l=t.url);const c={"noMipmap":!a,"invertY":t.invertY,"samplingMode":t.samplingMode,"onLoad":()=>{onLoaded(h)},"internalTexture":o};h=new Texture(l,i,c)}return h}},t,i)}static"CreateFromBase64String"(t,i,r,a,o,h=Texture.TRILINEAR_SAMPLINGMODE,l=null,c=null,u=5,d,_){return new Texture("data:"+i,r,a,o,h,l,c,t,!1,u,void 0,void 0,d,_)}static"LoadFromDataString"(t,i,r,a=!1,o,h=!0,l=Texture.TRILINEAR_SAMPLINGMODE,c=null,u=null,d=5,_,g){return"data:"!==t.substring(0,5)&&(t="data:"+t),new Texture(t,r,o,h,l,c,u,i,a,d,void 0,void 0,_,g)}}Texture.SerializeBuffers=!0,Texture.ForceSerializeBuffers=!1,Texture.OnTextureLoadErrorObservable=new h.y$,Texture._SerializeInternalTextureUniqueId=!1,Texture._CubeTextureParser=(t,i,r)=>{throw(0,d.S)("CubeTexture")},Texture._CreateMirror=(t,i,r,a)=>{throw(0,d.S)("MirrorTexture")},Texture._CreateRenderTargetTexture=(t,i,r,a,o)=>{throw(0,d.S)("RenderTargetTexture")},Texture.NEAREST_SAMPLINGMODE=1,Texture.NEAREST_NEAREST_MIPLINEAR=8,Texture.BILINEAR_SAMPLINGMODE=2,Texture.LINEAR_LINEAR_MIPNEAREST=11,Texture.TRILINEAR_SAMPLINGMODE=3,Texture.LINEAR_LINEAR_MIPLINEAR=3,Texture.NEAREST_NEAREST_MIPNEAREST=4,Texture.NEAREST_LINEAR_MIPNEAREST=5,Texture.NEAREST_LINEAR_MIPLINEAR=6,Texture.NEAREST_LINEAR=7,Texture.NEAREST_NEAREST=1,Texture.LINEAR_NEAREST_MIPNEAREST=9,Texture.LINEAR_NEAREST_MIPLINEAR=10,Texture.LINEAR_LINEAR=2,Texture.LINEAR_NEAREST=12,Texture.EXPLICIT_MODE=0,Texture.SPHERICAL_MODE=1,Texture.PLANAR_MODE=2,Texture.CUBIC_MODE=3,Texture.PROJECTION_MODE=4,Texture.SKYBOX_MODE=5,Texture.INVCUBIC_MODE=6,Texture.EQUIRECTANGULAR_MODE=7,Texture.FIXED_EQUIRECTANGULAR_MODE=8,Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Texture.CLAMP_ADDRESSMODE=0,Texture.WRAP_ADDRESSMODE=1,Texture.MIRROR_ADDRESSMODE=2,Texture.UseSerializedUrlIfAny=!1,(0,a.gn)([(0,o.qC)()],Texture.prototype,"url",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"uOffset",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"vOffset",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"uScale",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"vScale",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"uAng",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"vAng",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"wAng",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"uRotationCenter",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"vRotationCenter",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"wRotationCenter",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"homogeneousRotationInUVTransform",void 0),(0,a.gn)([(0,o.qC)()],Texture.prototype,"isBlocking",null),(0,u.H7)("BABYLON.Texture",Texture),y.p._TextureParser=Texture.Parse},"2628":function(t,i,r){function IsDepthTexture(t){return 13===t||14===t||15===t||16===t||17===t||18===t||19===t}function HasStencilAspect(t){return 13===t||17===t||18===t||19===t}r.d(i,{"Ab":function(){return IsDepthTexture},"QF":function(){return HasStencilAspect}})},"7050":function(t,i,r){r.d(i,{"q":function(){return DrawWrapper}});var a=r(9447);class DrawWrapper{static"GetEffect"(t){return void 0===t.getPipelineContext?t.effect:t}"constructor"(t,i=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=t.createDrawContext(),i&&(this.materialContext=t.createMaterialContext())}"setEffect"(t,i,r=!0){this.effect=t,void 0!==i&&(this.defines=i),r&&this.drawContext?.reset()}"dispose"(t=!1){if(this.effect){const i=this.effect;t?i.dispose():a.Q.SetImmediate(()=>{i.getEngine().onEndFrameObservable.addOnce(()=>{i.dispose()})}),this.effect=null}this.drawContext?.dispose()}}},"5881":function(t,i,r){r.d(i,{"Z9":function(){return _processShaderCode},"ZI":function(){return resetCachedPipeline},"dR":function(){return getCachedPipeline},"sp":function(){return createAndPreparePipelineContext}});var a=r(1102),o=r(7625),h=r(1206),l=r(658),c=r(3525),u=r(6443);function getCachedPipeline(t,i){return(0,o.iU)(i).cachedPipelines[t]}function resetCachedPipeline(t){const i=t._name,r=t.context;if(i&&r){const t=(0,o.iU)(r),a=t.cachedPipelines[i];a?.dispose(),delete t.cachedPipelines[i]}}function _processShaderCode(t,i,r,o,h,l,u){let d,_;const g=(0,a.CG)()?l?.getHostDocument():null;d="string"==typeof i?i:i.vertexSource?"source:"+i.vertexSource:i.vertexElement?g?.getElementById(i.vertexElement)||i.vertexElement:i.vertex||i,_="string"==typeof i?i:i.fragmentSource?"source:"+i.fragmentSource:i.fragmentElement?g?.getElementById(i.fragmentElement)||i.fragmentElement:i.fragment||i;const p=[void 0,void 0],shadersLoaded=()=>{if(p[0]&&p[1]){t.isFragment=!0;const[a,d]=p;(0,c.An)(d,t,(l,d)=>{u&&(u._fragmentSourceCodeBeforeMigration=d),r&&(l=r("fragment",l));const _=(0,c.Ku)(a,l,t);t=null;const g=function _useFinalCode(t,i,r,a){if(r){return{"vertexSourceCode":(1===a?"//":"")+"#define SHADER_NAME vertex:"+(r.vertexElement||r.vertex||r.spectorName||r)+"\n"+t,"fragmentSourceCode":(1===a?"//":"")+"#define SHADER_NAME fragment:"+(r.fragmentElement||r.fragment||r.spectorName||r)+"\n"+i}}return{"vertexSourceCode":t,"fragmentSourceCode":i}}(_.vertexCode,_.fragmentCode,i,h);o?.(g.vertexSourceCode,g.fragmentSourceCode)},l)}};_loadShader(d,"Vertex","",i=>{(0,c.wz)(t),(0,c.An)(i,t,(t,a)=>{u&&(u._rawVertexSourceCode=i,u._vertexSourceCodeBeforeMigration=a),r&&(t=r("vertex",t)),p[0]=t,shadersLoaded()},l)},h),_loadShader(_,"Fragment","Pixel",t=>{u&&(u._rawFragmentSourceCode=t),p[1]=t,shadersLoaded()},h)}function _loadShader(t,i,r,o,l,c){if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){return void o((0,a.v)(t))}if("source:"===t.substring(0,7))return void o(t.substring(7));if("base64:"===t.substring(0,7)){return void o(window.atob(t.substring(7)))}const d=h.v.GetShadersStore(l);if(d[t+i+"Shader"])return void o(d[t+i+"Shader"]);if(r&&d[t+r+"Shader"])return void o(d[t+r+"Shader"]);let _;if(_="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:h.v.GetShadersRepository(l)+t,!(c=c||u.wv))throw new Error("loadFileInjection is not defined");c(_+"."+i.toLowerCase()+".fx",o)}const createAndPreparePipelineContext=(t,i,r,a)=>{try{const h=t.context?(0,o.iU)(t.context):null;h&&(h.disableParallelShaderCompile=t.disableParallelCompilation);const l=t.existingPipelineContext||i(t.shaderProcessingContext);return l._name=t.name,t.name&&h&&(h.cachedPipelines[t.name]=l),r(l,t.vertex,t.fragment,!!t.createAsRaw,"","",t.rebuildRebind,t.defines,t.transformFeedbackVaryings,"",()=>{a(l,()=>{t.onRenderingStateCompiled?.(l)})}),l}catch(t){throw l.Y.Error("Error compiling effect"),t}}},"4442":function(t,i,r){r.d(i,{"Q":function(){return Effect}});var a=r(8139),o=r(658),h=r(1206),l=r(5881),c=r(9447);class Effect{static get"ShadersRepository"(){return h.v.ShadersRepository}static set"ShadersRepository"(t){h.v.ShadersRepository=t}get"isDisposed"(){return this._isDisposed}get"onBindObservable"(){return this._onBindObservable||(this._onBindObservable=new a.y$),this._onBindObservable}get"shaderLanguage"(){return this._shaderLanguage}"constructor"(t,i,r,o=null,h,c=null,u=null,d=null,_=null,g,p="",m=0,T){this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new a.y$,this.onErrorObservable=new a.y$,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=t,this._key=p;const y=this._key.replace(/\r/g,"").replace(/\n/g,"|");let M;if(i.attributes){const t=i;if(this._engine=r,this._attributesNames=t.attributes,this._uniformsNames=t.uniformsNames.concat(t.samplers),this._samplerList=t.samplers.slice(),this.defines=t.defines,this.onError=t.onError,this.onCompiled=t.onCompiled,this._fallbacks=t.fallbacks,this._indexParameters=t.indexParameters,this._transformFeedbackVaryings=t.transformFeedbackVaryings||null,this._multiTarget=!!t.multiTarget,this._shaderLanguage=t.shaderLanguage??0,this._disableParallelShaderCompilation=!!t.disableParallelShaderCompilation,t.uniformBuffersNames){this._uniformBuffersNamesList=t.uniformBuffersNames.slice();for(let i=0;i<t.uniformBuffersNames.length;i++)this._uniformBuffersNames[t.uniformBuffersNames[i]]=i}this._processFinalCode=t.processFinalCode??null,this._processCodeAfterIncludes=t.processCodeAfterIncludes??void 0,T=t.extraInitializationsAsync,M=t.existingPipelineContext}else this._engine=h,this.defines=null==c?"":c,this._uniformsNames=r.concat(o),this._samplerList=o?o.slice():[],this._attributesNames=i,this._uniformBuffersNamesList=[],this._shaderLanguage=m,this.onError=_,this.onCompiled=d,this._indexParameters=g,this._fallbacks=u;"WEBGL2"===this._engine.shaderPlatformName&&(M=(0,l.dR)(y,this._engine._gl)??M),this._attributeLocationByName={},this.uniqueId=Effect._UniqueIdSeed++,M?(this._pipelineContext=M,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,T),this._engine.onReleaseEffectsObservable.addOnce(()=>{this.isDisposed||this.dispose(!0)})}async"_processShaderCodeAsync"(t=null,i=!1,r=null,a){a&&await a(),this._processingContext=r||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const o={"defines":this.defines.split("\n"),"indexParameters":this._indexParameters,"isFragment":!1,"shouldUseHighPrecisionShader":this._engine._shouldUseHighPrecisionShader,"processor":t??this._engine._getShaderProcessor(this._shaderLanguage),"supportsUniformBuffers":this._engine.supportsUniformBuffers,"shadersRepository":h.v.GetShadersRepository(this._shaderLanguage),"includesShadersStore":h.v.GetIncludesShadersStore(this._shaderLanguage),"version":(100*this._engine.version).toString(),"platformName":this._engine.shaderPlatformName,"processingContext":this._processingContext,"isNDCHalfZRange":this._engine.isNDCHalfZRange,"useReverseDepthBuffer":this._engine.useReverseDepthBuffer,"processCodeAfterIncludes":this._processCodeAfterIncludes};(0,l.Z9)(o,this.name,this._processFinalCode,(t,r)=>{this._vertexSourceCode=t,this._fragmentSourceCode=r,this._prepareEffect(i)},this._shaderLanguage,this._engine,this)}get"key"(){return this._key}"isReady"(){try{return this._isReadyInternal()}catch{return!1}}"_isReadyInternal"(){return!!this._engine.isDisposed||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}"getEngine"(){return this._engine}"getPipelineContext"(){return this._pipelineContext}"getAttributesNames"(){return this._attributesNames}"getAttributeLocation"(t){return this._attributes[t]}"getAttributeLocationByName"(t){return this._attributeLocationByName[t]}"getAttributesCount"(){return this._attributes.length}"getUniformIndex"(t){return this._uniformsNames.indexOf(t)}"getUniform"(t){return this._uniforms[t]}"getSamplers"(){return this._samplerList}"getUniformNames"(){return this._uniformsNames}"getUniformBuffersNames"(){return this._uniformBuffersNamesList}"getIndexParameters"(){return this._indexParameters}"getCompilationError"(){return this._compilationError}"allFallbacksProcessed"(){return this._allFallbacksProcessed}"whenCompiledAsync"(){return new Promise(t=>{this.executeWhenCompiled(t)})}"executeWhenCompiled"(t){this.isReady()?t(this):(this.onCompileObservable.add(i=>{t(i)}),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}"_checkIsReady"(t){(0,c.r)(()=>this._isReadyInternal()||this._isDisposed,()=>{},i=>{this._processCompilationErrors(i,t)},16,12e4,!0,` - Effect: ${"string"==typeof this.name?this.name:this.key}`)}get"vertexSourceCode"(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}get"fragmentSourceCode"(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}get"vertexSourceCodeBeforeMigration"(){return this._vertexSourceCodeBeforeMigration}get"fragmentSourceCodeBeforeMigration"(){return this._fragmentSourceCodeBeforeMigration}get"rawVertexSourceCode"(){return this._rawVertexSourceCode}get"rawFragmentSourceCode"(){return this._rawFragmentSourceCode}"getPipelineGenerationOptions"(){return{"platformName":this._engine.shaderPlatformName,"shaderLanguage":this._shaderLanguage,"shaderNameOrContent":this.name,"key":this._key,"defines":this.defines.split("\n"),"addGlobalDefines":!1,"extendedProcessingOptions":{"indexParameters":this._indexParameters,"isNDCHalfZRange":this._engine.isNDCHalfZRange,"useReverseDepthBuffer":this._engine.useReverseDepthBuffer,"supportsUniformBuffers":this._engine.supportsUniformBuffers},"extendedCreatePipelineOptions":{"transformFeedbackVaryings":this._transformFeedbackVaryings,"createAsRaw":!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}"_rebuildProgram"(t,i,r,a){this._isReady=!1,this._vertexSourceCodeOverride=t,this._fragmentSourceCodeOverride=i,this.onError=(t,i)=>{a&&a(i)},this.onCompiled=()=>{const t=this.getEngine().scenes;if(t)for(let i=0;i<t.length;i++)t[i].markAllMaterialsAsDirty(127);this._pipelineContext._handlesSpectorRebuildCallback?.(r)},this._fallbacks=null,this._prepareEffect()}"_onRenderingStateCompiled"(t){if(this._pipelineContext=t,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let t=0;t<this._attributesNames.length;t++){const i=this._attributesNames[t];this._attributeLocationByName[i]=this._attributes[t]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),Effect.AutomaticallyClearCodeCache&&this.clearCodeCache()}"_prepareEffect"(t=!1){const i=this._pipelineContext;this._isReady=!1;try{const r=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),a=r?null:this.defines,o=r?this._vertexSourceCodeOverride:this._vertexSourceCode,h=r?this._fragmentSourceCodeOverride:this._fragmentSourceCode,c=this._engine;this._pipelineContext=(0,l.sp)({"existingPipelineContext":t?i:null,"vertex":o,"fragment":h,"context":"WEBGL2"===c.shaderPlatformName||"WEBGL1"===c.shaderPlatformName?c._gl:void 0,"rebuildRebind":(t,i,r,a)=>this._rebuildProgram(t,i,r,a),"defines":a,"transformFeedbackVaryings":this._transformFeedbackVaryings,"name":this._key.replace(/\r/g,"").replace(/\n/g,"|"),"createAsRaw":r,"disableParallelCompilation":this._disableParallelShaderCompilation,"shaderProcessingContext":this._processingContext,"onRenderingStateCompiled":r=>{i&&!t&&this._engine._deletePipelineContext(i),r&&this._onRenderingStateCompiled(r)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(t){this._processCompilationErrors(t,i)}}"_getShaderCodeAndErrorLine"(t,i,r){const a=r?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let o=null;if(i&&t){const h=i.match(a);if(h&&2===h.length){const i=parseInt(h[1]),a=t.split("\n",-1);a.length>=i&&(o=`Offending line [${i}] in ${r?"fragment":"vertex"} code: ${a[i-1]}`)}}return[t,o]}"_processCompilationErrors"(t,i=null){this._compilationError=t.message;const r=this._attributesNames,a=this._fallbacks;if(o.Y.Error("Unable to compile effect:"),o.Y.Error("Uniforms: "+this._uniformsNames.map(function(t){return" "+t})),o.Y.Error("Attributes: "+r.map(function(t){return" "+t})),o.Y.Error("Defines:\n"+this.defines),Effect.LogShaderCodeOnCompilationError){let t=null,i=null,r=null;this._pipelineContext?._getVertexShaderCode()&&([r,t]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),r&&(o.Y.Error("Vertex code:"),o.Y.Error(r))),this._pipelineContext?._getFragmentShaderCode()&&([r,i]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),r&&(o.Y.Error("Fragment code:"),o.Y.Error(r))),t&&o.Y.Error(t),i&&o.Y.Error(i)}o.Y.Error("Error: "+this._compilationError);const notifyErrors=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({"effect":this,"errors":this._compilationError})};i&&(this._pipelineContext=i,this._isReady=!0,notifyErrors()),a?(this._pipelineContext=null,a.hasMoreFallbacks?(this._allFallbacksProcessed=!1,o.Y.Error("Trying next fallback."),this.defines=a.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,notifyErrors(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,i||notifyErrors())}get"isSupported"(){return""===this._compilationError}"_bindTexture"(t,i){this._engine._bindTexture(this._samplers[t],i,t)}"setTexture"(t,i){this._engine.setTexture(this._samplers[t],this._uniforms[t],i,t)}"setTextureArray"(t,i){const r=t+"Ex";if(-1===this._samplerList.indexOf(r+"0")){const a=this._samplerList.indexOf(t);for(let t=1;t<i.length;t++){const i=r+(t-1).toString();this._samplerList.splice(a+t,0,i)}let o=0;for(const t of this._samplerList)this._samplers[t]=o,o+=1}this._engine.setTextureArray(this._samplers[t],this._uniforms[t],i,t)}"bindUniformBuffer"(t,i){const r=this._uniformBuffersNames[i];void 0===r||Effect._BaseCache[r]===t&&this._engine._features.useUBOBindingCache||(Effect._BaseCache[r]=t,this._engine.bindUniformBufferBase(t,r,i))}"bindUniformBlock"(t,i){this._engine.bindUniformBlock(this._pipelineContext,t,i)}"setInt"(t,i){return this._pipelineContext.setInt(t,i),this}"setInt2"(t,i,r){return this._pipelineContext.setInt2(t,i,r),this}"setInt3"(t,i,r,a){return this._pipelineContext.setInt3(t,i,r,a),this}"setInt4"(t,i,r,a,o){return this._pipelineContext.setInt4(t,i,r,a,o),this}"setIntArray"(t,i){return this._pipelineContext.setIntArray(t,i),this}"setIntArray2"(t,i){return this._pipelineContext.setIntArray2(t,i),this}"setIntArray3"(t,i){return this._pipelineContext.setIntArray3(t,i),this}"setIntArray4"(t,i){return this._pipelineContext.setIntArray4(t,i),this}"setUInt"(t,i){return this._pipelineContext.setUInt(t,i),this}"setUInt2"(t,i,r){return this._pipelineContext.setUInt2(t,i,r),this}"setUInt3"(t,i,r,a){return this._pipelineContext.setUInt3(t,i,r,a),this}"setUInt4"(t,i,r,a,o){return this._pipelineContext.setUInt4(t,i,r,a,o),this}"setUIntArray"(t,i){return this._pipelineContext.setUIntArray(t,i),this}"setUIntArray2"(t,i){return this._pipelineContext.setUIntArray2(t,i),this}"setUIntArray3"(t,i){return this._pipelineContext.setUIntArray3(t,i),this}"setUIntArray4"(t,i){return this._pipelineContext.setUIntArray4(t,i),this}"setFloatArray"(t,i){return this._pipelineContext.setArray(t,i),this}"setFloatArray2"(t,i){return this._pipelineContext.setArray2(t,i),this}"setFloatArray3"(t,i){return this._pipelineContext.setArray3(t,i),this}"setFloatArray4"(t,i){return this._pipelineContext.setArray4(t,i),this}"setArray"(t,i){return this._pipelineContext.setArray(t,i),this}"setArray2"(t,i){return this._pipelineContext.setArray2(t,i),this}"setArray3"(t,i){return this._pipelineContext.setArray3(t,i),this}"setArray4"(t,i){return this._pipelineContext.setArray4(t,i),this}"setMatrices"(t,i){return this._pipelineContext.setMatrices(t,i),this}"setMatrix"(t,i){return this._pipelineContext.setMatrix(t,i),this}"setMatrix3x3"(t,i){return this._pipelineContext.setMatrix3x3(t,i),this}"setMatrix2x2"(t,i){return this._pipelineContext.setMatrix2x2(t,i),this}"setFloat"(t,i){return this._pipelineContext.setFloat(t,i),this}"setBool"(t,i){return this._pipelineContext.setInt(t,i?1:0),this}"setVector2"(t,i){return this._pipelineContext.setVector2(t,i),this}"setFloat2"(t,i,r){return this._pipelineContext.setFloat2(t,i,r),this}"setVector3"(t,i){return this._pipelineContext.setVector3(t,i),this}"setFloat3"(t,i,r,a){return this._pipelineContext.setFloat3(t,i,r,a),this}"setVector4"(t,i){return this._pipelineContext.setVector4(t,i),this}"setQuaternion"(t,i){return this._pipelineContext.setQuaternion(t,i),this}"setFloat4"(t,i,r,a,o){return this._pipelineContext.setFloat4(t,i,r,a,o),this}"setColor3"(t,i){return this._pipelineContext.setColor3(t,i),this}"setColor4"(t,i,r){return this._pipelineContext.setColor4(t,i,r),this}"setDirectColor4"(t,i){return this._pipelineContext.setDirectColor4(t,i),this}"clearCodeCache"(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}"dispose"(t=!1){if(t)this._refCount=0;else{if(Effect.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,l.ZI)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static"RegisterShader"(t,i,r,a=0){i&&(h.v.GetShadersStore(a)[`${t}PixelShader`]=i),r&&(h.v.GetShadersStore(a)[`${t}VertexShader`]=r)}static"ResetCache"(){Effect._BaseCache={}}}Effect.LogShaderCodeOnCompilationError=!0,Effect.PersistentMode=!1,Effect.AutomaticallyClearCodeCache=!1,Effect._UniqueIdSeed=0,Effect._BaseCache={},Effect.ShadersStore=h.v.ShadersStore,Effect.IncludesShadersStore=h.v.IncludesShadersStore},"4662":function(t,i,r){r.d(i,{"$":function(){return ImageProcessingConfiguration}});var a=r(1069),o=r(8137),h=r(8139),l=r(2922),c=r(8113);function PrepareUniformsForColorCurves(t){t.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}class ColorCurves{"constructor"(){this._dirty=!0,this._tempColor=new l.HE(0,0,0,0),this._globalCurve=new l.HE(0,0,0,0),this._highlightsCurve=new l.HE(0,0,0,0),this._midtonesCurve=new l.HE(0,0,0,0),this._shadowsCurve=new l.HE(0,0,0,0),this._positiveCurve=new l.HE(0,0,0,0),this._negativeCurve=new l.HE(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get"globalHue"(){return this._globalHue}set"globalHue"(t){this._globalHue=t,this._dirty=!0}get"globalDensity"(){return this._globalDensity}set"globalDensity"(t){this._globalDensity=t,this._dirty=!0}get"globalSaturation"(){return this._globalSaturation}set"globalSaturation"(t){this._globalSaturation=t,this._dirty=!0}get"globalExposure"(){return this._globalExposure}set"globalExposure"(t){this._globalExposure=t,this._dirty=!0}get"highlightsHue"(){return this._highlightsHue}set"highlightsHue"(t){this._highlightsHue=t,this._dirty=!0}get"highlightsDensity"(){return this._highlightsDensity}set"highlightsDensity"(t){this._highlightsDensity=t,this._dirty=!0}get"highlightsSaturation"(){return this._highlightsSaturation}set"highlightsSaturation"(t){this._highlightsSaturation=t,this._dirty=!0}get"highlightsExposure"(){return this._highlightsExposure}set"highlightsExposure"(t){this._highlightsExposure=t,this._dirty=!0}get"midtonesHue"(){return this._midtonesHue}set"midtonesHue"(t){this._midtonesHue=t,this._dirty=!0}get"midtonesDensity"(){return this._midtonesDensity}set"midtonesDensity"(t){this._midtonesDensity=t,this._dirty=!0}get"midtonesSaturation"(){return this._midtonesSaturation}set"midtonesSaturation"(t){this._midtonesSaturation=t,this._dirty=!0}get"midtonesExposure"(){return this._midtonesExposure}set"midtonesExposure"(t){this._midtonesExposure=t,this._dirty=!0}get"shadowsHue"(){return this._shadowsHue}set"shadowsHue"(t){this._shadowsHue=t,this._dirty=!0}get"shadowsDensity"(){return this._shadowsDensity}set"shadowsDensity"(t){this._shadowsDensity=t,this._dirty=!0}get"shadowsSaturation"(){return this._shadowsSaturation}set"shadowsSaturation"(t){this._shadowsSaturation=t,this._dirty=!0}get"shadowsExposure"(){return this._shadowsExposure}set"shadowsExposure"(t){this._shadowsExposure=t,this._dirty=!0}"getClassName"(){return"ColorCurves"}static"Bind"(t,i,r="vCameraColorCurvePositive",a="vCameraColorCurveNeutral",o="vCameraColorCurveNegative"){t._dirty&&(t._dirty=!1,t._getColorGradingDataToRef(t._globalHue,t._globalDensity,t._globalSaturation,t._globalExposure,t._globalCurve),t._getColorGradingDataToRef(t._highlightsHue,t._highlightsDensity,t._highlightsSaturation,t._highlightsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._highlightsCurve),t._getColorGradingDataToRef(t._midtonesHue,t._midtonesDensity,t._midtonesSaturation,t._midtonesExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._midtonesCurve),t._getColorGradingDataToRef(t._shadowsHue,t._shadowsDensity,t._shadowsSaturation,t._shadowsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._shadowsCurve),t._highlightsCurve.subtractToRef(t._midtonesCurve,t._positiveCurve),t._midtonesCurve.subtractToRef(t._shadowsCurve,t._negativeCurve)),i&&(i.setFloat4(r,t._positiveCurve.r,t._positiveCurve.g,t._positiveCurve.b,t._positiveCurve.a),i.setFloat4(a,t._midtonesCurve.r,t._midtonesCurve.g,t._midtonesCurve.b,t._midtonesCurve.a),i.setFloat4(o,t._negativeCurve.r,t._negativeCurve.g,t._negativeCurve.b,t._negativeCurve.a))}"_getColorGradingDataToRef"(t,i,r,a,o){null!=t&&(t=ColorCurves._Clamp(t,0,360),i=ColorCurves._Clamp(i,-100,100),r=ColorCurves._Clamp(r,-100,100),a=ColorCurves._Clamp(a,-100,100),i=ColorCurves._ApplyColorGradingSliderNonlinear(i),i*=.5,a=ColorCurves._ApplyColorGradingSliderNonlinear(a),i<0&&(i*=-1,t=(t+180)%360),ColorCurves._FromHSBToRef(t,i,50+.25*a,o),o.scaleToRef(2,o),o.a=1+.01*r)}static"_ApplyColorGradingSliderNonlinear"(t){t/=100;let i=Math.abs(t);return i=Math.pow(i,2),t<0&&(i*=-1),i*=100,i}static"_FromHSBToRef"(t,i,r,a){let o=ColorCurves._Clamp(t,0,360);const h=ColorCurves._Clamp(i/100,0,1),l=ColorCurves._Clamp(r/100,0,1);if(0===h)a.r=l,a.g=l,a.b=l;else{o/=60;const t=Math.floor(o),i=o-t,r=l*(1-h),c=l*(1-h*i),u=l*(1-h*(1-i));switch(t){case 0:a.r=l,a.g=u,a.b=r;break;case 1:a.r=c,a.g=l,a.b=r;break;case 2:a.r=r,a.g=l,a.b=u;break;case 3:a.r=r,a.g=c,a.b=l;break;case 4:a.r=u,a.g=r,a.b=l;break;default:a.r=l,a.g=r,a.b=c}}a.a=1}static"_Clamp"(t,i,r){return Math.min(Math.max(t,i),r)}"clone"(){return c.p.Clone(()=>new ColorCurves,this)}"serialize"(){return c.p.Serialize(this)}static"Parse"(t){return c.p.Parse(()=>new ColorCurves,t,null,null)}}ColorCurves.PrepareUniforms=PrepareUniformsForColorCurves,(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_globalHue",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_globalDensity",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_globalSaturation",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_globalExposure",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_highlightsHue",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_highlightsDensity",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_highlightsSaturation",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_highlightsExposure",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_midtonesHue",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_midtonesDensity",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_midtonesSaturation",void 0),(0,a.gn)([(0,o.qC)()],ColorCurves.prototype,"_midtonesExposure",void 0),c.p._ColorCurvesParser=ColorCurves.Parse;var u=r(5336);var d=r(646);class ImageProcessingConfiguration{"constructor"(){this.colorCurves=new ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=ImageProcessingConfiguration.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new l.HE(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=ImageProcessingConfiguration.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new h.y$}get"colorCurvesEnabled"(){return this._colorCurvesEnabled}set"colorCurvesEnabled"(t){this._colorCurvesEnabled!==t&&(this._colorCurvesEnabled=t,this._updateParameters())}get"colorGradingTexture"(){return this._colorGradingTexture}set"colorGradingTexture"(t){this._colorGradingTexture!==t&&(this._colorGradingTexture=t,this._updateParameters())}get"colorGradingEnabled"(){return this._colorGradingEnabled}set"colorGradingEnabled"(t){this._colorGradingEnabled!==t&&(this._colorGradingEnabled=t,this._updateParameters())}get"colorGradingWithGreenDepth"(){return this._colorGradingWithGreenDepth}set"colorGradingWithGreenDepth"(t){this._colorGradingWithGreenDepth!==t&&(this._colorGradingWithGreenDepth=t,this._updateParameters())}get"colorGradingBGR"(){return this._colorGradingBGR}set"colorGradingBGR"(t){this._colorGradingBGR!==t&&(this._colorGradingBGR=t,this._updateParameters())}get"exposure"(){return this._exposure}set"exposure"(t){this._exposure!==t&&(this._exposure=t,this._updateParameters())}get"toneMappingEnabled"(){return this._toneMappingEnabled}set"toneMappingEnabled"(t){this._toneMappingEnabled!==t&&(this._toneMappingEnabled=t,this._updateParameters())}get"toneMappingType"(){return this._toneMappingType}set"toneMappingType"(t){this._toneMappingType!==t&&(this._toneMappingType=t,this._updateParameters())}get"contrast"(){return this._contrast}set"contrast"(t){this._contrast!==t&&(this._contrast=t,this._updateParameters())}get"vignetteCentreY"(){return this.vignetteCenterY}set"vignetteCentreY"(t){this.vignetteCenterY=t}get"vignetteCentreX"(){return this.vignetteCenterX}set"vignetteCentreX"(t){this.vignetteCenterX=t}get"vignetteBlendMode"(){return this._vignetteBlendMode}set"vignetteBlendMode"(t){this._vignetteBlendMode!==t&&(this._vignetteBlendMode=t,this._updateParameters())}get"vignetteEnabled"(){return this._vignetteEnabled}set"vignetteEnabled"(t){this._vignetteEnabled!==t&&(this._vignetteEnabled=t,this._updateParameters())}get"ditheringEnabled"(){return this._ditheringEnabled}set"ditheringEnabled"(t){this._ditheringEnabled!==t&&(this._ditheringEnabled=t,this._updateParameters())}get"ditheringIntensity"(){return this._ditheringIntensity}set"ditheringIntensity"(t){this._ditheringIntensity!==t&&(this._ditheringIntensity=t,this._updateParameters())}get"skipFinalColorClamp"(){return this._skipFinalColorClamp}set"skipFinalColorClamp"(t){this._skipFinalColorClamp!==t&&(this._skipFinalColorClamp=t,this._updateParameters())}get"applyByPostProcess"(){return this._applyByPostProcess}set"applyByPostProcess"(t){this._applyByPostProcess!==t&&(this._applyByPostProcess=t,this._updateParameters())}get"isEnabled"(){return this._isEnabled}set"isEnabled"(t){this._isEnabled!==t&&(this._isEnabled=t,this._updateParameters())}"_updateParameters"(){this.onUpdateParameters.notifyObservers(this)}"getClassName"(){return"ImageProcessingConfiguration"}"prepareDefines"(t,i=!1){if(i!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=0,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.DITHER=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case ImageProcessingConfiguration.TONEMAPPING_KHR_PBR_NEUTRAL:t.TONEMAPPING=3;break;case ImageProcessingConfiguration.TONEMAPPING_ACES:t.TONEMAPPING=2;break;default:t.TONEMAPPING=1}else t.TONEMAPPING=0;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.DITHER=this._ditheringEnabled,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||!!t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING||t.DITHER}"isReady"(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}"bind"(t,i){if(this._colorCurvesEnabled&&this.colorCurves&&ColorCurves.Bind(this.colorCurves,t),this._vignetteEnabled||this._ditheringEnabled){const r=1/t.getEngine().getRenderWidth(),a=1/t.getEngine().getRenderHeight();if(t.setFloat2("vInverseScreenSize",r,a),this._ditheringEnabled&&t.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const o=null!=i?i:a/r;let h=Math.tan(.5*this.vignetteCameraFov),l=h*o;const c=Math.sqrt(l*h);l=(0,u.V2)(l,c,this.vignetteStretch),h=(0,u.V2)(h,c,this.vignetteStretch),t.setFloat4("vignetteSettings1",l,h,-l*this.vignetteCenterX,-h*this.vignetteCenterY);const d=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,d)}}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);const i=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(i-1)/i,.5/i,i,this.colorGradingTexture.level)}}"clone"(){return c.p.Clone(()=>new ImageProcessingConfiguration,this)}"serialize"(){return c.p.Serialize(this)}static"Parse"(t){const i=c.p.Parse(()=>new ImageProcessingConfiguration,t,null,null);return void 0!==t.vignetteCentreX&&(i.vignetteCenterX=t.vignetteCentreX),void 0!==t.vignetteCentreY&&(i.vignetteCenterY=t.vignetteCentreY),i}static get"VIGNETTEMODE_MULTIPLY"(){return this._VIGNETTEMODE_MULTIPLY}static get"VIGNETTEMODE_OPAQUE"(){return this._VIGNETTEMODE_OPAQUE}}ImageProcessingConfiguration.TONEMAPPING_STANDARD=0,ImageProcessingConfiguration.TONEMAPPING_ACES=1,ImageProcessingConfiguration.TONEMAPPING_KHR_PBR_NEUTRAL=2,ImageProcessingConfiguration.PrepareUniforms=function PrepareUniformsForImageProcessing(t,i){i.EXPOSURE&&t.push("exposureLinear"),i.CONTRAST&&t.push("contrast"),i.COLORGRADING&&t.push("colorTransformSettings"),(i.VIGNETTE||i.DITHER)&&t.push("vInverseScreenSize"),i.VIGNETTE&&(t.push("vignetteSettings1"),t.push("vignetteSettings2")),i.COLORCURVES&&PrepareUniformsForColorCurves(t),i.DITHER&&t.push("ditherIntensity")},ImageProcessingConfiguration.PrepareSamplers=function PrepareSamplersForImageProcessing(t,i){i.COLORGRADING&&t.push("txColorTransform")},ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY=0,ImageProcessingConfiguration._VIGNETTEMODE_OPAQUE=1,(0,a.gn)([(0,o.N$)()],ImageProcessingConfiguration.prototype,"colorCurves",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_colorCurvesEnabled",void 0),(0,a.gn)([(0,o.oU)("colorGradingTexture")],ImageProcessingConfiguration.prototype,"_colorGradingTexture",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_colorGradingEnabled",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_colorGradingWithGreenDepth",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_colorGradingBGR",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_exposure",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_toneMappingEnabled",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_toneMappingType",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_contrast",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"vignetteStretch",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"vignetteCenterX",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"vignetteCenterY",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"vignetteWeight",void 0),(0,a.gn)([(0,o.XX)()],ImageProcessingConfiguration.prototype,"vignetteColor",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"vignetteCameraFov",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_vignetteBlendMode",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_vignetteEnabled",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_ditheringEnabled",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_ditheringIntensity",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_skipFinalColorClamp",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_applyByPostProcess",void 0),(0,a.gn)([(0,o.qC)()],ImageProcessingConfiguration.prototype,"_isEnabled",void 0),c.p._ImageProcessingConfigurationParser=ImageProcessingConfiguration.Parse,(0,d.H7)("BABYLON.ImageProcessingConfiguration",ImageProcessingConfiguration)},"760":function(t,i,r){r.d(i,{"M":function(){return UniformBuffer}});var a=r(658),o=r(8658);class UniformBuffer{"constructor"(t,i,r,a,o=!1){this._valueCache={},this._engine=t,this._noUBO=!t.supportsUniformBuffers||o,this._dynamic=r,this._name=a??"no-name",this._data=i||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get"useUbo"(){return!this._noUBO}get"isSync"(){return!this._needSync}"isDynamic"(){return void 0!==this._dynamic}"getData"(){return this._bufferData}"getBuffer"(){return this._buffer}"_fillAlignment"(t){let i;if(i=t<=2?t:4,this._uniformLocationPointer%i!==0){const t=this._uniformLocationPointer;this._uniformLocationPointer+=i-this._uniformLocationPointer%i;const r=this._uniformLocationPointer-t;for(let t=0;t<r;t++)this._data.push(0)}}"addUniform"(t,i,r=0){if(this._noUBO)return;if(void 0!==this._uniformLocations[t])return;let a;if(r>0){if(i instanceof Array)throw"addUniform should not be use with Array in UBO: "+t;if(this._fillAlignment(4),this._uniformArraySizes[t]={"strideSize":i,"arraySize":r},16==i)i*=r;else{i=i*r+(4-i)*r}a=[];for(let t=0;t<i;t++)a.push(0)}else{if(i instanceof Array)a=i,i=a.length;else{a=[];for(let t=0;t<i;t++)a.push(0)}this._fillAlignment(i)}this._uniformSizes[t]=i,this._uniformLocations[t]=this._uniformLocationPointer,this._uniformLocationPointer+=i;for(let t=0;t<i;t++)this._data.push(a[t]);this._needSync=!0}"addMatrix"(t,i){this.addUniform(t,Array.prototype.slice.call(i.asArray()))}"addFloat2"(t,i,r){const a=[i,r];this.addUniform(t,a)}"addFloat3"(t,i,r,a){const o=[i,r,a];this.addUniform(t,o)}"addColor3"(t,i){const r=[i.r,i.g,i.b];this.addUniform(t,r)}"addColor4"(t,i,r){const a=[i.r,i.g,i.b,r];this.addUniform(t,a)}"addVector3"(t,i){const r=[i.x,i.y,i.z];this.addUniform(t,r)}"addMatrix3x3"(t){this.addUniform(t,12)}"addMatrix2x2"(t){this.addUniform(t,8)}"create"(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}"_getNames"(){const t=[];let i=0;for(const r in this._uniformLocations)if(t.push(r),10===++i)break;return t.join(",")}"_rebuild"(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}"_rebuildAfterContextLost"(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get"_numBuffers"(){return this._buffers.length}get"_indexBuffer"(){return this._bufferIndex}get"name"(){return this._name}get"currentEffect"(){return this._currentEffect}"_buffersEqual"(t,i){for(let r=0;r<t.length;++r)if(t[r]!==i[r])return!1;return!0}"_copyBuffer"(t,i){for(let r=0;r<t.length;++r)i[r]=t[r]}"update"(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(UniformBuffer._UpdatedUbosInFrame[this._name]||(UniformBuffer._UpdatedUbosInFrame[this._name]=0),UniformBuffer._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}"_createNewBuffer"(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}"_checkNewFrame"(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}"updateUniform"(t,i,r){this._checkNewFrame();let o=this._uniformLocations[t];if(void 0===o){if(this._buffer)return void a.Y.Error("Cannot add an uniform after UBO has been created. uniformName="+t);this.addUniform(t,r),o=this._uniformLocations[t]}if(this._buffer||this.create(),this._dynamic)for(let t=0;t<r;t++)this._bufferData[o+t]=i[t];else{let t=!1;for(let a=0;a<r;a++)(16===r&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[o+a]!==Math.fround(i[a]))&&(t=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[o+a]=i[a]);this._needSync=this._needSync||t}}"updateUniformArray"(t,i,r){this._checkNewFrame();const h=this._uniformLocations[t];if(void 0===h)return void a.Y.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const l=this._uniformArraySizes[t];if(this._dynamic)for(let t=0;t<r;t++)this._bufferData[h+t]=i[t];else{let t=!1,a=0,c=0;for(let u=0;u<r;u++)if(this._bufferData[h+4*c+a]!==o.w1.FloatRound(i[u])&&(t=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[h+4*c+a]=i[u]),a++,a===l.strideSize){for(;a<4;a++)this._bufferData[h+4*c+a]=0;a=0,c++}this._needSync=this._needSync||t}}"_cacheMatrix"(t,i){this._checkNewFrame();const r=this._valueCache[t],a=i.updateFlag;return(void 0===r||r!==a)&&(this._valueCache[t]=a,!0)}"_updateMatrix3x3ForUniform"(t,i){for(let t=0;t<3;t++)UniformBuffer._TempBuffer[4*t]=i[3*t],UniformBuffer._TempBuffer[4*t+1]=i[3*t+1],UniformBuffer._TempBuffer[4*t+2]=i[3*t+2],UniformBuffer._TempBuffer[4*t+3]=0;this.updateUniform(t,UniformBuffer._TempBuffer,12)}"_updateMatrix3x3ForEffect"(t,i){this._currentEffect.setMatrix3x3(t,i)}"_updateMatrix2x2ForEffect"(t,i){this._currentEffect.setMatrix2x2(t,i)}"_updateMatrix2x2ForUniform"(t,i){for(let t=0;t<2;t++)UniformBuffer._TempBuffer[4*t]=i[2*t],UniformBuffer._TempBuffer[4*t+1]=i[2*t+1],UniformBuffer._TempBuffer[4*t+2]=0,UniformBuffer._TempBuffer[4*t+3]=0;this.updateUniform(t,UniformBuffer._TempBuffer,8)}"_updateFloatForEffect"(t,i){this._currentEffect.setFloat(t,i)}"_updateFloatForUniform"(t,i){UniformBuffer._TempBuffer[0]=i,this.updateUniform(t,UniformBuffer._TempBuffer,1)}"_updateFloat2ForEffect"(t,i,r,a=""){this._currentEffect.setFloat2(t+a,i,r)}"_updateFloat2ForUniform"(t,i,r){UniformBuffer._TempBuffer[0]=i,UniformBuffer._TempBuffer[1]=r,this.updateUniform(t,UniformBuffer._TempBuffer,2)}"_updateFloat3ForEffect"(t,i,r,a,o=""){this._currentEffect.setFloat3(t+o,i,r,a)}"_updateFloat3ForUniform"(t,i,r,a){UniformBuffer._TempBuffer[0]=i,UniformBuffer._TempBuffer[1]=r,UniformBuffer._TempBuffer[2]=a,this.updateUniform(t,UniformBuffer._TempBuffer,3)}"_updateFloat4ForEffect"(t,i,r,a,o,h=""){this._currentEffect.setFloat4(t+h,i,r,a,o)}"_updateFloat4ForUniform"(t,i,r,a,o){UniformBuffer._TempBuffer[0]=i,UniformBuffer._TempBuffer[1]=r,UniformBuffer._TempBuffer[2]=a,UniformBuffer._TempBuffer[3]=o,this.updateUniform(t,UniformBuffer._TempBuffer,4)}"_updateFloatArrayForEffect"(t,i){this._currentEffect.setFloatArray(t,i)}"_updateFloatArrayForUniform"(t,i){this.updateUniformArray(t,i,i.length)}"_updateArrayForEffect"(t,i){this._currentEffect.setArray(t,i)}"_updateArrayForUniform"(t,i){this.updateUniformArray(t,i,i.length)}"_updateIntArrayForEffect"(t,i){this._currentEffect.setIntArray(t,i)}"_updateIntArrayForUniform"(t,i){UniformBuffer._TempBufferInt32View.set(i),this.updateUniformArray(t,UniformBuffer._TempBuffer,i.length)}"_updateUIntArrayForEffect"(t,i){this._currentEffect.setUIntArray(t,i)}"_updateUIntArrayForUniform"(t,i){UniformBuffer._TempBufferUInt32View.set(i),this.updateUniformArray(t,UniformBuffer._TempBuffer,i.length)}"_updateMatrixForEffect"(t,i){this._currentEffect.setMatrix(t,i)}"_updateMatrixForUniform"(t,i){this._cacheMatrix(t,i)&&this.updateUniform(t,i.asArray(),16)}"_updateMatricesForEffect"(t,i){this._currentEffect.setMatrices(t,i)}"_updateMatricesForUniform"(t,i){this.updateUniform(t,i,i.length)}"_updateVector3ForEffect"(t,i){this._currentEffect.setVector3(t,i)}"_updateVector3ForUniform"(t,i){UniformBuffer._TempBuffer[0]=i.x,UniformBuffer._TempBuffer[1]=i.y,UniformBuffer._TempBuffer[2]=i.z,this.updateUniform(t,UniformBuffer._TempBuffer,3)}"_updateVector4ForEffect"(t,i){this._currentEffect.setVector4(t,i)}"_updateVector4ForUniform"(t,i){UniformBuffer._TempBuffer[0]=i.x,UniformBuffer._TempBuffer[1]=i.y,UniformBuffer._TempBuffer[2]=i.z,UniformBuffer._TempBuffer[3]=i.w,this.updateUniform(t,UniformBuffer._TempBuffer,4)}"_updateColor3ForEffect"(t,i,r=""){this._currentEffect.setColor3(t+r,i)}"_updateColor3ForUniform"(t,i){UniformBuffer._TempBuffer[0]=i.r,UniformBuffer._TempBuffer[1]=i.g,UniformBuffer._TempBuffer[2]=i.b,this.updateUniform(t,UniformBuffer._TempBuffer,3)}"_updateColor4ForEffect"(t,i,r,a=""){this._currentEffect.setColor4(t+a,i,r)}"_updateDirectColor4ForEffect"(t,i,r=""){this._currentEffect.setDirectColor4(t+r,i)}"_updateColor4ForUniform"(t,i,r){UniformBuffer._TempBuffer[0]=i.r,UniformBuffer._TempBuffer[1]=i.g,UniformBuffer._TempBuffer[2]=i.b,UniformBuffer._TempBuffer[3]=r,this.updateUniform(t,UniformBuffer._TempBuffer,4)}"_updateDirectColor4ForUniform"(t,i){UniformBuffer._TempBuffer[0]=i.r,UniformBuffer._TempBuffer[1]=i.g,UniformBuffer._TempBuffer[2]=i.b,UniformBuffer._TempBuffer[3]=i.a,this.updateUniform(t,UniformBuffer._TempBuffer,4)}"_updateIntForEffect"(t,i,r=""){this._currentEffect.setInt(t+r,i)}"_updateIntForUniform"(t,i){UniformBuffer._TempBufferInt32View[0]=i,this.updateUniform(t,UniformBuffer._TempBuffer,1)}"_updateInt2ForEffect"(t,i,r,a=""){this._currentEffect.setInt2(t+a,i,r)}"_updateInt2ForUniform"(t,i,r){UniformBuffer._TempBufferInt32View[0]=i,UniformBuffer._TempBufferInt32View[1]=r,this.updateUniform(t,UniformBuffer._TempBuffer,2)}"_updateInt3ForEffect"(t,i,r,a,o=""){this._currentEffect.setInt3(t+o,i,r,a)}"_updateInt3ForUniform"(t,i,r,a){UniformBuffer._TempBufferInt32View[0]=i,UniformBuffer._TempBufferInt32View[1]=r,UniformBuffer._TempBufferInt32View[2]=a,this.updateUniform(t,UniformBuffer._TempBuffer,3)}"_updateInt4ForEffect"(t,i,r,a,o,h=""){this._currentEffect.setInt4(t+h,i,r,a,o)}"_updateInt4ForUniform"(t,i,r,a,o){UniformBuffer._TempBufferInt32View[0]=i,UniformBuffer._TempBufferInt32View[1]=r,UniformBuffer._TempBufferInt32View[2]=a,UniformBuffer._TempBufferInt32View[3]=o,this.updateUniform(t,UniformBuffer._TempBuffer,4)}"_updateUIntForEffect"(t,i,r=""){this._currentEffect.setUInt(t+r,i)}"_updateUIntForUniform"(t,i){UniformBuffer._TempBufferUInt32View[0]=i,this.updateUniform(t,UniformBuffer._TempBuffer,1)}"_updateUInt2ForEffect"(t,i,r,a=""){this._currentEffect.setUInt2(t+a,i,r)}"_updateUInt2ForUniform"(t,i,r){UniformBuffer._TempBufferUInt32View[0]=i,UniformBuffer._TempBufferUInt32View[1]=r,this.updateUniform(t,UniformBuffer._TempBuffer,2)}"_updateUInt3ForEffect"(t,i,r,a,o=""){this._currentEffect.setUInt3(t+o,i,r,a)}"_updateUInt3ForUniform"(t,i,r,a){UniformBuffer._TempBufferUInt32View[0]=i,UniformBuffer._TempBufferUInt32View[1]=r,UniformBuffer._TempBufferUInt32View[2]=a,this.updateUniform(t,UniformBuffer._TempBuffer,3)}"_updateUInt4ForEffect"(t,i,r,a,o,h=""){this._currentEffect.setUInt4(t+h,i,r,a,o)}"_updateUInt4ForUniform"(t,i,r,a,o){UniformBuffer._TempBufferUInt32View[0]=i,UniformBuffer._TempBufferUInt32View[1]=r,UniformBuffer._TempBufferUInt32View[2]=a,UniformBuffer._TempBufferUInt32View[3]=o,this.updateUniform(t,UniformBuffer._TempBuffer,4)}"setTexture"(t,i){this._currentEffect.setTexture(t,i)}"setTextureArray"(t,i){this._currentEffect.setTextureArray(t,i)}"bindTexture"(t,i){this._currentEffect._bindTexture(t,i)}"updateUniformDirectly"(t,i){this.updateUniform(t,i,i.length),this.update()}"bindToEffect"(t,i){this._currentEffect=t,this._currentEffectName=i}"bindUniformBuffer"(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}"unbindEffect"(){this._currentEffect=void 0,this._currentEffectName=void 0}"setDataBuffer"(t){if(!this._buffers)return this._buffer===t;for(let i=0;i<this._buffers.length;++i){if(this._buffers[i][0]===t)return this._bufferIndex=i,this._buffer=t,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}"dispose"(){if(this._noUBO)return;const t=this._engine._uniformBuffers,i=t.indexOf(this);if(-1!==i&&(t[i]=t[t.length-1],t.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let t=0;t<this._buffers.length;++t){const i=this._buffers[t][0];this._engine._releaseBuffer(i)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}UniformBuffer._UpdatedUbosInFrame={},UniformBuffer._MAX_UNIFORM_SIZE=256,UniformBuffer._TempBuffer=new Float32Array(UniformBuffer._MAX_UNIFORM_SIZE),UniformBuffer._TempBufferInt32View=new Int32Array(UniformBuffer._TempBuffer.buffer),UniformBuffer._TempBufferUInt32View=new Uint32Array(UniformBuffer._TempBuffer.buffer)},"5241":function(t,i,r){r.d(i,{"RD":function(){return Axis}});var a,o,h=r(5412);!function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD",t[t.BONE=2]="BONE"}(a||(a={}));class Axis{}Axis.X=new h.P(1,0,0),Axis.Y=new h.P(0,1,0),Axis.Z=new h.P(0,0,1),function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(o||(o={}))},"2922":function(t,i,r){r.d(i,{"HE":function(){return Color4},"Wo":function(){return Color3},"zZ":function(){return TmpColors}});var a=r(2554),o=r(646),h=r(4551),l=r(7143);function colorChannelToLinearSpace(t){return Math.pow(t,h.Nn)}function colorChannelToLinearSpaceExact(t){return t<=.04045?.0773993808*t:Math.pow(.947867299*(t+.055),2.4)}function colorChannelToGammaSpace(t){return Math.pow(t,h.zp)}function colorChannelToGammaSpaceExact(t){return t<=.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Color3{"constructor"(t=0,i=0,r=0){this.r=t,this.g=i,this.b=r}"toString"(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}"getClassName"(){return"Color3"}"getHashCode"(){let t=255*this.r|0;return t=397*t^255*this.g,t=397*t^255*this.b,t}"toArray"(t,i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this}"fromArray"(t,i=0){return Color3.FromArrayToRef(t,i,this),this}"toColor4"(t=1){return new Color4(this.r,this.g,this.b,t)}"asArray"(){return[this.r,this.g,this.b]}"toLuminance"(){return.3*this.r+.59*this.g+.11*this.b}"multiply"(t){return new Color3(this.r*t.r,this.g*t.g,this.b*t.b)}"multiplyToRef"(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i}"multiplyInPlace"(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}"multiplyByFloats"(t,i,r){return new Color3(this.r*t,this.g*i,this.b*r)}"divide"(t){throw new ReferenceError("Can not divide a color")}"divideToRef"(t,i){throw new ReferenceError("Can not divide a color")}"divideInPlace"(t){throw new ReferenceError("Can not divide a color")}"minimizeInPlace"(t){return this.minimizeInPlaceFromFloats(t.r,t.g,t.b)}"maximizeInPlace"(t){return this.maximizeInPlaceFromFloats(t.r,t.g,t.b)}"minimizeInPlaceFromFloats"(t,i,r){return this.r=Math.min(t,this.r),this.g=Math.min(i,this.g),this.b=Math.min(r,this.b),this}"maximizeInPlaceFromFloats"(t,i,r){return this.r=Math.max(t,this.r),this.g=Math.max(i,this.g),this.b=Math.max(r,this.b),this}"floorToRef"(t){throw new ReferenceError("Can not floor a color")}"floor"(){throw new ReferenceError("Can not floor a color")}"fractToRef"(t){throw new ReferenceError("Can not fract a color")}"fract"(){throw new ReferenceError("Can not fract a color")}"equals"(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b}"equalsFloats"(t,i,r){return this.equalsToFloats(t,i,r)}"equalsToFloats"(t,i,r){return this.r===t&&this.g===i&&this.b===r}"equalsWithEpsilon"(t,i=h.kn){return(0,l.l5)(this.r,t.r,i)&&(0,l.l5)(this.g,t.g,i)&&(0,l.l5)(this.b,t.b,i)}"negate"(){throw new ReferenceError("Can not negate a color")}"negateInPlace"(){throw new ReferenceError("Can not negate a color")}"negateToRef"(t){throw new ReferenceError("Can not negate a color")}"scale"(t){return new Color3(this.r*t,this.g*t,this.b*t)}"scaleInPlace"(t){return this.r*=t,this.g*=t,this.b*=t,this}"scaleToRef"(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i}"scaleAndAddToRef"(t,i){return i.r+=this.r*t,i.g+=this.g*t,i.b+=this.b*t,i}"clampToRef"(t=0,i=1,r){return r.r=(0,l.Lh)(this.r,t,i),r.g=(0,l.Lh)(this.g,t,i),r.b=(0,l.Lh)(this.b,t,i),r}"add"(t){return new Color3(this.r+t.r,this.g+t.g,this.b+t.b)}"addInPlace"(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}"addInPlaceFromFloats"(t,i,r){return this.r+=t,this.g+=i,this.b+=r,this}"addToRef"(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,i}"subtract"(t){return new Color3(this.r-t.r,this.g-t.g,this.b-t.b)}"subtractToRef"(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i}"subtractInPlace"(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this}"subtractFromFloats"(t,i,r){return new Color3(this.r-t,this.g-i,this.b-r)}"subtractFromFloatsToRef"(t,i,r,a){return a.r=this.r-t,a.g=this.g-i,a.b=this.b-r,a}"clone"(){return new Color3(this.r,this.g,this.b)}"copyFrom"(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}"copyFromFloats"(t,i,r){return this.r=t,this.g=i,this.b=r,this}"set"(t,i,r){return this.copyFromFloats(t,i,r)}"setAll"(t){return this.r=this.g=this.b=t,this}"toHexString"(){const t=Math.round(255*this.r),i=Math.round(255*this.g),r=Math.round(255*this.b);return"#"+(0,l.Nc)(t)+(0,l.Nc)(i)+(0,l.Nc)(r)}"fromHexString"(t){return"#"!==t.substring(0,1)||7!==t.length||(this.r=parseInt(t.substring(1,3),16)/255,this.g=parseInt(t.substring(3,5),16)/255,this.b=parseInt(t.substring(5,7),16)/255),this}"toHSV"(){return this.toHSVToRef(new Color3)}"toHSVToRef"(t){const i=this.r,r=this.g,a=this.b,o=Math.max(i,r,a),h=Math.min(i,r,a);let l=0,c=0;const u=o,d=o-h;return 0!==o&&(c=d/o),o!=h&&(o==i?(l=(r-a)/d,r<a&&(l+=6)):o==r?l=(a-i)/d+2:o==a&&(l=(i-r)/d+4),l*=60),t.r=l,t.g=c,t.b=u,t}"toLinearSpace"(t=!1){const i=new Color3;return this.toLinearSpaceToRef(i,t),i}"toLinearSpaceToRef"(t,i=!1){return i?(t.r=colorChannelToLinearSpaceExact(this.r),t.g=colorChannelToLinearSpaceExact(this.g),t.b=colorChannelToLinearSpaceExact(this.b)):(t.r=colorChannelToLinearSpace(this.r),t.g=colorChannelToLinearSpace(this.g),t.b=colorChannelToLinearSpace(this.b)),this}"toGammaSpace"(t=!1){const i=new Color3;return this.toGammaSpaceToRef(i,t),i}"toGammaSpaceToRef"(t,i=!1){return i?(t.r=colorChannelToGammaSpaceExact(this.r),t.g=colorChannelToGammaSpaceExact(this.g),t.b=colorChannelToGammaSpaceExact(this.b)):(t.r=colorChannelToGammaSpace(this.r),t.g=colorChannelToGammaSpace(this.g),t.b=colorChannelToGammaSpace(this.b)),this}static"HSVtoRGBToRef"(t,i,r,a){const o=r*i,h=t/60,l=o*(1-Math.abs(h%2-1));let c=0,u=0,d=0;h>=0&&h<=1?(c=o,u=l):h>=1&&h<=2?(c=l,u=o):h>=2&&h<=3?(u=o,d=l):h>=3&&h<=4?(u=l,d=o):h>=4&&h<=5?(c=l,d=o):h>=5&&h<=6&&(c=o,d=l);const _=r-o;return a.r=c+_,a.g=u+_,a.b=d+_,a}static"FromHSV"(t,i,r){const a=new Color3(0,0,0);return Color3.HSVtoRGBToRef(t,i,r,a),a}static"FromHexString"(t){return new Color3(0,0,0).fromHexString(t)}static"FromArray"(t,i=0){return new Color3(t[i],t[i+1],t[i+2])}static"FromArrayToRef"(t,i=0,r){r.r=t[i],r.g=t[i+1],r.b=t[i+2]}static"FromInts"(t,i,r){return new Color3(t/255,i/255,r/255)}static"Lerp"(t,i,r){const a=new Color3(0,0,0);return Color3.LerpToRef(t,i,r,a),a}static"LerpToRef"(t,i,r,a){a.r=t.r+(i.r-t.r)*r,a.g=t.g+(i.g-t.g)*r,a.b=t.b+(i.b-t.b)*r}static"Hermite"(t,i,r,a,o){const h=o*o,l=o*h,c=2*l-3*h+1,u=-2*l+3*h,d=l-2*h+o,_=l-h,g=t.r*c+r.r*u+i.r*d+a.r*_,p=t.g*c+r.g*u+i.g*d+a.g*_,m=t.b*c+r.b*u+i.b*d+a.b*_;return new Color3(g,p,m)}static"Hermite1stDerivative"(t,i,r,a,o){const h=Color3.Black();return this.Hermite1stDerivativeToRef(t,i,r,a,o,h),h}static"Hermite1stDerivativeToRef"(t,i,r,a,o,h){const l=o*o;h.r=6*(l-o)*t.r+(3*l-4*o+1)*i.r+6*(-l+o)*r.r+(3*l-2*o)*a.r,h.g=6*(l-o)*t.g+(3*l-4*o+1)*i.g+6*(-l+o)*r.g+(3*l-2*o)*a.g,h.b=6*(l-o)*t.b+(3*l-4*o+1)*i.b+6*(-l+o)*r.b+(3*l-2*o)*a.b}static"Red"(){return new Color3(1,0,0)}static"Green"(){return new Color3(0,1,0)}static"Blue"(){return new Color3(0,0,1)}static"Black"(){return new Color3(0,0,0)}static get"BlackReadOnly"(){return Color3._BlackReadOnly}static"White"(){return new Color3(1,1,1)}static"Purple"(){return new Color3(.5,0,.5)}static"Magenta"(){return new Color3(1,0,1)}static"Yellow"(){return new Color3(1,1,0)}static"Gray"(){return new Color3(.5,.5,.5)}static"Teal"(){return new Color3(0,1,1)}static"Random"(){return new Color3(Math.random(),Math.random(),Math.random())}}Color3._V8PerformanceHack=new Color3(.5,.5,.5),Color3._BlackReadOnly=Color3.Black(),Object.defineProperties(Color3.prototype,{"dimension":{"value":[3]},"rank":{"value":1}});class Color4{"constructor"(t=0,i=0,r=0,a=1){this.r=t,this.g=i,this.b=r,this.a=a}"asArray"(){return[this.r,this.g,this.b,this.a]}"toArray"(t,i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this}"fromArray"(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this.a=t[i+3],this}"equals"(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}"add"(t){return new Color4(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}"addToRef"(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,i.a=this.a+t.a,i}"addInPlace"(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}"addInPlaceFromFloats"(t,i,r,a){return this.r+=t,this.g+=i,this.b+=r,this.a+=a,this}"subtract"(t){return new Color4(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}"subtractToRef"(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,i}"subtractInPlace"(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}"subtractFromFloats"(t,i,r,a){return new Color4(this.r-t,this.g-i,this.b-r,this.a-a)}"subtractFromFloatsToRef"(t,i,r,a,o){return o.r=this.r-t,o.g=this.g-i,o.b=this.b-r,o.a=this.a-a,o}"scale"(t){return new Color4(this.r*t,this.g*t,this.b*t,this.a*t)}"scaleInPlace"(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}"scaleToRef"(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,i}"scaleAndAddToRef"(t,i){return i.r+=this.r*t,i.g+=this.g*t,i.b+=this.b*t,i.a+=this.a*t,i}"clampToRef"(t=0,i=1,r){return r.r=(0,l.Lh)(this.r,t,i),r.g=(0,l.Lh)(this.g,t,i),r.b=(0,l.Lh)(this.b,t,i),r.a=(0,l.Lh)(this.a,t,i),r}"multiply"(t){return new Color4(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}"multiplyToRef"(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i.a=this.a*t.a,i}"multiplyInPlace"(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a,this}"multiplyByFloats"(t,i,r,a){return new Color4(this.r*t,this.g*i,this.b*r,this.a*a)}"divide"(t){throw new ReferenceError("Can not divide a color")}"divideToRef"(t,i){throw new ReferenceError("Can not divide a color")}"divideInPlace"(t){throw new ReferenceError("Can not divide a color")}"minimizeInPlace"(t){return this.r=Math.min(this.r,t.r),this.g=Math.min(this.g,t.g),this.b=Math.min(this.b,t.b),this.a=Math.min(this.a,t.a),this}"maximizeInPlace"(t){return this.r=Math.max(this.r,t.r),this.g=Math.max(this.g,t.g),this.b=Math.max(this.b,t.b),this.a=Math.max(this.a,t.a),this}"minimizeInPlaceFromFloats"(t,i,r,a){return this.r=Math.min(t,this.r),this.g=Math.min(i,this.g),this.b=Math.min(r,this.b),this.a=Math.min(a,this.a),this}"maximizeInPlaceFromFloats"(t,i,r,a){return this.r=Math.max(t,this.r),this.g=Math.max(i,this.g),this.b=Math.max(r,this.b),this.a=Math.max(a,this.a),this}"floorToRef"(t){throw new ReferenceError("Can not floor a color")}"floor"(){throw new ReferenceError("Can not floor a color")}"fractToRef"(t){throw new ReferenceError("Can not fract a color")}"fract"(){throw new ReferenceError("Can not fract a color")}"negate"(){throw new ReferenceError("Can not negate a color")}"negateInPlace"(){throw new ReferenceError("Can not negate a color")}"negateToRef"(t){throw new ReferenceError("Can not negate a color")}"equalsWithEpsilon"(t,i=h.kn){return(0,l.l5)(this.r,t.r,i)&&(0,l.l5)(this.g,t.g,i)&&(0,l.l5)(this.b,t.b,i)&&(0,l.l5)(this.a,t.a,i)}"equalsToFloats"(t,i,r,a){return this.r===t&&this.g===i&&this.b===r&&this.a===a}"toString"(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}"getClassName"(){return"Color4"}"getHashCode"(){let t=255*this.r|0;return t=397*t^255*this.g,t=397*t^255*this.b,t=397*t^255*this.a,t}"clone"(){return(new Color4).copyFrom(this)}"copyFrom"(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}"copyFromFloats"(t,i,r,a){return this.r=t,this.g=i,this.b=r,this.a=a,this}"set"(t,i,r,a){return this.copyFromFloats(t,i,r,a)}"setAll"(t){return this.r=this.g=this.b=this.a=t,this}"toHexString"(t=!1){const i=Math.round(255*this.r),r=Math.round(255*this.g),a=Math.round(255*this.b);if(t)return"#"+(0,l.Nc)(i)+(0,l.Nc)(r)+(0,l.Nc)(a);const o=Math.round(255*this.a);return"#"+(0,l.Nc)(i)+(0,l.Nc)(r)+(0,l.Nc)(a)+(0,l.Nc)(o)}"fromHexString"(t){return"#"!==t.substring(0,1)||9!==t.length&&7!==t.length||(this.r=parseInt(t.substring(1,3),16)/255,this.g=parseInt(t.substring(3,5),16)/255,this.b=parseInt(t.substring(5,7),16)/255,9===t.length&&(this.a=parseInt(t.substring(7,9),16)/255)),this}"toLinearSpace"(t=!1){const i=new Color4;return this.toLinearSpaceToRef(i,t),i}"toLinearSpaceToRef"(t,i=!1){return i?(t.r=colorChannelToLinearSpaceExact(this.r),t.g=colorChannelToLinearSpaceExact(this.g),t.b=colorChannelToLinearSpaceExact(this.b)):(t.r=colorChannelToLinearSpace(this.r),t.g=colorChannelToLinearSpace(this.g),t.b=colorChannelToLinearSpace(this.b)),t.a=this.a,this}"toGammaSpace"(t=!1){const i=new Color4;return this.toGammaSpaceToRef(i,t),i}"toGammaSpaceToRef"(t,i=!1){return i?(t.r=colorChannelToGammaSpaceExact(this.r),t.g=colorChannelToGammaSpaceExact(this.g),t.b=colorChannelToGammaSpaceExact(this.b)):(t.r=colorChannelToGammaSpace(this.r),t.g=colorChannelToGammaSpace(this.g),t.b=colorChannelToGammaSpace(this.b)),t.a=this.a,this}static"FromHexString"(t){return"#"!==t.substring(0,1)||9!==t.length&&7!==t.length?new Color4(0,0,0,0):new Color4(0,0,0,1).fromHexString(t)}static"Lerp"(t,i,r){return Color4.LerpToRef(t,i,r,new Color4)}static"LerpToRef"(t,i,r,a){return a.r=t.r+(i.r-t.r)*r,a.g=t.g+(i.g-t.g)*r,a.b=t.b+(i.b-t.b)*r,a.a=t.a+(i.a-t.a)*r,a}static"Hermite"(t,i,r,a,o){const h=o*o,l=o*h,c=2*l-3*h+1,u=-2*l+3*h,d=l-2*h+o,_=l-h,g=t.r*c+r.r*u+i.r*d+a.r*_,p=t.g*c+r.g*u+i.g*d+a.g*_,m=t.b*c+r.b*u+i.b*d+a.b*_,T=t.a*c+r.a*u+i.a*d+a.a*_;return new Color4(g,p,m,T)}static"Hermite1stDerivative"(t,i,r,a,o){const h=new Color4;return this.Hermite1stDerivativeToRef(t,i,r,a,o,h),h}static"Hermite1stDerivativeToRef"(t,i,r,a,o,h){const l=o*o;h.r=6*(l-o)*t.r+(3*l-4*o+1)*i.r+6*(-l+o)*r.r+(3*l-2*o)*a.r,h.g=6*(l-o)*t.g+(3*l-4*o+1)*i.g+6*(-l+o)*r.g+(3*l-2*o)*a.g,h.b=6*(l-o)*t.b+(3*l-4*o+1)*i.b+6*(-l+o)*r.b+(3*l-2*o)*a.b,h.a=6*(l-o)*t.a+(3*l-4*o+1)*i.a+6*(-l+o)*r.a+(3*l-2*o)*a.a}static"FromColor3"(t,i=1){return new Color4(t.r,t.g,t.b,i)}static"FromArray"(t,i=0){return new Color4(t[i],t[i+1],t[i+2],t[i+3])}static"FromArrayToRef"(t,i=0,r){r.r=t[i],r.g=t[i+1],r.b=t[i+2],r.a=t[i+3]}static"FromInts"(t,i,r,a){return new Color4(t/255,i/255,r/255,a/255)}static"CheckColors4"(t,i){if(t.length===3*i){const i=[];for(let r=0;r<t.length;r+=3){const a=r/3*4;i[a]=t[r],i[a+1]=t[r+1],i[a+2]=t[r+2],i[a+3]=1}return i}return t}}Color4._V8PerformanceHack=new Color4(.5,.5,.5,.5),Object.defineProperties(Color4.prototype,{"dimension":{"value":[4]},"rank":{"value":1}});class TmpColors{}TmpColors.Color3=(0,a.$G)(3,Color3.Black),TmpColors.Color4=(0,a.$G)(3,()=>new Color4(0,0,0,0)),(0,o.H7)("BABYLON.Color3",Color3),(0,o.H7)("BABYLON.Color4",Color4)},"4551":function(t,i,r){r.d(i,{"Nn":function(){return o},"kn":function(){return h},"zp":function(){return a}});const a=1/2.2,o=2.2,h=(Math.sqrt(5),.001)},"8952":function(t,i,r){r.d(i,{"i":function(){return Frustum}});var a=r(6504);class Frustum{static"GetPlanes"(t){const i=[];for(let t=0;t<6;t++)i.push(new a.J(0,0,0,0));return Frustum.GetPlanesToRef(t,i),i}static"GetNearPlaneToRef"(t,i){const r=t.m;i.normal.x=r[3]+r[2],i.normal.y=r[7]+r[6],i.normal.z=r[11]+r[10],i.d=r[15]+r[14],i.normalize()}static"GetFarPlaneToRef"(t,i){const r=t.m;i.normal.x=r[3]-r[2],i.normal.y=r[7]-r[6],i.normal.z=r[11]-r[10],i.d=r[15]-r[14],i.normalize()}static"GetLeftPlaneToRef"(t,i){const r=t.m;i.normal.x=r[3]+r[0],i.normal.y=r[7]+r[4],i.normal.z=r[11]+r[8],i.d=r[15]+r[12],i.normalize()}static"GetRightPlaneToRef"(t,i){const r=t.m;i.normal.x=r[3]-r[0],i.normal.y=r[7]-r[4],i.normal.z=r[11]-r[8],i.d=r[15]-r[12],i.normalize()}static"GetTopPlaneToRef"(t,i){const r=t.m;i.normal.x=r[3]-r[1],i.normal.y=r[7]-r[5],i.normal.z=r[11]-r[9],i.d=r[15]-r[13],i.normalize()}static"GetBottomPlaneToRef"(t,i){const r=t.m;i.normal.x=r[3]+r[1],i.normal.y=r[7]+r[5],i.normal.z=r[11]+r[9],i.d=r[15]+r[13],i.normalize()}static"GetPlanesToRef"(t,i){Frustum.GetNearPlaneToRef(t,i[0]),Frustum.GetFarPlaneToRef(t,i[1]),Frustum.GetLeftPlaneToRef(t,i[2]),Frustum.GetRightPlaneToRef(t,i[3]),Frustum.GetTopPlaneToRef(t,i[4]),Frustum.GetBottomPlaneToRef(t,i[5])}static"IsPointInFrustum"(t,i){for(let r=0;r<6;r++)if(i[r].dotCoordinate(t)<0)return!1;return!0}}},"3118":function(t,i,r){var a;r(7143),r(5412),r(4551);!function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(a||(a={}))},"6504":function(t,i,r){r.d(i,{"J":function(){return Plane}});var a=r(5412);class Plane{"constructor"(t,i,r,o){this.normal=new a.P(t,i,r),this.d=o}"asArray"(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}"clone"(){return new Plane(this.normal.x,this.normal.y,this.normal.z,this.d)}"getClassName"(){return"Plane"}"getHashCode"(){let t=this.normal.getHashCode();return t=397*t^this.d,t}"normalize"(){const t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this}"transform"(t){const i=Plane._TmpMatrix;t.invertToRef(i);const r=i.m,a=this.normal.x,o=this.normal.y,h=this.normal.z,l=this.d,c=a*r[0]+o*r[1]+h*r[2]+l*r[3],u=a*r[4]+o*r[5]+h*r[6]+l*r[7],d=a*r[8]+o*r[9]+h*r[10]+l*r[11],_=a*r[12]+o*r[13]+h*r[14]+l*r[15];return new Plane(c,u,d,_)}"dotCoordinate"(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d}"copyFromPoints"(t,i,r){const a=i.x-t.x,o=i.y-t.y,h=i.z-t.z,l=r.x-t.x,c=r.y-t.y,u=r.z-t.z,d=o*u-h*c,_=h*l-a*u,g=a*c-o*l,p=Math.sqrt(d*d+_*_+g*g);let m;return m=0!==p?1/p:0,this.normal.x=d*m,this.normal.y=_*m,this.normal.z=g*m,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this}"isFrontFacingTo"(t,i){return a.P.Dot(this.normal,t)<=i}"signedDistanceTo"(t){return a.P.Dot(t,this.normal)+this.d}static"FromArray"(t){return new Plane(t[0],t[1],t[2],t[3])}static"FromPoints"(t,i,r){const a=new Plane(0,0,0,0);return a.copyFromPoints(t,i,r),a}static"FromPositionAndNormal"(t,i){const r=new Plane(0,0,0,0);return this.FromPositionAndNormalToRef(t,i,r)}static"FromPositionAndNormalToRef"(t,i,r){return r.normal.copyFrom(i),r.normal.normalize(),r.d=-t.dot(r.normal),r}static"SignedDistanceToPlaneFromPositionAndNormal"(t,i,r){const o=-(i.x*t.x+i.y*t.y+i.z*t.z);return a.P.Dot(r,i)+o}}Plane._TmpMatrix=a.y3.Identity()},"7143":function(t,i,r){function WithinEpsilon(t,i,r=1401298e-51){return Math.abs(t-i)<=r}function RandomRange(t,i){return t===i?t:Math.random()*(i-t)+t}function Lerp(t,i,r){return t+(i-t)*r}function Hermite(t,i,r,a,o){const h=o*o,l=o*h;return t*(2*l-3*h+1)+r*(-2*l+3*h)+i*(l-2*h+o)+a*(l-h)}function Clamp(t,i=0,r=1){return Math.min(r,Math.max(i,t))}function NormalizeRadians(t){return t-=2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function ToHex(t){const i=t.toString(16);return t<=15?("0"+i).toUpperCase():i.toUpperCase()}function ILog2(t){if(Math.log2)return Math.floor(Math.log2(t));if(t<0)return NaN;if(0===t)return-1/0;let i=0;if(t<1){for(;t<1;)i++,t*=2;i=-i}else if(t>1)for(;t>1;)i++,t=Math.floor(t/2);return i}r.d(i,{"EH":function(){return Lerp},"Lh":function(){return Clamp},"Nc":function(){return ToHex},"Pg":function(){return RandomRange},"Xv":function(){return Hermite},"l5":function(){return WithinEpsilon},"m5":function(){return NormalizeRadians},"uc":function(){return ILog2}})},"3321":function(t,i,r){r.d(i,{"$":function(){return Size}});class Size{"constructor"(t,i){this.width=t,this.height=i}"toString"(){return`{W: ${this.width}, H: ${this.height}}`}"getClassName"(){return"Size"}"getHashCode"(){let t=0|this.width;return t=397*t^this.height,t}"copyFrom"(t){this.width=t.width,this.height=t.height}"copyFromFloats"(t,i){return this.width=t,this.height=i,this}"set"(t,i){return this.copyFromFloats(t,i)}"multiplyByFloats"(t,i){return new Size(this.width*t,this.height*i)}"clone"(){return new Size(this.width,this.height)}"equals"(t){return!!t&&(this.width===t.width&&this.height===t.height)}get"surface"(){return this.width*this.height}static"Zero"(){return new Size(0,0)}"add"(t){return new Size(this.width+t.width,this.height+t.height)}"subtract"(t){return new Size(this.width-t.width,this.height-t.height)}"scale"(t){return new Size(this.width*t,this.height*t)}static"Lerp"(t,i,r){const a=t.width+(i.width-t.width)*r,o=t.height+(i.height-t.height)*r;return new Size(a,o)}}},"5412":function(t,i,r){r.d(i,{"FM":function(){return Vector2},"Lt":function(){return Vector4},"P":function(){return Vector3},"_f":function(){return Quaternion},"jp":function(){return TmpVectors},"y3":function(){return Matrix}});var a=r(4551),o=r(2554),h=r(646),l=r(1716),c=r(5953),u=r(7143);const _ExtractAsInt=t=>parseInt(t.toString().replace(/\W/g,""));class Vector2{"constructor"(t=0,i=0){this.x=t,this.y=i}"toString"(){return`{X: ${this.x} Y: ${this.y}}`}"getClassName"(){return"Vector2"}"getHashCode"(){let t=_ExtractAsInt(this.x);return t=397*t^_ExtractAsInt(this.y),t}"toArray"(t,i=0){return t[i]=this.x,t[i+1]=this.y,this}"fromArray"(t,i=0){return Vector2.FromArrayToRef(t,i,this),this}"asArray"(){return[this.x,this.y]}"copyFrom"(t){return this.x=t.x,this.y=t.y,this}"copyFromFloats"(t,i){return this.x=t,this.y=i,this}"set"(t,i){return this.copyFromFloats(t,i)}"setAll"(t){return this.copyFromFloats(t,t)}"add"(t){return new Vector2(this.x+t.x,this.y+t.y)}"addToRef"(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i}"addInPlace"(t){return this.x+=t.x,this.y+=t.y,this}"addInPlaceFromFloats"(t,i){return this.x+=t,this.y+=i,this}"addVector3"(t){return new Vector2(this.x+t.x,this.y+t.y)}"subtract"(t){return new Vector2(this.x-t.x,this.y-t.y)}"subtractToRef"(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i}"subtractInPlace"(t){return this.x-=t.x,this.y-=t.y,this}"multiplyInPlace"(t){return this.x*=t.x,this.y*=t.y,this}"multiply"(t){return new Vector2(this.x*t.x,this.y*t.y)}"multiplyToRef"(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i}"multiplyByFloats"(t,i){return new Vector2(this.x*t,this.y*i)}"divide"(t){return new Vector2(this.x/t.x,this.y/t.y)}"divideToRef"(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i}"divideInPlace"(t){return this.x=this.x/t.x,this.y=this.y/t.y,this}"minimizeInPlace"(t){return this.minimizeInPlaceFromFloats(t.x,t.y)}"maximizeInPlace"(t){return this.maximizeInPlaceFromFloats(t.x,t.y)}"minimizeInPlaceFromFloats"(t,i){return this.x=Math.min(t,this.x),this.y=Math.min(i,this.y),this}"maximizeInPlaceFromFloats"(t,i){return this.x=Math.max(t,this.x),this.y=Math.max(i,this.y),this}"subtractFromFloats"(t,i){return new Vector2(this.x-t,this.y-i)}"subtractFromFloatsToRef"(t,i,r){return r.x=this.x-t,r.y=this.y-i,r}"negate"(){return new Vector2(-this.x,-this.y)}"negateInPlace"(){return this.x*=-1,this.y*=-1,this}"negateToRef"(t){return t.x=-this.x,t.y=-this.y,t}"scaleInPlace"(t){return this.x*=t,this.y*=t,this}"scale"(t){return new Vector2(this.x*t,this.y*t)}"scaleToRef"(t,i){return i.x=this.x*t,i.y=this.y*t,i}"scaleAndAddToRef"(t,i){return i.x+=this.x*t,i.y+=this.y*t,i}"equals"(t){return t&&this.x===t.x&&this.y===t.y}"equalsWithEpsilon"(t,i=a.kn){return t&&(0,u.l5)(this.x,t.x,i)&&(0,u.l5)(this.y,t.y,i)}"equalsToFloats"(t,i){return this.x===t&&this.y===i}"floor"(){return new Vector2(Math.floor(this.x),Math.floor(this.y))}"floorToRef"(t){return t.x=Math.floor(this.x),t.y=Math.floor(this.y),t}"fract"(){return new Vector2(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}"fractToRef"(t){return t.x=this.x-Math.floor(this.x),t.y=this.y-Math.floor(this.y),t}"rotateToRef"(t,i){const r=Math.cos(t),a=Math.sin(t),o=r*this.x-a*this.y,h=a*this.x+r*this.y;return i.x=o,i.y=h,i}"length"(){return Math.sqrt(this.x*this.x+this.y*this.y)}"lengthSquared"(){return this.x*this.x+this.y*this.y}"normalize"(){return this.normalizeFromLength(this.length())}"normalizeFromLength"(t){return 0===t||1===t?this:this.scaleInPlace(1/t)}"normalizeToNew"(){const t=new Vector2;return this.normalizeToRef(t),t}"normalizeToRef"(t){const i=this.length();return 0===i&&(t.x=this.x,t.y=this.y),this.scaleToRef(1/i,t)}"clone"(){return new Vector2(this.x,this.y)}"dot"(t){return this.x*t.x+this.y*t.y}static"Zero"(){return new Vector2(0,0)}static"One"(){return new Vector2(1,1)}static"Random"(t=0,i=1){return new Vector2((0,u.Pg)(t,i),(0,u.Pg)(t,i))}static"RandomToRef"(t=0,i=1,r){return r.copyFromFloats((0,u.Pg)(t,i),(0,u.Pg)(t,i))}static get"ZeroReadOnly"(){return Vector2._ZeroReadOnly}static"FromArray"(t,i=0){return new Vector2(t[i],t[i+1])}static"FromArrayToRef"(t,i,r){return r.x=t[i],r.y=t[i+1],r}static"FromFloatsToRef"(t,i,r){return r.copyFromFloats(t,i),r}static"CatmullRom"(t,i,r,a,o){const h=o*o,l=o*h,c=.5*(2*i.x+(-t.x+r.x)*o+(2*t.x-5*i.x+4*r.x-a.x)*h+(-t.x+3*i.x-3*r.x+a.x)*l),u=.5*(2*i.y+(-t.y+r.y)*o+(2*t.y-5*i.y+4*r.y-a.y)*h+(-t.y+3*i.y-3*r.y+a.y)*l);return new Vector2(c,u)}static"ClampToRef"(t,i,r,a){return a.x=(0,u.Lh)(t.x,i.x,r.x),a.y=(0,u.Lh)(t.y,i.y,r.y),a}static"Clamp"(t,i,r){const a=(0,u.Lh)(t.x,i.x,r.x),o=(0,u.Lh)(t.y,i.y,r.y);return new Vector2(a,o)}static"Hermite"(t,i,r,a,o){const h=o*o,l=o*h,c=2*l-3*h+1,u=-2*l+3*h,d=l-2*h+o,_=l-h,g=t.x*c+r.x*u+i.x*d+a.x*_,p=t.y*c+r.y*u+i.y*d+a.y*_;return new Vector2(g,p)}static"Hermite1stDerivative"(t,i,r,a,o){return this.Hermite1stDerivativeToRef(t,i,r,a,o,new Vector2)}static"Hermite1stDerivativeToRef"(t,i,r,a,o,h){const l=o*o;return h.x=6*(l-o)*t.x+(3*l-4*o+1)*i.x+6*(-l+o)*r.x+(3*l-2*o)*a.x,h.y=6*(l-o)*t.y+(3*l-4*o+1)*i.y+6*(-l+o)*r.y+(3*l-2*o)*a.y,h}static"Lerp"(t,i,r){return Vector2.LerpToRef(t,i,r,new Vector2)}static"LerpToRef"(t,i,r,a){return a.x=t.x+(i.x-t.x)*r,a.y=t.y+(i.y-t.y)*r,a}static"Dot"(t,i){return t.x*i.x+t.y*i.y}static"Normalize"(t){return Vector2.NormalizeToRef(t,new Vector2)}static"NormalizeToRef"(t,i){return t.normalizeToRef(i),i}static"Minimize"(t,i){const r=t.x<i.x?t.x:i.x,a=t.y<i.y?t.y:i.y;return new Vector2(r,a)}static"Maximize"(t,i){const r=t.x>i.x?t.x:i.x,a=t.y>i.y?t.y:i.y;return new Vector2(r,a)}static"Transform"(t,i){return Vector2.TransformToRef(t,i,new Vector2)}static"TransformToRef"(t,i,r){const a=i.m,o=t.x*a[0]+t.y*a[4]+a[12],h=t.x*a[1]+t.y*a[5]+a[13];return r.x=o,r.y=h,r}static"PointInTriangle"(t,i,r,a){const o=.5*(-r.y*a.x+i.y*(-r.x+a.x)+i.x*(r.y-a.y)+r.x*a.y),h=o<0?-1:1,l=(i.y*a.x-i.x*a.y+(a.y-i.y)*t.x+(i.x-a.x)*t.y)*h,c=(i.x*r.y-i.y*r.x+(i.y-r.y)*t.x+(r.x-i.x)*t.y)*h;return l>0&&c>0&&l+c<2*o*h}static"Distance"(t,i){return Math.sqrt(Vector2.DistanceSquared(t,i))}static"DistanceSquared"(t,i){const r=t.x-i.x,a=t.y-i.y;return r*r+a*a}static"Center"(t,i){return Vector2.CenterToRef(t,i,new Vector2)}static"CenterToRef"(t,i,r){return r.copyFromFloats((t.x+i.x)/2,(t.y+i.y)/2)}static"DistanceOfPointFromSegment"(t,i,r){const a=Vector2.DistanceSquared(i,r);if(0===a)return Vector2.Distance(t,i);const o=r.subtract(i),h=Math.max(0,Math.min(1,Vector2.Dot(t.subtract(i),o)/a)),l=i.add(o.multiplyByFloats(h,h));return Vector2.Distance(t,l)}}Vector2._V8PerformanceHack=new Vector2(.5,.5),Vector2._ZeroReadOnly=Vector2.Zero(),Object.defineProperties(Vector2.prototype,{"dimension":{"value":[2]},"rank":{"value":1}});class Vector3{get"x"(){return this._x}set"x"(t){this._x=t,this._isDirty=!0}get"y"(){return this._y}set"y"(t){this._y=t,this._isDirty=!0}get"z"(){return this._z}set"z"(t){this._z=t,this._isDirty=!0}"constructor"(t=0,i=0,r=0){this._isDirty=!0,this._x=t,this._y=i,this._z=r}"toString"(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}"getClassName"(){return"Vector3"}"getHashCode"(){let t=_ExtractAsInt(this._x);return t=397*t^_ExtractAsInt(this._y),t=397*t^_ExtractAsInt(this._z),t}"asArray"(){return[this._x,this._y,this._z]}"toArray"(t,i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,this}"fromArray"(t,i=0){return Vector3.FromArrayToRef(t,i,this),this}"toQuaternion"(){return Quaternion.RotationYawPitchRoll(this._y,this._x,this._z)}"addInPlace"(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._isDirty=!0,this}"addInPlaceFromFloats"(t,i,r){return this._x+=t,this._y+=i,this._z+=r,this._isDirty=!0,this}"add"(t){return new Vector3(this._x+t._x,this._y+t._y,this._z+t._z)}"addToRef"(t,i){return i._x=this._x+t._x,i._y=this._y+t._y,i._z=this._z+t._z,i._isDirty=!0,i}"subtractInPlace"(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._isDirty=!0,this}"subtract"(t){return new Vector3(this._x-t._x,this._y-t._y,this._z-t._z)}"subtractToRef"(t,i){return this.subtractFromFloatsToRef(t._x,t._y,t._z,i)}"subtractFromFloats"(t,i,r){return new Vector3(this._x-t,this._y-i,this._z-r)}"subtractFromFloatsToRef"(t,i,r,a){return a._x=this._x-t,a._y=this._y-i,a._z=this._z-r,a._isDirty=!0,a}"negate"(){return new Vector3(-this._x,-this._y,-this._z)}"negateInPlace"(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}"negateToRef"(t){return t._x=-1*this._x,t._y=-1*this._y,t._z=-1*this._z,t._isDirty=!0,t}"scaleInPlace"(t){return this._x*=t,this._y*=t,this._z*=t,this._isDirty=!0,this}"scale"(t){return new Vector3(this._x*t,this._y*t,this._z*t)}"scaleToRef"(t,i){return i._x=this._x*t,i._y=this._y*t,i._z=this._z*t,i._isDirty=!0,i}"getNormalToRef"(t){const i=this.length();let r=Math.acos(this.y/i);const a=Math.atan2(this.z,this.x);r>Math.PI/2?r-=Math.PI/2:r+=Math.PI/2;const o=i*Math.sin(r)*Math.cos(a),h=i*Math.cos(r),l=i*Math.sin(r)*Math.sin(a);return t.set(o,h,l),t}"applyRotationQuaternionToRef"(t,i){const r=this._x,a=this._y,o=this._z,h=t._x,l=t._y,c=t._z,u=t._w,d=2*(l*o-c*a),_=2*(c*r-h*o),g=2*(h*a-l*r);return i._x=r+u*d+l*g-c*_,i._y=a+u*_+c*d-h*g,i._z=o+u*g+h*_-l*d,i._isDirty=!0,i}"applyRotationQuaternionInPlace"(t){return this.applyRotationQuaternionToRef(t,this)}"applyRotationQuaternion"(t){return this.applyRotationQuaternionToRef(t,new Vector3)}"scaleAndAddToRef"(t,i){return i._x+=this._x*t,i._y+=this._y*t,i._z+=this._z*t,i._isDirty=!0,i}"projectOnPlane"(t,i){return this.projectOnPlaneToRef(t,i,new Vector3)}"projectOnPlaneToRef"(t,i,r){const a=t.normal,o=t.d,h=MathTmp.Vector3[0];this.subtractToRef(i,h),h.normalize();const l=Vector3.Dot(h,a);if(Math.abs(l)<1e-10)r.setAll(1/0);else{const t=-(Vector3.Dot(i,a)+o)/l,c=h.scaleInPlace(t);i.addToRef(c,r)}return r}"equals"(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z}"equalsWithEpsilon"(t,i=a.kn){return t&&(0,u.l5)(this._x,t._x,i)&&(0,u.l5)(this._y,t._y,i)&&(0,u.l5)(this._z,t._z,i)}"equalsToFloats"(t,i,r){return this._x===t&&this._y===i&&this._z===r}"multiplyInPlace"(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._isDirty=!0,this}"multiply"(t){return this.multiplyByFloats(t._x,t._y,t._z)}"multiplyToRef"(t,i){return i._x=this._x*t._x,i._y=this._y*t._y,i._z=this._z*t._z,i._isDirty=!0,i}"multiplyByFloats"(t,i,r){return new Vector3(this._x*t,this._y*i,this._z*r)}"divide"(t){return new Vector3(this._x/t._x,this._y/t._y,this._z/t._z)}"divideToRef"(t,i){return i._x=this._x/t._x,i._y=this._y/t._y,i._z=this._z/t._z,i._isDirty=!0,i}"divideInPlace"(t){return this._x=this._x/t._x,this._y=this._y/t._y,this._z=this._z/t._z,this._isDirty=!0,this}"minimizeInPlace"(t){return this.minimizeInPlaceFromFloats(t._x,t._y,t._z)}"maximizeInPlace"(t){return this.maximizeInPlaceFromFloats(t._x,t._y,t._z)}"minimizeInPlaceFromFloats"(t,i,r){return t<this._x&&(this.x=t),i<this._y&&(this.y=i),r<this._z&&(this.z=r),this}"maximizeInPlaceFromFloats"(t,i,r){return t>this._x&&(this.x=t),i>this._y&&(this.y=i),r>this._z&&(this.z=r),this}"isNonUniformWithinEpsilon"(t){const i=Math.abs(this._x),r=Math.abs(this._y);if(!(0,u.l5)(i,r,t))return!0;const a=Math.abs(this._z);return!(0,u.l5)(i,a,t)||!(0,u.l5)(r,a,t)}get"isNonUniform"(){const t=Math.abs(this._x);if(t!==Math.abs(this._y))return!0;return t!==Math.abs(this._z)}"floorToRef"(t){return t._x=Math.floor(this._x),t._y=Math.floor(this._y),t._z=Math.floor(this._z),t._isDirty=!0,t}"floor"(){return new Vector3(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}"fractToRef"(t){return t._x=this.x-Math.floor(this._x),t._y=this.y-Math.floor(this._y),t._z=this.z-Math.floor(this._z),t._isDirty=!0,t}"fract"(){return new Vector3(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}"length"(){return Math.sqrt(this.lengthSquared())}"lengthSquared"(){return this._x*this._x+this._y*this._y+this._z*this._z}get"hasAZeroComponent"(){return this._x*this._y*this._z===0}"normalize"(){return this.normalizeFromLength(this.length())}"reorderInPlace"(t){if("xyz"===(t=t.toLowerCase()))return this;const i=MathTmp.Vector3[0].copyFrom(this);return this.x=i[t[0]],this.y=i[t[1]],this.z=i[t[2]],this}"rotateByQuaternionToRef"(t,i){return t.toRotationMatrix(MathTmp.Matrix[0]),Vector3.TransformCoordinatesToRef(this,MathTmp.Matrix[0],i),i}"rotateByQuaternionAroundPointToRef"(t,i,r){return this.subtractToRef(i,MathTmp.Vector3[0]),MathTmp.Vector3[0].rotateByQuaternionToRef(t,MathTmp.Vector3[0]),i.addToRef(MathTmp.Vector3[0],r),r}"cross"(t){return Vector3.CrossToRef(this,t,new Vector3)}"normalizeFromLength"(t){return 0===t||1===t?this:this.scaleInPlace(1/t)}"normalizeToNew"(){return this.normalizeToRef(new Vector3)}"normalizeToRef"(t){const i=this.length();return 0===i||1===i?(t._x=this._x,t._y=this._y,t._z=this._z,t._isDirty=!0,t):this.scaleToRef(1/i,t)}"clone"(){return new Vector3(this._x,this._y,this._z)}"copyFrom"(t){return this.copyFromFloats(t._x,t._y,t._z)}"copyFromFloats"(t,i,r){return this._x=t,this._y=i,this._z=r,this._isDirty=!0,this}"set"(t,i,r){return this.copyFromFloats(t,i,r)}"setAll"(t){return this._x=this._y=this._z=t,this._isDirty=!0,this}static"GetClipFactor"(t,i,r,a){const o=Vector3.Dot(t,r);return(o-a)/(o-Vector3.Dot(i,r))}static"GetAngleBetweenVectors"(t,i,r){const a=t.normalizeToRef(MathTmp.Vector3[1]),o=i.normalizeToRef(MathTmp.Vector3[2]);let h=Vector3.Dot(a,o);h=(0,u.Lh)(h,-1,1);const l=Math.acos(h),c=MathTmp.Vector3[3];return Vector3.CrossToRef(a,o,c),Vector3.Dot(c,r)>0?isNaN(l)?0:l:isNaN(l)?-Math.PI:-Math.acos(h)}static"GetAngleBetweenVectorsOnPlane"(t,i,r){MathTmp.Vector3[0].copyFrom(t);const a=MathTmp.Vector3[0];MathTmp.Vector3[1].copyFrom(i);const o=MathTmp.Vector3[1];MathTmp.Vector3[2].copyFrom(r);const h=MathTmp.Vector3[2],l=MathTmp.Vector3[3],c=MathTmp.Vector3[4];a.normalize(),o.normalize(),h.normalize(),Vector3.CrossToRef(h,a,l),Vector3.CrossToRef(l,h,c);const d=Math.atan2(Vector3.Dot(o,l),Vector3.Dot(o,c));return(0,u.m5)(d)}static"PitchYawRollToMoveBetweenPointsToRef"(t,i,r){const a=TmpVectors.Vector3[0];return i.subtractToRef(t,a),r._y=Math.atan2(a.x,a.z)||0,r._x=Math.atan2(Math.sqrt(a.x**2+a.z**2),a.y)||0,r._z=0,r._isDirty=!0,r}static"PitchYawRollToMoveBetweenPoints"(t,i){const r=Vector3.Zero();return Vector3.PitchYawRollToMoveBetweenPointsToRef(t,i,r)}static"SlerpToRef"(t,i,r,o){r=(0,u.Lh)(r,0,1);const h=MathTmp.Vector3[0],l=MathTmp.Vector3[1];h.copyFrom(t);const c=h.length();h.normalizeFromLength(c),l.copyFrom(i);const d=l.length();l.normalizeFromLength(d);const _=Vector3.Dot(h,l);let g,p;if(_<1-a.kn){const t=Math.acos(_),i=1/Math.sin(t);g=Math.sin((1-r)*t)*i,p=Math.sin(r*t)*i}else g=1-r,p=r;return h.scaleInPlace(g),l.scaleInPlace(p),o.copyFrom(h).addInPlace(l),o.scaleInPlace((0,u.EH)(c,d,r)),o}static"SmoothToRef"(t,i,r,a,o){return Vector3.SlerpToRef(t,i,0===a?1:r/a,o),o}static"FromArray"(t,i=0){return new Vector3(t[i],t[i+1],t[i+2])}static"FromFloatArray"(t,i){return Vector3.FromArray(t,i)}static"FromArrayToRef"(t,i,r){return r._x=t[i],r._y=t[i+1],r._z=t[i+2],r._isDirty=!0,r}static"FromFloatArrayToRef"(t,i,r){return Vector3.FromArrayToRef(t,i,r)}static"FromFloatsToRef"(t,i,r,a){return a.copyFromFloats(t,i,r),a}static"Zero"(){return new Vector3(0,0,0)}static"One"(){return new Vector3(1,1,1)}static"Up"(){return new Vector3(0,1,0)}static get"UpReadOnly"(){return Vector3._UpReadOnly}static get"DownReadOnly"(){return Vector3._DownReadOnly}static get"RightReadOnly"(){return Vector3._RightReadOnly}static get"LeftReadOnly"(){return Vector3._LeftReadOnly}static get"LeftHandedForwardReadOnly"(){return Vector3._LeftHandedForwardReadOnly}static get"RightHandedForwardReadOnly"(){return Vector3._RightHandedForwardReadOnly}static get"LeftHandedBackwardReadOnly"(){return Vector3._LeftHandedBackwardReadOnly}static get"RightHandedBackwardReadOnly"(){return Vector3._RightHandedBackwardReadOnly}static get"ZeroReadOnly"(){return Vector3._ZeroReadOnly}static get"OneReadOnly"(){return Vector3._OneReadOnly}static"Down"(){return new Vector3(0,-1,0)}static"Forward"(t=!1){return new Vector3(0,0,t?-1:1)}static"Backward"(t=!1){return new Vector3(0,0,t?1:-1)}static"Right"(){return new Vector3(1,0,0)}static"Left"(){return new Vector3(-1,0,0)}static"Random"(t=0,i=1){return new Vector3((0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i))}static"RandomToRef"(t=0,i=1,r){return r.copyFromFloats((0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i))}static"TransformCoordinates"(t,i){const r=Vector3.Zero();return Vector3.TransformCoordinatesToRef(t,i,r),r}static"TransformCoordinatesToRef"(t,i,r){return Vector3.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,r),r}static"TransformCoordinatesFromFloatsToRef"(t,i,r,a,o){const h=a.m,l=t*h[0]+i*h[4]+r*h[8]+h[12],c=t*h[1]+i*h[5]+r*h[9]+h[13],u=t*h[2]+i*h[6]+r*h[10]+h[14],d=1/(t*h[3]+i*h[7]+r*h[11]+h[15]);return o._x=l*d,o._y=c*d,o._z=u*d,o._isDirty=!0,o}static"TransformNormal"(t,i){const r=Vector3.Zero();return Vector3.TransformNormalToRef(t,i,r),r}static"TransformNormalToRef"(t,i,r){return this.TransformNormalFromFloatsToRef(t._x,t._y,t._z,i,r),r}static"TransformNormalFromFloatsToRef"(t,i,r,a,o){const h=a.m;return o._x=t*h[0]+i*h[4]+r*h[8],o._y=t*h[1]+i*h[5]+r*h[9],o._z=t*h[2]+i*h[6]+r*h[10],o._isDirty=!0,o}static"CatmullRom"(t,i,r,a,o){const h=o*o,l=o*h,c=.5*(2*i._x+(-t._x+r._x)*o+(2*t._x-5*i._x+4*r._x-a._x)*h+(-t._x+3*i._x-3*r._x+a._x)*l),u=.5*(2*i._y+(-t._y+r._y)*o+(2*t._y-5*i._y+4*r._y-a._y)*h+(-t._y+3*i._y-3*r._y+a._y)*l),d=.5*(2*i._z+(-t._z+r._z)*o+(2*t._z-5*i._z+4*r._z-a._z)*h+(-t._z+3*i._z-3*r._z+a._z)*l);return new Vector3(c,u,d)}static"Clamp"(t,i,r){const a=new Vector3;return Vector3.ClampToRef(t,i,r,a),a}static"ClampToRef"(t,i,r,a){let o=t._x;o=o>r._x?r._x:o,o=o<i._x?i._x:o;let h=t._y;h=h>r._y?r._y:h,h=h<i._y?i._y:h;let l=t._z;return l=l>r._z?r._z:l,l=l<i._z?i._z:l,a.copyFromFloats(o,h,l),a}static"CheckExtends"(t,i,r){i.minimizeInPlace(t),r.maximizeInPlace(t)}static"Hermite"(t,i,r,a,o){const h=o*o,l=o*h,c=2*l-3*h+1,u=-2*l+3*h,d=l-2*h+o,_=l-h,g=t._x*c+r._x*u+i._x*d+a._x*_,p=t._y*c+r._y*u+i._y*d+a._y*_,m=t._z*c+r._z*u+i._z*d+a._z*_;return new Vector3(g,p,m)}static"Hermite1stDerivative"(t,i,r,a,o){const h=new Vector3;return this.Hermite1stDerivativeToRef(t,i,r,a,o,h),h}static"Hermite1stDerivativeToRef"(t,i,r,a,o,h){const l=o*o;return h._x=6*(l-o)*t._x+(3*l-4*o+1)*i._x+6*(-l+o)*r._x+(3*l-2*o)*a._x,h._y=6*(l-o)*t._y+(3*l-4*o+1)*i._y+6*(-l+o)*r._y+(3*l-2*o)*a._y,h._z=6*(l-o)*t._z+(3*l-4*o+1)*i._z+6*(-l+o)*r._z+(3*l-2*o)*a._z,h._isDirty=!0,h}static"Lerp"(t,i,r){const a=new Vector3(0,0,0);return Vector3.LerpToRef(t,i,r,a),a}static"LerpToRef"(t,i,r,a){return a._x=t._x+(i._x-t._x)*r,a._y=t._y+(i._y-t._y)*r,a._z=t._z+(i._z-t._z)*r,a._isDirty=!0,a}static"Dot"(t,i){return t._x*i._x+t._y*i._y+t._z*i._z}"dot"(t){return this._x*t._x+this._y*t._y+this._z*t._z}static"Cross"(t,i){const r=new Vector3;return Vector3.CrossToRef(t,i,r),r}static"CrossToRef"(t,i,r){const a=t._y*i._z-t._z*i._y,o=t._z*i._x-t._x*i._z,h=t._x*i._y-t._y*i._x;return r.copyFromFloats(a,o,h),r}static"Normalize"(t){const i=Vector3.Zero();return Vector3.NormalizeToRef(t,i),i}static"NormalizeToRef"(t,i){return t.normalizeToRef(i),i}static"Project"(t,i,r,a){const o=new Vector3;return Vector3.ProjectToRef(t,i,r,a,o),o}static"ProjectToRef"(t,i,r,a,o){const h=a.width,l=a.height,u=a.x,d=a.y,_=MathTmp.Matrix[1],g=c.l.LastCreatedEngine?.isNDCHalfZRange,p=g?1:.5,m=g?0:.5;Matrix.FromValuesToRef(h/2,0,0,0,0,-l/2,0,0,0,0,p,0,u+h/2,l/2+d,m,1,_);const T=MathTmp.Matrix[0];return i.multiplyToRef(r,T),T.multiplyToRef(_,T),Vector3.TransformCoordinatesToRef(t,T,o),o}static"Reflect"(t,i){return this.ReflectToRef(t,i,new Vector3)}static"ReflectToRef"(t,i,r){const a=TmpVectors.Vector3[0];return a.copyFrom(i).scaleInPlace(2*Vector3.Dot(t,i)),r.copyFrom(t).subtractInPlace(a)}static"_UnprojectFromInvertedMatrixToRef"(t,i,r){Vector3.TransformCoordinatesToRef(t,i,r);const a=i.m,o=t._x*a[3]+t._y*a[7]+t._z*a[11]+a[15];return(0,u.l5)(o,1)&&r.scaleInPlace(1/o),r}static"UnprojectFromTransform"(t,i,r,a,o){return this.Unproject(t,i,r,a,o,Matrix.IdentityReadOnly)}static"Unproject"(t,i,r,a,o,h){const l=new Vector3;return Vector3.UnprojectToRef(t,i,r,a,o,h,l),l}static"UnprojectToRef"(t,i,r,a,o,h,l){return Vector3.UnprojectFloatsToRef(t._x,t._y,t._z,i,r,a,o,h,l),l}static"UnprojectFloatsToRef"(t,i,r,a,o,h,l,u,d){const _=MathTmp.Matrix[0];h.multiplyToRef(l,_),_.multiplyToRef(u,_),_.invert();const g=MathTmp.Vector3[0];return g.x=t/a*2-1,g.y=-(i/o*2-1),c.l.LastCreatedEngine?.isNDCHalfZRange?g.z=r:g.z=2*r-1,Vector3._UnprojectFromInvertedMatrixToRef(g,_,d),d}static"Minimize"(t,i){const r=new Vector3;return r.copyFrom(t),r.minimizeInPlace(i),r}static"Maximize"(t,i){const r=new Vector3;return r.copyFrom(t),r.maximizeInPlace(i),r}static"Distance"(t,i){return Math.sqrt(Vector3.DistanceSquared(t,i))}static"DistanceSquared"(t,i){const r=t._x-i._x,a=t._y-i._y,o=t._z-i._z;return r*r+a*a+o*o}static"ProjectOnTriangleToRef"(t,i,r,o,h){const l=MathTmp.Vector3[0],c=MathTmp.Vector3[1],d=MathTmp.Vector3[2],_=MathTmp.Vector3[3],g=MathTmp.Vector3[4];r.subtractToRef(i,l),o.subtractToRef(i,c),o.subtractToRef(r,d);const p=l.length(),m=c.length(),T=d.length();if(p<a.kn||m<a.kn||T<a.kn)return h.copyFrom(i),Vector3.Distance(t,i);t.subtractToRef(i,g),Vector3.CrossToRef(l,c,_);const y=_.length();if(y<a.kn)return h.copyFrom(i),Vector3.Distance(t,i);_.normalizeFromLength(y);let M=g.length();if(M<a.kn)return h.copyFrom(i),0;g.normalizeFromLength(M);const b=Vector3.Dot(_,g),x=MathTmp.Vector3[5],E=MathTmp.Vector3[6];x.copyFrom(_).scaleInPlace(-M*b),E.copyFrom(t).addInPlace(x);const R=MathTmp.Vector3[4],A=MathTmp.Vector3[5],C=MathTmp.Vector3[7],v=MathTmp.Vector3[8];R.copyFrom(l).scaleInPlace(1/p),v.copyFrom(c).scaleInPlace(1/m),R.addInPlace(v).scaleInPlace(-1),A.copyFrom(l).scaleInPlace(-1/p),v.copyFrom(d).scaleInPlace(1/T),A.addInPlace(v).scaleInPlace(-1),C.copyFrom(d).scaleInPlace(-1/T),v.copyFrom(c).scaleInPlace(-1/m),C.addInPlace(v).scaleInPlace(-1);const P=MathTmp.Vector3[9];let S;P.copyFrom(E).subtractInPlace(i),Vector3.CrossToRef(R,P,v),S=Vector3.Dot(v,_);const I=S;P.copyFrom(E).subtractInPlace(r),Vector3.CrossToRef(A,P,v),S=Vector3.Dot(v,_);const D=S;P.copyFrom(E).subtractInPlace(o),Vector3.CrossToRef(C,P,v),S=Vector3.Dot(v,_);const O=S,w=MathTmp.Vector3[10];let B,L;I>0&&D<0?(w.copyFrom(l),B=i,L=r):D>0&&O<0?(w.copyFrom(d),B=r,L=o):(w.copyFrom(c).scaleInPlace(-1),B=o,L=i);const N=MathTmp.Vector3[9],U=MathTmp.Vector3[4];B.subtractToRef(E,v),L.subtractToRef(E,N),Vector3.CrossToRef(v,N,U);if(!(Vector3.Dot(U,_)<0))return h.copyFrom(E),Math.abs(M*b);const k=MathTmp.Vector3[5];Vector3.CrossToRef(w,U,k),k.normalize();const V=MathTmp.Vector3[9];V.copyFrom(B).subtractInPlace(E);const G=V.length();if(G<a.kn)return h.copyFrom(B),Vector3.Distance(t,B);V.normalizeFromLength(G);const z=Vector3.Dot(k,V),W=MathTmp.Vector3[7];W.copyFrom(E).addInPlace(k.scaleInPlace(G*z)),v.copyFrom(W).subtractInPlace(B),M=w.length(),w.normalizeFromLength(M);let H=Vector3.Dot(v,w)/Math.max(M,a.kn);return H=(0,u.Lh)(H,0,1),W.copyFrom(B).addInPlace(w.scaleInPlace(H*M)),h.copyFrom(W),Vector3.Distance(t,W)}static"Center"(t,i){return Vector3.CenterToRef(t,i,Vector3.Zero())}static"CenterToRef"(t,i,r){return r.copyFromFloats((t._x+i._x)/2,(t._y+i._y)/2,(t._z+i._z)/2)}static"RotationFromAxis"(t,i,r){const a=new Vector3;return Vector3.RotationFromAxisToRef(t,i,r,a),a}static"RotationFromAxisToRef"(t,i,r,a){const o=MathTmp.Quaternion[0];return Quaternion.RotationQuaternionFromAxisToRef(t,i,r,o),o.toEulerAnglesToRef(a),a}}Vector3._V8PerformanceHack=new Vector3(.5,.5,.5),Vector3._UpReadOnly=Vector3.Up(),Vector3._DownReadOnly=Vector3.Down(),Vector3._LeftHandedForwardReadOnly=Vector3.Forward(!1),Vector3._RightHandedForwardReadOnly=Vector3.Forward(!0),Vector3._LeftHandedBackwardReadOnly=Vector3.Backward(!1),Vector3._RightHandedBackwardReadOnly=Vector3.Backward(!0),Vector3._RightReadOnly=Vector3.Right(),Vector3._LeftReadOnly=Vector3.Left(),Vector3._ZeroReadOnly=Vector3.Zero(),Vector3._OneReadOnly=Vector3.One(),Object.defineProperties(Vector3.prototype,{"dimension":{"value":[3]},"rank":{"value":1}});class Vector4{"constructor"(t=0,i=0,r=0,a=0){this.x=t,this.y=i,this.z=r,this.w=a}"toString"(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}"getClassName"(){return"Vector4"}"getHashCode"(){let t=_ExtractAsInt(this.x);return t=397*t^_ExtractAsInt(this.y),t=397*t^_ExtractAsInt(this.z),t=397*t^_ExtractAsInt(this.w),t}"asArray"(){return[this.x,this.y,this.z,this.w]}"toArray"(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this}"fromArray"(t,i=0){return Vector4.FromArrayToRef(t,i,this),this}"addInPlace"(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}"addInPlaceFromFloats"(t,i,r,a){return this.x+=t,this.y+=i,this.z+=r,this.w+=a,this}"add"(t){return new Vector4(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}"addToRef"(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,i}"subtractInPlace"(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}"subtract"(t){return new Vector4(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}"subtractToRef"(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,i}"subtractFromFloats"(t,i,r,a){return new Vector4(this.x-t,this.y-i,this.z-r,this.w-a)}"subtractFromFloatsToRef"(t,i,r,a,o){return o.x=this.x-t,o.y=this.y-i,o.z=this.z-r,o.w=this.w-a,o}"negate"(){return new Vector4(-this.x,-this.y,-this.z,-this.w)}"negateInPlace"(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}"negateToRef"(t){return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=-this.w,t}"scaleInPlace"(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}"scale"(t){return new Vector4(this.x*t,this.y*t,this.z*t,this.w*t)}"scaleToRef"(t,i){return i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t,i}"scaleAndAddToRef"(t,i){return i.x+=this.x*t,i.y+=this.y*t,i.z+=this.z*t,i.w+=this.w*t,i}"equals"(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}"equalsWithEpsilon"(t,i=a.kn){return t&&(0,u.l5)(this.x,t.x,i)&&(0,u.l5)(this.y,t.y,i)&&(0,u.l5)(this.z,t.z,i)&&(0,u.l5)(this.w,t.w,i)}"equalsToFloats"(t,i,r,a){return this.x===t&&this.y===i&&this.z===r&&this.w===a}"multiplyInPlace"(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}"multiply"(t){return new Vector4(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}"multiplyToRef"(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,i}"multiplyByFloats"(t,i,r,a){return new Vector4(this.x*t,this.y*i,this.z*r,this.w*a)}"divide"(t){return new Vector4(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)}"divideToRef"(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,i}"divideInPlace"(t){return this.divideToRef(t,this)}"minimizeInPlace"(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this}"maximizeInPlace"(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this}"minimizeInPlaceFromFloats"(t,i,r,a){return this.x=Math.min(t,this.x),this.y=Math.min(i,this.y),this.z=Math.min(r,this.z),this.w=Math.min(a,this.w),this}"maximizeInPlaceFromFloats"(t,i,r,a){return this.x=Math.max(t,this.x),this.y=Math.max(i,this.y),this.z=Math.max(r,this.z),this.w=Math.max(a,this.w),this}"floorToRef"(t){return t.x=Math.floor(this.x),t.y=Math.floor(this.y),t.z=Math.floor(this.z),t.w=Math.floor(this.w),t}"floor"(){return new Vector4(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}"fractToRef"(t){return t.x=this.x-Math.floor(this.x),t.y=this.y-Math.floor(this.y),t.z=this.z-Math.floor(this.z),t.w=this.w-Math.floor(this.w),t}"fract"(){return new Vector4(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}"length"(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}"lengthSquared"(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}"normalize"(){return this.normalizeFromLength(this.length())}"normalizeFromLength"(t){return 0===t||1===t?this:this.scaleInPlace(1/t)}"normalizeToNew"(){return this.normalizeToRef(new Vector4)}"normalizeToRef"(t){const i=this.length();return 0===i||1===i?(t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t):this.scaleToRef(1/i,t)}"toVector3"(){return new Vector3(this.x,this.y,this.z)}"clone"(){return new Vector4(this.x,this.y,this.z,this.w)}"copyFrom"(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}"copyFromFloats"(t,i,r,a){return this.x=t,this.y=i,this.z=r,this.w=a,this}"set"(t,i,r,a){return this.copyFromFloats(t,i,r,a)}"setAll"(t){return this.x=this.y=this.z=this.w=t,this}"dot"(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}static"FromArray"(t,i){return i||(i=0),new Vector4(t[i],t[i+1],t[i+2],t[i+3])}static"FromArrayToRef"(t,i,r){return r.x=t[i],r.y=t[i+1],r.z=t[i+2],r.w=t[i+3],r}static"FromFloatArrayToRef"(t,i,r){return Vector4.FromArrayToRef(t,i,r),r}static"FromFloatsToRef"(t,i,r,a,o){return o.x=t,o.y=i,o.z=r,o.w=a,o}static"Zero"(){return new Vector4(0,0,0,0)}static"One"(){return new Vector4(1,1,1,1)}static"Random"(t=0,i=1){return new Vector4((0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i))}static"RandomToRef"(t=0,i=1,r){return r.x=(0,u.Pg)(t,i),r.y=(0,u.Pg)(t,i),r.z=(0,u.Pg)(t,i),r.w=(0,u.Pg)(t,i),r}static"Clamp"(t,i,r){return Vector4.ClampToRef(t,i,r,new Vector4)}static"ClampToRef"(t,i,r,a){return a.x=(0,u.Lh)(t.x,i.x,r.x),a.y=(0,u.Lh)(t.y,i.y,r.y),a.z=(0,u.Lh)(t.z,i.z,r.z),a.w=(0,u.Lh)(t.w,i.w,r.w),a}static"CheckExtends"(t,i,r){i.minimizeInPlace(t),r.maximizeInPlace(t)}static get"ZeroReadOnly"(){return Vector4._ZeroReadOnly}static"Normalize"(t){return Vector4.NormalizeToRef(t,new Vector4)}static"NormalizeToRef"(t,i){return t.normalizeToRef(i),i}static"Minimize"(t,i){const r=new Vector4;return r.copyFrom(t),r.minimizeInPlace(i),r}static"Maximize"(t,i){const r=new Vector4;return r.copyFrom(t),r.maximizeInPlace(i),r}static"Distance"(t,i){return Math.sqrt(Vector4.DistanceSquared(t,i))}static"DistanceSquared"(t,i){const r=t.x-i.x,a=t.y-i.y,o=t.z-i.z,h=t.w-i.w;return r*r+a*a+o*o+h*h}static"Center"(t,i){return Vector4.CenterToRef(t,i,new Vector4)}static"CenterToRef"(t,i,r){return r.x=(t.x+i.x)/2,r.y=(t.y+i.y)/2,r.z=(t.z+i.z)/2,r.w=(t.w+i.w)/2,r}static"TransformCoordinates"(t,i){return Vector4.TransformCoordinatesToRef(t,i,new Vector4)}static"TransformCoordinatesToRef"(t,i,r){return Vector4.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,r),r}static"TransformCoordinatesFromFloatsToRef"(t,i,r,a,o){const h=a.m,l=t*h[0]+i*h[4]+r*h[8]+h[12],c=t*h[1]+i*h[5]+r*h[9]+h[13],u=t*h[2]+i*h[6]+r*h[10]+h[14],d=t*h[3]+i*h[7]+r*h[11]+h[15];return o.x=l,o.y=c,o.z=u,o.w=d,o}static"TransformNormal"(t,i){return Vector4.TransformNormalToRef(t,i,new Vector4)}static"TransformNormalToRef"(t,i,r){const a=i.m,o=t.x*a[0]+t.y*a[4]+t.z*a[8],h=t.x*a[1]+t.y*a[5]+t.z*a[9],l=t.x*a[2]+t.y*a[6]+t.z*a[10];return r.x=o,r.y=h,r.z=l,r.w=t.w,r}static"TransformNormalFromFloatsToRef"(t,i,r,a,o,h){const l=o.m;return h.x=t*l[0]+i*l[4]+r*l[8],h.y=t*l[1]+i*l[5]+r*l[9],h.z=t*l[2]+i*l[6]+r*l[10],h.w=a,h}static"FromVector3"(t,i=0){return new Vector4(t._x,t._y,t._z,i)}static"Dot"(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w}}Vector4._V8PerformanceHack=new Vector4(.5,.5,.5,.5),Vector4._ZeroReadOnly=Vector4.Zero(),Object.defineProperties(Vector4.prototype,{"dimension":{"value":[4]},"rank":{"value":1}});class Quaternion{get"x"(){return this._x}set"x"(t){this._x=t,this._isDirty=!0}get"y"(){return this._y}set"y"(t){this._y=t,this._isDirty=!0}get"z"(){return this._z}set"z"(t){this._z=t,this._isDirty=!0}get"w"(){return this._w}set"w"(t){this._w=t,this._isDirty=!0}"constructor"(t=0,i=0,r=0,a=1){this._isDirty=!0,this._x=t,this._y=i,this._z=r,this._w=a}"toString"(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}"getClassName"(){return"Quaternion"}"getHashCode"(){let t=_ExtractAsInt(this._x);return t=397*t^_ExtractAsInt(this._y),t=397*t^_ExtractAsInt(this._z),t=397*t^_ExtractAsInt(this._w),t}"asArray"(){return[this._x,this._y,this._z,this._w]}"toArray"(t,i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,this}"fromArray"(t,i=0){return Quaternion.FromArrayToRef(t,i,this)}"equals"(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z&&this._w===t._w}"equalsWithEpsilon"(t,i=a.kn){return t&&(0,u.l5)(this._x,t._x,i)&&(0,u.l5)(this._y,t._y,i)&&(0,u.l5)(this._z,t._z,i)&&(0,u.l5)(this._w,t._w,i)}"isApprox"(t,i=a.kn){return t&&((0,u.l5)(this._x,t._x,i)&&(0,u.l5)(this._y,t._y,i)&&(0,u.l5)(this._z,t._z,i)&&(0,u.l5)(this._w,t._w,i)||(0,u.l5)(this._x,-t._x,i)&&(0,u.l5)(this._y,-t._y,i)&&(0,u.l5)(this._z,-t._z,i)&&(0,u.l5)(this._w,-t._w,i))}"clone"(){return new Quaternion(this._x,this._y,this._z,this._w)}"copyFrom"(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._w=t._w,this._isDirty=!0,this}"copyFromFloats"(t,i,r,a){return this._x=t,this._y=i,this._z=r,this._w=a,this._isDirty=!0,this}"set"(t,i,r,a){return this.copyFromFloats(t,i,r,a)}"setAll"(t){return this.copyFromFloats(t,t,t,t)}"add"(t){return new Quaternion(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)}"addInPlace"(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this._isDirty=!0,this}"addToRef"(t,i){return i._x=this._x+t._x,i._y=this._y+t._y,i._z=this._z+t._z,i._w=this._w+t._w,i._isDirty=!0,i}"addInPlaceFromFloats"(t,i,r,a){return this._x+=t,this._y+=i,this._z+=r,this._w+=a,this._isDirty=!0,this}"subtractToRef"(t,i){return i._x=this._x-t._x,i._y=this._y-t._y,i._z=this._z-t._z,i._w=this._w-t._w,i._isDirty=!0,i}"subtractFromFloats"(t,i,r,a){return this.subtractFromFloatsToRef(t,i,r,a,new Quaternion)}"subtractFromFloatsToRef"(t,i,r,a,o){return o._x=this._x-t,o._y=this._y-i,o._z=this._z-r,o._w=this._w-a,o._isDirty=!0,o}"subtract"(t){return new Quaternion(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)}"subtractInPlace"(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._w-=t._w,this._isDirty=!0,this}"scale"(t){return new Quaternion(this._x*t,this._y*t,this._z*t,this._w*t)}"scaleToRef"(t,i){return i._x=this._x*t,i._y=this._y*t,i._z=this._z*t,i._w=this._w*t,i._isDirty=!0,i}"scaleInPlace"(t){return this._x*=t,this._y*=t,this._z*=t,this._w*=t,this._isDirty=!0,this}"scaleAndAddToRef"(t,i){return i._x+=this._x*t,i._y+=this._y*t,i._z+=this._z*t,i._w+=this._w*t,i._isDirty=!0,i}"multiply"(t){const i=new Quaternion(0,0,0,1);return this.multiplyToRef(t,i),i}"multiplyToRef"(t,i){const r=this._x*t._w+this._y*t._z-this._z*t._y+this._w*t._x,a=-this._x*t._z+this._y*t._w+this._z*t._x+this._w*t._y,o=this._x*t._y-this._y*t._x+this._z*t._w+this._w*t._z,h=-this._x*t._x-this._y*t._y-this._z*t._z+this._w*t._w;return i.copyFromFloats(r,a,o,h),i}"multiplyInPlace"(t){return this.multiplyToRef(t,this)}"multiplyByFloats"(t,i,r,a){return this._x*=t,this._y*=i,this._z*=r,this._w*=a,this._isDirty=!0,this}"divide"(t){throw new ReferenceError("Can not divide a quaternion")}"divideToRef"(t,i){throw new ReferenceError("Can not divide a quaternion")}"divideInPlace"(t){throw new ReferenceError("Can not divide a quaternion")}"minimizeInPlace"(){throw new ReferenceError("Can not minimize a quaternion")}"minimizeInPlaceFromFloats"(){throw new ReferenceError("Can not minimize a quaternion")}"maximizeInPlace"(){throw new ReferenceError("Can not maximize a quaternion")}"maximizeInPlaceFromFloats"(){throw new ReferenceError("Can not maximize a quaternion")}"negate"(){return this.negateToRef(new Quaternion)}"negateInPlace"(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}"negateToRef"(t){return t._x=-this._x,t._y=-this._y,t._z=-this._z,t._w=-this._w,t._isDirty=!0,t}"equalsToFloats"(t,i,r,a){return this._x===t&&this._y===i&&this._z===r&&this._w===a}"floorToRef"(t){throw new ReferenceError("Can not floor a quaternion")}"floor"(){throw new ReferenceError("Can not floor a quaternion")}"fractToRef"(t){throw new ReferenceError("Can not fract a quaternion")}"fract"(){throw new ReferenceError("Can not fract a quaternion")}"conjugateToRef"(t){return t.copyFromFloats(-this._x,-this._y,-this._z,this._w),t}"conjugateInPlace"(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}"conjugate"(){return new Quaternion(-this._x,-this._y,-this._z,this._w)}"invert"(){const t=this.conjugate(),i=this.lengthSquared();return 0==i||1==i||t.scaleInPlace(1/i),t}"invertInPlace"(){this.conjugateInPlace();const t=this.lengthSquared();return 0==t||1==t||this.scaleInPlace(1/t),this}"lengthSquared"(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}"length"(){return Math.sqrt(this.lengthSquared())}"normalize"(){return this.normalizeFromLength(this.length())}"normalizeFromLength"(t){return 0===t||1===t?this:this.scaleInPlace(1/t)}"normalizeToNew"(){const t=new Quaternion(0,0,0,1);return this.normalizeToRef(t),t}"normalizeToRef"(t){const i=this.length();return 0===i||1===i?t.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/i,t)}"toEulerAngles"(){const t=Vector3.Zero();return this.toEulerAnglesToRef(t),t}"toEulerAnglesToRef"(t){const i=this._z,r=this._x,a=this._y,o=this._w,h=a*i-r*o,l=.4999999;if(h<-l)t._y=2*Math.atan2(a,o),t._x=Math.PI/2,t._z=0,t._isDirty=!0;else if(h>l)t._y=2*Math.atan2(a,o),t._x=-Math.PI/2,t._z=0,t._isDirty=!0;else{const l=o*o,c=i*i,u=r*r,d=a*a;t._z=Math.atan2(2*(r*a+i*o),-c-u+d+l),t._x=Math.asin(-2*h),t._y=Math.atan2(2*(i*r+a*o),c-u-d+l),t._isDirty=!0}return t}"toAlphaBetaGammaToRef"(t){const i=this._z,r=this._x,a=this._y,o=this._w,h=Math.sqrt(r*r+a*a),l=Math.sqrt(i*i+o*o),c=2*Math.atan2(h,l),u=2*Math.atan2(i,o),d=2*Math.atan2(a,r),_=(u+d)/2,g=(u-d)/2;return t.set(g,c,_),t}"toRotationMatrix"(t){return Matrix.FromQuaternionToRef(this,t),t}"fromRotationMatrix"(t){return Quaternion.FromRotationMatrixToRef(t,this),this}"dot"(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}static"FromRotationMatrix"(t){const i=new Quaternion;return Quaternion.FromRotationMatrixToRef(t,i),i}static"FromRotationMatrixToRef"(t,i){const r=t.m,a=r[0],o=r[4],h=r[8],l=r[1],c=r[5],u=r[9],d=r[2],_=r[6],g=r[10],p=a+c+g;let m;return p>0?(m=.5/Math.sqrt(p+1),i._w=.25/m,i._x=(_-u)*m,i._y=(h-d)*m,i._z=(l-o)*m,i._isDirty=!0):a>c&&a>g?(m=2*Math.sqrt(1+a-c-g),i._w=(_-u)/m,i._x=.25*m,i._y=(o+l)/m,i._z=(h+d)/m,i._isDirty=!0):c>g?(m=2*Math.sqrt(1+c-a-g),i._w=(h-d)/m,i._x=(o+l)/m,i._y=.25*m,i._z=(u+_)/m,i._isDirty=!0):(m=2*Math.sqrt(1+g-a-c),i._w=(l-o)/m,i._x=(h+d)/m,i._y=(u+_)/m,i._z=.25*m,i._isDirty=!0),i}static"Dot"(t,i){return t._x*i._x+t._y*i._y+t._z*i._z+t._w*i._w}static"AreClose"(t,i,r=.1){const a=Quaternion.Dot(t,i);return 1-a*a<=r}static"SmoothToRef"(t,i,r,a,o){let h=0===a?1:r/a;return h=(0,u.Lh)(h,0,1),Quaternion.SlerpToRef(t,i,h,o),o}static"Zero"(){return new Quaternion(0,0,0,0)}static"Inverse"(t){return new Quaternion(-t._x,-t._y,-t._z,t._w)}static"InverseToRef"(t,i){return i.set(-t._x,-t._y,-t._z,t._w),i}static"Identity"(){return new Quaternion(0,0,0,1)}static"IsIdentity"(t){return t&&0===t._x&&0===t._y&&0===t._z&&1===t._w}static"RotationAxis"(t,i){return Quaternion.RotationAxisToRef(t,i,new Quaternion)}static"RotationAxisToRef"(t,i,r){r._w=Math.cos(i/2);const a=Math.sin(i/2)/t.length();return r._x=t._x*a,r._y=t._y*a,r._z=t._z*a,r._isDirty=!0,r}static"FromArray"(t,i){return i||(i=0),new Quaternion(t[i],t[i+1],t[i+2],t[i+3])}static"FromArrayToRef"(t,i,r){return r._x=t[i],r._y=t[i+1],r._z=t[i+2],r._w=t[i+3],r._isDirty=!0,r}static"FromFloatsToRef"(t,i,r,a,o){return o.copyFromFloats(t,i,r,a),o}static"FromEulerAngles"(t,i,r){const a=new Quaternion;return Quaternion.RotationYawPitchRollToRef(i,t,r,a),a}static"FromEulerAnglesToRef"(t,i,r,a){return Quaternion.RotationYawPitchRollToRef(i,t,r,a),a}static"FromEulerVector"(t){const i=new Quaternion;return Quaternion.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i}static"FromEulerVectorToRef"(t,i){return Quaternion.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i}static"FromUnitVectorsToRef"(t,i,r,o=a.kn){const h=Vector3.Dot(t,i)+1;return h<o?Math.abs(t.x)>Math.abs(t.z)?r.set(-t.y,t.x,0,0):r.set(0,-t.z,t.y,0):(Vector3.CrossToRef(t,i,TmpVectors.Vector3[0]),r.set(TmpVectors.Vector3[0].x,TmpVectors.Vector3[0].y,TmpVectors.Vector3[0].z,h)),r.normalize()}static"RotationYawPitchRoll"(t,i,r){const a=new Quaternion;return Quaternion.RotationYawPitchRollToRef(t,i,r,a),a}static"RotationYawPitchRollToRef"(t,i,r,a){const o=.5*r,h=.5*i,l=.5*t,c=Math.sin(o),u=Math.cos(o),d=Math.sin(h),_=Math.cos(h),g=Math.sin(l),p=Math.cos(l);return a._x=p*d*u+g*_*c,a._y=g*_*u-p*d*c,a._z=p*_*c-g*d*u,a._w=p*_*u+g*d*c,a._isDirty=!0,a}static"RotationAlphaBetaGamma"(t,i,r){const a=new Quaternion;return Quaternion.RotationAlphaBetaGammaToRef(t,i,r,a),a}static"RotationAlphaBetaGammaToRef"(t,i,r,a){const o=.5*(r+t),h=.5*(r-t),l=.5*i;return a._x=Math.cos(h)*Math.sin(l),a._y=Math.sin(h)*Math.sin(l),a._z=Math.sin(o)*Math.cos(l),a._w=Math.cos(o)*Math.cos(l),a._isDirty=!0,a}static"RotationQuaternionFromAxis"(t,i,r){const a=new Quaternion(0,0,0,0);return Quaternion.RotationQuaternionFromAxisToRef(t,i,r,a),a}static"RotationQuaternionFromAxisToRef"(t,i,r,a){const o=MathTmp.Matrix[0];return t=t.normalizeToRef(MathTmp.Vector3[0]),i=i.normalizeToRef(MathTmp.Vector3[1]),r=r.normalizeToRef(MathTmp.Vector3[2]),Matrix.FromXYZAxesToRef(t,i,r,o),Quaternion.FromRotationMatrixToRef(o,a),a}static"FromLookDirectionLH"(t,i){const r=new Quaternion;return Quaternion.FromLookDirectionLHToRef(t,i,r),r}static"FromLookDirectionLHToRef"(t,i,r){const a=MathTmp.Matrix[0];return Matrix.LookDirectionLHToRef(t,i,a),Quaternion.FromRotationMatrixToRef(a,r),r}static"FromLookDirectionRH"(t,i){const r=new Quaternion;return Quaternion.FromLookDirectionRHToRef(t,i,r),r}static"FromLookDirectionRHToRef"(t,i,r){const a=MathTmp.Matrix[0];return Matrix.LookDirectionRHToRef(t,i,a),Quaternion.FromRotationMatrixToRef(a,r)}static"Slerp"(t,i,r){const a=Quaternion.Identity();return Quaternion.SlerpToRef(t,i,r,a),a}static"SlerpToRef"(t,i,r,a){let o,h,l=t._x*i._x+t._y*i._y+t._z*i._z+t._w*i._w,c=!1;if(l<0&&(c=!0,l=-l),l>.999999)h=1-r,o=c?-r:r;else{const t=Math.acos(l),i=1/Math.sin(t);h=Math.sin((1-r)*t)*i,o=c?-Math.sin(r*t)*i:Math.sin(r*t)*i}return a._x=h*t._x+o*i._x,a._y=h*t._y+o*i._y,a._z=h*t._z+o*i._z,a._w=h*t._w+o*i._w,a._isDirty=!0,a}static"Hermite"(t,i,r,a,o){const h=o*o,l=o*h,c=2*l-3*h+1,u=-2*l+3*h,d=l-2*h+o,_=l-h,g=t._x*c+r._x*u+i._x*d+a._x*_,p=t._y*c+r._y*u+i._y*d+a._y*_,m=t._z*c+r._z*u+i._z*d+a._z*_,T=t._w*c+r._w*u+i._w*d+a._w*_;return new Quaternion(g,p,m,T)}static"Hermite1stDerivative"(t,i,r,a,o){const h=new Quaternion;return this.Hermite1stDerivativeToRef(t,i,r,a,o,h),h}static"Hermite1stDerivativeToRef"(t,i,r,a,o,h){const l=o*o;return h._x=6*(l-o)*t._x+(3*l-4*o+1)*i._x+6*(-l+o)*r._x+(3*l-2*o)*a._x,h._y=6*(l-o)*t._y+(3*l-4*o+1)*i._y+6*(-l+o)*r._y+(3*l-2*o)*a._y,h._z=6*(l-o)*t._z+(3*l-4*o+1)*i._z+6*(-l+o)*r._z+(3*l-2*o)*a._z,h._w=6*(l-o)*t._w+(3*l-4*o+1)*i._w+6*(-l+o)*r._w+(3*l-2*o)*a._w,h._isDirty=!0,h}static"Normalize"(t){const i=Quaternion.Zero();return Quaternion.NormalizeToRef(t,i),i}static"NormalizeToRef"(t,i){return t.normalizeToRef(i),i}static"Clamp"(t,i,r){const a=new Quaternion;return Quaternion.ClampToRef(t,i,r,a),a}static"ClampToRef"(t,i,r,a){return a.copyFromFloats((0,u.Lh)(t.x,i.x,r.x),(0,u.Lh)(t.y,i.y,r.y),(0,u.Lh)(t.z,i.z,r.z),(0,u.Lh)(t.w,i.w,r.w))}static"Random"(t=0,i=1){return new Quaternion((0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i))}static"RandomToRef"(t=0,i=1,r){return r.copyFromFloats((0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i),(0,u.Pg)(t,i))}static"Minimize"(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static"Maximize"(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static"Distance"(t,i){return Math.sqrt(Quaternion.DistanceSquared(t,i))}static"DistanceSquared"(t,i){const r=t.x-i.x,a=t.y-i.y,o=t.z-i.z,h=t.w-i.w;return r*r+a*a+o*o+h*h}static"Center"(t,i){return Quaternion.CenterToRef(t,i,Quaternion.Zero())}static"CenterToRef"(t,i,r){return r.copyFromFloats((t.x+i.x)/2,(t.y+i.y)/2,(t.z+i.z)/2,(t.w+i.w)/2)}}Quaternion._V8PerformanceHack=new Quaternion(.5,.5,.5,.5),Object.defineProperties(Quaternion.prototype,{"dimension":{"value":[4]},"rank":{"value":1}});class Matrix{static get"Use64Bits"(){return l.Z.MatrixUse64Bits}get"m"(){return this._m}"markAsUpdated"(){this.updateFlag=Matrix._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}"_updateIdentityStatus"(t,i=!1,r=!1,a=!0){this._isIdentity=t,this._isIdentity3x2=t||r,this._isIdentityDirty=!this._isIdentity&&i,this._isIdentity3x2Dirty=!this._isIdentity3x2&&a}"constructor"(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,l.Z.MatrixTrackPrecisionChange&&l.Z.MatrixTrackedMatrices.push(this),this._m=new l.Z.MatrixCurrentType(16),this.markAsUpdated()}"isIdentity"(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const t=this._m;this._isIdentity=1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}return this._isIdentity}"isIdentityAs3x2"(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}"determinant"(){if(!0===this._isIdentity)return 1;const t=this._m,i=t[0],r=t[1],a=t[2],o=t[3],h=t[4],l=t[5],c=t[6],u=t[7],d=t[8],_=t[9],g=t[10],p=t[11],m=t[12],T=t[13],y=t[14],M=t[15],b=g*M-y*p,x=_*M-T*p,E=_*y-T*g,R=d*M-m*p,A=d*y-g*m,C=d*T-m*_;return i*+(l*b-c*x+u*E)+r*-(h*b-c*R+u*A)+a*+(h*x-l*R+u*C)+o*-(h*E-l*A+c*C)}"toString"(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}"toArray"(t=null,i=0){if(!t)return this._m;const r=this._m;for(let a=0;a<16;a++)t[i+a]=r[a];return this}"asArray"(){return this._m}"fromArray"(t,i=0){return Matrix.FromArrayToRef(t,i,this)}"copyFromFloats"(...t){return Matrix.FromArrayToRef(t,0,this)}"set"(...t){const i=this._m;for(let r=0;r<16;r++)i[r]=t[r];return this.markAsUpdated(),this}"setAll"(t){const i=this._m;for(let r=0;r<16;r++)i[r]=t;return this.markAsUpdated(),this}"invert"(){return this.invertToRef(this),this}"reset"(){return Matrix.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}"add"(t){const i=new Matrix;return this.addToRef(t,i),i}"addToRef"(t,i){const r=this._m,a=i._m,o=t.m;for(let t=0;t<16;t++)a[t]=r[t]+o[t];return i.markAsUpdated(),i}"addToSelf"(t){const i=this._m,r=t.m;return i[0]+=r[0],i[1]+=r[1],i[2]+=r[2],i[3]+=r[3],i[4]+=r[4],i[5]+=r[5],i[6]+=r[6],i[7]+=r[7],i[8]+=r[8],i[9]+=r[9],i[10]+=r[10],i[11]+=r[11],i[12]+=r[12],i[13]+=r[13],i[14]+=r[14],i[15]+=r[15],this.markAsUpdated(),this}"addInPlace"(t){const i=this._m,r=t.m;for(let t=0;t<16;t++)i[t]+=r[t];return this.markAsUpdated(),this}"addInPlaceFromFloats"(...t){const i=this._m;for(let r=0;r<16;r++)i[r]+=t[r];return this.markAsUpdated(),this}"subtract"(t){const i=this._m,r=t.m;for(let t=0;t<16;t++)i[t]-=r[t];return this.markAsUpdated(),this}"subtractToRef"(t,i){const r=this._m,a=t.m,o=i._m;for(let t=0;t<16;t++)o[t]=r[t]-a[t];return i.markAsUpdated(),i}"subtractInPlace"(t){const i=this._m,r=t.m;for(let t=0;t<16;t++)i[t]-=r[t];return this.markAsUpdated(),this}"subtractFromFloats"(...t){return this.subtractFromFloatsToRef(...t,new Matrix)}"subtractFromFloatsToRef"(...t){const i=t.pop(),r=this._m,a=i._m,o=t;for(let t=0;t<16;t++)a[t]=r[t]-o[t];return i.markAsUpdated(),i}"invertToRef"(t){if(!0===this._isIdentity)return Matrix.IdentityToRef(t),t;const i=this._m,r=i[0],a=i[1],o=i[2],h=i[3],l=i[4],c=i[5],u=i[6],d=i[7],_=i[8],g=i[9],p=i[10],m=i[11],T=i[12],y=i[13],M=i[14],b=i[15],x=p*b-M*m,E=g*b-y*m,R=g*M-y*p,A=_*b-T*m,C=_*M-p*T,v=_*y-T*g,P=+(c*x-u*E+d*R),S=-(l*x-u*A+d*C),I=+(l*E-c*A+d*v),D=-(l*R-c*C+u*v),O=r*P+a*S+o*I+h*D;if(0===O)return t.copyFrom(this),t;const w=1/O,B=u*b-M*d,L=c*b-y*d,N=c*M-y*u,U=l*b-T*d,k=l*M-T*u,V=l*y-T*c,G=u*m-p*d,z=c*m-g*d,W=c*p-g*u,H=l*m-_*d,X=l*p-_*u,K=l*g-_*c,q=-(a*x-o*E+h*R),Y=+(r*x-o*A+h*C),j=-(r*E-a*A+h*v),Z=+(r*R-a*C+o*v),Q=+(a*B-o*L+h*N),$=-(r*B-o*U+h*k),J=+(r*L-a*U+h*V),ee=-(r*N-a*k+o*V),te=-(a*G-o*z+h*W),ie=+(r*G-o*H+h*X),re=-(r*z-a*H+h*K),se=+(r*W-a*X+o*K);return Matrix.FromValuesToRef(P*w,q*w,Q*w,te*w,S*w,Y*w,$*w,ie*w,I*w,j*w,J*w,re*w,D*w,Z*w,ee*w,se*w,t),t}"addAtIndex"(t,i){return this._m[t]+=i,this.markAsUpdated(),this}"multiplyAtIndex"(t,i){return this._m[t]*=i,this.markAsUpdated(),this}"setTranslationFromFloats"(t,i,r){return this._m[12]=t,this._m[13]=i,this._m[14]=r,this.markAsUpdated(),this}"addTranslationFromFloats"(t,i,r){return this._m[12]+=t,this._m[13]+=i,this._m[14]+=r,this.markAsUpdated(),this}"setTranslation"(t){return this.setTranslationFromFloats(t._x,t._y,t._z)}"getTranslation"(){return new Vector3(this._m[12],this._m[13],this._m[14])}"getTranslationToRef"(t){return t.x=this._m[12],t.y=this._m[13],t.z=this._m[14],t}"removeRotationAndScaling"(){const t=this.m;return Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this}"copyFrom"(t){t.copyToArray(this._m);const i=t;return this.updateFlag=i.updateFlag,this._updateIdentityStatus(i._isIdentity,i._isIdentityDirty,i._isIdentity3x2,i._isIdentity3x2Dirty),this}"copyToArray"(t,i=0){const r=this._m;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],this}"multiply"(t){const i=new Matrix;return this.multiplyToRef(t,i),i}"multiplyInPlace"(t){const i=this._m,r=t.m;for(let t=0;t<16;t++)i[t]*=r[t];return this.markAsUpdated(),this}"multiplyByFloats"(...t){const i=this._m;for(let r=0;r<16;r++)i[r]*=t[r];return this.markAsUpdated(),this}"multiplyByFloatsToRef"(...t){const i=t.pop(),r=this._m,a=i._m,o=t;for(let t=0;t<16;t++)a[t]=r[t]*o[t];return i.markAsUpdated(),i}"multiplyToRef"(t,i){return this._isIdentity?(i.copyFrom(t),i):t._isIdentity?(i.copyFrom(this),i):(this.multiplyToArray(t,i._m,0),i.markAsUpdated(),i)}"multiplyToArray"(t,i,r){const a=this._m,o=t.m,h=a[0],l=a[1],c=a[2],u=a[3],d=a[4],_=a[5],g=a[6],p=a[7],m=a[8],T=a[9],y=a[10],M=a[11],b=a[12],x=a[13],E=a[14],R=a[15],A=o[0],C=o[1],v=o[2],P=o[3],S=o[4],I=o[5],D=o[6],O=o[7],w=o[8],B=o[9],L=o[10],N=o[11],U=o[12],k=o[13],V=o[14],G=o[15];return i[r]=h*A+l*S+c*w+u*U,i[r+1]=h*C+l*I+c*B+u*k,i[r+2]=h*v+l*D+c*L+u*V,i[r+3]=h*P+l*O+c*N+u*G,i[r+4]=d*A+_*S+g*w+p*U,i[r+5]=d*C+_*I+g*B+p*k,i[r+6]=d*v+_*D+g*L+p*V,i[r+7]=d*P+_*O+g*N+p*G,i[r+8]=m*A+T*S+y*w+M*U,i[r+9]=m*C+T*I+y*B+M*k,i[r+10]=m*v+T*D+y*L+M*V,i[r+11]=m*P+T*O+y*N+M*G,i[r+12]=b*A+x*S+E*w+R*U,i[r+13]=b*C+x*I+E*B+R*k,i[r+14]=b*v+x*D+E*L+R*V,i[r+15]=b*P+x*O+E*N+R*G,this}"divide"(t){return this.divideToRef(t,new Matrix)}"divideToRef"(t,i){const r=this._m,a=t.m,o=i._m;for(let t=0;t<16;t++)o[t]=r[t]/a[t];return i.markAsUpdated(),i}"divideInPlace"(t){const i=this._m,r=t.m;for(let t=0;t<16;t++)i[t]/=r[t];return this.markAsUpdated(),this}"minimizeInPlace"(t){const i=this._m,r=t.m;for(let t=0;t<16;t++)i[t]=Math.min(i[t],r[t]);return this.markAsUpdated(),this}"minimizeInPlaceFromFloats"(...t){const i=this._m;for(let r=0;r<16;r++)i[r]=Math.min(i[r],t[r]);return this.markAsUpdated(),this}"maximizeInPlace"(t){const i=this._m,r=t.m;for(let t=0;t<16;t++)i[t]=Math.min(i[t],r[t]);return this.markAsUpdated(),this}"maximizeInPlaceFromFloats"(...t){const i=this._m;for(let r=0;r<16;r++)i[r]=Math.min(i[r],t[r]);return this.markAsUpdated(),this}"negate"(){return this.negateToRef(new Matrix)}"negateInPlace"(){const t=this._m;for(let i=0;i<16;i++)t[i]=-t[i];return this.markAsUpdated(),this}"negateToRef"(t){const i=this._m,r=t._m;for(let t=0;t<16;t++)r[t]=-i[t];return t.markAsUpdated(),t}"equals"(t){const i=t;if(!i)return!1;if((this._isIdentity||i._isIdentity)&&!this._isIdentityDirty&&!i._isIdentityDirty)return this._isIdentity&&i._isIdentity;const r=this.m,a=i.m;return r[0]===a[0]&&r[1]===a[1]&&r[2]===a[2]&&r[3]===a[3]&&r[4]===a[4]&&r[5]===a[5]&&r[6]===a[6]&&r[7]===a[7]&&r[8]===a[8]&&r[9]===a[9]&&r[10]===a[10]&&r[11]===a[11]&&r[12]===a[12]&&r[13]===a[13]&&r[14]===a[14]&&r[15]===a[15]}"equalsWithEpsilon"(t,i=0){const r=this._m,a=t.m;for(let t=0;t<16;t++)if(!(0,u.l5)(r[t],a[t],i))return!1;return!0}"equalsToFloats"(...t){const i=this._m;for(let r=0;r<16;r++)if(i[r]!=t[r])return!1;return!0}"floor"(){return this.floorToRef(new Matrix)}"floorToRef"(t){const i=this._m,r=t._m;for(let t=0;t<16;t++)r[t]=Math.floor(i[t]);return t.markAsUpdated(),t}"fract"(){return this.fractToRef(new Matrix)}"fractToRef"(t){const i=this._m,r=t._m;for(let t=0;t<16;t++)r[t]=i[t]-Math.floor(i[t]);return t.markAsUpdated(),t}"clone"(){const t=new Matrix;return t.copyFrom(this),t}"getClassName"(){return"Matrix"}"getHashCode"(){let t=_ExtractAsInt(this._m[0]);for(let i=1;i<16;i++)t=397*t^_ExtractAsInt(this._m[i]);return t}"decomposeToTransformNode"(t){return t.rotationQuaternion=t.rotationQuaternion||new Quaternion,this.decompose(t.scaling,t.rotationQuaternion,t.position)}"decompose"(t,i,r,a,o=!0){if(this._isIdentity)return r&&r.setAll(0),t&&t.setAll(1),i&&i.copyFromFloats(0,0,0,1),!0;const h=this._m;if(r&&r.copyFromFloats(h[12],h[13],h[14]),(t=t||MathTmp.Vector3[0]).x=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),t.y=Math.sqrt(h[4]*h[4]+h[5]*h[5]+h[6]*h[6]),t.z=Math.sqrt(h[8]*h[8]+h[9]*h[9]+h[10]*h[10]),a){const i=(o?a.absoluteScaling.x:a.scaling.x)<0?-1:1,r=(o?a.absoluteScaling.y:a.scaling.y)<0?-1:1,h=(o?a.absoluteScaling.z:a.scaling.z)<0?-1:1;t.x*=i,t.y*=r,t.z*=h}else this.determinant()<=0&&(t.y*=-1);if(0===t._x||0===t._y||0===t._z)return i&&i.copyFromFloats(0,0,0,1),!1;if(i){const r=1/t._x,a=1/t._y,o=1/t._z;Matrix.FromValuesToRef(h[0]*r,h[1]*r,h[2]*r,0,h[4]*a,h[5]*a,h[6]*a,0,h[8]*o,h[9]*o,h[10]*o,0,0,0,0,1,MathTmp.Matrix[0]),Quaternion.FromRotationMatrixToRef(MathTmp.Matrix[0],i)}return!0}"getRow"(t){if(t<0||t>3)return null;const i=4*t;return new Vector4(this._m[i+0],this._m[i+1],this._m[i+2],this._m[i+3])}"getRowToRef"(t,i){if(t>=0&&t<=3){const r=4*t;i.x=this._m[r+0],i.y=this._m[r+1],i.z=this._m[r+2],i.w=this._m[r+3]}return i}"setRow"(t,i){return this.setRowFromFloats(t,i.x,i.y,i.z,i.w)}"transpose"(){const t=new Matrix;return Matrix.TransposeToRef(this,t),t}"transposeToRef"(t){return Matrix.TransposeToRef(this,t),t}"setRowFromFloats"(t,i,r,a,o){if(t<0||t>3)return this;const h=4*t;return this._m[h+0]=i,this._m[h+1]=r,this._m[h+2]=a,this._m[h+3]=o,this.markAsUpdated(),this}"scale"(t){const i=new Matrix;return this.scaleToRef(t,i),i}"scaleToRef"(t,i){for(let r=0;r<16;r++)i._m[r]=this._m[r]*t;return i.markAsUpdated(),i}"scaleAndAddToRef"(t,i){for(let r=0;r<16;r++)i._m[r]+=this._m[r]*t;return i.markAsUpdated(),i}"scaleInPlace"(t){const i=this._m;for(let r=0;r<16;r++)i[r]*=t;return this.markAsUpdated(),this}"toNormalMatrix"(t){const i=MathTmp.Matrix[0];this.invertToRef(i),i.transposeToRef(t);const r=t._m;return Matrix.FromValuesToRef(r[0],r[1],r[2],0,r[4],r[5],r[6],0,r[8],r[9],r[10],0,0,0,0,1,t),t}"getRotationMatrix"(){const t=new Matrix;return this.getRotationMatrixToRef(t),t}"getRotationMatrixToRef"(t){const i=MathTmp.Vector3[0];if(!this.decompose(i))return Matrix.IdentityToRef(t),t;const r=this._m,a=1/i._x,o=1/i._y,h=1/i._z;return Matrix.FromValuesToRef(r[0]*a,r[1]*a,r[2]*a,0,r[4]*o,r[5]*o,r[6]*o,0,r[8]*h,r[9]*h,r[10]*h,0,0,0,0,1,t),t}"toggleModelMatrixHandInPlace"(){const t=this._m;return t[2]*=-1,t[6]*=-1,t[8]*=-1,t[9]*=-1,t[14]*=-1,this.markAsUpdated(),this}"toggleProjectionMatrixHandInPlace"(){const t=this._m;return t[8]*=-1,t[9]*=-1,t[10]*=-1,t[11]*=-1,this.markAsUpdated(),this}static"FromArray"(t,i=0){const r=new Matrix;return Matrix.FromArrayToRef(t,i,r),r}static"FromArrayToRef"(t,i,r){for(let a=0;a<16;a++)r._m[a]=t[a+i];return r.markAsUpdated(),r}static"FromFloat32ArrayToRefScaled"(t,i,r,a){return a._m[0]=t[0+i]*r,a._m[1]=t[1+i]*r,a._m[2]=t[2+i]*r,a._m[3]=t[3+i]*r,a._m[4]=t[4+i]*r,a._m[5]=t[5+i]*r,a._m[6]=t[6+i]*r,a._m[7]=t[7+i]*r,a._m[8]=t[8+i]*r,a._m[9]=t[9+i]*r,a._m[10]=t[10+i]*r,a._m[11]=t[11+i]*r,a._m[12]=t[12+i]*r,a._m[13]=t[13+i]*r,a._m[14]=t[14+i]*r,a._m[15]=t[15+i]*r,a.markAsUpdated(),a}static get"IdentityReadOnly"(){return Matrix._IdentityReadOnly}static"FromValuesToRef"(t,i,r,a,o,h,l,c,u,d,_,g,p,m,T,y,M){const b=M._m;b[0]=t,b[1]=i,b[2]=r,b[3]=a,b[4]=o,b[5]=h,b[6]=l,b[7]=c,b[8]=u,b[9]=d,b[10]=_,b[11]=g,b[12]=p,b[13]=m,b[14]=T,b[15]=y,M.markAsUpdated()}static"FromValues"(t,i,r,a,o,h,l,c,u,d,_,g,p,m,T,y){const M=new Matrix,b=M._m;return b[0]=t,b[1]=i,b[2]=r,b[3]=a,b[4]=o,b[5]=h,b[6]=l,b[7]=c,b[8]=u,b[9]=d,b[10]=_,b[11]=g,b[12]=p,b[13]=m,b[14]=T,b[15]=y,M.markAsUpdated(),M}static"Compose"(t,i,r){const a=new Matrix;return Matrix.ComposeToRef(t,i,r,a),a}static"ComposeToRef"(t,i,r,a){const o=a._m,h=i._x,l=i._y,c=i._z,u=i._w,d=h+h,_=l+l,g=c+c,p=h*d,m=h*_,T=h*g,y=l*_,M=l*g,b=c*g,x=u*d,E=u*_,R=u*g,A=t._x,C=t._y,v=t._z;return o[0]=(1-(y+b))*A,o[1]=(m+R)*A,o[2]=(T-E)*A,o[3]=0,o[4]=(m-R)*C,o[5]=(1-(p+b))*C,o[6]=(M+x)*C,o[7]=0,o[8]=(T+E)*v,o[9]=(M-x)*v,o[10]=(1-(p+y))*v,o[11]=0,o[12]=r._x,o[13]=r._y,o[14]=r._z,o[15]=1,a.markAsUpdated(),a}static"Identity"(){const t=Matrix.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t}static"IdentityToRef"(t){return Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0),t}static"Zero"(){const t=Matrix.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t}static"RotationX"(t){const i=new Matrix;return Matrix.RotationXToRef(t,i),i}static"Invert"(t){const i=new Matrix;return t.invertToRef(i),i}static"RotationXToRef"(t,i){const r=Math.sin(t),a=Math.cos(t);return Matrix.FromValuesToRef(1,0,0,0,0,a,r,0,0,-r,a,0,0,0,0,1,i),i._updateIdentityStatus(1===a&&0===r),i}static"RotationY"(t){const i=new Matrix;return Matrix.RotationYToRef(t,i),i}static"RotationYToRef"(t,i){const r=Math.sin(t),a=Math.cos(t);return Matrix.FromValuesToRef(a,0,-r,0,0,1,0,0,r,0,a,0,0,0,0,1,i),i._updateIdentityStatus(1===a&&0===r),i}static"RotationZ"(t){const i=new Matrix;return Matrix.RotationZToRef(t,i),i}static"RotationZToRef"(t,i){const r=Math.sin(t),a=Math.cos(t);return Matrix.FromValuesToRef(a,r,0,0,-r,a,0,0,0,0,1,0,0,0,0,1,i),i._updateIdentityStatus(1===a&&0===r),i}static"RotationAxis"(t,i){const r=new Matrix;return Matrix.RotationAxisToRef(t,i,r),r}static"RotationAxisToRef"(t,i,r){const a=Math.sin(-i),o=Math.cos(-i),h=1-o;t=t.normalizeToRef(MathTmp.Vector3[0]);const l=r._m;return l[0]=t._x*t._x*h+o,l[1]=t._x*t._y*h-t._z*a,l[2]=t._x*t._z*h+t._y*a,l[3]=0,l[4]=t._y*t._x*h+t._z*a,l[5]=t._y*t._y*h+o,l[6]=t._y*t._z*h-t._x*a,l[7]=0,l[8]=t._z*t._x*h-t._y*a,l[9]=t._z*t._y*h+t._x*a,l[10]=t._z*t._z*h+o,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,r.markAsUpdated(),r}static"RotationAlignToRef"(t,i,r,o=!1){const h=Vector3.Dot(i,t),l=r._m;if(h<-1+a.kn)l[0]=-1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o?1:-1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o?-1:1,l[11]=0;else{const r=Vector3.Cross(i,t),a=1/(1+h);l[0]=r._x*r._x*a+h,l[1]=r._y*r._x*a-r._z,l[2]=r._z*r._x*a+r._y,l[3]=0,l[4]=r._x*r._y*a+r._z,l[5]=r._y*r._y*a+h,l[6]=r._z*r._y*a-r._x,l[7]=0,l[8]=r._x*r._z*a-r._y,l[9]=r._y*r._z*a+r._x,l[10]=r._z*r._z*a+h,l[11]=0}return l[12]=0,l[13]=0,l[14]=0,l[15]=1,r.markAsUpdated(),r}static"RotationYawPitchRoll"(t,i,r){const a=new Matrix;return Matrix.RotationYawPitchRollToRef(t,i,r,a),a}static"RotationYawPitchRollToRef"(t,i,r,a){return Quaternion.RotationYawPitchRollToRef(t,i,r,MathTmp.Quaternion[0]),MathTmp.Quaternion[0].toRotationMatrix(a),a}static"Scaling"(t,i,r){const a=new Matrix;return Matrix.ScalingToRef(t,i,r,a),a}static"ScalingToRef"(t,i,r,a){return Matrix.FromValuesToRef(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1,a),a._updateIdentityStatus(1===t&&1===i&&1===r),a}static"Translation"(t,i,r){const a=new Matrix;return Matrix.TranslationToRef(t,i,r,a),a}static"TranslationToRef"(t,i,r,a){return Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,r,1,a),a._updateIdentityStatus(0===t&&0===i&&0===r),a}static"Lerp"(t,i,r){const a=new Matrix;return Matrix.LerpToRef(t,i,r,a),a}static"LerpToRef"(t,i,r,a){const o=a._m,h=t.m,l=i.m;for(let t=0;t<16;t++)o[t]=h[t]*(1-r)+l[t]*r;return a.markAsUpdated(),a}static"DecomposeLerp"(t,i,r){const a=new Matrix;return Matrix.DecomposeLerpToRef(t,i,r,a),a}static"DecomposeLerpToRef"(t,i,r,a){const o=MathTmp.Vector3[0],h=MathTmp.Quaternion[0],l=MathTmp.Vector3[1];t.decompose(o,h,l);const c=MathTmp.Vector3[2],u=MathTmp.Quaternion[1],d=MathTmp.Vector3[3];i.decompose(c,u,d);const _=MathTmp.Vector3[4];Vector3.LerpToRef(o,c,r,_);const g=MathTmp.Quaternion[2];Quaternion.SlerpToRef(h,u,r,g);const p=MathTmp.Vector3[5];return Vector3.LerpToRef(l,d,r,p),Matrix.ComposeToRef(_,g,p,a),a}static"LookAtLH"(t,i,r){const a=new Matrix;return Matrix.LookAtLHToRef(t,i,r,a),a}static"LookAtLHToRef"(t,i,r,a){const o=MathTmp.Vector3[0],h=MathTmp.Vector3[1],l=MathTmp.Vector3[2];i.subtractToRef(t,l),l.normalize(),Vector3.CrossToRef(r,l,o);const c=o.lengthSquared();0===c?o.x=1:o.normalizeFromLength(Math.sqrt(c)),Vector3.CrossToRef(l,o,h),h.normalize();const u=-Vector3.Dot(o,t),d=-Vector3.Dot(h,t),_=-Vector3.Dot(l,t);return Matrix.FromValuesToRef(o._x,h._x,l._x,0,o._y,h._y,l._y,0,o._z,h._z,l._z,0,u,d,_,1,a),a}static"LookAtRH"(t,i,r){const a=new Matrix;return Matrix.LookAtRHToRef(t,i,r,a),a}static"LookAtRHToRef"(t,i,r,a){const o=MathTmp.Vector3[0],h=MathTmp.Vector3[1],l=MathTmp.Vector3[2];t.subtractToRef(i,l),l.normalize(),Vector3.CrossToRef(r,l,o);const c=o.lengthSquared();0===c?o.x=1:o.normalizeFromLength(Math.sqrt(c)),Vector3.CrossToRef(l,o,h),h.normalize();const u=-Vector3.Dot(o,t),d=-Vector3.Dot(h,t),_=-Vector3.Dot(l,t);return Matrix.FromValuesToRef(o._x,h._x,l._x,0,o._y,h._y,l._y,0,o._z,h._z,l._z,0,u,d,_,1,a),a}static"LookDirectionLH"(t,i){const r=new Matrix;return Matrix.LookDirectionLHToRef(t,i,r),r}static"LookDirectionLHToRef"(t,i,r){const a=MathTmp.Vector3[0];a.copyFrom(t),a.scaleInPlace(-1);const o=MathTmp.Vector3[1];return Vector3.CrossToRef(i,a,o),Matrix.FromValuesToRef(o._x,o._y,o._z,0,i._x,i._y,i._z,0,a._x,a._y,a._z,0,0,0,0,1,r),r}static"LookDirectionRH"(t,i){const r=new Matrix;return Matrix.LookDirectionRHToRef(t,i,r),r}static"LookDirectionRHToRef"(t,i,r){const a=MathTmp.Vector3[2];return Vector3.CrossToRef(i,t,a),Matrix.FromValuesToRef(a._x,a._y,a._z,0,i._x,i._y,i._z,0,t._x,t._y,t._z,0,0,0,0,1,r),r}static"OrthoLH"(t,i,r,a,o){const h=new Matrix;return Matrix.OrthoLHToRef(t,i,r,a,h,o),h}static"OrthoLHToRef"(t,i,r,a,o,h){const l=2/t,c=2/i,u=2/(a-r),_=-(a+r)/(a-r);return Matrix.FromValuesToRef(l,0,0,0,0,c,0,0,0,0,u,0,0,0,_,1,o),h&&o.multiplyToRef(d,o),o._updateIdentityStatus(1===l&&1===c&&1===u&&0===_),o}static"OrthoOffCenterLH"(t,i,r,a,o,h,l){const c=new Matrix;return Matrix.OrthoOffCenterLHToRef(t,i,r,a,o,h,c,l),c}static"OrthoOffCenterLHToRef"(t,i,r,a,o,h,l,c){const u=2/(i-t),_=2/(a-r),g=2/(h-o),p=-(h+o)/(h-o),m=(t+i)/(t-i),T=(a+r)/(r-a);return Matrix.FromValuesToRef(u,0,0,0,0,_,0,0,0,0,g,0,m,T,p,1,l),c&&l.multiplyToRef(d,l),l.markAsUpdated(),l}static"ObliqueOffCenterLHToRef"(t,i,r,a,o,h,l,c,u,d,_){const g=-l*Math.cos(c),p=-l*Math.sin(c);return Matrix.TranslationToRef(0,0,-u,MathTmp.Matrix[1]),Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,g,p,1,0,0,0,0,1,MathTmp.Matrix[0]),MathTmp.Matrix[1].multiplyToRef(MathTmp.Matrix[0],MathTmp.Matrix[0]),Matrix.TranslationToRef(0,0,u,MathTmp.Matrix[1]),MathTmp.Matrix[0].multiplyToRef(MathTmp.Matrix[1],MathTmp.Matrix[0]),Matrix.OrthoOffCenterLHToRef(t,i,r,a,o,h,d,_),MathTmp.Matrix[0].multiplyToRef(d,d),d}static"OrthoOffCenterRH"(t,i,r,a,o,h,l){const c=new Matrix;return Matrix.OrthoOffCenterRHToRef(t,i,r,a,o,h,c,l),c}static"OrthoOffCenterRHToRef"(t,i,r,a,o,h,l,c){return Matrix.OrthoOffCenterLHToRef(t,i,r,a,o,h,l,c),l._m[10]*=-1,l}static"ObliqueOffCenterRHToRef"(t,i,r,a,o,h,l,c,u,d,_){const g=l*Math.cos(c),p=l*Math.sin(c);return Matrix.TranslationToRef(0,0,u,MathTmp.Matrix[1]),Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,g,p,1,0,0,0,0,1,MathTmp.Matrix[0]),MathTmp.Matrix[1].multiplyToRef(MathTmp.Matrix[0],MathTmp.Matrix[0]),Matrix.TranslationToRef(0,0,-u,MathTmp.Matrix[1]),MathTmp.Matrix[0].multiplyToRef(MathTmp.Matrix[1],MathTmp.Matrix[0]),Matrix.OrthoOffCenterRHToRef(t,i,r,a,o,h,d,_),MathTmp.Matrix[0].multiplyToRef(d,d),d}static"PerspectiveLH"(t,i,r,a,o,h=0){const l=new Matrix,c=2*r/t,u=2*r/i,_=(a+r)/(a-r),g=-2*a*r/(a-r),p=Math.tan(h);return Matrix.FromValuesToRef(c,0,0,0,0,u,0,p,0,0,_,1,0,0,g,0,l),o&&l.multiplyToRef(d,l),l._updateIdentityStatus(!1),l}static"PerspectiveFovLH"(t,i,r,a,o,h=0,l=!1){const c=new Matrix;return Matrix.PerspectiveFovLHToRef(t,i,r,a,c,!0,o,h,l),c}static"PerspectiveFovLHToRef"(t,i,r,a,o,h=!0,l,c=0,u=!1){const _=r,g=a,p=1/Math.tan(.5*t),m=h?p/i:p,T=h?p:p*i,y=u&&0===_?-1:0!==g?(g+_)/(g-_):1,M=u&&0===_?2*g:0!==g?-2*g*_/(g-_):-2*_,b=Math.tan(c);return Matrix.FromValuesToRef(m,0,0,0,0,T,0,b,0,0,y,1,0,0,M,0,o),l&&o.multiplyToRef(d,o),o._updateIdentityStatus(!1),o}static"PerspectiveFovReverseLHToRef"(t,i,r,a,o,h=!0,l,c=0){const u=1/Math.tan(.5*t),_=h?u/i:u,g=h?u:u*i,p=Math.tan(c);return Matrix.FromValuesToRef(_,0,0,0,0,g,0,p,0,0,-r,1,0,0,1,0,o),l&&o.multiplyToRef(d,o),o._updateIdentityStatus(!1),o}static"PerspectiveFovRH"(t,i,r,a,o,h=0,l=!1){const c=new Matrix;return Matrix.PerspectiveFovRHToRef(t,i,r,a,c,!0,o,h,l),c}static"PerspectiveFovRHToRef"(t,i,r,a,o,h=!0,l,c=0,u=!1){const _=r,g=a,p=1/Math.tan(.5*t),m=h?p/i:p,T=h?p:p*i,y=u&&0===_?1:0!==g?-(g+_)/(g-_):-1,M=u&&0===_?2*g:0!==g?-2*g*_/(g-_):-2*_,b=Math.tan(c);return Matrix.FromValuesToRef(m,0,0,0,0,T,0,b,0,0,y,-1,0,0,M,0,o),l&&o.multiplyToRef(d,o),o._updateIdentityStatus(!1),o}static"PerspectiveFovReverseRHToRef"(t,i,r,a,o,h=!0,l,c=0){const u=1/Math.tan(.5*t),_=h?u/i:u,g=h?u:u*i,p=Math.tan(c);return Matrix.FromValuesToRef(_,0,0,0,0,g,0,p,0,0,-r,-1,0,0,-1,0,o),l&&o.multiplyToRef(d,o),o._updateIdentityStatus(!1),o}static"GetFinalMatrix"(t,i,r,a,o,h){const l=t.width,c=t.height,u=t.x,d=t.y,_=Matrix.FromValues(l/2,0,0,0,0,-c/2,0,0,0,0,h-o,0,u+l/2,c/2+d,o,1),g=new Matrix;return i.multiplyToRef(r,g),g.multiplyToRef(a,g),g.multiplyToRef(_,g)}static"GetAsMatrix2x2"(t){const i=t.m,r=[i[0],i[1],i[4],i[5]];return l.Z.MatrixUse64Bits?r:new Float32Array(r)}static"GetAsMatrix3x3"(t){const i=t.m,r=[i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10]];return l.Z.MatrixUse64Bits?r:new Float32Array(r)}static"Transpose"(t){const i=new Matrix;return Matrix.TransposeToRef(t,i),i}static"TransposeToRef"(t,i){const r=t.m,a=r[0],o=r[4],h=r[8],l=r[12],c=r[1],u=r[5],d=r[9],_=r[13],g=r[2],p=r[6],m=r[10],T=r[14],y=r[3],M=r[7],b=r[11],x=r[15],E=i._m;return E[0]=a,E[1]=o,E[2]=h,E[3]=l,E[4]=c,E[5]=u,E[6]=d,E[7]=_,E[8]=g,E[9]=p,E[10]=m,E[11]=T,E[12]=y,E[13]=M,E[14]=b,E[15]=x,i.markAsUpdated(),i._updateIdentityStatus(t._isIdentity,t._isIdentityDirty),i}static"Reflection"(t){const i=new Matrix;return Matrix.ReflectionToRef(t,i),i}static"ReflectionToRef"(t,i){t.normalize();const r=t.normal.x,a=t.normal.y,o=t.normal.z,h=-2*r,l=-2*a,c=-2*o;return Matrix.FromValuesToRef(h*r+1,l*r,c*r,0,h*a,l*a+1,c*a,0,h*o,l*o,c*o+1,0,h*t.d,l*t.d,c*t.d,1,i),i}static"FromXYZAxesToRef"(t,i,r,a){return Matrix.FromValuesToRef(t._x,t._y,t._z,0,i._x,i._y,i._z,0,r._x,r._y,r._z,0,0,0,0,1,a),a}static"FromQuaternionToRef"(t,i){const r=t._x*t._x,a=t._y*t._y,o=t._z*t._z,h=t._x*t._y,l=t._z*t._w,c=t._z*t._x,u=t._y*t._w,d=t._y*t._z,_=t._x*t._w;return i._m[0]=1-2*(a+o),i._m[1]=2*(h+l),i._m[2]=2*(c-u),i._m[3]=0,i._m[4]=2*(h-l),i._m[5]=1-2*(o+r),i._m[6]=2*(d+_),i._m[7]=0,i._m[8]=2*(c+u),i._m[9]=2*(d-_),i._m[10]=1-2*(a+r),i._m[11]=0,i._m[12]=0,i._m[13]=0,i._m[14]=0,i._m[15]=1,i.markAsUpdated(),i}}Matrix._UpdateFlagSeed=0,Matrix._IdentityReadOnly=Matrix.Identity(),Object.defineProperties(Matrix.prototype,{"dimension":{"value":[4,4]},"rank":{"value":2}});class MathTmp{}MathTmp.Vector3=(0,o.rP)(11,Vector3.Zero),MathTmp.Matrix=(0,o.rP)(2,Matrix.Identity),MathTmp.Quaternion=(0,o.rP)(3,Quaternion.Zero);class TmpVectors{}TmpVectors.Vector2=(0,o.rP)(3,Vector2.Zero),TmpVectors.Vector3=(0,o.rP)(13,Vector3.Zero),TmpVectors.Vector4=(0,o.rP)(3,Vector4.Zero),TmpVectors.Quaternion=(0,o.rP)(3,Quaternion.Zero),TmpVectors.Matrix=(0,o.rP)(8,Matrix.Identity),(0,h.H7)("BABYLON.Vector2",Vector2),(0,h.H7)("BABYLON.Vector3",Vector3),(0,h.H7)("BABYLON.Vector4",Vector4),(0,h.H7)("BABYLON.Matrix",Matrix);const d=Matrix.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},"470":function(t,i,r){r.d(i,{"l":function(){return Viewport}});class Viewport{"constructor"(t,i,r,a){this.x=t,this.y=i,this.width=r,this.height=a}"toGlobal"(t,i){return new Viewport(this.x*t,this.y*i,this.width*t,this.height*i)}"toGlobalToRef"(t,i,r){return r.x=this.x*t,r.y=this.y*i,r.width=this.width*t,r.height=this.height*i,this}"clone"(){return new Viewport(this.x,this.y,this.width,this.height)}}},"6298":function(t,i,r){r.d(i,{"_":function(){return SphericalHarmonics},"i":function(){return SphericalPolynomial}});var a=r(5412);r(5241),r(2922),r(4551),r(8952),r(3118),r(6504),r(3321);r(470);const o=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],h=[()=>1,t=>t.y,t=>t.z,t=>t.x,t=>t.x*t.y,t=>t.y*t.z,t=>3*t.z*t.z-1,t=>t.x*t.z,t=>t.x*t.x-t.y*t.y],applySH3=(t,i)=>o[t]*h[t](i),l=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class SphericalHarmonics{"constructor"(){this.preScaled=!1,this.l00=a.P.Zero(),this.l1_1=a.P.Zero(),this.l10=a.P.Zero(),this.l11=a.P.Zero(),this.l2_2=a.P.Zero(),this.l2_1=a.P.Zero(),this.l20=a.P.Zero(),this.l21=a.P.Zero(),this.l22=a.P.Zero()}"addLight"(t,i,r){a.jp.Vector3[0].set(i.r,i.g,i.b);const o=a.jp.Vector3[0],h=a.jp.Vector3[1];o.scaleToRef(r,h),h.scaleToRef(applySH3(0,t),a.jp.Vector3[2]),this.l00.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(1,t),a.jp.Vector3[2]),this.l1_1.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(2,t),a.jp.Vector3[2]),this.l10.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(3,t),a.jp.Vector3[2]),this.l11.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(4,t),a.jp.Vector3[2]),this.l2_2.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(5,t),a.jp.Vector3[2]),this.l2_1.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(6,t),a.jp.Vector3[2]),this.l20.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(7,t),a.jp.Vector3[2]),this.l21.addInPlace(a.jp.Vector3[2]),h.scaleToRef(applySH3(8,t),a.jp.Vector3[2]),this.l22.addInPlace(a.jp.Vector3[2])}"scaleInPlace"(t){this.l00.scaleInPlace(t),this.l1_1.scaleInPlace(t),this.l10.scaleInPlace(t),this.l11.scaleInPlace(t),this.l2_2.scaleInPlace(t),this.l2_1.scaleInPlace(t),this.l20.scaleInPlace(t),this.l21.scaleInPlace(t),this.l22.scaleInPlace(t)}"convertIncidentRadianceToIrradiance"(){this.l00.scaleInPlace(l[0]),this.l1_1.scaleInPlace(l[1]),this.l10.scaleInPlace(l[2]),this.l11.scaleInPlace(l[3]),this.l2_2.scaleInPlace(l[4]),this.l2_1.scaleInPlace(l[5]),this.l20.scaleInPlace(l[6]),this.l21.scaleInPlace(l[7]),this.l22.scaleInPlace(l[8])}"convertIrradianceToLambertianRadiance"(){this.scaleInPlace(1/Math.PI)}"preScaleForRendering"(){this.preScaled=!0,this.l00.scaleInPlace(o[0]),this.l1_1.scaleInPlace(o[1]),this.l10.scaleInPlace(o[2]),this.l11.scaleInPlace(o[3]),this.l2_2.scaleInPlace(o[4]),this.l2_1.scaleInPlace(o[5]),this.l20.scaleInPlace(o[6]),this.l21.scaleInPlace(o[7]),this.l22.scaleInPlace(o[8])}"updateFromArray"(t){return a.P.FromArrayToRef(t[0],0,this.l00),a.P.FromArrayToRef(t[1],0,this.l1_1),a.P.FromArrayToRef(t[2],0,this.l10),a.P.FromArrayToRef(t[3],0,this.l11),a.P.FromArrayToRef(t[4],0,this.l2_2),a.P.FromArrayToRef(t[5],0,this.l2_1),a.P.FromArrayToRef(t[6],0,this.l20),a.P.FromArrayToRef(t[7],0,this.l21),a.P.FromArrayToRef(t[8],0,this.l22),this}"updateFromFloatsArray"(t){return a.P.FromFloatsToRef(t[0],t[1],t[2],this.l00),a.P.FromFloatsToRef(t[3],t[4],t[5],this.l1_1),a.P.FromFloatsToRef(t[6],t[7],t[8],this.l10),a.P.FromFloatsToRef(t[9],t[10],t[11],this.l11),a.P.FromFloatsToRef(t[12],t[13],t[14],this.l2_2),a.P.FromFloatsToRef(t[15],t[16],t[17],this.l2_1),a.P.FromFloatsToRef(t[18],t[19],t[20],this.l20),a.P.FromFloatsToRef(t[21],t[22],t[23],this.l21),a.P.FromFloatsToRef(t[24],t[25],t[26],this.l22),this}static"FromArray"(t){return(new SphericalHarmonics).updateFromArray(t)}static"FromPolynomial"(t){const i=new SphericalHarmonics;return i.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),i.l1_1=t.y.scale(.977204),i.l10=t.z.scale(.977204),i.l11=t.x.scale(.977204),i.l2_2=t.xy.scale(1.16538),i.l2_1=t.yz.scale(1.16538),i.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),i.l21=t.zx.scale(1.16538),i.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),i.l1_1.scaleInPlace(-1),i.l11.scaleInPlace(-1),i.l2_1.scaleInPlace(-1),i.l21.scaleInPlace(-1),i.scaleInPlace(Math.PI),i}}class SphericalPolynomial{"constructor"(){this.x=a.P.Zero(),this.y=a.P.Zero(),this.z=a.P.Zero(),this.xx=a.P.Zero(),this.yy=a.P.Zero(),this.zz=a.P.Zero(),this.xy=a.P.Zero(),this.yz=a.P.Zero(),this.zx=a.P.Zero()}get"preScaledHarmonics"(){return this._harmonics||(this._harmonics=SphericalHarmonics.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}"addAmbient"(t){a.jp.Vector3[0].copyFromFloats(t.r,t.g,t.b);const i=a.jp.Vector3[0];this.xx.addInPlace(i),this.yy.addInPlace(i),this.zz.addInPlace(i)}"scaleInPlace"(t){this.x.scaleInPlace(t),this.y.scaleInPlace(t),this.z.scaleInPlace(t),this.xx.scaleInPlace(t),this.yy.scaleInPlace(t),this.zz.scaleInPlace(t),this.yz.scaleInPlace(t),this.zx.scaleInPlace(t),this.xy.scaleInPlace(t)}"updateFromHarmonics"(t){return this._harmonics=t,this.x.copyFrom(t.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(t.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(t.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(t.l00),a.jp.Vector3[0].copyFrom(t.l20).scaleInPlace(.247708),a.jp.Vector3[1].copyFrom(t.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(a.jp.Vector3[0]).addInPlace(a.jp.Vector3[1]),this.yy.copyFrom(t.l00),this.yy.scaleInPlace(.886277).subtractInPlace(a.jp.Vector3[0]).subtractInPlace(a.jp.Vector3[1]),this.zz.copyFrom(t.l00),a.jp.Vector3[0].copyFrom(t.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(a.jp.Vector3[0]),this.yz.copyFrom(t.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(t.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(t.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static"FromHarmonics"(t){return(new SphericalPolynomial).updateFromHarmonics(t)}static"FromArray"(t){const i=new SphericalPolynomial;return a.P.FromArrayToRef(t[0],0,i.x),a.P.FromArrayToRef(t[1],0,i.y),a.P.FromArrayToRef(t[2],0,i.z),a.P.FromArrayToRef(t[3],0,i.xx),a.P.FromArrayToRef(t[4],0,i.yy),a.P.FromArrayToRef(t[5],0,i.zz),a.P.FromArrayToRef(t[6],0,i.yz),a.P.FromArrayToRef(t[7],0,i.zx),a.P.FromArrayToRef(t[8],0,i.xy),i}}},"4081":function(t,i,r){r.d(i,{"M":function(){return WebGLDataBuffer}});var a=r(1545);class WebGLDataBuffer extends a.h{"constructor"(t){super(),this._buffer=t}get"underlyingResource"(){return this._buffer}}},"2554":function(t,i,r){function BuildArray(t,i){const r=[];for(let a=0;a<t;++a)r.push(i());return r}function BuildTuple(t,i){return BuildArray(t,i)}r.d(i,{"$G":function(){return BuildArray},"Mf":function(){return _ObserveArray},"rP":function(){return BuildTuple}});const a=["push","splice","pop","shift","unshift"];function _ObserveArray(t,i){const r=a.map(r=>function _observeArrayfunction(t,i,r){const a=t[i];if("function"!=typeof a)return null;const newFunction=function(){const a=t.length,o=newFunction.previous.apply(t,arguments);return r(i,a),o};return a.next=newFunction,newFunction.previous=a,t[i]=newFunction,()=>{const r=newFunction.previous;if(!r)return;const a=newFunction.next;a?(r.next=a,a.previous=r):(r.next=void 0,t[i]=r),newFunction.next=void 0,newFunction.previous=void 0}}(t,r,i));return()=>{r.forEach(t=>{t?.()})}}},"8532":function(t,i,r){r.d(i,{"D":function(){return GetMergedStore},"x":function(){return GetDirectStore}});const a={},o={};function GetDirectStore(t){const i=t.getClassName();return o[i]||(o[i]={}),o[i]}function GetMergedStore(t){const i=t.getClassName();if(a[i])return a[i];a[i]={};const r=a[i];let h=t,l=i;for(;l;){const t=o[l];for(const i in t)r[i]=t[i];let i,a=!1;do{if(i=Object.getPrototypeOf(h),!i.getClassName){a=!0;break}if(i.getClassName()!==l)break;h=i}while(i);if(a)break;l=i.getClassName(),h=i}return r}},"8137":function(t,i,r){r.d(i,{"G6":function(){return nativeOverride},"N$":function(){return serializeAsColorCurves},"QC":function(){return serializeAsVector2},"RR":function(){return serializeAsMeshReference},"XX":function(){return serializeAsColor4},"hd":function(){return serializeAsVector3},"mv":function(){return serializeAsQuaternion},"n9":function(){return serializeAsColor3},"oU":function(){return serializeAsTexture},"qC":function(){return serialize},"qQ":function(){return serializeAsFresnelParameters},"wz":function(){return expandToProperty}});var a=r(8532);function generateSerializableMember(t,i){return(r,o)=>{const h=(0,a.x)(r);h[o]||(h[o]={"type":t,"sourceName":i})}}function expandToProperty(t,i=null){return function generateExpandMember(t,i=null){return(r,a)=>{const o=i||"_"+a;Object.defineProperty(r,a,{"get":function(){return this[o]},"set":function(i){"function"==typeof this[o]?.equals&&this[o].equals(i)||this[o]!==i&&(this[o]=i,r[t].apply(this))},"enumerable":!0,"configurable":!0})}}(t,i)}function serialize(t){return generateSerializableMember(0,t)}function serializeAsTexture(t){return generateSerializableMember(1,t)}function serializeAsColor3(t){return generateSerializableMember(2,t)}function serializeAsFresnelParameters(t){return generateSerializableMember(3,t)}function serializeAsVector2(t){return generateSerializableMember(4,t)}function serializeAsVector3(t){return generateSerializableMember(5,t)}function serializeAsMeshReference(t){return generateSerializableMember(6,t)}function serializeAsColorCurves(t){return generateSerializableMember(7,t)}function serializeAsColor4(t){return generateSerializableMember(8,t)}function serializeAsQuaternion(t){return generateSerializableMember(10,t)}function nativeOverride(t,i,r,a){const o=r.value;r.value=(...r)=>{let h=o;if("undefined"!=typeof _native&&_native[i]){const t=_native[i];h=a?(...i)=>a(...i)?t(...i):o(...i):t}return t[i]=h,h(...r)}}nativeOverride.filter=function(t){return(i,r,a)=>nativeOverride(i,r,a,t)}},"8113":function(t,i,r){r.d(i,{"p":function(){return SerializationHelper}});var a=r(9069),o=r(1995),h=r(2922),l=r(5412),c=r(8532);const _copySource=function(t,i,r,a={}){const h=t();o.$&&o.$.HasTags(i)&&o.$.AddTagsTo(h,o.$.GetTags(i,!0));const l=(0,c.D)(h),u={};for(const t in l){const o=l[t],c=i[t],d=o.type;if(null!=c&&("uniqueId"!==t||SerializationHelper.AllowLoadingUniqueId))switch(d){case 0:case 6:case 9:case 11:h[t]=c;break;case 1:a.cloneTexturesOnlyOnce&&u[c.uniqueId]?h[t]=u[c.uniqueId]:(h[t]=r||c.isRenderTarget?c:c.clone(),u[c.uniqueId]=h[t]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:h[t]=r?c:c.clone()}}return h};class SerializationHelper{static"AppendSerializedAnimations"(t,i){if(t.animations){i.animations=[];for(let r=0;r<t.animations.length;r++){const a=t.animations[r];i.animations.push(a.serialize())}}}static"Serialize"(t,i){i||(i={}),o.$&&(i.tags=o.$.GetTags(t));const r=(0,c.D)(t);for(const a in r){const o=r[a],h=o.sourceName||a,l=o.type,c=t[a];if(null!=c&&("uniqueId"!==a||SerializationHelper.AllowLoadingUniqueId))switch(l){case 0:i[h]=c;break;case 1:case 3:case 7:case 9:i[h]=c.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:i[h]=c.asArray();break;case 6:case 11:i[h]=c.id}}return i}static"ParseProperties"(t,i,r,a){a||(a="");const o=(0,c.D)(i);for(const c in o){const u=o[c],d=t[u.sourceName||c],_=u.type;if(null!=d&&("uniqueId"!==c||SerializationHelper.AllowLoadingUniqueId)){const t=i;switch(_){case 0:t[c]=d;break;case 1:r&&(t[c]=SerializationHelper._TextureParser(d,r,a));break;case 2:t[c]=h.Wo.FromArray(d);break;case 3:t[c]=SerializationHelper._FresnelParametersParser(d);break;case 4:t[c]=l.FM.FromArray(d);break;case 5:t[c]=l.P.FromArray(d);break;case 6:r&&(t[c]=r.getLastMeshById(d));break;case 7:t[c]=SerializationHelper._ColorCurvesParser(d);break;case 8:t[c]=h.HE.FromArray(d);break;case 9:t[c]=SerializationHelper._ImageProcessingConfigurationParser(d);break;case 10:t[c]=l._f.FromArray(d);break;case 11:r&&(t[c]=r.getCameraById(d));break;case 12:t[c]=l.y3.FromArray(d)}}}}static"Parse"(t,i,r,a=null){const h=t();return o.$&&o.$.AddTagsTo(h,i.tags),SerializationHelper.ParseProperties(i,h,r,a),h}static"Clone"(t,i,r={}){return _copySource(t,i,!1,r)}static"Instanciate"(t,i){return _copySource(t,i,!0)}}SerializationHelper.AllowLoadingUniqueId=!1,SerializationHelper._ImageProcessingConfigurationParser=t=>{throw(0,a.S)("ImageProcessingConfiguration")},SerializationHelper._FresnelParametersParser=t=>{throw(0,a.S)("FresnelParameters")},SerializationHelper._ColorCurvesParser=t=>{throw(0,a.S)("ColorCurves")},SerializationHelper._TextureParser=(t,i,r)=>{throw(0,a.S)("Texture")}},"2827":function(t,i,r){r.d(i,{"j":function(){return DeepCopier}});var a=r(658);const CloneValue=(t,i,r)=>t?t.getClassName&&"Mesh"===t.getClassName()?null:!t.getClassName||"SubMesh"!==t.getClassName()&&"PhysicsBody"!==t.getClassName()?t.clone?t.clone():Array.isArray(t)?t.slice():r&&"object"==typeof t?{...t}:null:t.clone(i):null;class DeepCopier{static"DeepCopy"(t,i,r,o,h=!1){const l=function GetAllPropertyNames(t){const i=[];do{Object.getOwnPropertyNames(t).forEach(function(t){-1===i.indexOf(t)&&i.push(t)})}while(t=Object.getPrototypeOf(t));return i}(t);for(const c of l){if("_"===c[0]&&(!o||-1===o.indexOf(c)))continue;if(c.endsWith("Observable"))continue;if(r&&-1!==r.indexOf(c))continue;const l=t[c],u=typeof l;if("function"!==u)try{if("object"===u)if(l instanceof Uint8Array)i[c]=Uint8Array.from(l);else if(l instanceof Array){if(i[c]=[],l.length>0)if("object"==typeof l[0])for(let t=0;t<l.length;t++){const r=CloneValue(l[t],i,h);-1===i[c].indexOf(r)&&i[c].push(r)}else i[c]=l.slice(0)}else i[c]=CloneValue(l,i,h);else i[c]=l}catch(t){a.Y.Warn(t.message)}}}}},"9069":function(t,i,r){r.d(i,{"S":function(){return _WarnImport}});const a={};function _WarnImport(t,i=!1){if(!i||!a[t])return a[t]=!0,`${t} needs to be imported before as it contains a side-effect required by your code.`}},"1102":function(t,i,r){function IsWindowObjectExist(){return"undefined"!=typeof window}function IsNavigatorAvailable(){return"undefined"!=typeof navigator}function IsDocumentAvailable(){return"undefined"!=typeof document}function GetDOMTextContent(t){let i="",r=t.firstChild;for(;r;)3===r.nodeType&&(i+=r.textContent),r=r.nextSibling;return i}r.d(i,{"CG":function(){return IsWindowObjectExist},"n5":function(){return IsDocumentAvailable},"up":function(){return IsNavigatorAvailable},"v":function(){return GetDOMTextContent}})},"9714":function(t,i,r){r.d(i,{"GU":function(){return BaseError},"LH":function(){return RuntimeError},"SM":function(){return a}});class BaseError extends Error{}BaseError._setPrototypeOf=Object.setPrototypeOf||((t,i)=>(t.__proto__=i,t));const a={"MeshInvalidPositionsError":0,"UnsupportedTextureError":1e3,"GLTFLoaderUnexpectedMagicError":2e3,"SceneLoaderError":3e3,"LoadFileError":4e3,"RequestFileError":4001,"ReadFileError":4002};class RuntimeError extends BaseError{"constructor"(t,i,r){super(t),this.errorCode=i,this.innerError=r,this.name="RuntimeError",BaseError._setPrototypeOf(this,RuntimeError.prototype)}}},"9485":function(t,i,r){r.d(i,{"$K":function(){return DecodeBase64UrlToBinary},"rN":function(){return y},"VL":function(){return IsBase64DataUrl},"vP":function(){return LoadFile},"r6":function(){return LoadImage},"Ip":function(){return ReadFile},"FV":function(){return RequestFile},"$M":function(){return SetCorsBehavior}});var a=r(4910),o=r(1102),h=r(8139);class FilesInputStore{}FilesInputStore.FilesToLoad={};var l=r(9714),c=r(8661),u=r(3525),d=r(5953),_=r(658),g=r(9447),p=r(6443),m=r(9204);const T=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class LoadFileError extends l.LH{"constructor"(t,i){super(t,l.SM.LoadFileError),this.name="LoadFileError",l.GU._setPrototypeOf(this,LoadFileError.prototype),i instanceof a.g?this.request=i:this.file=i}}class RequestFileError extends l.LH{"constructor"(t,i){super(t,l.SM.RequestFileError),this.request=i,this.name="RequestFileError",l.GU._setPrototypeOf(this,RequestFileError.prototype)}}class ReadFileError extends l.LH{"constructor"(t,i){super(t,l.SM.ReadFileError),this.file=i,this.name="ReadFileError",l.GU._setPrototypeOf(this,ReadFileError.prototype)}}const y={"DefaultRetryStrategy":class RetryStrategy{static"ExponentialBackoff"(t=3,i=500){return(r,a,o)=>0!==a.status||o>=t||-1!==r.indexOf("file:")?-1:Math.pow(2,o)*i}}.ExponentialBackoff(),"BaseUrl":"","CorsBehavior":"anonymous","PreprocessUrl":t=>t,"ScriptBaseUrl":"","ScriptPreprocessUrl":t=>t,"CleanUrl":t=>t=t.replace(/#/gm,"%23")},SetCorsBehavior=(t,i)=>{if((!t||0!==t.indexOf("data:"))&&y.CorsBehavior)if("string"==typeof y.CorsBehavior||y.CorsBehavior instanceof String)i.crossOrigin=y.CorsBehavior;else{const r=y.CorsBehavior(t);r&&(i.crossOrigin=r)}},M={"getRequiredSize":null},LoadImage=(t,i,r,o,h="",l,u=d.l.LastCreatedEngine)=>{if("undefined"==typeof HTMLImageElement&&!u?._features.forceBitmapOverHTMLImageElement)return r("LoadImage is only supported in web or BabylonNative environments."),null;let _,g=!1;t instanceof ArrayBuffer||ArrayBuffer.isView(t)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(_=URL.createObjectURL(new Blob([t],{"type":h})),g=!0):_=`data:${h};base64,`+(0,c.Gh)(t):t instanceof Blob?(_=URL.createObjectURL(t),g=!0):(_=y.CleanUrl(t),_=y.PreprocessUrl(_));const onErrorHandler=i=>{if(r){const a=_||t.toString();r(`Error while trying to load image: ${0===a.indexOf("http")||a.length<=128?a:a.slice(0,128)+"..."}`,i)}};if(u?._features.forceBitmapOverHTMLImageElement)return LoadFile(_,a=>{u.createImageBitmap(new Blob([a],{"type":h}),{"premultiplyAlpha":"none",...l}).then(t=>{i(t),g&&URL.revokeObjectURL(_)}).catch(i=>{r&&r("Error while trying to load image: "+t,i)})},void 0,o||void 0,!0,(t,i)=>{onErrorHandler(i)}),null;const p=new Image;if(M.getRequiredSize){const i=M.getRequiredSize(t);i.width&&(p.width=i.width),i.height&&(p.height=i.height)}SetCorsBehavior(_,p);const m=[],unloadHandlersList=()=>{m.forEach(t=>{t.target.removeEventListener(t.name,t.handler)}),m.length=0};m.push({"target":p,"name":"load","handler":()=>{unloadHandlersList(),i(p),g&&p.src&&URL.revokeObjectURL(p.src)}}),m.push({"target":p,"name":"error","handler":t=>{unloadHandlersList(),onErrorHandler(t),g&&p.src&&URL.revokeObjectURL(p.src)}}),m.push({"target":document,"name":"securitypolicyviolation","handler":t=>{if(t.blockedURI!==p.src||"report"===t.disposition)return;unloadHandlersList();const i=new Error(`CSP violation of policy ${t.effectiveDirective} ${t.blockedURI}. Current policy is ${t.originalPolicy}`);d.l.UseFallbackTexture=!1,onErrorHandler(i),g&&p.src&&URL.revokeObjectURL(p.src),p.src=""}}),m.forEach(t=>{t.target.addEventListener(t.name,t.handler)});const T="blob:"===_.substring(0,5),b="data:"===_.substring(0,5),noOfflineSupport=()=>{T||b||!a.g.IsCustomRequestAvailable?p.src=_:LoadFile(_,(t,i,r)=>{const a=new Blob([t],{"type":!h&&r?r:h}),o=URL.createObjectURL(a);g=!0,p.src=o},void 0,o||void 0,!0,(t,i)=>{onErrorHandler(i)})},loadFromOfflineSupport=()=>{o&&o.loadImage(_,p)};if(!T&&!b&&o&&o.enableTexturesOffline)o.open(loadFromOfflineSupport,noOfflineSupport);else{if(-1!==_.indexOf("file:")){const t=decodeURIComponent(_.substring(5).toLowerCase());if(FilesInputStore.FilesToLoad[t]&&"undefined"!=typeof URL){try{let i;try{i=URL.createObjectURL(FilesInputStore.FilesToLoad[t])}catch(r){i=URL.createObjectURL(FilesInputStore.FilesToLoad[t])}p.src=i,g=!0}catch(t){p.src=""}return p}}noOfflineSupport()}return p},ReadFile=(t,i,r,a,o)=>{const l=new FileReader,c={"onCompleteObservable":new h.y$,"abort":()=>l.abort()};return l.onloadend=()=>c.onCompleteObservable.notifyObservers(c),o&&(l.onerror=()=>{o(new ReadFileError(`Unable to read ${t.name}`,t))}),l.onload=t=>{i(t.target.result)},r&&(l.onprogress=r),a?l.readAsArrayBuffer(t):l.readAsText(t),c},LoadFile=(t,i,r,a,o,l,c)=>{if(t.name)return ReadFile(t,i,r,o,l?t=>{l(void 0,t)}:void 0);const u=t;if(-1!==u.indexOf("file:")){let t=decodeURIComponent(u.substring(5).toLowerCase());0===t.indexOf("./")&&(t=t.substring(2));const a=FilesInputStore.FilesToLoad[t];if(a)return ReadFile(a,i,r,o,l?t=>l(void 0,new LoadFileError(t.message,t.file)):void 0)}const{"match":d,"type":p}=TestBase64DataUrl(u);if(d){const t={"onCompleteObservable":new h.y$,"abort":()=>()=>{}};try{const t=o?DecodeBase64UrlToBinary(u):DecodeBase64UrlToString(u);i(t,void 0,p)}catch(t){l?l(void 0,t):_.Y.Error(t.message||"Failed to parse the Data URL")}return g.Q.SetImmediate(()=>{t.onCompleteObservable.notifyObservers(t)}),t}return RequestFile(u,(t,r)=>{i(t,r?.responseURL,r?.getResponseHeader("content-type"))},r,a,o,l?t=>{l(t.request,new LoadFileError(t.message,t.request))}:void 0,c)},RequestFile=(t,i,r,l,c,u,d)=>{t=y.CleanUrl(t),t=y.PreprocessUrl(t);const g=y.BaseUrl+t;let p=!1;const m={"onCompleteObservable":new h.y$,"abort":()=>p=!0},requestFile=()=>{let t,h=new a.g,l=null;const unbindEvents=()=>{h&&(r&&h.removeEventListener("progress",r),t&&h.removeEventListener("readystatechange",t),h.removeEventListener("loadend",onLoadEnd))};let onLoadEnd=()=>{unbindEvents(),m.onCompleteObservable.notifyObservers(m),m.onCompleteObservable.clear(),r=void 0,t=null,onLoadEnd=null,u=void 0,d=void 0,i=void 0};m.abort=()=>{p=!0,onLoadEnd&&onLoadEnd(),h&&h.readyState!==(XMLHttpRequest.DONE||4)&&h.abort(),null!==l&&(clearTimeout(l),l=null),h=null};const handleError=t=>{const i=t.message||"Unknown error";u&&h?u(new RequestFileError(i,h)):_.Y.Error(i)},retryLoop=_=>{if(h){if(h.open("GET",g),d)try{d(h)}catch(t){return void handleError(t)}c&&(h.responseType="arraybuffer"),r&&h.addEventListener("progress",r),onLoadEnd&&h.addEventListener("loadend",onLoadEnd),t=()=>{if(!p&&h&&h.readyState===(XMLHttpRequest.DONE||4)){if(t&&h.removeEventListener("readystatechange",t),h.status>=200&&h.status<300||0===h.status&&(!(0,o.CG)()||IsFileURL())){const t=c?h.response:h.responseText;if(null!==t){try{i&&i(t,h)}catch(t){handleError(t)}return}}const r=y.DefaultRetryStrategy;if(r){const t=r(g,h,_);if(-1!==t)return unbindEvents(),h=new a.g,void(l=setTimeout(()=>retryLoop(_+1),t))}const d=new RequestFileError("Error status: "+h.status+" "+h.statusText+" - Unable to load "+g,h);u&&u(d)}},h.addEventListener("readystatechange",t),h.send()}};retryLoop(0)};if(l&&l.enableSceneOffline){const noOfflineSupport=t=>{t&&t.status>400?u&&u(t):requestFile()},loadFromOfflineSupport=()=>{l&&l.loadFile(y.BaseUrl+t,t=>{!p&&i&&i(t),m.onCompleteObservable.notifyObservers(m)},r?t=>{!p&&r&&r(t)}:void 0,noOfflineSupport,c)};l.open(loadFromOfflineSupport,noOfflineSupport)}else requestFile();return m},IsFileURL=()=>"undefined"!=typeof location&&"file:"===location.protocol,IsBase64DataUrl=t=>T.test(t),TestBase64DataUrl=t=>{const i=T.exec(t);if(null===i||0===i.length)return{"match":!1,"type":""};return{"match":!0,"type":i[0].replace("data:","").replace("base64,","")}};function DecodeBase64UrlToBinary(t){return(0,c.HQ)(t.split(",")[1])}const DecodeBase64UrlToString=t=>(0,c.rP)(t.split(",")[1]);let b;m.a._FileToolsLoadImage=LoadImage,p.an.loadFile=LoadFile,u.PM.loadFile=LoadFile;((t,i,r,a,o,h,l,c,u,d)=>{b={"DecodeBase64UrlToBinary":t,"DecodeBase64UrlToString":i,"DefaultRetryStrategy":r.DefaultRetryStrategy,"BaseUrl":r.BaseUrl,"CorsBehavior":r.CorsBehavior,"PreprocessUrl":r.PreprocessUrl,"IsBase64DataUrl":a,"IsFileURL":o,"LoadFile":h,"LoadImage":l,"ReadFile":c,"RequestFile":u,"SetCorsBehavior":d},Object.defineProperty(b,"DefaultRetryStrategy",{"get":function(){return r.DefaultRetryStrategy},"set":function(t){r.DefaultRetryStrategy=t}}),Object.defineProperty(b,"BaseUrl",{"get":function(){return r.BaseUrl},"set":function(t){r.BaseUrl=t}}),Object.defineProperty(b,"PreprocessUrl",{"get":function(){return r.PreprocessUrl},"set":function(t){r.PreprocessUrl=t}}),Object.defineProperty(b,"CorsBehavior",{"get":function(){return r.CorsBehavior},"set":function(t){r.CorsBehavior=t}})})(DecodeBase64UrlToBinary,DecodeBase64UrlToString,y,IsBase64DataUrl,IsFileURL,LoadFile,LoadImage,ReadFile,RequestFile,SetCorsBehavior)},"3706":function(t,i,r){function RandomGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)})}r.d(i,{"f":function(){return RandomGUID}})},"6448":function(t,i,r){r.d(i,{"K":function(){return InstantiationTools}});var a=r(658),o=r(646);class InstantiationTools{static"Instantiate"(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];const i=(0,o.qw)(t);if(i)return i;a.Y.Warn(t+" not found, you may have missed an import.");const r=t.split(".");let h=window||this;for(let t=0,i=r.length;t<i;t++)h=h[r[t]];return"function"!=typeof h?null:h}}InstantiationTools.RegisteredExternalClasses={}},"658":function(t,i,r){r.d(i,{"Y":function(){return Logger}});class Logger{static"_CheckLimit"(t,i){let r=Logger._LogLimitOutputs[t];return r?r.current++:(r={"limit":i,"current":1},Logger._LogLimitOutputs[t]=r),r.current<=r.limit}static"_GenerateLimitMessage"(t,i=1){const r=Logger._LogLimitOutputs[t];if(!r||!Logger.MessageLimitReached)return;const a=this._Levels[i];r.current===r.limit&&Logger[a.name](Logger.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,a.name??""))}static"_AddLogEntry"(t){Logger._LogCache=t+Logger._LogCache,Logger.OnNewCacheEntry&&Logger.OnNewCacheEntry(t)}static"_FormatMessage"(t){const padStr=t=>t<10?"0"+t:""+t,i=new Date;return"["+padStr(i.getHours())+":"+padStr(i.getMinutes())+":"+padStr(i.getSeconds())+"]: "+t}static"_LogDisabled"(t,i){}static"_LogEnabled"(t=1,i,r){const a=Array.isArray(i)?i[0]:i;if(void 0!==r&&!Logger._CheckLimit(a,r))return;const o=Logger._FormatMessage(a),h=this._Levels[t],l=Array.isArray(i)?i.slice(1):[];h.logFunc&&h.logFunc("BJS - "+o,...l);const c=`<div style='color:${h.color}'>${o}</div><br>`;Logger._AddLogEntry(c),Logger._GenerateLimitMessage(a,t)}static get"LogCache"(){return Logger._LogCache}static"ClearLogCache"(){Logger._LogCache="",Logger._LogLimitOutputs={},Logger.errorsCount=0}static set"LogLevels"(t){Logger.Log=Logger._LogDisabled,Logger.Warn=Logger._LogDisabled,Logger.Error=Logger._LogDisabled,[Logger.MessageLogLevel,Logger.WarningLogLevel,Logger.ErrorLogLevel].forEach(i=>{if((t&i)===i){const t=this._Levels[i];Logger[t.name]=Logger._LogEnabled.bind(Logger,i)}})}}Logger.NoneLogLevel=0,Logger.MessageLogLevel=1,Logger.WarningLogLevel=2,Logger.ErrorLogLevel=4,Logger.AllLogLevel=7,Logger.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Logger._LogCache="",Logger._LogLimitOutputs={},Logger._Levels=[{},{"color":"white","logFunc":console.log,"name":"Log"},{"color":"orange","logFunc":console.warn,"name":"Warn"},{},{"color":"red","logFunc":console.error,"name":"Error"}],Logger.errorsCount=0,Logger.Log=Logger._LogEnabled.bind(Logger,Logger.MessageLogLevel),Logger.Warn=Logger._LogEnabled.bind(Logger,Logger.WarningLogLevel),Logger.Error=Logger._LogEnabled.bind(Logger,Logger.ErrorLogLevel)},"8139":function(t,i,r){r.d(i,{"y$":function(){return Observable}});const a="undefined"!=typeof WeakRef;class EventState{"constructor"(t,i=!1,r,a){this.initialize(t,i,r,a)}"initialize"(t,i=!1,r,a){return this.mask=t,this.skipNextObservers=i,this.target=r,this.currentTarget=a,this}}class Observer{"constructor"(t,i,r=null){this.callback=t,this.mask=i,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}"remove"(){this._remove&&this._remove()}}class Observable{static"FromPromise"(t,i){const r=new Observable;return t.then(t=>{r.notifyObservers(t)}).catch(t=>{if(!i)throw t;i.notifyObservers(t)}),r}get"observers"(){return this._observers}"constructor"(t,i=!1){this.notifyIfTriggered=i,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new EventState(0),t&&(this._onObserverAdded=t)}"add"(t,i=-1,r=!1,o=null,h=!1){if(!t)return null;const l=new Observer(t,i,o);l.unregisterOnNextCall=h,r?this._observers.unshift(l):this._observers.push(l),this._onObserverAdded&&this._onObserverAdded(l),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(l,this._lastNotifiedValue);const c=a?new WeakRef(this):{"deref":()=>this};return l._remove=()=>{const t=c.deref();t&&t._remove(l)},l}"addOnce"(t){return this.add(t,void 0,void 0,void 0,!0)}"remove"(t){if(!t)return!1;t._remove=null;return-1!==this._observers.indexOf(t)&&(this._deferUnregister(t),!0)}"removeCallback"(t,i){for(let r=0;r<this._observers.length;r++){const a=this._observers[r];if(!a._willBeUnregistered&&(a.callback===t&&(!i||i===a.scope)))return this._deferUnregister(a),!0}return!1}"_deferUnregister"(t){t._willBeUnregistered||(this._numObserversMarkedAsDeleted++,t.unregisterOnNextCall=!1,t._willBeUnregistered=!0,setTimeout(()=>{this._remove(t)},0))}"_remove"(t,i=!0){if(!t)return!1;const r=this._observers.indexOf(t);return-1!==r&&(i&&this._numObserversMarkedAsDeleted--,this._observers.splice(r,1),!0)}"makeObserverTopPriority"(t){this._remove(t,!1),this._observers.unshift(t)}"makeObserverBottomPriority"(t){this._remove(t,!1),this._observers.push(t)}"notifyObservers"(t,i=-1,r,a,o){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),!this._observers.length)return!0;const h=this._eventState;h.mask=i,h.target=r,h.currentTarget=a,h.skipNextObservers=!1,h.lastReturnValue=t,h.userInfo=o;for(const r of this._observers)if(!r._willBeUnregistered&&(r.mask&i&&(r.unregisterOnNextCall&&this._deferUnregister(r),r.scope?h.lastReturnValue=r.callback.apply(r.scope,[t,h]):h.lastReturnValue=r.callback(t,h)),h.skipNextObservers))return!1;return!0}"notifyObserver"(t,i,r=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=i),t._willBeUnregistered)return;const a=this._eventState;a.mask=r,a.skipNextObservers=!1,t.unregisterOnNextCall&&this._deferUnregister(t),t.callback(i,a)}"hasObservers"(){return this._observers.length-this._numObserversMarkedAsDeleted>0}"clear"(){for(;this._observers.length;){const t=this._observers.pop();t&&(t._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}"cleanLastNotifiedState"(){this._hasNotified=!1,this._lastNotifiedValue=void 0}"clone"(){const t=new Observable;return t._observers=this._observers.slice(0),t}"hasSpecificMask"(t=-1){for(const i of this._observers)if(i.mask&t||i.mask===t)return!0;return!1}}},"8482":function(t,i,r){r.d(i,{"z":function(){return PerfCounter}});var a=r(9665);class PerfCounter{get"min"(){return this._min}get"max"(){return this._max}get"average"(){return this._average}get"lastSecAverage"(){return this._lastSecAverage}get"current"(){return this._current}get"total"(){return this._totalAccumulated}get"count"(){return this._totalValueCount}"constructor"(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}"fetchNewFrame"(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}"addCount"(t,i){PerfCounter.Enabled&&(this._current+=t,i&&this._fetchResult())}"beginMonitoring"(){PerfCounter.Enabled&&(this._startMonitoringTime=a.F.Now)}"endMonitoring"(t=!0){if(!PerfCounter.Enabled)return;t&&this.fetchNewFrame();const i=a.F.Now;this._current=i-this._startMonitoringTime,t&&this._fetchResult()}"endFrame"(){this._fetchResult()}"_fetchResult"(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const t=a.F.Now;t-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=t,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}PerfCounter.Enabled=!0},"9665":function(t,i,r){r.d(i,{"F":function(){return PrecisionDate}});var a=r(1102);class PrecisionDate{static get"Now"(){return(0,a.CG)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},"8173":function(t,i,r){r.d(i,{"f":function(){return SmartArrayNoDuplicate},"t":function(){return SmartArray}});class SmartArray{"constructor"(t){this.length=0,this.data=new Array(t),this._id=SmartArray._GlobalId++}"push"(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)}"forEach"(t){for(let i=0;i<this.length;i++)t(this.data[i])}"sort"(t){this.data.sort(t)}"reset"(){this.length=0}"dispose"(){this.reset(),this.data&&(this.data.length=0)}"concat"(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(let i=0;i<t.length;i++)this.data[this.length++]=(t.data||t)[i]}}"indexOf"(t){const i=this.data.indexOf(t);return i>=this.length?-1:i}"contains"(t){return-1!==this.indexOf(t)}}SmartArray._GlobalId=0;class SmartArrayNoDuplicate extends SmartArray{"constructor"(){super(...arguments),this._duplicateId=0}"push"(t){super.push(t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId}"pushNoDuplicate"(t){return(!t.__smartArrayFlags||t.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(t),!0)}"reset"(){super.reset(),this._duplicateId++}"concatWithNoDuplicate"(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(let i=0;i<t.length;i++){const r=(t.data||t)[i];this.pushNoDuplicate(r)}}}}},"8661":function(t,i,r){r.d(i,{"Gh":function(){return EncodeArrayBufferToBase64},"HQ":function(){return DecodeBase64ToBinary},"rP":function(){return DecodeBase64ToString}});const EncodeArrayBufferToBase64=t=>{const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,a,o,h,l,c,u,d="",_=0;const g=ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t);for(;_<g.length;)r=g[_++],a=_<g.length?g[_++]:Number.NaN,o=_<g.length?g[_++]:Number.NaN,h=r>>2,l=(3&r)<<4|a>>4,c=(15&a)<<2|o>>6,u=63&o,isNaN(a)?c=u=64:isNaN(o)&&(u=64),d+=i.charAt(h)+i.charAt(l)+i.charAt(c)+i.charAt(u);return d},DecodeBase64ToString=t=>atob(t),DecodeBase64ToBinary=t=>{const i=DecodeBase64ToString(t),r=i.length,a=new Uint8Array(new ArrayBuffer(r));for(let t=0;t<r;t++)a[t]=i.charCodeAt(t);return a.buffer}},"1995":function(t,i,r){r.d(i,{"$":function(){return Tags}});class AndOrNotEvaluator{static"Eval"(t,i){return"true"===(t=t.match(/\([^()]*\)/g)?t.replace(/\([^()]*\)/g,t=>(t=t.slice(1,t.length-1),AndOrNotEvaluator._HandleParenthesisContent(t,i))):AndOrNotEvaluator._HandleParenthesisContent(t,i))||"false"!==t&&AndOrNotEvaluator.Eval(t,i)}static"_HandleParenthesisContent"(t,i){let r;i=i||(t=>"true"===t);const a=t.split("||");for(const t in a)if(Object.prototype.hasOwnProperty.call(a,t)){let o=AndOrNotEvaluator._SimplifyNegation(a[t].trim());const h=o.split("&&");if(h.length>1)for(let t=0;t<h.length;++t){const a=AndOrNotEvaluator._SimplifyNegation(h[t].trim());if(r="true"!==a&&"false"!==a?"!"===a[0]?!i(a.substring(1)):i(a):"true"===a,!r){o="false";break}}if(r||"true"===o){r=!0;break}r="true"!==o&&"false"!==o?"!"===o[0]?!i(o.substring(1)):i(o):"true"===o}return r?"true":"false"}static"_SimplifyNegation"(t){return"!true"===(t=(t=t.replace(/^[\s!]+/,t=>(t=t.replace(/[\s]/g,()=>"")).length%2?"!":"")).trim())?t="false":"!false"===t&&(t="true"),t}}class Tags{static"EnableFor"(t){t._tags=t._tags||{},t.hasTags=()=>Tags.HasTags(t),t.addTags=i=>Tags.AddTagsTo(t,i),t.removeTags=i=>Tags.RemoveTagsFrom(t,i),t.matchesTagsQuery=i=>Tags.MatchesQuery(t,i)}static"DisableFor"(t){delete t._tags,delete t.hasTags,delete t.addTags,delete t.removeTags,delete t.matchesTagsQuery}static"HasTags"(t){if(!t._tags)return!1;const i=t._tags;for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!0;return!1}static"GetTags"(t,i=!0){if(!t._tags)return null;if(i){const i=[];for(const r in t._tags)Object.prototype.hasOwnProperty.call(t._tags,r)&&!0===t._tags[r]&&i.push(r);return i.join(" ")}return t._tags}static"AddTagsTo"(t,i){if(!i)return;if("string"!=typeof i)return;i.split(" ").forEach(function(i){Tags._AddTagTo(t,i)})}static"_AddTagTo"(t,i){""!==(i=i.trim())&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(Tags.EnableFor(t),t._tags[i]=!0))}static"RemoveTagsFrom"(t,i){if(!Tags.HasTags(t))return;const r=i.split(" ");for(const i in r)Tags._RemoveTagFrom(t,r[i])}static"_RemoveTagFrom"(t,i){delete t._tags[i]}static"MatchesQuery"(t,i){return void 0===i||(""===i?Tags.HasTags(t):AndOrNotEvaluator.Eval(i,i=>Tags.HasTags(t)&&t._tags[i]))}}},"9447":function(t,i,r){r.d(i,{"Q":function(){return TimingTools},"r":function(){return _retryWithInterval}});let a=[];class TimingTools{static"SetImmediate"(t){0===a.length&&setTimeout(()=>{const t=a;a=[];for(const i of t)i()},1),a.push(t)}}function _runWithCondition(t,i,r){try{if(t())return i(),!0}catch(t){return r?.(t),!0}return!1}const _retryWithInterval=(t,i,r,a=16,o=3e4,h=!0,l)=>{if(h&&_runWithCondition(t,i,r))return null;const c=setInterval(()=>{_runWithCondition(t,i,r)?clearInterval(c):(o-=a)<0&&(clearInterval(c),r?.(new Error("Operation timed out after maximum retries. "+(l||"")),!0))},a);return()=>clearInterval(c)}},"5336":function(t,i,r){function IsExponentOfTwo(t){let i=1;do{i*=2}while(i<t);return i===t}function Mix(t,i,r){return t*(1-r)+i*r}function NearestPOT(t){const i=CeilingPOT(t),r=FloorPOT(t);return i-t>t-r?r:i}function CeilingPOT(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function FloorPOT(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)-(t>>1)}function GetExponentOfTwo(t,i,r=2){let a;switch(r){case 1:a=FloorPOT(t);break;case 2:a=NearestPOT(t);break;default:a=CeilingPOT(t)}return Math.min(a,i)}r.d(i,{"Av":function(){return FloorPOT},"Tr":function(){return NearestPOT},"V2":function(){return Mix},"lP":function(){return IsExponentOfTwo},"p7":function(){return GetExponentOfTwo}})},"8658":function(t,i,r){r.d(i,{"$g":function(){return AsyncLoop},"w1":function(){return Tools}});var a=r(8139),o=r(1102),h=r(658),l=r(2827),c=r(9665),u=r(9069),d=r(4910),_=r(5953),g=r(9485),p=r(9447),m=r(6448),T=r(3706),y=r(5336);class Tools{static get"BaseUrl"(){return g.rN.BaseUrl}static set"BaseUrl"(t){g.rN.BaseUrl=t}static get"CleanUrl"(){return g.rN.CleanUrl}static set"CleanUrl"(t){g.rN.CleanUrl=t}static"IsAbsoluteUrl"(t){return 0===t.indexOf("//")||-1!==t.indexOf("://")&&(-1!==t.indexOf(".")&&(-1!==t.indexOf("/")&&(!(t.indexOf(":")>t.indexOf("/"))&&(t.indexOf("://")<t.indexOf(".")||(0===t.indexOf("data:")||0===t.indexOf("blob:"))))))}static set"ScriptBaseUrl"(t){g.rN.ScriptBaseUrl=t}static get"ScriptBaseUrl"(){return g.rN.ScriptBaseUrl}static set"CDNBaseUrl"(t){Tools.ScriptBaseUrl=t,Tools.AssetBaseUrl=t}static set"ScriptPreprocessUrl"(t){g.rN.ScriptPreprocessUrl=t}static get"ScriptPreprocessUrl"(){return g.rN.ScriptPreprocessUrl}static get"DefaultRetryStrategy"(){return g.rN.DefaultRetryStrategy}static set"DefaultRetryStrategy"(t){g.rN.DefaultRetryStrategy=t}static get"CorsBehavior"(){return g.rN.CorsBehavior}static set"CorsBehavior"(t){g.rN.CorsBehavior=t}static get"UseFallbackTexture"(){return _.l.UseFallbackTexture}static set"UseFallbackTexture"(t){_.l.UseFallbackTexture=t}static get"RegisteredExternalClasses"(){return m.K.RegisteredExternalClasses}static set"RegisteredExternalClasses"(t){m.K.RegisteredExternalClasses=t}static get"fallbackTexture"(){return _.l.FallbackTexture}static set"fallbackTexture"(t){_.l.FallbackTexture=t}static"FetchToRef"(t,i,r,a,o,h){const l=4*((Math.abs(t)*r%r|0)+(Math.abs(i)*a%a|0)*r);h.r=o[l]/255,h.g=o[l+1]/255,h.b=o[l+2]/255,h.a=o[l+3]/255}static"Mix"(t,i,r){return 0}static"Instantiate"(t){return m.K.Instantiate(t)}static"SetImmediate"(t){p.Q.SetImmediate(t)}static"IsExponentOfTwo"(t){return!0}static"FloatRound"(t){return Math.fround(t)}static"GetFilename"(t){const i=t.lastIndexOf("/");return i<0?t:t.substring(i+1)}static"GetFolderPath"(t,i=!1){const r=t.lastIndexOf("/");return r<0?i?t:"":t.substring(0,r+1)}static"ToDegrees"(t){return 180*t/Math.PI}static"ToRadians"(t){return t*Math.PI/180}static"SmoothAngleChange"(t,i,r=.9){const a=this.ToRadians(t),o=this.ToRadians(i);return this.ToDegrees(Math.atan2((1-r)*Math.sin(o)+r*Math.sin(a),(1-r)*Math.cos(o)+r*Math.cos(a)))}static"MakeArray"(t,i){return!0===i||void 0!==t&&null!=t?Array.isArray(t)?t:[t]:null}static"GetPointerPrefix"(t){return(0,o.CG)()&&!window.PointerEvent?"mouse":"pointer"}static"SetCorsBehavior"(t,i){(0,g.$M)(t,i)}static"SetReferrerPolicyBehavior"(t,i){i.referrerPolicy=t}static get"PreprocessUrl"(){return g.rN.PreprocessUrl}static set"PreprocessUrl"(t){g.rN.PreprocessUrl=t}static"LoadImage"(t,i,r,a,o,h){return(0,g.r6)(t,i,r,a,o,h)}static"LoadFile"(t,i,r,a,o,h){return(0,g.vP)(t,i,r,a,o,h)}static"LoadFileAsync"(t,i=!0){return new Promise((r,a)=>{(0,g.vP)(t,t=>{r(t)},void 0,void 0,i,(t,i)=>{a(i)})})}static"GetAssetUrl"(t){if(!t)return"";if(Tools.AssetBaseUrl&&t.startsWith(Tools._DefaultAssetsUrl)){const i="/"===Tools.AssetBaseUrl[Tools.AssetBaseUrl.length-1]?Tools.AssetBaseUrl.substring(0,Tools.AssetBaseUrl.length-1):Tools.AssetBaseUrl;return t.replace(Tools._DefaultAssetsUrl,i)}return t}static"GetBabylonScriptURL"(t,i){if(!t)return"";if(Tools.ScriptBaseUrl&&t.startsWith(Tools._DefaultCdnUrl)){const i="/"===Tools.ScriptBaseUrl[Tools.ScriptBaseUrl.length-1]?Tools.ScriptBaseUrl.substring(0,Tools.ScriptBaseUrl.length-1):Tools.ScriptBaseUrl;t=t.replace(Tools._DefaultCdnUrl,i)}return t=Tools.ScriptPreprocessUrl(t),i&&(t=Tools.GetAbsoluteUrl(t)),t}static"LoadBabylonScript"(t,i,r,a){t=Tools.GetBabylonScriptURL(t),Tools.LoadScript(t,i,r)}static"LoadBabylonScriptAsync"(t){return t=Tools.GetBabylonScriptURL(t),Tools.LoadScriptAsync(t)}static"LoadScript"(t,i,r,a,h=!1){if("function"==typeof importScripts){try{importScripts(t),i&&i()}catch(i){r?.(`Unable to load script '${t}' in worker`,i)}return}if(!(0,o.CG)())return void r?.(`Cannot load script '${t}' outside of a window or a worker`);const l=document.getElementsByTagName("head")[0],c=document.createElement("script");h?(c.setAttribute("type","module"),c.innerText=t):(c.setAttribute("type","text/javascript"),c.setAttribute("src",t)),a&&(c.id=a),c.onload=()=>{i&&i()},c.onerror=i=>{r&&r(`Unable to load script '${t}'`,i)},l.appendChild(c)}static"LoadScriptAsync"(t,i){return new Promise((r,a)=>{this.LoadScript(t,()=>{r()},(t,i)=>{a(i||new Error(t))},i)})}static"ReadFileAsDataURL"(t,i,r){const o=new FileReader,h={"onCompleteObservable":new a.y$,"abort":()=>o.abort()};return o.onloadend=()=>{h.onCompleteObservable.notifyObservers(h)},o.onload=t=>{i(t.target.result)},o.onprogress=r,o.readAsDataURL(t),h}static"ReadFile"(t,i,r,a,o){return(0,g.Ip)(t,i,r,a,o)}static"FileAsURL"(t){const i=new Blob([t]);return window.URL.createObjectURL(i)}static"Format"(t,i=2){return t.toFixed(i)}static"DeepCopy"(t,i,r,a){l.j.DeepCopy(t,i,r,a)}static"IsEmpty"(t){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i))return!1;return!0}static"RegisterTopRootEvents"(t,i){for(let r=0;r<i.length;r++){const a=i[r];t.addEventListener(a.name,a.handler,!1);try{window.parent&&window.parent.addEventListener(a.name,a.handler,!1)}catch(t){}}}static"UnregisterTopRootEvents"(t,i){for(let r=0;r<i.length;r++){const a=i[r];t.removeEventListener(a.name,a.handler);try{t.parent&&t.parent.removeEventListener(a.name,a.handler)}catch(t){}}}static async"DumpFramebuffer"(t,i,r,a,o="image/png",h,l){throw(0,u.S)("DumpTools")}static"DumpData"(t,i,r,a,o="image/png",h,l=!1,c=!1,d){throw(0,u.S)("DumpTools")}static"DumpDataAsync"(t,i,r,a="image/png",o,h=!1,l=!1,c){throw(0,u.S)("DumpTools")}static"_IsOffScreenCanvas"(t){return void 0!==t.convertToBlob}static"ToBlob"(t,i,r="image/png",a){Tools._IsOffScreenCanvas(t)||t.toBlob||(t.toBlob=function(t,i,r){setTimeout(()=>{const a=atob(this.toDataURL(i,r).split(",")[1]),o=a.length,h=new Uint8Array(o);for(let t=0;t<o;t++)h[t]=a.charCodeAt(t);t(new Blob([h]))})}),Tools._IsOffScreenCanvas(t)?t.convertToBlob({"type":r,"quality":a}).then(t=>i(t)):t.toBlob(function(t){i(t)},r,a)}static"DownloadBlob"(t,i){if("download"in document.createElement("a")){if(!i){const t=new Date;i="screenshot_"+((t.getFullYear()+"-"+(t.getMonth()+1)).slice(2)+"-"+t.getDate()+"_"+t.getHours()+"-"+("0"+t.getMinutes()).slice(-2))+".png"}Tools.Download(t,i)}else if(t&&"undefined"!=typeof URL){const i=URL.createObjectURL(t),r=window.open("");if(!r)return;const a=r.document.createElement("img");a.onload=function(){URL.revokeObjectURL(i)},a.src=i,r.document.body.appendChild(a)}}static"EncodeScreenshotCanvasData"(t,i,r="image/png",a,o){if("string"!=typeof a&&i){if(i){if(Tools._IsOffScreenCanvas(t))return void t.convertToBlob({"type":r,"quality":o}).then(t=>{const r=new FileReader;r.readAsDataURL(t),r.onloadend=()=>{const t=r.result;i(t)}});const a=t.toDataURL(r,o);i(a)}}else this.ToBlob(t,function(t){t&&Tools.DownloadBlob(t,a),i&&i("")},r,o)}static"Download"(t,i){if("undefined"==typeof URL)return;const r=window.URL.createObjectURL(t),a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=r,a.download=i,a.addEventListener("click",()=>{a.parentElement&&a.parentElement.removeChild(a)}),a.click(),window.URL.revokeObjectURL(r)}static"BackCompatCameraNoPreventDefault"(t){return"boolean"==typeof t[0]?t[0]:"boolean"==typeof t[1]&&t[1]}static"CreateScreenshot"(t,i,r,a,o="image/png",h=!1,l){throw(0,u.S)("ScreenshotTools")}static"CreateScreenshotAsync"(t,i,r,a="image/png",o){throw(0,u.S)("ScreenshotTools")}static"CreateScreenshotUsingRenderTarget"(t,i,r,a,o="image/png",h=1,l=!1,c,d=!1,_=!1,g=!0,p,m){throw(0,u.S)("ScreenshotTools")}static"CreateScreenshotUsingRenderTargetAsync"(t,i,r,a="image/png",o=1,h=!1,l,c=!1,d=!1,_=!0,g,p){throw(0,u.S)("ScreenshotTools")}static"RandomId"(){return(0,T.f)()}static"IsBase64"(t){return(0,g.VL)(t)}static"DecodeBase64"(t){return(0,g.$K)(t)}static get"errorsCount"(){return h.Y.errorsCount}static"Log"(t){h.Y.Log(t)}static"Warn"(t){h.Y.Warn(t)}static"Error"(t){h.Y.Error(t)}static get"LogCache"(){return h.Y.LogCache}static"ClearLogCache"(){h.Y.ClearLogCache()}static set"LogLevels"(t){h.Y.LogLevels=t}static set"PerformanceLogLevel"(t){return(t&Tools.PerformanceUserMarkLogLevel)===Tools.PerformanceUserMarkLogLevel?(Tools.StartPerformanceCounter=Tools._StartUserMark,void(Tools.EndPerformanceCounter=Tools._EndUserMark)):(t&Tools.PerformanceConsoleLogLevel)===Tools.PerformanceConsoleLogLevel?(Tools.StartPerformanceCounter=Tools._StartPerformanceConsole,void(Tools.EndPerformanceCounter=Tools._EndPerformanceConsole)):(Tools.StartPerformanceCounter=Tools._StartPerformanceCounterDisabled,void(Tools.EndPerformanceCounter=Tools._EndPerformanceCounterDisabled))}static"_StartPerformanceCounterDisabled"(t,i){}static"_EndPerformanceCounterDisabled"(t,i){}static"_StartUserMark"(t,i=!0){if(!Tools._Performance){if(!(0,o.CG)())return;Tools._Performance=window.performance}i&&Tools._Performance.mark&&Tools._Performance.mark(t+"-Begin")}static"_EndUserMark"(t,i=!0){i&&Tools._Performance.mark&&(Tools._Performance.mark(t+"-End"),Tools._Performance.measure(t,t+"-Begin",t+"-End"))}static"_StartPerformanceConsole"(t,i=!0){i&&(Tools._StartUserMark(t,i),console.time&&console.time(t))}static"_EndPerformanceConsole"(t,i=!0){i&&(Tools._EndUserMark(t,i),console.timeEnd(t))}static get"Now"(){return c.F.Now}static"GetClassName"(t,i=!1){let r=null;if(!i&&t.getClassName)r=t.getClassName();else{if(t instanceof Object){r=(i?t:Object.getPrototypeOf(t)).constructor.__bjsclassName__}r||(r=typeof t)}return r}static"First"(t,i){for(const r of t)if(i(r))return r;return null}static"getFullClassName"(t,i=!1){let r=null,a=null;if(!i&&t.getClassName)r=t.getClassName();else{if(t instanceof Object){const o=i?t:Object.getPrototypeOf(t);r=o.constructor.__bjsclassName__,a=o.constructor.__bjsmoduleName__}r||(r=typeof t)}return r?(null!=a?a+".":"")+r:null}static"DelayAsync"(t){return new Promise(i=>{setTimeout(()=>{i()},t)})}static"IsSafari"(){return!!(0,o.up)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}Tools.AssetBaseUrl="",Tools.UseCustomRequestHeaders=!1,Tools.CustomRequestHeaders=d.g.CustomRequestHeaders,Tools.GetDOMTextContent=o.v,Tools._DefaultCdnUrl="https://cdn.babylonjs.com",Tools._DefaultAssetsUrl="https://assets.babylonjs.com/core",Tools.GetAbsoluteUrl="object"==typeof document?t=>{const i=document.createElement("a");return i.href=t,i.href}:"function"==typeof URL&&"object"==typeof location?t=>new URL(t,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},Tools.NoneLogLevel=h.Y.NoneLogLevel,Tools.MessageLogLevel=h.Y.MessageLogLevel,Tools.WarningLogLevel=h.Y.WarningLogLevel,Tools.ErrorLogLevel=h.Y.ErrorLogLevel,Tools.AllLogLevel=h.Y.AllLogLevel,Tools.IsWindowObjectExist=o.CG,Tools.PerformanceNoneLogLevel=0,Tools.PerformanceUserMarkLogLevel=1,Tools.PerformanceConsoleLogLevel=2,Tools.StartPerformanceCounter=Tools._StartPerformanceCounterDisabled,Tools.EndPerformanceCounter=Tools._EndPerformanceCounterDisabled;class AsyncLoop{"constructor"(t,i,r,a=0){this.iterations=t,this.index=a-1,this._done=!1,this._fn=i,this._successCallback=r}"executeNext"(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}"breakLoop"(){this._done=!0,this._successCallback()}static"Run"(t,i,r,a=0){const o=new AsyncLoop(t,i,r,a);return o.executeNext(),o}static"SyncAsyncForLoop"(t,i,r,a,o,h=0){return AsyncLoop.Run(Math.ceil(t/i),a=>{o&&o()?a.breakLoop():setTimeout(()=>{for(let h=0;h<i;++h){const l=a.index*i+h;if(l>=t)break;if(r(l),o&&o()){a.breakLoop();break}}a.executeNext()},h)},a)}}Tools.Mix=y.V2,Tools.IsExponentOfTwo=y.lP,_.l.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},"646":function(t,i,r){r.d(i,{"H7":function(){return RegisterClass},"qw":function(){return GetClass}});const a={};function RegisterClass(t,i){a[t]=i}function GetClass(t){return a[t]}},"4910":function(t,i,r){r.d(i,{"g":function(){return WebRequest}});class WebRequest{"constructor"(){this._xhr=function createXMLHttpRequest(){return"undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}(),this._requestURL=""}static get"IsCustomRequestAvailable"(){return Object.keys(WebRequest.CustomRequestHeaders).length>0||WebRequest.CustomRequestModifiers.length>0}get"requestURL"(){return this._requestURL}"_injectCustomRequestHeaders"(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const t in WebRequest.CustomRequestHeaders){const i=WebRequest.CustomRequestHeaders[t];i&&this._xhr.setRequestHeader(t,i)}}"_shouldSkipRequestModifications"(t){return WebRequest.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))}get"onprogress"(){return this._xhr.onprogress}set"onprogress"(t){this._xhr.onprogress=t}get"readyState"(){return this._xhr.readyState}get"status"(){return this._xhr.status}get"statusText"(){return this._xhr.statusText}get"response"(){return this._xhr.response}get"responseURL"(){return this._xhr.responseURL}get"responseText"(){return this._xhr.responseText}get"responseType"(){return this._xhr.responseType}set"responseType"(t){this._xhr.responseType=t}get"timeout"(){return this._xhr.timeout}set"timeout"(t){this._xhr.timeout=t}"addEventListener"(t,i,r){this._xhr.addEventListener(t,i,r)}"removeEventListener"(t,i,r){this._xhr.removeEventListener(t,i,r)}"abort"(){this._xhr.abort()}"send"(t){WebRequest.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)}"open"(t,i){for(const t of WebRequest.CustomRequestModifiers){if(this._shouldSkipRequestModifications(i))return;i=t(this._xhr,i)||i}i=(i=i.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=i,this._xhr.open(t,i,!0)}"setRequestHeader"(t,i){this._xhr.setRequestHeader(t,i)}"getResponseHeader"(t){return this._xhr.getResponseHeader(t)}}WebRequest.CustomRequestHeaders={},WebRequest.CustomRequestModifiers=new Array,WebRequest.SkipRequestModificationForBabylonCDN=!0},"9093":function(t,i,r){r.d(i,{"O":function(){return PostProcessManager}});var a=r(2186),o=r(8139);class PostProcessManager{"constructor"(t){this._vertexBuffers={},this.onBeforeRenderObservable=new o.y$,this._scene=t}"_prepareBuffers"(){if(this._vertexBuffers[a.o.PositionKind])return;const t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[a.o.PositionKind]=new a.o(this._scene.getEngine(),t,a.o.PositionKind,!1,!1,2),this._buildIndexBuffer()}"_buildIndexBuffer"(){const t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(t)}"_rebuild"(){const t=this._vertexBuffers[a.o.PositionKind];t&&(t._rebuild(),this._buildIndexBuffer())}"_prepareFrame"(t=null,i=null){const r=this._scene.activeCamera;return!!r&&(!(!(i=i||r._postProcesses.filter(t=>null!=t))||0===i.length||!this._scene.postProcessesEnabled)&&(i[0].activate(r,t,null!=i),!0))}"directRender"(t,i=null,r=!1,a=0,o=0,h=!1){const l=this._scene.getEngine();for(let c=0;c<t.length;c++){c<t.length-1?t[c+1].activate(this._scene.activeCamera||this._scene,i?.texture):(i?l.bindFramebuffer(i,a,void 0,void 0,r,o):h||l.restoreDefaultFramebuffer(),l._debugInsertMarker?.(`post process ${t[c].name} output`));const u=t[c],d=u.apply();d&&(u.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,d),l.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(d))}l.setDepthBuffer(!0),l.setDepthWrite(!0)}"_finalizeFrame"(t,i,r,a,o=!1){const h=this._scene.activeCamera;if(!h)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(a=a||h._postProcesses.filter(t=>null!=t)).length||!this._scene.postProcessesEnabled)return;const l=this._scene.getEngine();for(let c=0,u=a.length;c<u;c++){const d=a[c];if(c<u-1?d._outputTexture=a[c+1].activate(h,i?.texture):(i?(l.bindFramebuffer(i,r,void 0,void 0,o),d._outputTexture=i):(l.restoreDefaultFramebuffer(),d._outputTexture=null),l._debugInsertMarker?.(`post process ${a[c].name} output`)),t)break;const _=d.apply();_&&(d.onBeforeRenderObservable.notifyObservers(_),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,_),l.drawElementsType(0,0,6),d.onAfterRenderObservable.notifyObservers(_))}l.setDepthBuffer(!0),l.setDepthWrite(!0),l.setAlphaMode(0)}"dispose"(){const t=this._vertexBuffers[a.o.PositionKind];t&&(t.dispose(),this._vertexBuffers[a.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},"1535":function(t,i,r){r.d(i,{"$":function(){return RenderingManager}});var a=r(8173),o=r(5412);class RenderingGroup{set"opaqueSortCompareFn"(t){this._opaqueSortCompareFn=t||RenderingGroup.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set"alphaTestSortCompareFn"(t){this._alphaTestSortCompareFn=t||RenderingGroup.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set"transparentSortCompareFn"(t){this._transparentSortCompareFn=t||RenderingGroup.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}"constructor"(t,i,r=null,o=null,h=null){this.index=t,this._opaqueSubMeshes=new a.t(256),this._transparentSubMeshes=new a.t(256),this._alphaTestSubMeshes=new a.t(256),this._depthOnlySubMeshes=new a.t(256),this._particleSystems=new a.t(256),this._spriteManagers=new a.t(256),this._empty=!0,this._edgesRenderers=new a.f(16),this._scene=i,this.opaqueSortCompareFn=r,this.alphaTestSortCompareFn=o,this.transparentSortCompareFn=h}"render"(t,i,r,a){if(t)return void t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const o=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(o.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),o.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const h=o.getStencilBuffer();if(o.setStencilBuffer(!1),i&&this._renderSprites(),r&&this._renderParticles(a),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(o.setStencilBuffer(h),this._scene.useOrderIndependentTransparency){const t=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);t.length&&this._renderTransparent(t)}else this._renderTransparent(this._transparentSubMeshes);o.setAlphaMode(0)}if(o.setStencilBuffer(!1),this._edgesRenderers.length){for(let t=0;t<this._edgesRenderers.length;t++)this._edgesRenderers.data[t].render();o.setAlphaMode(0)}o.setStencilBuffer(h)}"_renderOpaqueSorted"(t){RenderingGroup._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}"_renderAlphaTestSorted"(t){RenderingGroup._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}"_renderTransparentSorted"(t){RenderingGroup._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static"_RenderSorted"(t,i,r,a){let h,l=0;const c=r?r.globalPosition:RenderingGroup._ZeroVector;if(a)for(;l<t.length;l++)h=t.data[l],h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=o.P.Distance(h.getBoundingInfo().boundingSphere.centerWorld,c);const u=t.length===t.data.length?t.data:t.data.slice(0,t.length);i&&u.sort(i);const d=u[0].getMesh().getScene();for(l=0;l<u.length;l++)if(h=u[l],!d._activeMeshesFrozenButKeepClipping||h.isInFrustum(d._frustumPlanes)){if(a){const t=h.getMaterial();if(t&&t.needDepthPrePass){const i=t.getScene().getEngine();i.setColorWrite(!1),i.setAlphaMode(0),h.render(!1),i.setColorWrite(!0)}}h.render(a)}}static"defaultTransparentSortCompare"(t,i){return t._alphaIndex>i._alphaIndex?1:t._alphaIndex<i._alphaIndex?-1:RenderingGroup.backToFrontSortCompare(t,i)}static"backToFrontSortCompare"(t,i){return t._distanceToCamera<i._distanceToCamera?1:t._distanceToCamera>i._distanceToCamera?-1:0}static"frontToBackSortCompare"(t,i){return t._distanceToCamera<i._distanceToCamera?-1:t._distanceToCamera>i._distanceToCamera?1:0}static"PainterSortCompare"(t,i){const r=t.getMesh(),a=i.getMesh();return r.material&&a.material?r.material.uniqueId-a.material.uniqueId:r.uniqueId-a.uniqueId}"prepare"(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}"prepareSprites"(){this._spriteManagers.reset()}"dispose"(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}"dispatch"(t,i,r){void 0===i&&(i=t.getMesh()),void 0===r&&(r=t.getMaterial()),null!=r&&(r.needAlphaBlendingForMesh(i)?this._transparentSubMeshes.push(t):r.needAlphaTestingForMesh(i)?(r.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._alphaTestSubMeshes.push(t)):(r.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._opaqueSubMeshes.push(t)),i._renderingGroup=this,i._edgesRenderer&&i.isEnabled()&&i.isVisible&&i._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(i._edgesRenderer),this._empty=!1)}"dispatchSprites"(t){this._spriteManagers.push(t),this._empty=!1}"dispatchParticles"(t){this._particleSystems.push(t),this._empty=!1}"_renderParticles"(t){if(0===this._particleSystems.length)return;const i=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let r=0;r<this._particleSystems.length;r++){const a=this._particleSystems.data[r];if(0===(i&&i.layerMask&a.layerMask))continue;const o=a.emitter;o.position&&t&&-1===t.indexOf(o)||this._scene._activeParticles.addCount(a.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}"_renderSprites"(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const t=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._spriteManagers.length;i++){const r=this._spriteManagers.data[i];0!==(t&&t.layerMask&r.layerMask)&&r.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}RenderingGroup._ZeroVector=o.P.Zero();class RenderingGroupInfo{}class RenderingManager{get"maintainStateBetweenFrames"(){return this._maintainStateBetweenFrames}set"maintainStateBetweenFrames"(t){t!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=t,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}"restoreDispachedFlags"(){for(const t of this._scene.meshes)if(t.subMeshes)for(const i of t.subMeshes)i._wasDispatched=!1;if(this._scene.spriteManagers)for(const t of this._scene.spriteManagers)t._wasDispatched=!1;for(const t of this._scene.particleSystems)t._wasDispatched=!1}"constructor"(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new RenderingGroupInfo,this._maintainStateBetweenFrames=!1,this._scene=t;for(let t=RenderingManager.MIN_RENDERINGGROUPS;t<RenderingManager.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={"autoClear":!0,"depth":!0,"stencil":!0}}"getRenderingGroup"(t){const i=t||0;return this._prepareRenderingGroup(i),this._renderingGroups[i]}"_clearDepthStencilBuffer"(t=!0,i=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,t,i),this._depthStencilBufferAlreadyCleaned=!0)}"render"(t,i,r,a){const o=this._renderingGroupInfo;if(o.scene=this._scene,o.camera=this._scene.activeCamera,o.renderingManager=this,this._scene.spriteManagers&&a)for(let t=0;t<this._scene.spriteManagers.length;t++){const i=this._scene.spriteManagers[t];this.dispatchSprites(i)}for(let h=RenderingManager.MIN_RENDERINGGROUPS;h<RenderingManager.MAX_RENDERINGGROUPS;h++){this._depthStencilBufferAlreadyCleaned=h===RenderingManager.MIN_RENDERINGGROUPS;const l=this._renderingGroups[h];if(!l||l._empty)continue;const c=1<<h;if(o.renderingGroupId=h,this._scene.onBeforeRenderingGroupObservable.notifyObservers(o,c),RenderingManager.AUTOCLEAR){const t=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(h):this._autoClearDepthStencil[h];t&&t.autoClear&&this._clearDepthStencilBuffer(t.depth,t.stencil)}for(const t of this._scene._beforeRenderingGroupDrawStage)t.action(h);l.render(t,a,r,i);for(const t of this._scene._afterRenderingGroupDrawStage)t.action(h);this._scene.onAfterRenderingGroupObservable.notifyObservers(o,c)}}"reset"(){if(!this.maintainStateBetweenFrames)for(let t=RenderingManager.MIN_RENDERINGGROUPS;t<RenderingManager.MAX_RENDERINGGROUPS;t++){const i=this._renderingGroups[t];i&&i.prepare()}}"resetSprites"(){if(!this.maintainStateBetweenFrames)for(let t=RenderingManager.MIN_RENDERINGGROUPS;t<RenderingManager.MAX_RENDERINGGROUPS;t++){const i=this._renderingGroups[t];i&&i.prepareSprites()}}"dispose"(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}"freeRenderingGroups"(){for(let t=RenderingManager.MIN_RENDERINGGROUPS;t<RenderingManager.MAX_RENDERINGGROUPS;t++){const i=this._renderingGroups[t];i&&i.dispose()}}"_prepareRenderingGroup"(t){void 0===this._renderingGroups[t]&&(this._renderingGroups[t]=new RenderingGroup(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))}"dispatchSprites"(t){this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatchSprites(t))}"dispatchParticles"(t){this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatchParticles(t))}"dispatch"(t,i,r){void 0===i&&(i=t.getMesh()),this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(i.renderingGroupId).dispatch(t,i,r))}"setRenderingOrder"(t,i=null,r=null,a=null){if(this._customOpaqueSortCompareFn[t]=i,this._customAlphaTestSortCompareFn[t]=r,this._customTransparentSortCompareFn[t]=a,this._renderingGroups[t]){const i=this._renderingGroups[t];i.opaqueSortCompareFn=this._customOpaqueSortCompareFn[t],i.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[t],i.transparentSortCompareFn=this._customTransparentSortCompareFn[t]}}"setRenderingAutoClearDepthStencil"(t,i,r=!0,a=!0){this._autoClearDepthStencil[t]={"autoClear":i,"depth":r,"stencil":a}}"getAutoClearDepthStencilSetup"(t){return this._autoClearDepthStencil[t]}}RenderingManager.MAX_RENDERINGGROUPS=4,RenderingManager.MIN_RENDERINGGROUPS=0,RenderingManager.AUTOCLEAR=!0},"2467":function(t,i,r){r.d(i,{"r":function(){return _ImportHelper}});class _ImportHelper{}_ImportHelper._IsPickingAvailable=!1},"4073":function(t,i,r){r.d(i,{"x":function(){return Scene}});var a=r(8658),o=r(9665),h=r(8139),l=r(8173);class StringDictionary{"constructor"(){this._count=0,this._data={}}"copyFrom"(t){this.clear(),t.forEach((t,i)=>this.add(t,i))}"get"(t){const i=this._data[t];if(void 0!==i)return i}"getOrAddWithFactory"(t,i){let r=this.get(t);return void 0!==r||(r=i(t),r&&this.add(t,r)),r}"getOrAdd"(t,i){const r=this.get(t);return void 0!==r?r:(this.add(t,i),i)}"contains"(t){return void 0!==this._data[t]}"add"(t,i){return void 0===this._data[t]&&(this._data[t]=i,++this._count,!0)}"set"(t,i){return void 0!==this._data[t]&&(this._data[t]=i,!0)}"getAndRemove"(t){const i=this.get(t);return void 0!==i?(delete this._data[t],--this._count,i):null}"remove"(t){return!!this.contains(t)&&(delete this._data[t],--this._count,!0)}"clear"(){this._data={},this._count=0}get"count"(){return this._count}"forEach"(t){for(const i in this._data){t(i,this._data[i])}}"first"(t){for(const i in this._data){const r=t(i,this._data[i]);if(r)return r}return null}}var c=r(1995),u=r(5412),d=r(4662),_=r(760),g=r(318);class ActionEvent{"constructor"(t,i,r,a,o,h){this.source=t,this.pointerX=i,this.pointerY=r,this.meshUnderPointer=a,this.sourceEvent=o,this.additionalData=h}static"CreateNew"(t,i,r){const a=t.getScene();return new ActionEvent(t,a.pointerX,a.pointerY,a.meshUnderPointer||t,i,r)}static"CreateNewFromSprite"(t,i,r,a){return new ActionEvent(t,i.pointerX,i.pointerY,i.meshUnderPointer,r,a)}static"CreateNewFromScene"(t,i){return new ActionEvent(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)}static"CreateNewFromPrimitive"(t,i,r,a){return new ActionEvent(t,i.x,i.y,null,r,a)}}var p=r(9093),m=r(1535),T=r(4559),y=r(1102),M=r(5953),b=r(9069),x=r(27);class AbstractActionManager{"constructor"(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get"HasTriggers"(){for(const t in AbstractActionManager.Triggers)if(Object.prototype.hasOwnProperty.call(AbstractActionManager.Triggers,t))return!0;return!1}static get"HasPickTriggers"(){for(const t in AbstractActionManager.Triggers)if(Object.prototype.hasOwnProperty.call(AbstractActionManager.Triggers,t)){const i=parseInt(t);if(i>=1&&i<=7)return!0}return!1}static"HasSpecificTrigger"(t){for(const i in AbstractActionManager.Triggers)if(Object.prototype.hasOwnProperty.call(AbstractActionManager.Triggers,i)){if(parseInt(i)===t)return!0}return!1}}AbstractActionManager.Triggers={};var E,R,A,C,v,P,S,I=r(6081);!function(t){t[t.Generic=0]="Generic",t[t.Keyboard=1]="Keyboard",t[t.Mouse=2]="Mouse",t[t.Touch=3]="Touch",t[t.DualShock=4]="DualShock",t[t.Xbox=5]="Xbox",t[t.Switch=6]="Switch",t[t.DualSense=7]="DualSense"}(E||(E={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.LeftClick=2]="LeftClick",t[t.MiddleClick=3]="MiddleClick",t[t.RightClick=4]="RightClick",t[t.BrowserBack=5]="BrowserBack",t[t.BrowserForward=6]="BrowserForward",t[t.MouseWheelX=7]="MouseWheelX",t[t.MouseWheelY=8]="MouseWheelY",t[t.MouseWheelZ=9]="MouseWheelZ",t[t.Move=12]="Move"}(R||(R={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.LeftClick=2]="LeftClick",t[t.MiddleClick=3]="MiddleClick",t[t.RightClick=4]="RightClick",t[t.BrowserBack=5]="BrowserBack",t[t.BrowserForward=6]="BrowserForward",t[t.MouseWheelX=7]="MouseWheelX",t[t.MouseWheelY=8]="MouseWheelY",t[t.MouseWheelZ=9]="MouseWheelZ",t[t.DeltaHorizontal=10]="DeltaHorizontal",t[t.DeltaVertical=11]="DeltaVertical"}(A||(A={})),function(t){t[t.Cross=0]="Cross",t[t.Circle=1]="Circle",t[t.Square=2]="Square",t[t.Triangle=3]="Triangle",t[t.L1=4]="L1",t[t.R1=5]="R1",t[t.L2=6]="L2",t[t.R2=7]="R2",t[t.Share=8]="Share",t[t.Options=9]="Options",t[t.L3=10]="L3",t[t.R3=11]="R3",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.TouchPad=17]="TouchPad",t[t.LStickXAxis=18]="LStickXAxis",t[t.LStickYAxis=19]="LStickYAxis",t[t.RStickXAxis=20]="RStickXAxis",t[t.RStickYAxis=21]="RStickYAxis"}(C||(C={})),function(t){t[t.Cross=0]="Cross",t[t.Circle=1]="Circle",t[t.Square=2]="Square",t[t.Triangle=3]="Triangle",t[t.L1=4]="L1",t[t.R1=5]="R1",t[t.L2=6]="L2",t[t.R2=7]="R2",t[t.Create=8]="Create",t[t.Options=9]="Options",t[t.L3=10]="L3",t[t.R3=11]="R3",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.TouchPad=17]="TouchPad",t[t.LStickXAxis=18]="LStickXAxis",t[t.LStickYAxis=19]="LStickYAxis",t[t.RStickXAxis=20]="RStickXAxis",t[t.RStickYAxis=21]="RStickYAxis"}(v||(v={})),function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.X=2]="X",t[t.Y=3]="Y",t[t.LB=4]="LB",t[t.RB=5]="RB",t[t.LT=6]="LT",t[t.RT=7]="RT",t[t.Back=8]="Back",t[t.Start=9]="Start",t[t.LS=10]="LS",t[t.RS=11]="RS",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.LStickXAxis=17]="LStickXAxis",t[t.LStickYAxis=18]="LStickYAxis",t[t.RStickXAxis=19]="RStickXAxis",t[t.RStickYAxis=20]="RStickYAxis"}(P||(P={})),function(t){t[t.B=0]="B",t[t.A=1]="A",t[t.Y=2]="Y",t[t.X=3]="X",t[t.L=4]="L",t[t.R=5]="R",t[t.ZL=6]="ZL",t[t.ZR=7]="ZR",t[t.Minus=8]="Minus",t[t.Plus=9]="Plus",t[t.LS=10]="LS",t[t.RS=11]="RS",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.Capture=17]="Capture",t[t.LStickXAxis=18]="LStickXAxis",t[t.LStickYAxis=19]="LStickYAxis",t[t.RStickXAxis=20]="RStickXAxis",t[t.RStickYAxis=21]="RStickYAxis"}(S||(S={}));var D=r(1318);class DeviceEventFactory{static"CreateDeviceEvent"(t,i,r,a,o,h,l){switch(t){case E.Keyboard:return this._CreateKeyboardEvent(r,a,o,h);case E.Mouse:if(r===R.MouseWheelX||r===R.MouseWheelY||r===R.MouseWheelZ)return this._CreateWheelEvent(t,i,r,a,o,h);case E.Touch:return this._CreatePointerEvent(t,i,r,a,o,h,l);default:throw`Unable to generate event for device ${E[t]}`}}static"_CreatePointerEvent"(t,i,r,a,o,h,l){const c=this._CreateMouseEvent(t,i,r,a,o,h);t===E.Mouse?(c.deviceType=E.Mouse,c.pointerId=1,c.pointerType="mouse"):(c.deviceType=E.Touch,c.pointerId=l??i,c.pointerType="touch");let u=0;return u+=o.pollInput(t,i,R.LeftClick),u+=2*o.pollInput(t,i,R.RightClick),u+=4*o.pollInput(t,i,R.MiddleClick),c.buttons=u,r===R.Move?c.type="pointermove":r>=R.LeftClick&&r<=R.RightClick&&(c.type=1===a?"pointerdown":"pointerup",c.button=r-2),c}static"_CreateWheelEvent"(t,i,r,a,o,h){const l=this._CreateMouseEvent(t,i,r,a,o,h);switch(l.pointerId=1,l.type="wheel",l.deltaMode=D.G.DOM_DELTA_PIXEL,l.deltaX=0,l.deltaY=0,l.deltaZ=0,r){case R.MouseWheelX:l.deltaX=a;break;case R.MouseWheelY:l.deltaY=a;break;case R.MouseWheelZ:l.deltaZ=a}return l}static"_CreateMouseEvent"(t,i,r,a,o,h){const l=this._CreateEvent(h),c=o.pollInput(t,i,R.Horizontal),u=o.pollInput(t,i,R.Vertical);return h?(l.movementX=0,l.movementY=0,l.offsetX=l.movementX-h.getBoundingClientRect().x,l.offsetY=l.movementY-h.getBoundingClientRect().y):(l.movementX=o.pollInput(t,i,10),l.movementY=o.pollInput(t,i,11),l.offsetX=0,l.offsetY=0),this._CheckNonCharacterKeys(l,o),l.clientX=c,l.clientY=u,l.x=c,l.y=u,l.deviceType=t,l.deviceSlot=i,l.inputIndex=r,l}static"_CreateKeyboardEvent"(t,i,r,a){const o=this._CreateEvent(a);return this._CheckNonCharacterKeys(o,r),o.deviceType=E.Keyboard,o.deviceSlot=0,o.inputIndex=t,o.type=1===i?"keydown":"keyup",o.key=String.fromCharCode(t),o.keyCode=t,o}static"_CheckNonCharacterKeys"(t,i){const r=i.isDeviceAvailable(E.Keyboard),a=r&&1===i.pollInput(E.Keyboard,0,18),o=r&&1===i.pollInput(E.Keyboard,0,17),h=r&&(1===i.pollInput(E.Keyboard,0,91)||1===i.pollInput(E.Keyboard,0,92)||1===i.pollInput(E.Keyboard,0,93)),l=r&&1===i.pollInput(E.Keyboard,0,16);t.altKey=a,t.ctrlKey=o,t.metaKey=h,t.shiftKey=l}static"_CreateEvent"(t){const i={"preventDefault":()=>{}};return i.target=t,i}}class NativeDeviceInputSystem{"constructor"(t,i,r){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(t,i,(t,i,a,o)=>{const h=DeviceEventFactory.CreateDeviceEvent(t,i,a,o,this);r(t,i,h)}):this._createDummyNativeInput()}"pollInput"(t,i,r){return this._nativeInput.pollInput(t,i,r)}"isDeviceAvailable"(t){return t===E.Mouse||t===E.Touch}"dispose"(){this._nativeInput.dispose()}"_createDummyNativeInput"(){return{"pollInput":()=>0,"isDeviceAvailable":()=>!1,"dispose":()=>{}}}}const O=Object.keys(R).length/2;class WebDeviceInputSystem{"constructor"(t,i,r,o){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=a.w1.IsSafari(),this._usingMacOS=(0,y.up)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=t=>{},this._keyboardUpEvent=t=>{},this._keyboardBlurEvent=t=>{},this._pointerMoveEvent=t=>{},this._pointerDownEvent=t=>{},this._pointerUpEvent=t=>{},this._pointerCancelEvent=t=>{},this._pointerCancelTouch=t=>{},this._pointerLeaveEvent=t=>{},this._pointerWheelEvent=t=>{},this._pointerBlurEvent=t=>{},this._pointerMacOSChromeOutEvent=t=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,y.up)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,y.up)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=t=>{},this._gamepadDisconnectedEvent=t=>{},this._eventPrefix=a.w1.GetPointerPrefix(t),this._engine=t,this._onDeviceConnected=i,this._onDeviceDisconnected=r,this._onInputChanged=o,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}"pollInput"(t,i,r){const o=this._inputs[t][i];if(!o)throw`Unable to find device ${E[t]}`;t>=E.DualShock&&t<=E.DualSense&&this._updateDevice(t,i,r);const h=o[r];if(void 0===h)throw`Unable to find input ${r} for device ${E[t]} in slot ${i}`;return r===R.Move&&a.w1.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),h}"isDeviceAvailable"(t){return void 0!==this._inputs[t]}"dispose"(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}"_enableEvents"(){const t=this?._engine.getInputElement();if(t&&(!this._eventsAttached||this._elementToAttachTo!==t)){if(this._disableEvents(),this._inputs)for(const t of this._inputs)if(t)for(const i in t){const r=t[+i];if(r)for(let t=0;t<r.length;t++)r[t]=0}this._elementToAttachTo=t,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}"_disableEvents"(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}"_checkForConnectedDevices"(){if(navigator.getGamepads){const t=navigator.getGamepads();for(const i of t)i&&this._addGamePad(i)}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(E.Mouse,0,0,0)}"_addGamePad"(t){const i=this._getGamepadDeviceType(t.id),r=t.index;this._gamepads=this._gamepads||new Array(t.index+1),this._registerDevice(i,r,t.buttons.length+t.axes.length),this._gamepads[r]=i}"_addPointerDevice"(t,i,r,a){this._pointerActive||(this._pointerActive=!0),this._registerDevice(t,i,O);const o=this._inputs[t][i];o[0]=r,o[1]=a}"_registerDevice"(t,i,r){if(void 0===i)throw`Unable to register device ${E[t]} to undefined slot.`;if(this._inputs[t]||(this._inputs[t]={}),!this._inputs[t][i]){const a=new Array(r);a.fill(0),this._inputs[t][i]=a,this._onDeviceConnected(t,i)}}"_unregisterDevice"(t,i){this._inputs[t][i]&&(delete this._inputs[t][i],this._onDeviceDisconnected(t,i))}"_handleKeyActions"(){this._keyboardDownEvent=t=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(E.Keyboard,0,255));const i=this._inputs[E.Keyboard][0];if(i){i[t.keyCode]=1;const r=t;r.inputIndex=t.keyCode,this._usingMacOS&&t.metaKey&&"Meta"!==t.key&&(this._metaKeys.includes(t.keyCode)||this._metaKeys.push(t.keyCode)),this._onInputChanged(E.Keyboard,0,r)}},this._keyboardUpEvent=t=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(E.Keyboard,0,255));const i=this._inputs[E.Keyboard][0];if(i){i[t.keyCode]=0;const r=t;if(r.inputIndex=t.keyCode,this._usingMacOS&&"Meta"===t.key&&this._metaKeys.length>0){for(const t of this._metaKeys){const r=DeviceEventFactory.CreateDeviceEvent(E.Keyboard,0,t,0,this,this._elementToAttachTo);i[t]=0,this._onInputChanged(E.Keyboard,0,r)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(E.Keyboard,0,r)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const t=this._inputs[E.Keyboard][0];for(let i=0;i<t.length;i++)if(0!==t[i]){t[i]=0;const r=DeviceEventFactory.CreateDeviceEvent(E.Keyboard,0,i,0,this,this._elementToAttachTo);this._onInputChanged(E.Keyboard,0,r)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}"_handlePointerActions"(){this._maxTouchPoints=(0,y.up)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;this._pointerMoveEvent=t=>{const i=this._getPointerType(t);let r=i===E.Mouse?0:this._activeTouchIds.indexOf(t.pointerId);if(i===E.Touch&&-1===r){const o=this._activeTouchIds.indexOf(-1);if(!(o>=0))return void a.w1.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);r=o,this._activeTouchIds[o]=t.pointerId,this._onDeviceConnected(i,r)}this._inputs[i]||(this._inputs[i]={}),this._inputs[i][r]||this._addPointerDevice(i,r,t.clientX,t.clientY);const o=this._inputs[i][r];if(o){const a=t;a.inputIndex=R.Move,o[R.Horizontal]=t.clientX,o[R.Vertical]=t.clientY,i===E.Touch&&0===o[R.LeftClick]&&(o[R.LeftClick]=1),void 0===t.pointerId&&(t.pointerId=this._mouseId),this._onInputChanged(i,r,a),this._usingSafari||-1===t.button||(a.inputIndex=t.button+2,o[t.button+2]=o[t.button+2]?0:1,this._onInputChanged(i,r,a))}},this._pointerDownEvent=t=>{const i=this._getPointerType(t);let r=i===E.Mouse?0:t.pointerId;if(i===E.Touch){let i=this._activeTouchIds.indexOf(t.pointerId);if(-1===i&&(i=this._activeTouchIds.indexOf(-1)),!(i>=0))return void a.w1.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);r=i,this._activeTouchIds[i]=t.pointerId}this._inputs[i]||(this._inputs[i]={}),this._inputs[i][r]?i===E.Touch&&this._onDeviceConnected(i,r):this._addPointerDevice(i,r,t.clientX,t.clientY);const o=this._inputs[i][r];if(o){const a=o[R.Horizontal],h=o[R.Vertical];if(i===E.Mouse){if(void 0===t.pointerId&&(t.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(t){}}else if(t.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(t.pointerId)}catch(t){}o[R.Horizontal]=t.clientX,o[R.Vertical]=t.clientY,o[t.button+2]=1;const l=t;l.inputIndex=t.button+2,this._onInputChanged(i,r,l),a===t.clientX&&h===t.clientY||(l.inputIndex=R.Move,this._onInputChanged(i,r,l))}},this._pointerUpEvent=t=>{const i=this._getPointerType(t),r=i===E.Mouse?0:this._activeTouchIds.indexOf(t.pointerId);if(i===E.Touch){if(-1===r)return;this._activeTouchIds[r]=-1}const a=this._inputs[i]?.[r];let o=t.button,h=a&&0!==a[o+2];if(!h&&this._isUsingFirefox&&this._usingMacOS&&a&&(o=2===o?0:2,h=0!==a[o+2]),h){const h=a[R.Horizontal],l=a[R.Vertical];a[R.Horizontal]=t.clientX,a[R.Vertical]=t.clientY,a[o+2]=0;const c=t;void 0===t.pointerId&&(t.pointerId=this._mouseId),h===t.clientX&&l===t.clientY||(c.inputIndex=R.Move,this._onInputChanged(i,r,c)),c.inputIndex=o+2,i===E.Mouse&&this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):t.pointerId&&this._elementToAttachTo.hasPointerCapture?.(t.pointerId)&&this._elementToAttachTo.releasePointerCapture(t.pointerId),this._onInputChanged(i,r,c),i===E.Touch&&this._onDeviceDisconnected(i,r)}},this._pointerCancelTouch=t=>{const i=this._activeTouchIds.indexOf(t);if(-1===i)return;this._elementToAttachTo.hasPointerCapture?.(t)&&this._elementToAttachTo.releasePointerCapture(t),this._inputs[E.Touch][i][R.LeftClick]=0;const r=DeviceEventFactory.CreateDeviceEvent(E.Touch,i,R.LeftClick,0,this,this._elementToAttachTo,t);this._onInputChanged(E.Touch,i,r),this._activeTouchIds[i]=-1,this._onDeviceDisconnected(E.Touch,i)},this._pointerCancelEvent=t=>{if("mouse"===t.pointerType){const t=this._inputs[E.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let i=R.LeftClick;i<=R.BrowserForward;i++)if(1===t[i]){t[i]=0;const r=DeviceEventFactory.CreateDeviceEvent(E.Mouse,0,i,0,this,this._elementToAttachTo);this._onInputChanged(E.Mouse,0,r)}}else this._pointerCancelTouch(t.pointerId)},this._pointerLeaveEvent=t=>{"pen"===t.pointerType&&this._pointerCancelTouch(t.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let t=!1;const noop=function(){};try{const i=Object.defineProperty({},"passive",{"get":function(){t=!0}});this._elementToAttachTo.addEventListener("test",noop,i),this._elementToAttachTo.removeEventListener("test",noop,i)}catch(t){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(E.Mouse)){const t=this._inputs[E.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let i=R.LeftClick;i<=R.BrowserForward;i++)if(1===t[i]){t[i]=0;const r=DeviceEventFactory.CreateDeviceEvent(E.Mouse,0,i,0,this,this._elementToAttachTo);this._onInputChanged(E.Mouse,0,r)}}if(this.isDeviceAvailable(E.Touch)){const t=this._inputs[E.Touch];for(let i=0;i<this._activeTouchIds.length;i++){const r=this._activeTouchIds[i];if(this._elementToAttachTo.hasPointerCapture?.(r)&&this._elementToAttachTo.releasePointerCapture(r),-1!==r&&1===t[i]?.[R.LeftClick]){t[i][R.LeftClick]=0;const a=DeviceEventFactory.CreateDeviceEvent(E.Touch,i,R.LeftClick,0,this,this._elementToAttachTo,r);this._onInputChanged(E.Touch,i,a),this._activeTouchIds[i]=-1,this._onDeviceDisconnected(E.Touch,i)}}}},this._pointerWheelEvent=t=>{const i=E.Mouse;this._inputs[i]||(this._inputs[i]=[]),this._inputs[i][0]||(this._pointerActive=!0,this._registerDevice(i,0,O));const r=this._inputs[i][0];if(r){r[R.MouseWheelX]=t.deltaX||0,r[R.MouseWheelY]=t.deltaY||t.wheelDelta||0,r[R.MouseWheelZ]=t.deltaZ||0;const a=t;void 0===t.pointerId&&(t.pointerId=this._mouseId),0!==r[R.MouseWheelX]&&(a.inputIndex=R.MouseWheelX,this._onInputChanged(i,0,a)),0!==r[R.MouseWheelY]&&(a.inputIndex=R.MouseWheelY,this._onInputChanged(i,0,a)),0!==r[R.MouseWheelZ]&&(a.inputIndex=R.MouseWheelZ,this._onInputChanged(i,0,a))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=t=>{t.buttons>1&&this._pointerCancelEvent(t)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!t&&{"passive":!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(()=>{if(this.isDeviceAvailable(E.Mouse)){const t=this._inputs[E.Mouse][0];t[R.MouseWheelX]=0,t[R.MouseWheelY]=0,t[R.MouseWheelZ]=0}})}"_handleGamepadActions"(){this._gamepadConnectedEvent=t=>{this._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=t=>{if(this._gamepads){const i=this._getGamepadDeviceType(t.gamepad.id),r=t.gamepad.index;this._unregisterDevice(i,r),delete this._gamepads[r]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}"_updateDevice"(t,i,r){const a=navigator.getGamepads()[i];if(a&&t===this._gamepads[i]){const o=this._inputs[t][i];r>=a.buttons.length?o[r]=a.axes[r-a.buttons.length].valueOf():o[r]=a.buttons[r].value}}"_getGamepadDeviceType"(t){return-1!==t.indexOf("054c")?-1!==t.indexOf("0ce6")?E.DualSense:E.DualShock:-1!==t.indexOf("Xbox One")||-1!==t.search("Xbox 360")||-1!==t.search("xinput")?E.Xbox:-1!==t.indexOf("057e")?E.Switch:E.Generic}"_getPointerType"(t){let i=E.Mouse;return("touch"===t.pointerType||"pen"===t.pointerType||t.touches)&&(i=E.Touch),i}}class DeviceSource{"constructor"(t,i,r=0){this.deviceType=i,this.deviceSlot=r,this.onInputChangedObservable=new h.y$,this._deviceInputSystem=t}"getInput"(t){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,t)}}class InternalDeviceSourceManager{"constructor"(t){this._registeredManagers=new Array,this._refCount=0,this.registerManager=t=>{for(let i=0;i<this._devices.length;i++){const r=this._devices[i];for(const a in r){const r=+a;t._addDevice(new DeviceSource(this._deviceInputSystem,i,r))}}this._registeredManagers.push(t)},this.unregisterManager=t=>{const i=this._registeredManagers.indexOf(t);i>-1&&this._registeredManagers.splice(i,1)};const i=Object.keys(E).length/2;this._devices=new Array(i);const onDeviceConnected=(t,i)=>{this._devices[t]||(this._devices[t]=new Array),this._devices[t][i]||(this._devices[t][i]=i);for(const r of this._registeredManagers){const a=new DeviceSource(this._deviceInputSystem,t,i);r._addDevice(a)}},onDeviceDisconnected=(t,i)=>{this._devices[t]?.[i]&&delete this._devices[t][i];for(const r of this._registeredManagers)r._removeDevice(t,i)},onInputChanged=(t,i,r)=>{if(r)for(const a of this._registeredManagers)a._onInputChanged(t,i,r)};"undefined"!=typeof _native?this._deviceInputSystem=new NativeDeviceInputSystem(onDeviceConnected,onDeviceDisconnected,onInputChanged):this._deviceInputSystem=new WebDeviceInputSystem(t,onDeviceConnected,onDeviceDisconnected,onInputChanged)}"dispose"(){this._deviceInputSystem.dispose()}}class DeviceSourceManager{"getDeviceSource"(t,i){if(void 0===i){if(void 0===this._firstDevice[t])return null;i=this._firstDevice[t]}return this._devices[t]&&void 0!==this._devices[t][i]?this._devices[t][i]:null}"getDeviceSources"(t){return this._devices[t]?this._devices[t].filter(t=>!!t):[]}"constructor"(t){const i=Object.keys(E).length/2;this._devices=new Array(i),this._firstDevice=new Array(i),this._engine=t,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new InternalDeviceSourceManager(t)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new h.y$(t=>{for(const i of this._devices)if(i)for(const r of i)r&&this.onDeviceConnectedObservable.notifyObserver(t,r)}),this.onDeviceDisconnectedObservable=new h.y$,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=t.onDisposeObservable.add(()=>{this.dispose()})}"dispose"(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}"_addDevice"(t){this._devices[t.deviceType]||(this._devices[t.deviceType]=new Array),this._devices[t.deviceType][t.deviceSlot]||(this._devices[t.deviceType][t.deviceSlot]=t,this._updateFirstDevices(t.deviceType)),this.onDeviceConnectedObservable.notifyObservers(t)}"_removeDevice"(t,i){const r=this._devices[t]?.[i];this.onDeviceDisconnectedObservable.notifyObservers(r),this._devices[t]?.[i]&&delete this._devices[t][i],this._updateFirstDevices(t)}"_onInputChanged"(t,i,r){this._devices[t]?.[i]?.onInputChangedObservable.notifyObservers(r)}"_updateFirstDevices"(t){switch(t){case E.Keyboard:case E.Mouse:this._firstDevice[t]=0;break;case E.Touch:case E.DualSense:case E.DualShock:case E.Xbox:case E.Switch:case E.Generic:{delete this._firstDevice[t];const i=this._devices[t];if(i)for(let r=0;r<i.length;r++)if(i[r]){this._firstDevice[t]=r;break}break}}}}var w=r(2467);class _ClickInfo{"constructor"(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get"singleClick"(){return this._singleClick}get"doubleClick"(){return this._doubleClick}get"hasSwiped"(){return this._hasSwiped}get"ignore"(){return this._ignore}set"singleClick"(t){this._singleClick=t}set"doubleClick"(t){this._doubleClick=t}set"hasSwiped"(t){this._hasSwiped=t}set"ignore"(t){this._ignore=t}}class InputManager{"constructor"(t){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new u.FM(0,0),this._previousStartingPointerPosition=new u.FM(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=t||M.l.LastCreatedScene,this._scene}get"meshUnderPointer"(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}"getMeshUnderPointerByPointerId"(t){return this._meshUnderPointerId[t]||null}get"unTranslatedPointer"(){return new u.FM(this._unTranslatedPointerX,this._unTranslatedPointerY)}get"pointerX"(){return this._pointerX}set"pointerX"(t){this._pointerX=t}get"pointerY"(){return this._pointerY}set"pointerY"(t){this._pointerY=t}"_updatePointerPosition"(t){const i=this._scene.getEngine().getInputElementClientRect();i&&(this._pointerX=t.clientX-i.left,this._pointerY=t.clientY-i.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}"_processPointerMove"(t,i){const r=this._scene,a=r.getEngine(),o=a.getInputElement();o&&(o.tabIndex=a.canvasTabIndex,r.doNotHandleCursors||(o.style.cursor=r.defaultCursor)),this._setCursorAndPointerOverMesh(t,i,r);for(const a of r._pointerMoveStage){t=t||this._pickMove(i);const r=!!t?.pickedMesh;t=a.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,r,o)}const h=i.inputIndex>=R.MouseWheelX&&i.inputIndex<=R.MouseWheelZ?x.kD.POINTERWHEEL:x.kD.POINTERMOVE;let l;r.onPointerMove&&(t=t||this._pickMove(i),r.onPointerMove(i,t,h)),t?(l=new x.R5(h,i,t),this._setRayOnPointerInfo(t,i)):(l=new x.R5(h,i,null,this),this._movePointerInfo=l),r.onPointerObservable.hasObservers()&&r.onPointerObservable.notifyObservers(l,h)}"_setRayOnPointerInfo"(t,i){const r=this._scene;t&&w.r._IsPickingAvailable&&(t.ray||(t.ray=r.createPickingRay(i.offsetX,i.offsetY,u.y3.Identity(),r.activeCamera)))}"_addCameraPointerObserver"(t,i){return this._cameraObserverCount++,this._scene.onPointerObservable.add(t,i)}"_removeCameraPointerObserver"(t){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(t)}"_checkForPicking"(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}"_checkPrePointerObservable"(t,i,r){const a=this._scene,o=new x.FV(r,i,this._unTranslatedPointerX,this._unTranslatedPointerY);return t&&(o.originalPickingInfo=t,o.ray=t.ray,"xr-near"===i.pointerType&&t.originMesh&&(o.nearInteractionPickingInfo=t)),a.onPrePointerObservable.notifyObservers(o,r),!!o.skipOnPointerObservable}"_pickMove"(t){const i=this._scene,r=i.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,i.pointerMovePredicate,i.pointerMoveFastCheck,i.cameraToUseForPointers,i.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(r,t,i),r}"_setCursorAndPointerOverMesh"(t,i,r){const a=r.getEngine().getInputElement();if(t?.pickedMesh){if(this.setPointerOverMesh(t.pickedMesh,i.pointerId,t,i),!r.doNotHandleCursors&&a&&this._pointerOverMesh){const t=this._pointerOverMesh._getActionManagerForTrigger();t&&t.hasPointerTriggers&&(a.style.cursor=t.hoverCursor||r.hoverCursor)}}else this.setPointerOverMesh(null,i.pointerId,t,i)}"simulatePointerMove"(t,i){const r=new PointerEvent("pointermove",i);r.inputIndex=R.Move,this._checkPrePointerObservable(t,r,x.kD.POINTERMOVE)||this._processPointerMove(t,r)}"simulatePointerDown"(t,i){const r=new PointerEvent("pointerdown",i);r.inputIndex=r.button+2,this._checkPrePointerObservable(t,r,x.kD.POINTERDOWN)||this._processPointerDown(t,r)}"_processPointerDown"(t,i){const r=this._scene;if(t?.pickedMesh){this._pickedDownMesh=t.pickedMesh;const a=t.pickedMesh._getActionManagerForTrigger();if(a){if(a.hasPickTriggers)switch(a.processTrigger(5,new ActionEvent(t.pickedMesh,r.pointerX,r.pointerY,t.pickedMesh,i,t)),i.button){case 0:a.processTrigger(2,new ActionEvent(t.pickedMesh,r.pointerX,r.pointerY,t.pickedMesh,i,t));break;case 1:a.processTrigger(4,new ActionEvent(t.pickedMesh,r.pointerX,r.pointerY,t.pickedMesh,i,t));break;case 2:a.processTrigger(3,new ActionEvent(t.pickedMesh,r.pointerX,r.pointerY,t.pickedMesh,i,t))}a.hasSpecificTrigger(8)&&window.setTimeout(()=>{const t=r.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t=>t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(8)&&t===this._pickedDownMesh,!1,r.cameraToUseForPointers);t?.pickedMesh&&a&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>InputManager.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,a.processTrigger(8,ActionEvent.CreateNew(t.pickedMesh,i)))},InputManager.LongPressDelay)}}else for(const a of r._pointerDownStage)t=a.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i,!1);let a;const o=x.kD.POINTERDOWN;t?(r.onPointerDown&&r.onPointerDown(i,t,o),a=new x.R5(o,i,t),this._setRayOnPointerInfo(t,i)):a=new x.R5(o,i,null,this),r.onPointerObservable.hasObservers()&&r.onPointerObservable.notifyObservers(a,o)}"_isPointerSwiping"(){return this._isSwiping}"simulatePointerUp"(t,i,r){const a=new PointerEvent("pointerup",i);a.inputIndex=R.Move;const o=new _ClickInfo;r?o.doubleClick=!0:o.singleClick=!0,this._checkPrePointerObservable(t,a,x.kD.POINTERUP)||this._processPointerUp(t,a,o)}"_processPointerUp"(t,i,r){const a=this._scene;if(t?.pickedMesh){if(this._pickedUpMesh=t.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(a.onPointerPick&&a.onPointerPick(i,t),r.singleClick&&!r.ignore&&a.onPointerObservable.observers.length>this._cameraObserverCount)){const r=x.kD.POINTERPICK,o=new x.R5(r,i,t);this._setRayOnPointerInfo(t,i),a.onPointerObservable.notifyObservers(o,r)}const o=t.pickedMesh._getActionManagerForTrigger();if(o&&!r.ignore){o.processTrigger(7,ActionEvent.CreateNew(t.pickedMesh,i,t)),!r.hasSwiped&&r.singleClick&&o.processTrigger(1,ActionEvent.CreateNew(t.pickedMesh,i,t));const a=t.pickedMesh._getActionManagerForTrigger(6);r.doubleClick&&a&&a.processTrigger(6,ActionEvent.CreateNew(t.pickedMesh,i,t))}}else if(!r.ignore)for(const o of a._pointerUpStage)t=o.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i,r.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const t=this._pickedDownMesh._getActionManagerForTrigger(16);t&&t.processTrigger(16,ActionEvent.CreateNew(this._pickedDownMesh,i))}if(!r.ignore){const o=new x.R5(x.kD.POINTERUP,i,t);if(this._setRayOnPointerInfo(t,i),a.onPointerObservable.notifyObservers(o,x.kD.POINTERUP),a.onPointerUp&&a.onPointerUp(i,t,x.kD.POINTERUP),!r.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let o=0;if(r.singleClick?o=x.kD.POINTERTAP:r.doubleClick&&(o=x.kD.POINTERDOUBLETAP),o){const r=new x.R5(o,i,t);a.onPointerObservable.hasObservers()&&a.onPointerObservable.hasSpecificMask(o)&&a.onPointerObservable.notifyObservers(r,o)}}}}"isPointerCaptured"(t=0){return this._pointerCaptures[t]}"attachControl"(t=!0,i=!0,r=!0,a=null){const o=this._scene,h=o.getEngine();a||(a=h.getInputElement()),this._alreadyAttached&&this.detachControl(),a&&(this._alreadyAttachedTo=a),this._deviceSourceManager=new DeviceSourceManager(h),this._initActionManager=t=>{if(!this._meshPickProceed){const i=o.skipPointerUpPicking||0===o._registeredActions&&!this._checkForPicking()&&!o.onPointerUp?null:o.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,o.pointerUpPredicate,o.pointerUpFastCheck,o.cameraToUseForPointers,o.pointerUpTrianglePredicate);this._currentPickResult=i,i&&(t=i.hit&&i.pickedMesh?i.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return t},this._delayedSimpleClick=(t,i,r)=>{if((Date.now()-this._previousStartingPointerTime>InputManager.DoubleClickDelay&&!this._doubleClickOccured||t!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,this._delayedClicks[t])){const i=this._delayedClicks[t].evt,r=x.kD.POINTERTAP,a=new x.R5(r,i,this._currentPickResult);o.onPointerObservable.hasObservers()&&o.onPointerObservable.hasSpecificMask(r)&&o.onPointerObservable.notifyObservers(a,r),this._delayedClicks[t]=null}},this._initClickEvent=(t,i,r,a)=>{const o=new _ClickInfo;this._currentPickResult=null;let h=null,l=t.hasSpecificMask(x.kD.POINTERPICK)||i.hasSpecificMask(x.kD.POINTERPICK)||t.hasSpecificMask(x.kD.POINTERTAP)||i.hasSpecificMask(x.kD.POINTERTAP)||t.hasSpecificMask(x.kD.POINTERDOUBLETAP)||i.hasSpecificMask(x.kD.POINTERDOUBLETAP);!l&&AbstractActionManager&&(h=this._initActionManager(h,o),h&&(l=h.hasPickTriggers));let c=!1;if(l=l&&!this._isMultiTouchGesture,l){const l=r.button;if(o.hasSwiped=this._isPointerSwiping(),!o.hasSwiped){let u=!InputManager.ExclusiveDoubleClickMode;if(u||(u=!t.hasSpecificMask(x.kD.POINTERDOUBLETAP)&&!i.hasSpecificMask(x.kD.POINTERDOUBLETAP),u&&!AbstractActionManager.HasSpecificTrigger(6)&&(h=this._initActionManager(h,o),h&&(u=!h.hasSpecificTrigger(6)))),u)(Date.now()-this._previousStartingPointerTime>InputManager.DoubleClickDelay||l!==this._previousButtonPressed)&&(o.singleClick=!0,a(o,this._currentPickResult),c=!0);else{const t={"evt":r,"clickInfo":o,"timeoutId":window.setTimeout(this._delayedSimpleClick.bind(this,l,o,a),InputManager.DoubleClickDelay)};this._delayedClicks[l]=t}let d=t.hasSpecificMask(x.kD.POINTERDOUBLETAP)||i.hasSpecificMask(x.kD.POINTERDOUBLETAP);!d&&AbstractActionManager.HasSpecificTrigger(6)&&(h=this._initActionManager(h,o),h&&(d=h.hasSpecificTrigger(6))),d&&(l===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<InputManager.DoubleClickDelay&&!this._doubleClickOccured?(o.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l,InputManager.ExclusiveDoubleClickMode?(this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),a(o,this._previousPickResult)):a(o,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,o.doubleClick=!0,o.ignore=!1,InputManager.ExclusiveDoubleClickMode&&this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),a(o,this._currentPickResult)),c=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l))}}c||a(o,this._currentPickResult)},this._onPointerMove=t=>{if(this._updatePointerPosition(t),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>InputManager.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>InputManager.DragMovementThreshold),h.isPointerLock&&h._verifyPointerLock(),this._checkPrePointerObservable(null,t,t.inputIndex>=R.MouseWheelX&&t.inputIndex<=R.MouseWheelZ?x.kD.POINTERWHEEL:x.kD.POINTERMOVE))return;if(!o.cameraToUseForPointers&&!o.activeCamera)return;if(o.skipPointerMovePicking)return void this._processPointerMove(new g.p,t);o.pointerMovePredicate||(o.pointerMovePredicate=t=>t.isPickable&&t.isVisible&&t.isReady()&&t.isEnabled()&&(t.enablePointerMoveEvents||o.constantlyUpdateMeshUnderPointer||null!==t._getActionManagerForTrigger())&&(!o.cameraToUseForPointers||0!==(o.cameraToUseForPointers.layerMask&t.layerMask)));const i=o._registeredActions>0||o.constantlyUpdateMeshUnderPointer?this._pickMove(t):null;this._processPointerMove(i,t)},this._onPointerDown=t=>{const i=this._activePointerIds.indexOf(-1);if(-1===i?this._activePointerIds.push(t.pointerId):this._activePointerIds[i]=t.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,InputManager.ExclusiveDoubleClickMode)for(let i=0;i<this._delayedClicks.length;i++)if(this._delayedClicks[i])if(t.button===i)clearTimeout(this._delayedClicks[i]?.timeoutId);else{const t=this._delayedClicks[i].clickInfo;this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1;const r=this._delayedClicks[i].evt,a=x.kD.POINTERTAP,h=new x.R5(a,r,this._currentPickResult);o.onPointerObservable.hasObservers()&&o.onPointerObservable.hasSpecificMask(a)&&o.onPointerObservable.notifyObservers(h,a),this._delayedClicks[i]=null}if(this._updatePointerPosition(t),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=t.button),o.preventDefaultOnPointerDown&&a&&(t.preventDefault(),a.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,t,x.kD.POINTERDOWN))return;if(!o.cameraToUseForPointers&&!o.activeCamera)return;let r;this._pointerCaptures[t.pointerId]=!0,o.pointerDownPredicate||(o.pointerDownPredicate=t=>t.isPickable&&t.isVisible&&t.isReady()&&t.isEnabled()&&(!o.cameraToUseForPointers||0!==(o.cameraToUseForPointers.layerMask&t.layerMask))),this._pickedDownMesh=null,r=o.skipPointerDownPicking||0===o._registeredActions&&!this._checkForPicking()&&!o.onPointerDown?new g.p:o.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,o.pointerDownPredicate,o.pointerDownFastCheck,o.cameraToUseForPointers,o.pointerDownTrianglePredicate),this._processPointerDown(r,t)},this._onPointerUp=t=>{const i=this._activePointerIds.indexOf(t.pointerId);-1!==i&&(this._activePointerIds[i]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(t),o.preventDefaultOnPointerUp&&a&&(t.preventDefault(),a.focus()),this._initClickEvent(o.onPrePointerObservable,o.onPointerObservable,t,(i,r)=>{if(o.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!i.ignore)){if(this._checkPrePointerObservable(null,t,x.kD.POINTERUP))return this._swipeButtonPressed===t.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===t.buttons&&(this._pointerCaptures[t.pointerId]=!1));i.hasSwiped||(i.singleClick&&o.onPrePointerObservable.hasSpecificMask(x.kD.POINTERTAP)&&this._checkPrePointerObservable(null,t,x.kD.POINTERTAP)&&(this._skipPointerTap=!0),i.doubleClick&&o.onPrePointerObservable.hasSpecificMask(x.kD.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,t,x.kD.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[t.pointerId]?(0===t.buttons&&(this._pointerCaptures[t.pointerId]=!1),(o.cameraToUseForPointers||o.activeCamera)&&(o.pointerUpPredicate||(o.pointerUpPredicate=t=>t.isPickable&&t.isVisible&&t.isReady()&&t.isEnabled()&&(!o.cameraToUseForPointers||0!==(o.cameraToUseForPointers.layerMask&t.layerMask))),!this._meshPickProceed&&(AbstractActionManager&&AbstractActionManager.HasTriggers||this._checkForPicking()||o.onPointerUp)&&this._initActionManager(null,i),r||(r=this._currentPickResult),this._processPointerUp(r,t,i),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===t.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===t.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)}))},this._onKeyDown=t=>{const i=I.OG.KEYDOWN;if(o.onPreKeyboardObservable.hasObservers()){const r=new I.WZ(i,t);if(o.onPreKeyboardObservable.notifyObservers(r,i),r.skipOnKeyboardObservable)return}if(o.onKeyboardObservable.hasObservers()){const r=new I.NG(i,t);o.onKeyboardObservable.notifyObservers(r,i)}o.actionManager&&o.actionManager.processTrigger(14,ActionEvent.CreateNewFromScene(o,t))},this._onKeyUp=t=>{const i=I.OG.KEYUP;if(o.onPreKeyboardObservable.hasObservers()){const r=new I.WZ(i,t);if(o.onPreKeyboardObservable.notifyObservers(r,i),r.skipOnKeyboardObservable)return}if(o.onKeyboardObservable.hasObservers()){const r=new I.NG(i,t);o.onKeyboardObservable.notifyObservers(r,i)}o.actionManager&&o.actionManager.processTrigger(15,ActionEvent.CreateNewFromScene(o,t))},this._deviceSourceManager.onDeviceConnectedObservable.add(a=>{a.deviceType===E.Mouse?a.onInputChangedObservable.add(o=>{this._originMouseEvent=o,o.inputIndex===R.LeftClick||o.inputIndex===R.MiddleClick||o.inputIndex===R.RightClick||o.inputIndex===R.BrowserBack||o.inputIndex===R.BrowserForward?i&&1===a.getInput(o.inputIndex)?this._onPointerDown(o):t&&0===a.getInput(o.inputIndex)&&this._onPointerUp(o):r&&(o.inputIndex===R.Move?this._onPointerMove(o):o.inputIndex!==R.MouseWheelX&&o.inputIndex!==R.MouseWheelY&&o.inputIndex!==R.MouseWheelZ||this._onPointerMove(o))}):a.deviceType===E.Touch?a.onInputChangedObservable.add(o=>{o.inputIndex===R.LeftClick&&(i&&1===a.getInput(o.inputIndex)?(this._onPointerDown(o),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):t&&0===a.getInput(o.inputIndex)&&(this._onPointerUp(o),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),r&&o.inputIndex===R.Move&&this._onPointerMove(o)}):a.deviceType===E.Keyboard&&a.onInputChangedObservable.add(t=>{"keydown"===t.type?this._onKeyDown(t):"keyup"===t.type&&this._onKeyUp(t)})}),this._alreadyAttached=!0}"detachControl"(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}"setPointerOverMesh"(t,i=0,r,a){if(!(this._meshUnderPointerId[i]!==t||t&&t._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const o=this._meshUnderPointerId[i];let h;o&&(h=o._getActionManagerForTrigger(10),h&&h.processTrigger(10,new ActionEvent(o,this._pointerX,this._pointerY,t,a,{"pointerId":i}))),t?(this._meshUnderPointerId[i]=t,this._pointerOverMesh=t,h=t._getActionManagerForTrigger(9),h&&h.processTrigger(9,new ActionEvent(t,this._pointerX,this._pointerY,t,a,{"pointerId":i,"pickResult":r}))):(delete this._meshUnderPointerId[i],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({"mesh":t,"pointerId":i})}"getPointerOverMesh"(){return this.meshUnderPointer}"_invalidateMesh"(t){this._pointerOverMesh===t&&(this._pointerOverMesh=null),this._pickedDownMesh===t&&(this._pickedDownMesh=null),this._pickedUpMesh===t&&(this._pickedUpMesh=null);for(const i in this._meshUnderPointerId)this._meshUnderPointerId[i]===t&&delete this._meshUnderPointerId[i]}}InputManager.DragMovementThreshold=10,InputManager.LongPressDelay=500,InputManager.DoubleClickDelay=300,InputManager.ExclusiveDoubleClickMode=!1;var B=r(8482),L=r(2922),N=r(8952);class UniqueIdGenerator{static get"UniqueId"(){const t=this._UniqueIdCounter;return this._UniqueIdCounter++,t}}UniqueIdGenerator._UniqueIdCounter=1;var U=r(9485),k=r(183),V=r(2554);class PointerPickingConfiguration{"constructor"(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var G,z=r(658),W=r(646);!function(t){t[t.BackwardCompatible=0]="BackwardCompatible",t[t.Intermediate=1]="Intermediate",t[t.Aggressive=2]="Aggressive"}(G||(G={}));class Scene{static"DefaultMaterialFactory"(t){throw(0,b.S)("StandardMaterial")}static"CollisionCoordinatorFactory"(){throw(0,b.S)("DefaultCollisionCoordinator")}get"clearColor"(){return this._clearColor}set"clearColor"(t){t!==this._clearColor&&(this._clearColor=t,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get"imageProcessingConfiguration"(){return this._imageProcessingConfiguration}get"performancePriority"(){return this._performancePriority}set"performancePriority"(t){if(t!==this._performancePriority){switch(this._performancePriority=t,t){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(t)}}set"forceWireframe"(t){this._forceWireframe!==t&&(this._forceWireframe=t,this.markAllMaterialsAsDirty(16))}get"forceWireframe"(){return this._forceWireframe}set"skipFrustumClipping"(t){this._skipFrustumClipping!==t&&(this._skipFrustumClipping=t)}get"skipFrustumClipping"(){return this._skipFrustumClipping}set"forcePointsCloud"(t){this._forcePointsCloud!==t&&(this._forcePointsCloud=t,this.markAllMaterialsAsDirty(16))}get"forcePointsCloud"(){return this._forcePointsCloud}get"environmentTexture"(){return this._environmentTexture}set"environmentTexture"(t){this._environmentTexture!==t&&(this._environmentTexture=t,this.onEnvironmentTextureChangedObservable.notifyObservers(t),this.markAllMaterialsAsDirty(1))}"getNodes"(){let t=[];return t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes),this.skeletons.forEach(i=>t=t.concat(i.bones)),t}get"animationPropertiesOverride"(){return this._animationPropertiesOverride}set"animationPropertiesOverride"(t){this._animationPropertiesOverride=t}set"onDispose"(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}set"beforeRender"(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),t&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t))}set"afterRender"(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),t&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(t))}set"beforeCameraRender"(t){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(t)}set"afterCameraRender"(t){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(t)}get"pointerDownPredicate"(){return this._pointerPickingConfiguration.pointerDownPredicate}set"pointerDownPredicate"(t){this._pointerPickingConfiguration.pointerDownPredicate=t}get"pointerUpPredicate"(){return this._pointerPickingConfiguration.pointerUpPredicate}set"pointerUpPredicate"(t){this._pointerPickingConfiguration.pointerUpPredicate=t}get"pointerMovePredicate"(){return this._pointerPickingConfiguration.pointerMovePredicate}set"pointerMovePredicate"(t){this._pointerPickingConfiguration.pointerMovePredicate=t}get"pointerDownFastCheck"(){return this._pointerPickingConfiguration.pointerDownFastCheck}set"pointerDownFastCheck"(t){this._pointerPickingConfiguration.pointerDownFastCheck=t}get"pointerUpFastCheck"(){return this._pointerPickingConfiguration.pointerUpFastCheck}set"pointerUpFastCheck"(t){this._pointerPickingConfiguration.pointerUpFastCheck=t}get"pointerMoveFastCheck"(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set"pointerMoveFastCheck"(t){this._pointerPickingConfiguration.pointerMoveFastCheck=t}get"skipPointerMovePicking"(){return this._pointerPickingConfiguration.skipPointerMovePicking}set"skipPointerMovePicking"(t){this._pointerPickingConfiguration.skipPointerMovePicking=t}get"skipPointerDownPicking"(){return this._pointerPickingConfiguration.skipPointerDownPicking}set"skipPointerDownPicking"(t){this._pointerPickingConfiguration.skipPointerDownPicking=t}get"skipPointerUpPicking"(){return this._pointerPickingConfiguration.skipPointerUpPicking}set"skipPointerUpPicking"(t){this._pointerPickingConfiguration.skipPointerUpPicking=t}get"unTranslatedPointer"(){return this._inputManager.unTranslatedPointer}static get"DragMovementThreshold"(){return InputManager.DragMovementThreshold}static set"DragMovementThreshold"(t){InputManager.DragMovementThreshold=t}static get"LongPressDelay"(){return InputManager.LongPressDelay}static set"LongPressDelay"(t){InputManager.LongPressDelay=t}static get"DoubleClickDelay"(){return InputManager.DoubleClickDelay}static set"DoubleClickDelay"(t){InputManager.DoubleClickDelay=t}static get"ExclusiveDoubleClickMode"(){return InputManager.ExclusiveDoubleClickMode}static set"ExclusiveDoubleClickMode"(t){InputManager.ExclusiveDoubleClickMode=t}"bindEyePosition"(t,i="vEyePosition",r=!1){const a=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera?.globalPosition??u.P.ZeroReadOnly,o=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return u.jp.Vector4[0].set(a.x,a.y,a.z,o?-1:1),t&&(r?t.setFloat3(i,u.jp.Vector4[0].x,u.jp.Vector4[0].y,u.jp.Vector4[0].z):t.setVector4(i,u.jp.Vector4[0])),u.jp.Vector4[0]}"finalizeSceneUbo"(){const t=this.getSceneUniformBuffer(),i=this.bindEyePosition(null);return t.updateFloat4("vEyePosition",i.x,i.y,i.z,i.w),t.update(),t}set"useRightHandedSystem"(t){this._useRightHandedSystem!==t&&(this._useRightHandedSystem=t,this.markAllMaterialsAsDirty(16))}get"useRightHandedSystem"(){return this._useRightHandedSystem}"setStepId"(t){this._currentStepId=t}"getStepId"(){return this._currentStepId}"getInternalStep"(){return this._currentInternalStep}set"fogEnabled"(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAllMaterialsAsDirty(16))}get"fogEnabled"(){return this._fogEnabled}set"fogMode"(t){this._fogMode!==t&&(this._fogMode=t,this.markAllMaterialsAsDirty(16))}get"fogMode"(){return this._fogMode}get"prePass"(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set"shadowsEnabled"(t){this._shadowsEnabled!==t&&(this._shadowsEnabled=t,this.markAllMaterialsAsDirty(2))}get"shadowsEnabled"(){return this._shadowsEnabled}set"lightsEnabled"(t){this._lightsEnabled!==t&&(this._lightsEnabled=t,this.markAllMaterialsAsDirty(2))}get"lightsEnabled"(){return this._lightsEnabled}get"activeCameras"(){return this._activeCameras}set"activeCameras"(t){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),t&&(this._unObserveActiveCameras=(0,V.Mf)(t,()=>{this.onActiveCamerasChanged.notifyObservers(this)})),this._activeCameras=t}get"activeCamera"(){return this._activeCamera}set"activeCamera"(t){t!==this._activeCamera&&(this._activeCamera=t,this.onActiveCameraChanged.notifyObservers(this))}get"_hasDefaultMaterial"(){return Scene.DefaultMaterialFactory!==Scene._OriginalDefaultMaterialFactory}get"defaultMaterial"(){return this._defaultMaterial||(this._defaultMaterial=Scene.DefaultMaterialFactory(this)),this._defaultMaterial}set"defaultMaterial"(t){this._defaultMaterial=t}set"texturesEnabled"(t){this._texturesEnabled!==t&&(this._texturesEnabled=t,this.markAllMaterialsAsDirty(1))}get"texturesEnabled"(){return this._texturesEnabled}get"frameGraph"(){return this._frameGraph}set"frameGraph"(t){if(this._frameGraph)return this._frameGraph=t,void(t||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=t,t&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set"skeletonsEnabled"(t){this._skeletonsEnabled!==t&&(this._skeletonsEnabled=t,this.markAllMaterialsAsDirty(8))}get"skeletonsEnabled"(){return this._skeletonsEnabled}get"collisionCoordinator"(){return this._collisionCoordinator||(this._collisionCoordinator=Scene.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get"renderingManager"(){return this._renderingManager}get"frustumPlanes"(){return this._frustumPlanes}"_registerTransientComponents"(){if(this._transientComponents.length>0){for(const t of this._transientComponents)t.register();this._transientComponents.length=0}}"_addComponent"(t){this._components.push(t),this._transientComponents.push(t);const i=t;i.addFromContainer&&i.serialize&&this._serializableComponents.push(i)}"_getComponent"(t){for(const i of this._components)if(i.name===t)return i;return null}"constructor"(t,i){this._inputManager=new InputManager(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new L.HE(.2,.2,.3,1),this.onClearColorChangedObservable=new h.y$,this.ambientColor=new L.Wo(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new h.y$,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.sounds=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new h.y$,this._onDisposeObserver=null,this.onBeforeRenderObservable=new h.y$,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new h.y$,this.onAfterRenderCameraObservable=new h.y$,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new h.y$,this.onAfterAnimationsObservable=new h.y$,this.onBeforeDrawPhaseObservable=new h.y$,this.onAfterDrawPhaseObservable=new h.y$,this.onReadyObservable=new h.y$,this.onBeforeCameraRenderObservable=new h.y$,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new h.y$,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new h.y$,this.onAfterActiveMeshesEvaluationObservable=new h.y$,this.onBeforeParticlesRenderingObservable=new h.y$,this.onAfterParticlesRenderingObservable=new h.y$,this.onDataLoadedObservable=new h.y$,this.onNewCameraAddedObservable=new h.y$,this.onCameraRemovedObservable=new h.y$,this.onNewLightAddedObservable=new h.y$,this.onLightRemovedObservable=new h.y$,this.onNewGeometryAddedObservable=new h.y$,this.onGeometryRemovedObservable=new h.y$,this.onNewTransformNodeAddedObservable=new h.y$,this.onTransformNodeRemovedObservable=new h.y$,this.onNewMeshAddedObservable=new h.y$,this.onMeshRemovedObservable=new h.y$,this.onNewSkeletonAddedObservable=new h.y$,this.onSkeletonRemovedObservable=new h.y$,this.onNewMaterialAddedObservable=new h.y$,this.onNewMultiMaterialAddedObservable=new h.y$,this.onMaterialRemovedObservable=new h.y$,this.onMultiMaterialRemovedObservable=new h.y$,this.onNewTextureAddedObservable=new h.y$,this.onTextureRemovedObservable=new h.y$,this.onBeforeRenderTargetsRenderObservable=new h.y$,this.onAfterRenderTargetsRenderObservable=new h.y$,this.onBeforeStepObservable=new h.y$,this.onAfterStepObservable=new h.y$,this.onActiveCameraChanged=new h.y$,this.onActiveCamerasChanged=new h.y$,this.onBeforeRenderingGroupObservable=new h.y$,this.onAfterRenderingGroupObservable=new h.y$,this.onMeshImportedObservable=new h.y$,this.onAnimationFileImportedObservable=new h.y$,this.onEnvironmentTextureChangedObservable=new h.y$,this.onMeshUnderPointerUpdatedObservable=new h.y$,this._registeredForLateAnimationBindings=new l.f(256),this._pointerPickingConfiguration=new PointerPickingConfiguration,this.onPrePointerObservable=new h.y$,this.onPointerObservable=new h.y$,this.onPreKeyboardObservable=new h.y$,this.onKeyboardObservable=new h.y$,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=Scene.FOGMODE_NONE,this.fogColor=new L.Wo(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new u.P(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new l.f(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new B.z,this._activeIndices=new B.z,this._activeParticles=new B.z,this._activeBones=new B.z,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new l.t(256),this._processedMaterials=new l.t(256),this._renderTargets=new l.f(256),this._materialsRenderTargets=new l.f(256),this._activeParticleSystems=new l.t(256),this._activeSkeletons=new l.f(32),this._softwareSkinnedMeshes=new l.f(32),this._activeAnimatables=new Array,this._transformMatrix=u.y3.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=T.H.Create(),this._beforeClearStage=T.H.Create(),this._beforeRenderTargetClearStage=T.H.Create(),this._gatherRenderTargetsStage=T.H.Create(),this._gatherActiveCameraRenderTargetsStage=T.H.Create(),this._isReadyForMeshStage=T.H.Create(),this._beforeEvaluateActiveMeshStage=T.H.Create(),this._evaluateSubMeshStage=T.H.Create(),this._preActiveMeshStage=T.H.Create(),this._cameraDrawRenderTargetStage=T.H.Create(),this._beforeCameraDrawStage=T.H.Create(),this._beforeRenderTargetDrawStage=T.H.Create(),this._beforeRenderingGroupDrawStage=T.H.Create(),this._beforeRenderingMeshStage=T.H.Create(),this._afterRenderingMeshStage=T.H.Create(),this._afterRenderingGroupDrawStage=T.H.Create(),this._afterCameraDrawStage=T.H.Create(),this._afterCameraPostProcessStage=T.H.Create(),this._afterRenderTargetDrawStage=T.H.Create(),this._afterRenderTargetPostProcessStage=T.H.Create(),this._afterRenderStage=T.H.Create(),this._pointerMoveStage=T.H.Create(),this._pointerDownStage=T.H.Create(),this._pointerUpStage=T.H.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={"data":[],"length":0},this._defaultSubMeshCandidates={"data":[],"length":0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const r={"useGeometryUniqueIdsMap":!0,"useMaterialMeshMap":!0,"useClonedMeshMap":!0,"virtual":!1,...i};t=this._engine=t||M.l.LastCreatedEngine,r.virtual?t._virtualScenes.push(this):(M.l._LastCreatedScene=this,t.scenes.push(this)),this._uid=null,this._renderingManager=new m.$(this),p.O&&(this.postProcessManager=new p.O(this)),(0,y.CG)()&&this.attachControl(),this._createUbo(),d.$&&(this._imageProcessingConfiguration=new d.$),this.setDefaultCandidateProviders(),r.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=r.useMaterialMeshMap,this.useClonedMeshMap=r.useClonedMeshMap,i&&i.virtual||t.onNewSceneAddedObservable.notifyObservers(this)}"getClassName"(){return"Scene"}"_getDefaultMeshCandidates"(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}"_getDefaultSubMeshCandidates"(t){return this._defaultSubMeshCandidates.data=t.subMeshes,this._defaultSubMeshCandidates.length=t.subMeshes.length,this._defaultSubMeshCandidates}"setDefaultCandidateProviders"(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=t=>this._getDefaultSubMeshCandidates(t),this.getIntersectingSubMeshCandidates=(t,i)=>this._getDefaultSubMeshCandidates(t),this.getCollidingSubMeshCandidates=(t,i)=>this._getDefaultSubMeshCandidates(t)}get"meshUnderPointer"(){return this._inputManager.meshUnderPointer}get"pointerX"(){return this._inputManager.pointerX}set"pointerX"(t){this._inputManager.pointerX=t}get"pointerY"(){return this._inputManager.pointerY}set"pointerY"(t){this._inputManager.pointerY=t}"getCachedMaterial"(){return this._cachedMaterial}"getCachedEffect"(){return this._cachedEffect}"getCachedVisibility"(){return this._cachedVisibility}"isCachedMaterialInvalid"(t,i,r=1){return this._cachedEffect!==i||this._cachedMaterial!==t||this._cachedVisibility!==r}"getEngine"(){return this._engine}"getTotalVertices"(){return this._totalVertices.current}get"totalVerticesPerfCounter"(){return this._totalVertices}"getActiveIndices"(){return this._activeIndices.current}get"totalActiveIndicesPerfCounter"(){return this._activeIndices}"getActiveParticles"(){return this._activeParticles.current}get"activeParticlesPerfCounter"(){return this._activeParticles}"getActiveBones"(){return this._activeBones.current}get"activeBonesPerfCounter"(){return this._activeBones}"getActiveMeshes"(){return this._activeMeshes}"getAnimationRatio"(){return void 0!==this._animationRatio?this._animationRatio:1}"getRenderId"(){return this._renderId}"getFrameId"(){return this._frameId}"incrementRenderId"(){this._renderId++}"_createUbo"(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}"simulatePointerMove"(t,i){return this._inputManager.simulatePointerMove(t,i),this}"simulatePointerDown"(t,i){return this._inputManager.simulatePointerDown(t,i),this}"simulatePointerUp"(t,i,r){return this._inputManager.simulatePointerUp(t,i,r),this}"isPointerCaptured"(t=0){return this._inputManager.isPointerCaptured(t)}"attachControl"(t=!0,i=!0,r=!0){this._inputManager.attachControl(t,i,r)}"detachControl"(){this._inputManager.detachControl()}"isReady"(t=!0){if(this._isDisposed)return!1;let i;const r=this.getEngine(),a=r.currentRenderPassId;r.currentRenderPassId=this.activeCamera?.renderPassId??a;let o=!0;for(this._pendingData.length>0&&(o=!1),this.prePassRenderer?.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&o&&(o=this.depthPeelingRenderer.isReady()),t&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),i=0;i<this.meshes.length;i++){const a=this.meshes[i];if(!a.subMeshes||0===a.subMeshes.length)continue;if(!a.isReady(!0)){o=!1;continue}const h=a.hasThinInstances||"InstancedMesh"===a.getClassName()||"InstancedLinesMesh"===a.getClassName()||r.getCaps().instancedArrays&&a.instances.length>0;for(const t of this._isReadyForMeshStage)t.action(a,h)||(o=!1);if(!t)continue;const l=a.material||this.defaultMaterial;if(l)if(l._storeEffectOnSubMeshes)for(const t of a.subMeshes){const i=t.getMaterial();i&&i.hasRenderTargetTextures&&null!=i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._materialsRenderTargets.concatWithNoDuplicate(i.getRenderTargetTextures()))}else l.hasRenderTargetTextures&&null!=l.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(l)&&(this._processedMaterials.push(l),this._materialsRenderTargets.concatWithNoDuplicate(l.getRenderTargetTextures()))}if(t)for(i=0;i<this._materialsRenderTargets.length;++i){this._materialsRenderTargets.data[i].isReadyForRendering()||(o=!1)}for(i=0;i<this.geometries.length;i++){2===this.geometries[i].delayLoadState&&(o=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const t of this.activeCameras)t.isReady(!0)||(o=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(o=!1));for(const t of this.particleSystems)t.isReady()||(o=!1);if(this.layers)for(const t of this.layers)t.isReady()||(o=!1);if(this.effectLayers)for(const t of this.effectLayers)t.isLayerReady()||(o=!1);return r.areAllEffectsReady()||(o=!1),r.currentRenderPassId=a,o}"resetCachedMaterial"(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}"registerBeforeRender"(t){this.onBeforeRenderObservable.add(t)}"unregisterBeforeRender"(t){this.onBeforeRenderObservable.removeCallback(t)}"registerAfterRender"(t){this.onAfterRenderObservable.add(t)}"unregisterAfterRender"(t){this.onAfterRenderObservable.removeCallback(t)}"_executeOnceBeforeRender"(t){const execFunc=()=>{t(),setTimeout(()=>{this.unregisterBeforeRender(execFunc)})};this.registerBeforeRender(execFunc)}"executeOnceBeforeRender"(t,i){void 0!==i?setTimeout(()=>{this._executeOnceBeforeRender(t)},i):this._executeOnceBeforeRender(t)}"addPendingData"(t){this._pendingData.push(t)}"removePendingData"(t){const i=this.isLoading,r=this._pendingData.indexOf(t);-1!==r&&this._pendingData.splice(r,1),i&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}"getWaitingItemsCount"(){return this._pendingData.length}get"isLoading"(){return this._pendingData.length>0}"executeWhenReady"(t,i=!1){this.onReadyObservable.addOnce(t),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(i)}"whenReadyAsync"(t=!1){return new Promise(i=>{this.executeWhenReady(()=>{i()},t)})}"_checkIsReady"(t=!1){return this._registerTransientComponents(),this.isReady(t)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout(()=>{this.incrementRenderId(),this._checkIsReady(t)},100))}get"animatables"(){return this._activeAnimatables}"resetLastAnimationTimeFrame"(){this._animationTimeLast=o.F.Now}"getViewMatrix"(){return this._viewMatrix}"getProjectionMatrix"(){return this._projectionMatrix}"getTransformMatrix"(){return this._transformMatrix}"setTransformMatrix"(t,i,r,a){r||a||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===t.updateFlag&&this._projectionUpdateFlag===i.updateFlag||(this._viewUpdateFlag=t.updateFlag,this._projectionUpdateFlag=i.updateFlag,this._viewMatrix=t,this._projectionMatrix=i,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?N.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=N.i.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(r,a):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}"getSceneUniformBuffer"(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}"createSceneUniformBuffer"(t){const i=new _.M(this._engine,void 0,!1,t??"scene");return i.addUniform("viewProjection",16),i.addUniform("view",16),i.addUniform("projection",16),i.addUniform("vEyePosition",4),i}"setSceneUniformBuffer"(t){this._sceneUbo=t,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}"getUniqueId"(){return UniqueIdGenerator.UniqueId}"addMesh"(t,i=!1){this._blockEntityCollection||(this.meshes.push(t),t._resyncLightSources(),t.parent||t._addToSceneRootNodes(),a.w1.SetImmediate(()=>{this.onNewMeshAddedObservable.notifyObservers(t)}),i&&t.getChildMeshes().forEach(t=>{this.addMesh(t)}))}"removeMesh"(t,i=!1){const r=this.meshes.indexOf(t);return-1!==r&&(this.meshes.splice(r,1),t.parent||t._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(t),this.onMeshRemovedObservable.notifyObservers(t),i&&t.getChildMeshes().forEach(t=>{this.removeMesh(t)}),r}"addTransformNode"(t){this._blockEntityCollection||t.getScene()===this&&-1!==t._indexInSceneTransformNodesArray||(t._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(t),t.parent||t._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(t))}"removeTransformNode"(t){const i=t._indexInSceneTransformNodesArray;if(-1!==i){if(i!==this.transformNodes.length-1){const t=this.transformNodes[this.transformNodes.length-1];this.transformNodes[i]=t,t._indexInSceneTransformNodesArray=i}t._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),t.parent||t._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(t),i}"removeSkeleton"(t){const i=this.skeletons.indexOf(t);return-1!==i&&(this.skeletons.splice(i,1),this.onSkeletonRemovedObservable.notifyObservers(t),this._executeActiveContainerCleanup(this._activeSkeletons)),i}"removeMorphTargetManager"(t){const i=this.morphTargetManagers.indexOf(t);return-1!==i&&this.morphTargetManagers.splice(i,1),i}"removeLight"(t){const i=this.lights.indexOf(t);if(-1!==i){for(const i of this.meshes)i._removeLightSource(t,!1);this.lights.splice(i,1),this.sortLightsByPriority(),t.parent||t._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(t),i}"removeCamera"(t){const i=this.cameras.indexOf(t);if(-1!==i&&(this.cameras.splice(i,1),t.parent||t._removeFromSceneRootNodes()),this.activeCameras){const i=this.activeCameras.indexOf(t);-1!==i&&this.activeCameras.splice(i,1)}return this.activeCamera===t&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(t),i}"removeParticleSystem"(t){const i=this.particleSystems.indexOf(t);return-1!==i&&(this.particleSystems.splice(i,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),i}"removeAnimation"(t){const i=this.animations.indexOf(t);return-1!==i&&this.animations.splice(i,1),i}"stopAnimation"(t,i,r){}"removeAnimationGroup"(t){const i=this.animationGroups.indexOf(t);return-1!==i&&this.animationGroups.splice(i,1),i}"removeMultiMaterial"(t){const i=this.multiMaterials.indexOf(t);return-1!==i&&this.multiMaterials.splice(i,1),this.onMultiMaterialRemovedObservable.notifyObservers(t),i}"removeMaterial"(t){const i=t._indexInSceneMaterialArray;if(-1!==i&&i<this.materials.length){if(i!==this.materials.length-1){const t=this.materials[this.materials.length-1];this.materials[i]=t,t._indexInSceneMaterialArray=i}t._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(t),i}"removeActionManager"(t){const i=this.actionManagers.indexOf(t);return-1!==i&&this.actionManagers.splice(i,1),i}"removeTexture"(t){const i=this.textures.indexOf(t);return-1!==i&&this.textures.splice(i,1),this.onTextureRemovedObservable.notifyObservers(t),i}"addLight"(t){if(!this._blockEntityCollection){this.lights.push(t),this.sortLightsByPriority(),t.parent||t._addToSceneRootNodes();for(const i of this.meshes)-1===i.lightSources.indexOf(t)&&(i.lightSources.push(t),i._resyncLightSources());a.w1.SetImmediate(()=>{this.onNewLightAddedObservable.notifyObservers(t)})}}"sortLightsByPriority"(){this.requireLightSorting&&this.lights.sort(k.m.CompareLightsPriority)}"addCamera"(t){this._blockEntityCollection||(this.cameras.push(t),a.w1.SetImmediate(()=>{this.onNewCameraAddedObservable.notifyObservers(t)}),t.parent||t._addToSceneRootNodes())}"addSkeleton"(t){this._blockEntityCollection||(this.skeletons.push(t),a.w1.SetImmediate(()=>{this.onNewSkeletonAddedObservable.notifyObservers(t)}))}"addParticleSystem"(t){this._blockEntityCollection||this.particleSystems.push(t)}"addAnimation"(t){this._blockEntityCollection||this.animations.push(t)}"addAnimationGroup"(t){this._blockEntityCollection||this.animationGroups.push(t)}"addMultiMaterial"(t){this._blockEntityCollection||(this.multiMaterials.push(t),a.w1.SetImmediate(()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(t)}))}"addMaterial"(t){this._blockEntityCollection||t.getScene()===this&&-1!==t._indexInSceneMaterialArray||(t._indexInSceneMaterialArray=this.materials.length,this.materials.push(t),a.w1.SetImmediate(()=>{this.onNewMaterialAddedObservable.notifyObservers(t)}))}"addMorphTargetManager"(t){this._blockEntityCollection||this.morphTargetManagers.push(t)}"addGeometry"(t){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[t.uniqueId]=this.geometries.length),this.geometries.push(t))}"addActionManager"(t){this.actionManagers.push(t)}"addTexture"(t){this._blockEntityCollection||(this.textures.push(t),this.onNewTextureAddedObservable.notifyObservers(t))}"switchActiveCamera"(t,i=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=t,i&&t.attachControl())}"setActiveCameraById"(t){const i=this.getCameraById(t);return i?(this.activeCamera=i,i):null}"setActiveCameraByName"(t){const i=this.getCameraByName(t);return i?(this.activeCamera=i,i):null}"getAnimationGroupByName"(t){for(let i=0;i<this.animationGroups.length;i++)if(this.animationGroups[i].name===t)return this.animationGroups[i];return null}"_getMaterial"(t,i){for(let t=0;t<this.materials.length;t++){const r=this.materials[t];if(i(r))return r}if(t)for(let t=0;t<this.multiMaterials.length;t++){const r=this.multiMaterials[t];if(i(r))return r}return null}"getMaterialByUniqueID"(t,i=!1){return this._getMaterial(i,i=>i.uniqueId===t)}"getMaterialById"(t,i=!1){return this._getMaterial(i,i=>i.id===t)}"getMaterialByName"(t,i=!1){return this._getMaterial(i,i=>i.name===t)}"getLastMaterialById"(t,i=!1){for(let i=this.materials.length-1;i>=0;i--)if(this.materials[i].id===t)return this.materials[i];if(i)for(let i=this.multiMaterials.length-1;i>=0;i--)if(this.multiMaterials[i].id===t)return this.multiMaterials[i];return null}"getTextureByUniqueId"(t){for(let i=0;i<this.textures.length;i++)if(this.textures[i].uniqueId===t)return this.textures[i];return null}"getTextureByName"(t){for(let i=0;i<this.textures.length;i++)if(this.textures[i].name===t)return this.textures[i];return null}"getCameraById"(t){for(let i=0;i<this.cameras.length;i++)if(this.cameras[i].id===t)return this.cameras[i];return null}"getCameraByUniqueId"(t){for(let i=0;i<this.cameras.length;i++)if(this.cameras[i].uniqueId===t)return this.cameras[i];return null}"getCameraByName"(t){for(let i=0;i<this.cameras.length;i++)if(this.cameras[i].name===t)return this.cameras[i];return null}"getBoneById"(t){for(let i=0;i<this.skeletons.length;i++){const r=this.skeletons[i];for(let i=0;i<r.bones.length;i++)if(r.bones[i].id===t)return r.bones[i]}return null}"getBoneByName"(t){for(let i=0;i<this.skeletons.length;i++){const r=this.skeletons[i];for(let i=0;i<r.bones.length;i++)if(r.bones[i].name===t)return r.bones[i]}return null}"getLightByName"(t){for(let i=0;i<this.lights.length;i++)if(this.lights[i].name===t)return this.lights[i];return null}"getLightById"(t){for(let i=0;i<this.lights.length;i++)if(this.lights[i].id===t)return this.lights[i];return null}"getLightByUniqueId"(t){for(let i=0;i<this.lights.length;i++)if(this.lights[i].uniqueId===t)return this.lights[i];return null}"getParticleSystemById"(t){for(let i=0;i<this.particleSystems.length;i++)if(this.particleSystems[i].id===t)return this.particleSystems[i];return null}"getGeometryById"(t){for(let i=0;i<this.geometries.length;i++)if(this.geometries[i].id===t)return this.geometries[i];return null}"_getGeometryByUniqueId"(t){if(this._geometriesByUniqueId){const i=this._geometriesByUniqueId[t];if(void 0!==i)return this.geometries[i]}else for(let i=0;i<this.geometries.length;i++)if(this.geometries[i].uniqueId===t)return this.geometries[i];return null}"getFrameGraphByName"(t){for(let i=0;i<this.frameGraphs.length;i++)if(this.frameGraphs[i].name===t)return this.frameGraphs[i];return null}"pushGeometry"(t,i){return!(!i&&this._getGeometryByUniqueId(t.uniqueId))&&(this.addGeometry(t),a.w1.SetImmediate(()=>{this.onNewGeometryAddedObservable.notifyObservers(t)}),!0)}"removeGeometry"(t){let i;if(this._geometriesByUniqueId){if(i=this._geometriesByUniqueId[t.uniqueId],void 0===i)return!1}else if(i=this.geometries.indexOf(t),i<0)return!1;if(i!==this.geometries.length-1){const t=this.geometries[this.geometries.length-1];t&&(this.geometries[i]=t,this._geometriesByUniqueId&&(this._geometriesByUniqueId[t.uniqueId]=i))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[t.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(t),!0}"getGeometries"(){return this.geometries}"getMeshById"(t){for(let i=0;i<this.meshes.length;i++)if(this.meshes[i].id===t)return this.meshes[i];return null}"getMeshesById"(t){return this.meshes.filter(function(i){return i.id===t})}"getTransformNodeById"(t){for(let i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].id===t)return this.transformNodes[i];return null}"getTransformNodeByUniqueId"(t){for(let i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].uniqueId===t)return this.transformNodes[i];return null}"getTransformNodesById"(t){return this.transformNodes.filter(function(i){return i.id===t})}"getMeshByUniqueId"(t){for(let i=0;i<this.meshes.length;i++)if(this.meshes[i].uniqueId===t)return this.meshes[i];return null}"getLastMeshById"(t){for(let i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];return null}"getLastTransformNodeById"(t){for(let i=this.transformNodes.length-1;i>=0;i--)if(this.transformNodes[i].id===t)return this.transformNodes[i];return null}"getLastEntryById"(t){let i;for(i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];for(i=this.transformNodes.length-1;i>=0;i--)if(this.transformNodes[i].id===t)return this.transformNodes[i];for(i=this.cameras.length-1;i>=0;i--)if(this.cameras[i].id===t)return this.cameras[i];for(i=this.lights.length-1;i>=0;i--)if(this.lights[i].id===t)return this.lights[i];return null}"getNodeById"(t){const i=this.getMeshById(t);if(i)return i;const r=this.getTransformNodeById(t);if(r)return r;const a=this.getLightById(t);if(a)return a;const o=this.getCameraById(t);if(o)return o;const h=this.getBoneById(t);return h||null}"getNodeByName"(t){const i=this.getMeshByName(t);if(i)return i;const r=this.getTransformNodeByName(t);if(r)return r;const a=this.getLightByName(t);if(a)return a;const o=this.getCameraByName(t);if(o)return o;const h=this.getBoneByName(t);return h||null}"getMeshByName"(t){for(let i=0;i<this.meshes.length;i++)if(this.meshes[i].name===t)return this.meshes[i];return null}"getTransformNodeByName"(t){for(let i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].name===t)return this.transformNodes[i];return null}"getLastSkeletonById"(t){for(let i=this.skeletons.length-1;i>=0;i--)if(this.skeletons[i].id===t)return this.skeletons[i];return null}"getSkeletonByUniqueId"(t){for(let i=0;i<this.skeletons.length;i++)if(this.skeletons[i].uniqueId===t)return this.skeletons[i];return null}"getSkeletonById"(t){for(let i=0;i<this.skeletons.length;i++)if(this.skeletons[i].id===t)return this.skeletons[i];return null}"getSkeletonByName"(t){for(let i=0;i<this.skeletons.length;i++)if(this.skeletons[i].name===t)return this.skeletons[i];return null}"getMorphTargetManagerById"(t){for(let i=0;i<this.morphTargetManagers.length;i++)if(this.morphTargetManagers[i].uniqueId===t)return this.morphTargetManagers[i];return null}"getMorphTargetById"(t){for(let i=0;i<this.morphTargetManagers.length;++i){const r=this.morphTargetManagers[i];for(let i=0;i<r.numTargets;++i){const a=r.getTarget(i);if(a.id===t)return a}}return null}"getMorphTargetByName"(t){for(let i=0;i<this.morphTargetManagers.length;++i){const r=this.morphTargetManagers[i];for(let i=0;i<r.numTargets;++i){const a=r.getTarget(i);if(a.name===t)return a}}return null}"getPostProcessByName"(t){for(let i=0;i<this.postProcesses.length;++i){const r=this.postProcesses[i];if(r.name===t)return r}return null}"isActiveMesh"(t){return-1!==this._activeMeshes.indexOf(t)}get"uid"(){return this._uid||(this._uid=a.w1.RandomId()),this._uid}"addExternalData"(t,i){return this._externalData||(this._externalData=new StringDictionary),this._externalData.add(t,i)}"getExternalData"(t){return this._externalData?this._externalData.get(t):null}"getOrAddExternalDataWithFactory"(t,i){return this._externalData||(this._externalData=new StringDictionary),this._externalData.getOrAddWithFactory(t,i)}"removeExternalData"(t){return this._externalData.remove(t)}"_evaluateSubMesh"(t,i,r,a){if(a||t.isInFrustum(this._frustumPlanes)){for(const r of this._evaluateSubMeshStage)r.action(i,t);const r=t.getMaterial();null!=r&&(r.hasRenderTargetTextures&&null!=r.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(r)&&(this._processedMaterials.push(r),this._materialsRenderTargets.concatWithNoDuplicate(r.getRenderTargetTextures())),this._renderingManager.dispatch(t,i,r))}}"freeProcessedMaterials"(){this._processedMaterials.dispose()}get"blockfreeActiveMeshesAndRenderingGroups"(){return this._preventFreeActiveMeshesAndRenderingGroups}set"blockfreeActiveMeshesAndRenderingGroups"(t){this._preventFreeActiveMeshesAndRenderingGroups!==t&&(t&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=t)}"freeActiveMeshes"(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let t=0;t<this.activeCameras.length;t++){const i=this.activeCameras[t];i&&i._activeMeshes&&i._activeMeshes.dispose()}}"freeRenderingGroups"(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let t=0;t<this.textures.length;t++){const i=this.textures[t];i&&i.renderList&&i.freeRenderingGroups()}}"_isInIntermediateRendering"(){return this._intermediateRendering}"freezeActiveMeshes"(t=!1,i,r,a=!0,o=!1){return this.executeWhenReady(()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=o,this._skipEvaluateActiveMeshesCompletely=t,a)for(let t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._freeze();i&&i()}else r&&r("No active camera found")}),this}"unfreezeActiveMeshes"(){for(let t=0;t<this.meshes.length;t++){const i=this.meshes[t];i._internalAbstractMeshDataInfo&&(i._internalAbstractMeshDataInfo._isActive=!1)}for(let t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._unFreeze();return this._activeMeshesFrozen=!1,this}"_executeActiveContainerCleanup"(t){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce(()=>t.dispose())}"_evaluateActiveMeshes"(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)return void(this._activeMeshes.length>0&&(this.activeCamera?._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset()));if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const t=this._activeMeshes.length;for(let i=0;i<t;i++){this._activeMeshes.data[i].computeWorldMatrix()}}if(this._activeParticleSystems){const t=this._activeParticleSystems.length;for(let i=0;i<t;i++)this._activeParticleSystems.data[i].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const t of this._beforeEvaluateActiveMeshStage)t.action();const t=this.getActiveMeshCandidates(),i=t.length;for(let r=0;r<i;r++){const i=t.data[r];let a=i._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(a?a[1]=-1:(a=[i,-1],i._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,a)),i.isBlocked)continue;if(this._totalVertices.addCount(i.getTotalVertices(),!1),!i.isReady()||!i.isEnabled()||i.scaling.hasAZeroComponent)continue;i.computeWorldMatrix(),i.actionManager&&i.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(i);let o=this.customLODSelector?this.customLODSelector(i,this.activeCamera):i.getLOD(this.activeCamera);if(a[0]=o,a[1]=this._frameId,null!=o&&(o!==i&&0!==o.billboardMode&&o.computeWorldMatrix(),i._preActivate(),i.isVisible&&i.visibility>0&&0!==(i.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||i.alwaysSelectAsActiveMesh||i.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(i),this.activeCamera._activeMeshes.push(i),o!==i&&o._activate(this._renderId,!1);for(const t of this._preActiveMeshStage)t.action(i);i._activate(this._renderId,!1)&&(i.isAnInstance?i._internalAbstractMeshDataInfo._actAsRegularMesh&&(o=i):o._internalAbstractMeshDataInfo._onlyForInstances=!1,o._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(i,o)),i._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let t=0;t<this.particleSystems.length;t++){const i=this.particleSystems[t];if(!i.isStarted()||!i.emitter)continue;const r=i.emitter;r.position&&!r.isEnabled()||(this._activeParticleSystems.push(i),i.animate(),this._renderingManager.dispatchParticles(i))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}"_prepareSkeleton"(t){this._skeletonsEnabled&&t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t)&&this.frameGraph&&t.applySkeleton(t.skeleton))}"_activeMesh"(t,i){this._prepareSkeleton(i);let r=t.hasInstances||t.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||i.alwaysSelectAsActiveMesh;if(i&&i.subMeshes&&i.subMeshes.length>0){const a=this.getActiveSubMeshCandidates(i),o=a.length;r=r||1===o;for(let h=0;h<o;h++){const o=a.data[h];this._evaluateSubMesh(o,i,t,r)}}}"updateTransformMatrix"(t){const i=this.activeCamera;if(i)if(i._renderingMultiview){const r=i._rigCameras[0],a=i._rigCameras[1];this.setTransformMatrix(r.getViewMatrix(),r.getProjectionMatrix(t),a.getViewMatrix(),a.getProjectionMatrix(t))}else this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(t))}"_bindFrameBuffer"(t,i=!0){this._useCurrentFrameBuffer||(t&&t._multiviewTexture?t._multiviewTexture._bindFrameBuffer():t&&t.outputRenderTarget?t.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),i&&this._clearFrameBuffer(t)}"_clearFrameBuffer"(t){if(t&&t._multiviewTexture);else if(t&&t.outputRenderTarget&&!t._renderingMultiview){const i=t.outputRenderTarget;i.onClearObservable.hasObservers()?i.onClearObservable.notifyObservers(this._engine):i.skipInitialClear||t.isRightCamera||(this.autoClear&&this._engine.clear(i.clearColor||this._clearColor,!i._cleared,!0,!0),i._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}"_renderForCamera"(t,i,r=!0){if(t&&t._skipRendering)return;const o=this._engine;if(this._activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");if(o.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&r){let i=!0;t._renderingMultiview&&t.outputRenderTarget&&(i=t.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,t.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),t._renderingMultiview&&t.outputRenderTarget&&(t.outputRenderTarget.skipInitialClear=i)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let t=0;t<this._softwareSkinnedMeshes.length;t++){const i=this._softwareSkinnedMeshes.data[t];i.applySkeleton(i.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),i&&i.customRenderTargets&&i.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(i.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const t of this._gatherActiveCameraRenderTargetsStage)t.action(this._renderTargets);let h=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){a.w1.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let t=0;t<this._renderTargets.length;t++){const i=this._renderTargets.data[t];if(i._shouldRender()){this._renderId++;const t=i.activeCamera&&i.activeCamera!==this.activeCamera;i.render(t,this.dumpNextRenderTargets),h=!0}}a.w1.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const t of this._cameraDrawRenderTargetStage)h=t.action(this.activeCamera)||h;this._intermediateRendering=!1}this._engine.currentRenderPassId=t.outputRenderTarget?.renderPassId??t.renderPassId??0,h&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||t._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const t of this._beforeCameraDrawStage)t.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),o.snapshotRendering&&1===o.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const t of this._afterCameraDrawStage)t.action(this.activeCamera);if(this.postProcessManager&&!t._multiviewTexture){const i=t.outputRenderTarget?t.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(t.isIntermediate,i)}for(const t of this._afterCameraPostProcessStage)t.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}"_processSubCameras"(t,i=!0){if(0===t.cameraRigMode||t._renderingMultiview)return t._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(t,void 0,i),void this.onAfterRenderCameraObservable.notifyObservers(t);if(t._useMultiviewToSingleView)this._renderMultiviewToSingleView(t);else{this.onBeforeCameraRenderObservable.notifyObservers(t);for(let i=0;i<t._rigCameras.length;i++)this._renderForCamera(t._rigCameras[i],t)}this._activeCamera=t,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(t)}"_checkIntersections"(){for(let t=0;t<this._meshesForIntersections.length;t++){const i=this._meshesForIntersections.data[t];if(i.actionManager)for(let t=0;i.actionManager&&t<i.actionManager.actions.length;t++){const r=i.actionManager.actions[t];if(12===r.trigger||13===r.trigger){const t=r.getTriggerParameter(),a=t.mesh?t.mesh:t,o=a.intersectsMesh(i,t.usePreciseIntersection),h=i._intersectionsInProgress.indexOf(a);o&&-1===h?12===r.trigger?(r._executeCurrent(ActionEvent.CreateNew(i,void 0,a)),i._intersectionsInProgress.push(a)):13===r.trigger&&i._intersectionsInProgress.push(a):!o&&h>-1&&(13===r.trigger&&r._executeCurrent(ActionEvent.CreateNew(i,void 0,a)),i.actionManager.hasSpecificTrigger(13,t=>{const i=t.mesh?t.mesh:t;return a===i})&&13!==r.trigger||i._intersectionsInProgress.splice(h,1))}}}}"_advancePhysicsEngineStep"(t){}"_animate"(t){}"animate"(){if(this._engine.isDeterministicLockStep()){let t=Math.max(Scene.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Scene.MaxDeltaTime))+this._timeAccumulator;const i=this._engine.getTimeStep(),r=1e3/i/1e3;let a=0;const o=this._engine.getLockstepMaxSteps();let h=Math.floor(t/i);for(h=Math.min(h,o);t>0&&a<h;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=i*r,this._animate(i),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,a++,t-=i;this._timeAccumulator=t<0?0:t}else{const t=this.useConstantAnimationDeltaTime?16:Math.max(Scene.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Scene.MaxDeltaTime));this._animationRatio=.06*t,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t)}}"_clear"(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this._clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}"_checkCameraRenderTarget"(t){if(t?.outputRenderTarget&&!t?.isRigCamera&&(t.outputRenderTarget._cleared=!1),t?.rigCameras?.length)for(let i=0;i<t.rigCameras.length;++i){const r=t.rigCameras[i].outputRenderTarget;r&&(r._cleared=!1)}}"resetDrawCache"(t){if(this.meshes)for(const i of this.meshes)i.resetDrawCache(t)}"_renderWithFrameGraph"(t=!0,i=!1){if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),t)for(const t of this.cameras)if(t.update(),0!==t.cameraRigMode)for(let i=0;i<t._rigCameras.length;i++)t._rigCameras[i].update();for(const t of this._beforeClearStage)t.action();const r=this.getActiveMeshCandidates(),a=r.length;for(let t=0;t<a;t++){const i=r.data[t];i.isBlocked||(this._totalVertices.addCount(i.getTotalVertices(),!1),i.isReady()&&i.isEnabled()&&!i.scaling.hasAZeroComponent&&(i.computeWorldMatrix(),i.actionManager&&i.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(i)))}if(this.particlesEnabled)for(let t=0;t<this.particleSystems.length;t++){const i=this.particleSystems[t];if(!i.isStarted()||!i.emitter)continue;const r=i.emitter;r.position&&!r.isEnabled()||(this._activeParticleSystems.push(i),i.animate())}this.frameGraph?.execute()}"render"(t=!0,i=!1){if(!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),this.activeCameras?.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),i||this.animate();for(const t of this._beforeCameraUpdateStage)t.action();if(t)if(this.activeCameras&&this.activeCameras.length>0)for(let t=0;t<this.activeCameras.length;t++){const i=this.activeCameras[t];if(i.update(),0!==i.cameraRigMode)for(let t=0;t<i._rigCameras.length;t++)i._rigCameras[t].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let t=0;t<this.activeCamera._rigCameras.length;t++)this.activeCamera._rigCameras[t].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(t,i);else{const t=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const i=this.activeCameras?.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){a.w1.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let r=0;r<this.customRenderTargets.length;r++){const a=this.customRenderTargets[r];if(a._shouldRender()){if(this._renderId++,this.activeCamera=a.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");t.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),a.render(i!==this.activeCamera,this.dumpNextRenderTargets)}}a.w1.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=i?.renderPassId??0,this.activeCamera=i,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const t of this._beforeClearStage)t.action();this._clearFrameBuffer(this.activeCamera);for(const t of this._gatherRenderTargetsStage)t.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let t=0;t<this.activeCameras.length;t++)this._processSubCameras(this.activeCameras[t],t>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const t of this._afterRenderStage)t.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let t=0;t<this._toBeDisposed.length;t++){const i=this._toBeDisposed[t];i&&i.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}"freezeMaterials"(){for(let t=0;t<this.materials.length;t++)this.materials[t].freeze()}"unfreezeMaterials"(){for(let t=0;t<this.materials.length;t++)this.materials[t].unfreeze()}"dispose"(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach(t=>{t.onAnimationEndObservable.clear(),t.onAnimationEnd=null}),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const t=this._activeRequests.slice();for(const i of t)i.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(t){z.Y.Error("An error occurred while calling onDisposeObservable!",t)}this.detachControl();if(this._engine.getInputElement())for(let t=0;t<this.cameras.length;t++)this.cameras[t].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,t=>t.dispose(!0)),this._disposeList(this.transformNodes,t=>t.dispose(!0));const i=this.cameras;this._disposeList(i),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let r=this._engine.scenes.indexOf(this);if(r>-1&&this._engine.scenes.splice(r,1),M.l._LastCreatedScene===this){M.l._LastCreatedScene=null;let t=M.l.Instances.length-1;for(;t>=0;){const i=M.l.Instances[t];if(i.scenes.length>0){M.l._LastCreatedScene=i.scenes[this._engine.scenes.length-1];break}t--}}r=this._engine._virtualScenes.indexOf(this),r>-1&&this._engine._virtualScenes.splice(r,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}"_disposeList"(t,i){const r=t.slice(0);i=i??(t=>t.dispose());for(const t of r)i(t);t.length=0}get"isDisposed"(){return this._isDisposed}"clearCachedVertexData"(){for(let t=0;t<this.meshes.length;t++){const i=this.meshes[t].geometry;i&&i.clearCachedData()}}"cleanCachedTextureBuffer"(){for(const t of this.textures){t._buffer&&(t._buffer=null)}}"getWorldExtends"(t){const i=new u.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new u.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t=t||(()=>!0),this.meshes.filter(t).forEach(t=>{if(t.computeWorldMatrix(!0),!t.subMeshes||0===t.subMeshes.length||t.infiniteDistance)return;const a=t.getBoundingInfo(),o=a.boundingBox.minimumWorld,h=a.boundingBox.maximumWorld;u.P.CheckExtends(o,i,r),u.P.CheckExtends(h,i,r)}),{"min":i,"max":r}}"createPickingRay"(t,i,r,a,o=!1){throw(0,b.S)("Ray")}"createPickingRayToRef"(t,i,r,a,o,h=!1,l=!1){throw(0,b.S)("Ray")}"createPickingRayInCameraSpace"(t,i,r){throw(0,b.S)("Ray")}"createPickingRayInCameraSpaceToRef"(t,i,r,a){throw(0,b.S)("Ray")}"pick"(t,i,r,a,o,h){const l=(0,b.S)("Ray",!0);return l&&z.Y.Warn(l),new g.p}"pickWithBoundingInfo"(t,i,r,a,o){const h=(0,b.S)("Ray",!0);return h&&z.Y.Warn(h),new g.p}"pickWithRay"(t,i,r,a){throw(0,b.S)("Ray")}"multiPick"(t,i,r,a,o){throw(0,b.S)("Ray")}"multiPickWithRay"(t,i,r){throw(0,b.S)("Ray")}"setPointerOverMesh"(t,i,r){this._inputManager.setPointerOverMesh(t,i,r)}"getPointerOverMesh"(){return this._inputManager.getPointerOverMesh()}"_rebuildGeometries"(){for(const t of this.geometries)t._rebuild();for(const t of this.meshes)t._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const t of this._components)t.rebuild();for(const t of this.particleSystems)t.rebuild();if(this.spriteManagers)for(const t of this.spriteManagers)t.rebuild()}"_rebuildTextures"(){for(const t of this.textures)t._rebuild(!0);this.markAllMaterialsAsDirty(1)}"_getByTags"(t,i,r){if(void 0===i)return t;const a=[];for(const o in t){const h=t[o];c.$&&c.$.MatchesQuery(h,i)&&(!r||r(h))&&a.push(h)}return a}"getMeshesByTags"(t,i){return this._getByTags(this.meshes,t,i)}"getCamerasByTags"(t,i){return this._getByTags(this.cameras,t,i)}"getLightsByTags"(t,i){return this._getByTags(this.lights,t,i)}"getMaterialByTags"(t,i){return this._getByTags(this.materials,t,i).concat(this._getByTags(this.multiMaterials,t,i))}"getTransformNodesByTags"(t,i){return this._getByTags(this.transformNodes,t,i)}"setRenderingOrder"(t,i=null,r=null,a=null){this._renderingManager.setRenderingOrder(t,i,r,a)}"setRenderingAutoClearDepthStencil"(t,i,r=!0,a=!0){this._renderingManager.setRenderingAutoClearDepthStencil(t,i,r,a)}"getAutoClearDepthStencilSetup"(t){return this._renderingManager.getAutoClearDepthStencilSetup(t)}"_forceBlockMaterialDirtyMechanism"(t){this._blockMaterialDirtyMechanism=t}get"blockMaterialDirtyMechanism"(){return this._blockMaterialDirtyMechanism}set"blockMaterialDirtyMechanism"(t){this._blockMaterialDirtyMechanism!==t&&(this._blockMaterialDirtyMechanism=t,t||this.markAllMaterialsAsDirty(127))}"markAllMaterialsAsDirty"(t,i){if(!this._blockMaterialDirtyMechanism)for(const r of this.materials)i&&!i(r)||r.markAsDirty(t)}"_loadFile"(t,i,r,a,o,h,l){const c=(0,U.vP)(t,i,r,a?this.offlineProvider:void 0,o,h,l);return this._activeRequests.push(c),c.onCompleteObservable.add(t=>{this._activeRequests.splice(this._activeRequests.indexOf(t),1)}),c}"_loadFileAsync"(t,i,r,a,o){return new Promise((h,l)=>{this._loadFile(t,t=>{h(t)},i,r,a,(t,i)=>{l(i)},o)})}"_requestFile"(t,i,r,a,o,h,l){const c=(0,U.FV)(t,i,r,a?this.offlineProvider:void 0,o,h,l);return this._activeRequests.push(c),c.onCompleteObservable.add(t=>{this._activeRequests.splice(this._activeRequests.indexOf(t),1)}),c}"_requestFileAsync"(t,i,r,a,o){return new Promise((h,l)=>{this._requestFile(t,t=>{h(t)},i,r,a,t=>{l(t)},o)})}"_readFile"(t,i,r,a,o){const h=(0,U.Ip)(t,i,r,a,o);return this._activeRequests.push(h),h.onCompleteObservable.add(t=>{this._activeRequests.splice(this._activeRequests.indexOf(t),1)}),h}"_readFileAsync"(t,i,r){return new Promise((a,o)=>{this._readFile(t,t=>{a(t)},i,r,t=>{o(t)})})}"getPerfCollector"(){throw(0,b.S)("performanceViewerSceneExtension")}"setActiveCameraByID"(t){return this.setActiveCameraById(t)}"getMaterialByID"(t){return this.getMaterialById(t)}"getLastMaterialByID"(t){return this.getLastMaterialById(t)}"getTextureByUniqueID"(t){return this.getTextureByUniqueId(t)}"getCameraByID"(t){return this.getCameraById(t)}"getCameraByUniqueID"(t){return this.getCameraByUniqueId(t)}"getBoneByID"(t){return this.getBoneById(t)}"getLightByID"(t){return this.getLightById(t)}"getLightByUniqueID"(t){return this.getLightByUniqueId(t)}"getParticleSystemByID"(t){return this.getParticleSystemById(t)}"getGeometryByID"(t){return this.getGeometryById(t)}"getMeshByID"(t){return this.getMeshById(t)}"getMeshByUniqueID"(t){return this.getMeshByUniqueId(t)}"getLastMeshByID"(t){return this.getLastMeshById(t)}"getMeshesByID"(t){return this.getMeshesById(t)}"getTransformNodeByID"(t){return this.getTransformNodeById(t)}"getTransformNodeByUniqueID"(t){return this.getTransformNodeByUniqueId(t)}"getTransformNodesByID"(t){return this.getTransformNodesById(t)}"getNodeByID"(t){return this.getNodeById(t)}"getLastEntryByID"(t){return this.getLastEntryById(t)}"getLastSkeletonByID"(t){return this.getLastSkeletonById(t)}}Scene.FOGMODE_NONE=0,Scene.FOGMODE_EXP=1,Scene.FOGMODE_EXP2=2,Scene.FOGMODE_LINEAR=3,Scene.MinDeltaTime=1,Scene.MaxDeltaTime=1e3,Scene._OriginalDefaultMaterialFactory=Scene.DefaultMaterialFactory,(0,W.H7)("BABYLON.Scene",Scene)},"4559":function(t,i,r){r.d(i,{"H":function(){return Stage},"l":function(){return SceneComponentConstants}});class SceneComponentConstants{}SceneComponentConstants.NAME_EFFECTLAYER="EffectLayer",SceneComponentConstants.NAME_LAYER="Layer",SceneComponentConstants.NAME_LENSFLARESYSTEM="LensFlareSystem",SceneComponentConstants.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",SceneComponentConstants.NAME_PARTICLESYSTEM="ParticleSystem",SceneComponentConstants.NAME_GAMEPAD="Gamepad",SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",SceneComponentConstants.NAME_PREPASSRENDERER="PrePassRenderer",SceneComponentConstants.NAME_DEPTHRENDERER="DepthRenderer",SceneComponentConstants.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",SceneComponentConstants.NAME_SPRITE="Sprite",SceneComponentConstants.NAME_SUBSURFACE="SubSurface",SceneComponentConstants.NAME_OUTLINERENDERER="Outline",SceneComponentConstants.NAME_PROCEDURALTEXTURE="ProceduralTexture",SceneComponentConstants.NAME_SHADOWGENERATOR="ShadowGenerator",SceneComponentConstants.NAME_OCTREE="Octree",SceneComponentConstants.NAME_PHYSICSENGINE="PhysicsEngine",SceneComponentConstants.NAME_AUDIO="Audio",SceneComponentConstants.NAME_FLUIDRENDERER="FluidRenderer",SceneComponentConstants.NAME_IBLCDFGENERATOR="iblCDFGenerator",SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER=0,SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,SceneComponentConstants.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,SceneComponentConstants.STEP_BEFORECAMERADRAW_PREPASS=0,SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER=2,SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_LAYER=1,SceneComponentConstants.STEP_BEFORERENDERINGMESH_PREPASS=0,SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE=1,SceneComponentConstants.STEP_AFTERRENDERINGMESH_PREPASS=0,SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE=1,SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,SceneComponentConstants.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,SceneComponentConstants.STEP_BEFORECLEAR_PREPASS=1,SceneComponentConstants.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,SceneComponentConstants.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,SceneComponentConstants.STEP_AFTERRENDERTARGETDRAW_LAYER=1,SceneComponentConstants.STEP_AFTERCAMERADRAW_PREPASS=0,SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER=4,SceneComponentConstants.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,SceneComponentConstants.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,SceneComponentConstants.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,SceneComponentConstants.STEP_AFTERRENDER_AUDIO=0,SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,SceneComponentConstants.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,SceneComponentConstants.STEP_POINTERMOVE_SPRITE=0,SceneComponentConstants.STEP_POINTERDOWN_SPRITE=0,SceneComponentConstants.STEP_POINTERUP_SPRITE=0;class Stage extends Array{"constructor"(t){super(...t)}static"Create"(){return Object.create(Stage.prototype)}"registerStep"(t,i,r){let a=0,o=Number.MAX_VALUE;for(;a<this.length;a++){if(o=this[a].index,t<o)break}this.splice(a,0,{"index":t,"component":i,"action":r.bind(i)})}"clear"(){this.length=0}}},"1069":function(t,i,r){r.d(i,{"gn":function(){return __decorate}});function __decorate(t,i,r,a){var o,h=arguments.length,l=h<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,r,a);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(l=(h<3?o(l):h>3?o(i,r,l):o(i,r))||l);return h>3&&l&&Object.defineProperty(i,r,l),l}Object.create;Object.create}}]);