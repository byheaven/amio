"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[597],{"5597":function(e,n,l){l.r(n),l.d(n,{"_IESTextureLoader":function(){return _IESTextureLoader}});var a=l(7143);function lineToArray(e){return e.split(" ").filter(e=>""!==e).map(e=>parseFloat(e))}function readArray(e,n,l){for(;l.length!==n;){const n=lineToArray(e.lines[e.index++]);l.push(...n)}}function interpolateCandelaValues(e,n,l){let r=0,t=0,o=0,i=0,s=0,u=0;for(let n=0;n<e.numberOfHorizontalAngles-1;n++)if(l<e.horizontalAngles[n+1]||n===e.numberOfHorizontalAngles-2){t=n,o=e.horizontalAngles[n],i=e.horizontalAngles[n+1];break}for(let l=0;l<e.numberOfVerticalAngles-1;l++)if(n<e.verticalAngles[l+1]||l===e.numberOfVerticalAngles-2){r=l,s=e.verticalAngles[l],u=e.verticalAngles[l+1];break}const c=i-o,f=u-s;if(0===f)return 0;const d=0===c?0:(l-o)/c,g=(n-s)/f,A=0===c?t:t+1,b=(0,a.EH)(e.candelaValues[t][r],e.candelaValues[A][r],d),h=(0,a.EH)(e.candelaValues[t][r+1],e.candelaValues[A][r+1],d);return(0,a.EH)(b,h,g)}class _IESTextureLoader{"constructor"(){this.supportCascades=!1}"loadCubeData"(){throw".ies not supported in Cube."}"loadData"(e,n,l){const a=function LoadIESData(e){const n={"lines":new TextDecoder("utf-8").decode(e).split("\n"),"index":0},l={"version":n.lines[0],"candelaValues":[],"horizontalAngles":[],"verticalAngles":[],"numberOfHorizontalAngles":0,"numberOfVerticalAngles":0};for(n.index=1;n.lines.length>0&&!n.lines[n.index].includes("TILT=");)n.index++;n.lines[n.index].includes("INCLUDE"),n.index++;const a=lineToArray(n.lines[n.index++]);l.numberOfLights=a[0],l.lumensPerLamp=a[1],l.candelaMultiplier=a[2],l.numberOfVerticalAngles=a[3],l.numberOfHorizontalAngles=a[4],l.photometricType=a[5],l.unitsType=a[6],l.width=a[7],l.length=a[8],l.height=a[9];const r=lineToArray(n.lines[n.index++]);l.ballastFactor=r[0],l.fileGenerationType=r[1],l.inputWatts=r[2];for(let e=0;e<l.numberOfHorizontalAngles;e++)l.candelaValues[e]=[];readArray(n,l.numberOfVerticalAngles,l.verticalAngles),readArray(n,l.numberOfHorizontalAngles,l.horizontalAngles);for(let e=0;e<l.numberOfHorizontalAngles;e++)readArray(n,l.numberOfVerticalAngles,l.candelaValues[e]);let t=-1;for(let e=0;e<l.numberOfHorizontalAngles;e++)for(let n=0;n<l.numberOfVerticalAngles;n++)l.candelaValues[e][n]*=l.candelaValues[e][n]*l.candelaMultiplier*l.ballastFactor*l.fileGenerationType,t=Math.max(t,l.candelaValues[e][n]);if(t>0)for(let e=0;e<l.numberOfHorizontalAngles;e++)for(let n=0;n<l.numberOfVerticalAngles;n++)l.candelaValues[e][n]/=t;const o=180,i=360,s=new Float32Array(64800),u=l.horizontalAngles[0],c=l.horizontalAngles[l.numberOfHorizontalAngles-1];for(let e=0;e<64800;e++){let n=e%i;const a=Math.floor(e/i);c-u!==0&&(n<u||n>=c)&&(n%=2*c,n>c&&(n=2*c-n)),s[a+n*o]=interpolateCandelaValues(l,a,n)}return{"width":180,"height":1,"data":s}}(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));l(a.width,a.height,!1,!1,()=>{const e=n.getEngine();n.type=1,n.format=6,n._gammaSpace=!1,e._uploadDataToTextureDirectly(n,a.data)})}}}}]);