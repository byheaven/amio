"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[941],{"6941":function(e,t,a){a.r(t),a.d(t,{"_HDRTextureLoader":function(){return _HDRTextureLoader}});var r=a(5412);class PanoramaToCubeMapTools{static"ConvertPanoramaToCubemap"(e,t,a,r,n=!1){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=t*a*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{"front":this.CreateCubemapTexture(r,this.FACE_FRONT,e,t,a,n),"back":this.CreateCubemapTexture(r,this.FACE_BACK,e,t,a,n),"left":this.CreateCubemapTexture(r,this.FACE_LEFT,e,t,a,n),"right":this.CreateCubemapTexture(r,this.FACE_RIGHT,e,t,a,n),"up":this.CreateCubemapTexture(r,this.FACE_UP,e,t,a,n),"down":this.CreateCubemapTexture(r,this.FACE_DOWN,e,t,a,n),"size":r,"type":1,"format":4,"gammaSpace":!1}}static"CreateCubemapTexture"(e,t,a,r,n,o=!1){const i=new ArrayBuffer(e*e*4*3),h=new Float32Array(i),s=o?Math.max(1,Math.round(r/4/e)):1,u=1/s,l=u*u,d=t[1].subtract(t[0]).scale(u/e),w=t[3].subtract(t[2]).scale(u/e),f=1/e;let c=0;for(let o=0;o<e;o++)for(let i=0;i<s;i++){let i=t[0],P=t[2];for(let t=0;t<e;t++)for(let u=0;u<s;u++){const s=P.subtract(i).scale(c).add(i);s.normalize();const u=this.CalcProjectionSpherical(s,a,r,n);h[o*e*3+3*t+0]+=u.r*l,h[o*e*3+3*t+1]+=u.g*l,h[o*e*3+3*t+2]+=u.b*l,i=i.add(d),P=P.add(w)}c+=f*u}return h}static"CalcProjectionSpherical"(e,t,a,r){let n=Math.atan2(e.z,e.x);const o=Math.acos(e.y);for(;n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;let i=n/Math.PI;const h=o/Math.PI;i=.5*i+.5;let s=Math.round(i*a);s<0?s=0:s>=a&&(s=a-1);let u=Math.round(h*r);u<0?u=0:u>=r&&(u=r-1);const l=r-u-1;return{"r":t[l*a*3+3*s+0],"g":t[l*a*3+3*s+1],"b":t[l*a*3+3*s+2]}}}function rgbe2float(e,t,a,r,n,o){n>0?(n=function ldexp(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)}(1,n-136),e[o+0]=t*n,e[o+1]=a*n,e[o+2]=r*n):(e[o+0]=0,e[o+1]=0,e[o+2]=0)}function readStringLine(e,t){let a="",r="";for(let n=t;n<e.length-t&&(r=String.fromCharCode(e[n]),"\n"!=r);n++)a+=r;return a}function RGBE_ReadHeader(e){let t=0,a=0,r=readStringLine(e,0);if("#"!=r[0]||"?"!=r[1])throw"Bad HDR Format.";let n=!1,o=!1,i=0;do{i+=r.length+1,r=readStringLine(e,i),"FORMAT=32-bit_rle_rgbe"==r?o=!0:0==r.length&&(n=!0)}while(!n);if(!o)throw"HDR Bad header format, unsupported FORMAT";i+=r.length+1,r=readStringLine(e,i);const h=/^-Y (.*) \+X (.*)$/g.exec(r);if(!h||h.length<3)throw"HDR Bad header format, no size";if(a=parseInt(h[2]),t=parseInt(h[1]),a<8||a>32767)throw"HDR Bad header format, unsupported size";return i+=r.length+1,{"height":t,"width":a,"dataPosition":i}}function RGBE_ReadPixels(e,t){return function readRGBEPixelsRLE(e,t){let a=t.height;const r=t.width;let n,o,i,h,s,u=t.dataPosition,l=0,d=0,w=0;const f=new ArrayBuffer(4*r),c=new Uint8Array(f),P=new ArrayBuffer(t.width*t.height*4*3),p=new Float32Array(P);for(;a>0;){if(n=e[u++],o=e[u++],i=e[u++],h=e[u++],2!=n||2!=o||128&i||t.width<8||t.width>32767)return readRGBEPixelsNotRLE(e,t);if((i<<8|h)!=r)throw"HDR Bad header format, wrong scan line width";for(l=0,w=0;w<4;w++)for(d=(w+1)*r;l<d;)if(n=e[u++],o=e[u++],n>128){if(s=n-128,0==s||s>d-l)throw"HDR Bad Format, bad scanline data (run)";for(;s-- >0;)c[l++]=o}else{if(s=n,0==s||s>d-l)throw"HDR Bad Format, bad scanline data (non-run)";if(c[l++]=o,--s>0)for(let t=0;t<s;t++)c[l++]=e[u++]}for(w=0;w<r;w++)n=c[w],o=c[w+r],i=c[w+2*r],h=c[w+3*r],rgbe2float(p,n,o,i,h,(t.height-a)*r*3+3*w);a--}return p}(e,t)}function readRGBEPixelsNotRLE(e,t){let a=t.height;const r=t.width;let n,o,i,h,s,u=t.dataPosition;const l=new ArrayBuffer(t.width*t.height*4*3),d=new Float32Array(l);for(;a>0;){for(s=0;s<t.width;s++)n=e[u++],o=e[u++],i=e[u++],h=e[u++],rgbe2float(d,n,o,i,h,(t.height-a)*r*3+3*s);a--}return d}PanoramaToCubeMapTools.FACE_LEFT=[new r.P(-1,-1,-1),new r.P(1,-1,-1),new r.P(-1,1,-1),new r.P(1,1,-1)],PanoramaToCubeMapTools.FACE_RIGHT=[new r.P(1,-1,1),new r.P(-1,-1,1),new r.P(1,1,1),new r.P(-1,1,1)],PanoramaToCubeMapTools.FACE_FRONT=[new r.P(1,-1,-1),new r.P(1,-1,1),new r.P(1,1,-1),new r.P(1,1,1)],PanoramaToCubeMapTools.FACE_BACK=[new r.P(-1,-1,1),new r.P(-1,-1,-1),new r.P(-1,1,1),new r.P(-1,1,-1)],PanoramaToCubeMapTools.FACE_DOWN=[new r.P(1,1,-1),new r.P(1,1,1),new r.P(-1,1,-1),new r.P(-1,1,1)],PanoramaToCubeMapTools.FACE_UP=[new r.P(-1,-1,-1),new r.P(-1,-1,1),new r.P(1,-1,-1),new r.P(1,-1,1)];class _HDRTextureLoader{"constructor"(){this.supportCascades=!1}"loadCubeData"(){throw".hdr not supported in Cube."}"loadData"(e,t,a){const r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=RGBE_ReadHeader(r),o=RGBE_ReadPixels(r,n),i=n.width*n.height,h=new Float32Array(4*i);for(let e=0;e<i;e+=1)h[4*e]=o[3*e],h[4*e+1]=o[3*e+1],h[4*e+2]=o[3*e+2],h[4*e+3]=1;a(n.width,n.height,t.generateMipMaps,!1,()=>{const e=t.getEngine();t.type=1,t.format=5,t._gammaSpace=!1,e._uploadDataToTextureDirectly(t,h)})}}}}]);