"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[4],{"7477":function(t,a,r){r.d(a,{"Z":function(){return c}});r(7294);var o=r(3970),l=r(3499),i=r(5893),c=function PlanetView(t){var a=t.progress,r=t.size,c=void 0===r?"medium":r,u=t.showLabel,d=void 0===u||u,m=t.animated,h=void 0===m||m,v=t.onClick,p=(0,l.NU)(a),g="planet--".concat(c),x="planet--".concat(p),y=h?"planet--animated":"";return(0,i.jsxs)(o.G7,{"className":"planet-container ".concat(g),"onClick":v,"style":{"cursor":v?"pointer":"default"},"children":[(0,i.jsxs)(o.G7,{"className":"planet ".concat(x," ").concat(y),"children":[(0,i.jsxs)(o.G7,{"className":"planet__surface","children":["desolate"===p&&(0,i.jsx)(o.G7,{"className":"planet__cracks"}),("sprout"===p||"construction"===p)&&(0,i.jsx)(o.G7,{"className":"planet__vegetation"}),("prosperity"===p||"launch"===p||"landing"===p)&&(0,i.jsx)(o.G7,{"className":"planet__cities"}),("launch"===p||"landing"===p)&&(0,i.jsx)(o.G7,{"className":"planet__ring"})]}),(0,i.jsx)(o.G7,{"className":"planet__glow"}),h&&(0,i.jsxs)(i.Fragment,{"children":[(0,i.jsx)(o.G7,{"className":"planet__pulse"}),(0,i.jsxs)(o.G7,{"className":"planet__ai-bots","children":[(0,i.jsx)(o.G7,{"className":"ai-bot ai-bot--1"}),(0,i.jsx)(o.G7,{"className":"ai-bot ai-bot--2"}),(0,i.jsx)(o.G7,{"className":"ai-bot ai-bot--3"})]})]})]}),d&&(0,i.jsxs)(o.G7,{"className":"planet-label","children":[(0,i.jsx)(o.xv,{"className":"planet-label__name","children":"È≤®‰πãÊòü"}),(0,i.jsxs)(o.xv,{"className":"planet-label__stage","children":["¬∑ Â∑≤ËãèÈÜí ",a.toFixed(1),"%"]})]})]})}},"2937":function(t,a,r){r.d(a,{"d":function(){return p}});var o=r(5671),l=r(3144),i=r(4942),c=r(5961),u=new(function(){return(0,l.Z)(function ChestRatingEngine(){(0,o.Z)(this,ChestRatingEngine)},[{"key":"rate","value":function rate(t,a){return t.efficiencyScore>=a.diamond.minEfficiencyScore&&t.toolsUsed<=a.diamond.maxToolsUsed?"diamond":t.efficiencyScore>=a.gold.minEfficiencyScore&&t.toolsUsed<=a.gold.maxToolsUsed?"gold":t.efficiencyScore>=a.silver.minEfficiencyScore&&t.toolsUsed<=a.silver.maxToolsUsed?"silver":"bronze"}}])}()),d=r(9366),m=new(function(){return(0,l.Z)(function GameScheduler(){(0,o.Z)(this,GameScheduler)},[{"key":"getTodayGameType","value":function getTodayGameType(t,a){return Math.floor(new Date("".concat(a,"T00:00:00")).getTime()/864e5)%2==0?"3tiles":"sudoku"}},{"key":"getStorageKey","value":function getStorageKey(){return"amio_game_scheduler_v1"}}])}()),h=r(3311),v=r(9874),p=function(){return(0,l.Z)(function GameEngine(){(0,o.Z)(this,GameEngine),(0,i.Z)(this,"activePlugin",null),(0,i.Z)(this,"activeState",null),(0,i.Z)(this,"mode","normal"),(0,i.Z)(this,"userId","local-user"),(0,i.Z)(this,"date","")},[{"key":"getTodayGame","value":function getTodayGame(t,a){var r=m.getTodayGameType(t,a);return d.O.get(r)}},{"key":"setGame","value":function setGame(t){this.activePlugin=d.O.get(t)}},{"key":"startGame","value":function startGame(t){if(!this.activePlugin){var a=this.getTodayGame(t.userId||"local-user",t.date);this.activePlugin=a}return this.mode=t.mode,this.userId=t.userId||"local-user",this.date=t.date,this.activeState=this.activePlugin.initGame(t),this.activeState}},{"key":"dispatch","value":function dispatch(t){if(!this.activePlugin||!this.activeState)throw new Error("Game is not started");return this.activeState=this.activePlugin.handleAction(this.activeState,t),this.activeState}},{"key":"useTool","value":function useTool(t){if(!this.activePlugin||!this.activeState)throw new Error("Game is not started");return this.activeState=this.activePlugin.useTool(this.activeState,t),this.activeState}},{"key":"getStatus","value":function getStatus(){return this.activePlugin&&this.activeState?this.activePlugin.getStatus(this.activeState):"idle"}},{"key":"getState","value":function getState(){return this.activeState}},{"key":"enterSettlement","value":function enterSettlement(t){if(!this.activePlugin||!this.activeState)throw new Error("Game is not started");var a=this.activePlugin.getPerformance(this.activeState);return{"result":t,"chestLevel":u.rate(a,this.activePlugin.ratingConfig),"performance":a}}},{"key":"onGameEnd","value":function onGameEnd(t){var a=this.enterSettlement(t);return h.J.append({"userId":this.userId,"date":this.date,"gameType":t.gameId,"mode":this.mode,"result":t.status,"attempts":t.attempts,"durationSeconds":t.durationSeconds,"toolsUsed":t.toolsUsed,"chestLevel":a.chestLevel,"heroAttempted":t.heroAttempted,"heroResult":t.heroResult,"feedback":t.feedback}),t.feedback&&v.u.save({"userId":this.userId,"date":this.date,"gameType":t.gameId,"feedback":t.feedback}),a}},{"key":"getChestLevelAsEnum","value":function getChestLevelAsEnum(t){return function mapChestLevel(t){switch(t){case"diamond":return c.q2.DIAMOND;case"gold":return c.q2.GOLD;case"silver":return c.q2.SILVER;default:return c.q2.BRONZE}}(t)}}])}();new p},"9366":function(t,a,r){r.d(a,{"O":function(){return c}});var o=r(5671),l=r(3144),i=r(4942),c=new(function(){return(0,l.Z)(function GameRegistry(){(0,o.Z)(this,GameRegistry),(0,i.Z)(this,"plugins",new Map)},[{"key":"register","value":function register(t){this.plugins.set(t.id,t)}},{"key":"get","value":function get(t){var a=this.plugins.get(t);if(!a)throw new Error("Game plugin not found: ".concat(t));return a}},{"key":"list","value":function list(){return Array.from(this.plugins.values())}}])}())},"1024":function(t,a,r){r.d(a,{"Z":function(){return g}});r(7294);var o=r(3970),l=r(6107),i=r(5893),c=function Tile(t){var a=t.data,r=t.onClick,c=t.width,u=void 0===c?60:c,d=t.height,m=void 0===d?66:d,h=a.type,v=a.isClickable,p=(0,l.a2)(h);return(0,i.jsx)(o.G7,{"className":"tile ".concat(v?"":"disabled"),"style":{"width":"".concat(u,"px"),"height":"".concat(m,"px")},"onClick":function handleClick(){v&&r(a)},"children":p?(0,i.jsx)(o.G7,{"className":"icon-container","dangerouslySetInnerHTML":{"__html":p}}):(0,i.jsx)(o.xv,{"className":"content","children":h})})},u=function Board(t){var a=t.tiles,r=t.onTileClick;return(0,i.jsx)(o.G7,{"className":"board","children":(0,i.jsx)(o.G7,{"className":"board-container","children":(0,i.jsx)(o.G7,{"className":"tiles-area","children":a.map(function(t){return(0,i.jsx)(o.G7,{"className":"tile-wrapper","style":{"left":"".concat(36*t.x,"px"),"top":"".concat(32*t.y,"px"),"zIndex":t.layer},"children":(0,i.jsx)(c,{"data":t,"onClick":r,"width":40,"height":44})},t.id)})})})})},d=r(1413),m=r(5961),h=function Slot(t){var a=t.tiles,r=Array(m.j$).fill(null).map(function(t,r){return a[r]||null});return(0,i.jsx)(o.G7,{"className":"slot-bar","children":r.map(function(t,a){return(0,i.jsx)(o.G7,{"className":"slot-cell","children":t&&(0,i.jsx)(c,{"data":(0,d.Z)((0,d.Z)({},t),{},{"isClickable":!1}),"onClick":function onClick(){},"width":32,"height":36})},"slot-".concat(a))})})},v=function TempSlot(t){var a=t.stacks,r=t.onStackClick;return a.some(function(t){return t.length>0})?(0,i.jsx)(o.G7,{"className":"temp-slot","children":a.map(function(t,a){return(0,i.jsxs)(o.G7,{"className":"temp-position","onClick":function onClick(){return t.length>0&&r(a)},"children":[t.map(function(a,r){return(0,i.jsx)(o.G7,{"className":"stacked-tile","style":{"zIndex":r,"transform":"translate(-50%, calc(-50% - ".concat(4*r,"px))")},"children":(0,i.jsx)(c,{"data":(0,d.Z)((0,d.Z)({},a),{},{"isClickable":r===t.length-1}),"onClick":function onClick(){},"width":32,"height":36})},a.id)}),0===t.length&&(0,i.jsx)(o.G7,{"className":"empty-slot"})]},a)})}):null},p=function ToolBar(t){var a=t.onUndo,r=t.onShuffle,c=t.onRemove,u=t.undoDisabled,d=void 0!==u&&u,m=t.shuffleDisabled,h=void 0!==m&&m,v=t.removeDisabled,p=void 0!==v&&v,g=(0,l.Hi)();return(0,i.jsxs)(o.G7,{"className":"tool-bar","children":[(0,i.jsxs)(o.G7,{"className":"tool-btn ".concat(d?"disabled":""),"onClick":d?void 0:a,"children":[(0,i.jsx)(o.G7,{"className":"tool-icon","dangerouslySetInnerHTML":{"__html":g.undo}}),(0,i.jsx)(o.xv,{"className":"tool-name","children":"Êí§Âõû"}),(0,i.jsx)(o.xv,{"className":"tool-count","children":d?"0/1":"1/1"})]}),(0,i.jsxs)(o.G7,{"className":"tool-btn ".concat(p?"disabled":""),"onClick":p?void 0:c,"children":[(0,i.jsx)(o.G7,{"className":"tool-icon","dangerouslySetInnerHTML":{"__html":g.pop}}),(0,i.jsx)(o.xv,{"className":"tool-name","children":"ÁßªÂá∫"}),(0,i.jsx)(o.xv,{"className":"tool-count","children":p?"0/1":"1/1"})]}),(0,i.jsxs)(o.G7,{"className":"tool-btn ".concat(h?"disabled":""),"onClick":h?void 0:r,"children":[(0,i.jsx)(o.G7,{"className":"tool-icon","dangerouslySetInnerHTML":{"__html":g.shuffle}}),(0,i.jsx)(o.xv,{"className":"tool-name","children":"Ê¥óÁâå"}),(0,i.jsx)(o.xv,{"className":"tool-count","children":h?"0/1":"1/1"})]})]})},g=function ThreeTilesGameComponent(t){var a=t.state,r=t.onAction,o=t.onUseTool;return(0,i.jsxs)(i.Fragment,{"children":[(0,i.jsx)(u,{"tiles":a.boardTiles,"onTileClick":function onTileClick(t){return r({"type":"tile_click","payload":{"tileId":t.id}})}}),(0,i.jsx)(v,{"stacks":a.tempStacks,"onStackClick":function onStackClick(t){return r({"type":"return_temp","payload":{"positionIndex":t}})}}),(0,i.jsx)(h,{"tiles":a.slotTiles}),(0,i.jsx)(p,{"onUndo":function onUndo(){return o("undo")},"onShuffle":function onShuffle(){return o("shuffle")},"onRemove":function onRemove(){return o("pop")},"undoDisabled":a.undoUsed,"shuffleDisabled":a.shuffleUsed,"removeDisabled":a.popUsed})]})}},"4568":function(t,a,r){r.d(a,{"b":function(){return Q}});var o=r(9366),l=r(2982),i=r(1413),c=r(5961),u=function isTileBlocked(t,a){return a.some(function(a){if(a.id===t.id)return!1;if(a.layer<=t.layer)return!1;var r=Math.abs(a.x-t.x)<2,o=Math.abs(a.y-t.y)<2;return r&&o})},d=function updateClickableStatus(t){return t.map(function(a){return(0,i.Z)((0,i.Z)({},a),{},{"isClickable":!u(a,t)})})},m=function checkMatch(t){var a={};t.forEach(function(t){a[t.type]=(a[t.type]||0)+1});var r=Object.keys(a).find(function(t){return a[t]>=3});if(r){var o=0;return{"newSlots":t.filter(function(t){return!(t.type===r&&o<3)||(o++,!1)}),"matched":!0}}return{"newSlots":t,"matched":!1}},h=function getDailyLayoutSeed(){var t=new Date;return function hashString(t){for(var a=0,r=0;r<t.length;r++)a=(a<<5)-a+t.charCodeAt(r),a&=a;return Math.abs(a)}("".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")))},v=function generateDailyLayout(t){for(var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:75,r=function createSeededRandom(t){var a=t;return function(){return(a=1103515245*a+12345&2147483647)/2147483647}}(t),o=[],l=0;l<a;l++)o.push({"x":Math.floor(9*r()),"y":Math.floor(12*r()),"layer":Math.floor(6*r())});return o.sort(function(t,a){return t.layer-a.layer}),o},p=function assignRandomTileTypes(t){for(var a=Object.values(c.YU),r=Math.floor(t.length/3),o=[],l=0;l<r;l++){var i=a[Math.floor(Math.random()*a.length)];o.push(i,i,i)}for(var u=o.length-1;u>0;u--){var m=Math.floor(Math.random()*(u+1)),h=[o[m],o[u]];o[u]=h[0],o[m]=h[1]}var v=t.map(function(t,a){return{"id":"tile-".concat(a),"type":o[a]||c.YU.STAR,"x":t.x,"y":t.y,"layer":t.layer,"isClickable":!0}});return d(v)},g=function generateHeroLevel(t){var a=function generateHeroLayout(t){for(var a=function createSeededRandom(t){var a=t;return function(){return(a=1103515245*a+12345&2147483647)/2147483647}}(t+1e3),r=[],o=0;o<150;o++)r.push({"x":Math.floor(9*a()),"y":Math.floor(12*a()),"layer":Math.floor(8*a())});return r.sort(function(t,a){return t.layer-a.layer}),r}(t);return function assignHeroTileTypes(t){for(var a=Object.values(c.YU),r=[].concat(a),o=Math.floor(t.length/3),l=[],i=0;i<o;i++){var u=r[Math.floor(Math.random()*r.length)];l.push(u,u,u)}for(var m=l.length-1;m>0;m--){var h=Math.floor(Math.random()*(m+1)),v=[l[h],l[m]];l[m]=v[0],l[h]=v[1]}var p=t.map(function(t,a){return{"id":"hero-tile-".concat(a),"type":l[a]||c.YU.STAR,"x":t.x,"y":t.y,"layer":t.layer,"isClickable":!0}});return d(p)}(a)},x=function shuffleBoard(t){for(var a=t.map(function(t){return{"x":t.x,"y":t.y,"layer":t.layer}}),r=(0,l.Z)(a),o=r.length-1;o>0;o--){var c=Math.floor(Math.random()*(o+1)),u=[r[c],r[o]];r[o]=u[0],r[c]=u[1]}var m=t.map(function(t,a){return(0,i.Z)((0,i.Z)({},t),{},{"x":r[a].x,"y":r[a].y,"layer":r[a].layer})});return d(m)},y=r(6891),k=function applyWinOrLossState(t){return function isCleared(t){var a=t.tempStacks.reduce(function(t,a){return t+a.length},0);return 0===t.boardTiles.length&&0===t.slotTiles.length&&0===a}(t)?(0,i.Z)((0,i.Z)({},t),{},{"status":"cleared","endedAt":Date.now()}):t.slotTiles.length>=7?(0,i.Z)((0,i.Z)({},t),{},{"status":"failed","endedAt":Date.now()}):t},b=function handleReturnFromTemp(t,a){var r=function returnTileFromTempStack(t,a,r,o){if(a.length>=o)return{"newSlot":a,"newTempStacks":r,"success":!1};if(t<0||t>=r.length)return{"newSlot":a,"newTempStacks":r,"success":!1};if(0===r[t].length)return{"newSlot":a,"newTempStacks":r,"success":!1};var i=r.map(function(t){return(0,l.Z)(t)}),c=i[t].pop();return{"newSlot":[].concat((0,l.Z)(a),[c]),"newTempStacks":i,"success":!0}}(a,t.slotTiles,t.tempStacks,7),o=r.newSlot,c=r.newTempStacks;if(!r.success)return t;var u=m(o).newSlots;return k((0,i.Z)((0,i.Z)({},t),{},{"slotTiles":u,"tempStacks":c}))},S=function addToolUsage(t){return(0,i.Z)((0,i.Z)({},t),{},{"toolsUsed":t.toolsUsed+1})},C=function mapChestToScore(t){switch(t){case c.q2.DIAMOND:return 100;case c.q2.GOLD:return 80;case c.q2.SILVER:return 60;default:return 30}},j={"enabled":!0,"mode":"hero","description":"Hard mode with denser stacks and one chance to maximize chest upgrade."},T=(r(7294),r(3970)),N=r(5893),_={"id":"3tiles","meta":{"id":"3tiles","narrativeName":"Three Tiles","narrativeDesc":"Match three tiles and clear all stacks.","icon":"üÄÑÔ∏è","thumbnailComponent":function ThreeTilesThumbnail(){return(0,N.jsx)(T.G7,{"children":(0,N.jsx)(T.xv,{"children":"üÄÑÔ∏è 3-Tiles"})})},"energyReward":120},"ratingConfig":{"diamond":{"minEfficiencyScore":95,"maxToolsUsed":0},"gold":{"minEfficiencyScore":75,"maxToolsUsed":1},"silver":{"minEfficiencyScore":50,"maxToolsUsed":3}},"initGame":function initThreeTilesState(t){var a,r=Date.now(),o=null!==(a=t.seed)&&void 0!==a?a:h();if("hero"===t.mode)return{"gameId":"3tiles","mode":"hero","status":"playing","startedAt":r,"attempts":1,"toolsUsed":0,"boardTiles":g(o),"slotTiles":[],"tempStacks":[[],[],[]],"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"dailySeed":o,"dailyLayout":[]};var l=function createNormalTiles(t){var a=v(t,75);return{"layout":a,"tiles":p(a)}}(o),i=l.layout;return{"gameId":"3tiles","mode":"normal","status":"playing","startedAt":r,"attempts":1,"toolsUsed":0,"boardTiles":l.tiles,"slotTiles":[],"tempStacks":[[],[],[]],"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"dailySeed":o,"dailyLayout":i}},"handleAction":function handleThreeTilesAction(t,a){switch(a.type){case"tile_click":var r,o=null===(r=a.payload)||void 0===r?void 0:r.tileId;return"string"!=typeof o?t:function handleTileClick(t,a){if("playing"!==t.status)return t;var r=function findTileById(t,a){return t.find(function(t){return t.id===a})}(t.boardTiles,a);if(!r||!r.isClickable)return t;var o=d(t.boardTiles.filter(function(t){return t.id!==a})),c=m([].concat((0,l.Z)(t.slotTiles),[r])),u=c.newSlots,h=(c.matched,(0,i.Z)((0,i.Z)({},t),{},{"boardTiles":o,"slotTiles":u}));return k(h)}(t,o);case"retry":return function handleRetry(t){if("hero"===t.mode)return(0,i.Z)((0,i.Z)({},t),{},{"status":"playing","attempts":t.attempts+1,"toolsUsed":0,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"endedAt":void 0,"boardTiles":g(t.dailySeed),"slotTiles":[],"tempStacks":[[],[],[]]});var a=p(t.dailyLayout);return(0,i.Z)((0,i.Z)({},t),{},{"status":"playing","attempts":t.attempts+1,"toolsUsed":0,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"endedAt":void 0,"boardTiles":a,"slotTiles":[],"tempStacks":[[],[],[]]})}(t);case"return_temp":var c,u=null===(c=a.payload)||void 0===c?void 0:c.positionIndex;return"number"!=typeof u?t:b(t,u);case"quit":return(0,i.Z)((0,i.Z)({},t),{},{"status":"quit","endedAt":Date.now()});default:return t}},"getStatus":function getThreeTilesStatus(t){return t.status},"getPerformance":function getThreeTilesPerformance(t){var a=(0,y.ns)();a.attempts=t.attempts,a.toolsUsed=t.toolsUsed;var r=(0,y.HS)(a);return{"efficiencyScore":C(r),"toolsUsed":t.toolsUsed,"rawData":{"attempts":t.attempts,"mode":t.mode,"status":t.status,"chestLevel":r}}},"getTools":function getTools(){return[{"id":"undo","name":"Undo","description":"Move last slot tile back to board.","freeUses":1},{"id":"pop","name":"Pop","description":"Move front slot tiles to temp stacks.","freeUses":1},{"id":"shuffle","name":"Shuffle","description":"Shuffle board positions.","freeUses":1}]},"useTool":function useThreeTilesTool(t,a){if("playing"!==t.status)return t;if("undo"===a){if(t.undoUsed)return t;var r=function undoLastTile(t,a){if(0===a.length)return{"newBoard":t,"newSlot":a,"success":!1};var r=a[a.length-1],o=a.slice(0,-1),i=[].concat((0,l.Z)(t),[r]);return{"newBoard":d(i),"newSlot":o,"success":!0}}(t.boardTiles,t.slotTiles),o=r.newBoard,c=r.newSlot;return r.success?S((0,i.Z)((0,i.Z)({},t),{},{"boardTiles":o,"slotTiles":c,"undoUsed":!0})):t}if("shuffle"===a)return t.shuffleUsed?t:S((0,i.Z)((0,i.Z)({},t),{},{"boardTiles":x(t.boardTiles),"shuffleUsed":!0}));if("pop"===a){if(t.popUsed)return t;var u=function popTilesToTemp(t,a){if(0===t.length)return{"remainSlot":t,"newTempStacks":a,"success":!1};var r=Math.min(t.length,3),o=t.slice(0,r),i=t.slice(r),c=3===a.length?a.map(function(t){return(0,l.Z)(t)}):[[],[],[]];return o.forEach(function(t,a){c[a].push(t)}),{"remainSlot":i,"newTempStacks":c,"success":!0}}(t.slotTiles,t.tempStacks),m=u.remainSlot,h=u.newTempStacks;return u.success?S((0,i.Z)((0,i.Z)({},t),{},{"slotTiles":m,"tempStacks":h,"popUsed":!0})):t}return t},"getHeroConfig":function getHeroConfig(){return j},"GameComponent":function getThreeTilesGameComponent(){return r(1024).Z}()},Z=r(885),w=r(181);function createForOfIteratorHelper_createForOfIteratorHelper(t,a){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=(0,w.Z)(t))||a&&t&&"number"==typeof t.length){r&&(t=r);var o=0,l=function F(){};return{"s":l,"n":function n(){return o>=t.length?{"done":!0}:{"done":!1,"value":t[o++]}},"e":function e(t){throw t},"f":l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{"s":function s(){r=r.call(t)},"n":function n(){var t=r.next();return c=t.done,t},"e":function e(t){u=!0,i=t},"f":function f(){try{c||null==r.return||r.return()}finally{if(u)throw i}}}}var G=function cloneGrid(t){return t.map(function(t){return(0,l.Z)(t)})},U=function findEmpty(t){for(var a=0;a<t.length;a+=1)for(var r=0;r<t[a].length;r+=1)if(null===t[a][r])return[a,r];return null},M=function isValidPlacement(t,a,r,o,l){for(var i=0;i<l.size;i+=1){if(t[a][i]===o&&i!==r)return!1;if(t[i][r]===o&&i!==a)return!1}for(var c=Math.floor(a/l.boxRows)*l.boxRows,u=Math.floor(r/l.boxCols)*l.boxCols,d=c;d<c+l.boxRows;d+=1)for(var m=u;m<u+l.boxCols;m+=1)if((d!==a||m!==r)&&t[d][m]===o)return!1;return!0},D=function countBacktracking(t,a,r){var o=U(t);if(!o)return 1;var l,i=(0,Z.Z)(o,2),c=i[0],u=i[1],d=0,m=createForOfIteratorHelper_createForOfIteratorHelper(a.symbols);try{for(m.s();!(l=m.n()).done;){var h=l.value;if(M(t,c,u,h,a)){if(t[c][u]=h,(d+=D(t,a,r))>=r)return t[c][u]=null,d;t[c][u]=null}}}catch(t){m.e(t)}finally{m.f()}return d},I=function countSudokuSolutions(t,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,o=G(t);return D(o,a,r)},R=function shuffle(t,a){for(var r=(0,l.Z)(t),o=r.length-1;o>0;o-=1){var i=Math.floor(a()*(o+1)),c=[r[i],r[o]];r[o]=c[0],r[i]=c[1]}return r},z=function clone(t){return t.map(function(t){return(0,l.Z)(t)})},A=function generateSudokuPuzzle(t){var a,r=function getSudokuRules(t){return"hero"===t?{"size":6,"boxRows":2,"boxCols":3,"symbols":["üèì","‚≠ê","ü¶à","üíô","üèÖ","üëë"]}:{"size":4,"boxRows":2,"boxCols":2,"symbols":["üèì","‚≠ê","ü¶à","üíô"]}}(t.mode),o=function createSeededRandom(t){var a=t;return function(){return(a=1664525*a+1013904223>>>0)/4294967295}}(null!==(a=t.seed)&&void 0!==a?a:Date.now()),i=function createSolvedGrid(t,a){var r=(0,l.Z)(Array(t.size).keys()),o=(0,l.Z)(Array(t.size).keys()),i=(0,l.Z)(Array(t.size/t.boxRows).keys()),c=(0,l.Z)(Array(t.size/t.boxCols).keys()),u=R(i,a).flatMap(function(o){return R(r.slice(o*t.boxRows,(o+1)*t.boxRows),a)}),d=R(c,a).flatMap(function(r){return R(o.slice(r*t.boxCols,(r+1)*t.boxCols),a)}),m=R(t.symbols,a);return u.map(function(a){return d.map(function(r){var o=(a*t.boxCols+Math.floor(a/t.boxRows)+r)%t.size;return m[o]})})}(r,o),c="hero"===t.mode?12:6,u="hero"===t.mode?16:8,d=function removeCellsWithUniqueSolution(t,a,r,o){for(var i=t.map(function(t){return(0,l.Z)(t)}),c=[],u=0;u<a.size;u+=1)for(var d=0;d<a.size;d+=1)c.push([u,d]);var m,h=R(c,o),v=a.size*a.size,p=createForOfIteratorHelper_createForOfIteratorHelper(h);try{for(p.s();!(m=p.n()).done;){var g=(0,Z.Z)(m.value,2),x=g[0],y=g[1];if(v<=r)break;var k=i[x][y];i[x][y]=null,1===I(z(i),a,2)?v-=1:i[x][y]=k}}catch(t){p.e(t)}finally{p.f()}return i}(i,r,c+Math.floor(o()*(u-c+1)),o);return{"size":r.size,"boxRows":r.boxRows,"boxCols":r.boxCols,"symbols":r.symbols,"givens":d,"solution":i}},L=function SudokuBoard(t){var a=t.size,r=t.boxRows,o=t.boxCols,l=t.grid,i=t.givens,c=t.selectedCell,u=t.errorCells,d=t.onSelect;return(0,N.jsx)(T.G7,{"className":"sudoku-board","data-board-size":String(a),"children":l.map(function(t,l){return(0,N.jsx)(T.G7,{"className":"sudoku-row","children":t.map(function(t,m){var h=null!==i[l][m],v=(null==c?void 0:c.row)===l&&(null==c?void 0:c.col)===m,p=u.some(function(t){return t.row===l&&t.col===m}),g=["sudoku-cell",h?"sudoku-cell--given":"",v?"sudoku-cell--selected":"",p?"sudoku-cell--error":"",l%r===0?"sudoku-cell--box-top":"",m%o===0?"sudoku-cell--box-left":"",l===a-1?"sudoku-cell--box-bottom":"",m===a-1?"sudoku-cell--box-right":""].filter(Boolean).join(" ");return(0,N.jsx)(T.G7,{"className":g,"data-cell-row":String(l),"data-cell-col":String(m),"data-cell-given":h?"true":"false","data-cell-selected":v?"true":"false","data-cell-error":p?"true":"false","onClick":function onClick(){return d(l,m)},"children":(0,N.jsx)(T.xv,{"children":null!=t?t:""})},"cell-".concat(l,"-").concat(m))})},"row-".concat(l))})})},E=function IconSelector(t){var a=t.symbols,r=t.onPick,o=t.onClear,l=t.disabled,i=void 0!==l&&l,c=t.disabledReason,u=void 0===c?null:c;return(0,N.jsxs)(T.G7,{"className":"icon-selector".concat(i?" icon-selector--disabled":""),"children":[a.map(function(t,a){return(0,N.jsx)(T.G7,{"className":"icon-selector__item".concat(i?" icon-selector__item--disabled":""),"data-selector-symbol":t,"onClick":function onClick(){i||r(t)},"children":(0,N.jsx)(T.xv,{"children":t})},"".concat(t,"-").concat(a))}),(0,N.jsx)(T.G7,{"className":"icon-selector__item".concat(i?" icon-selector__item--disabled":""),"data-selector-symbol":"clear","onClick":function onClick(){i||o()},"children":(0,N.jsx)(T.xv,{"children":"‚úï"})}),i&&u&&(0,N.jsx)(T.xv,{"className":"icon-selector__reason","children":u})]})},O=function HeroTimer(t){var a=t.remainingSeconds,r=t.totalSeconds,o=Math.max(0,Math.min(1,a/r)),l=a<=30;return(0,N.jsxs)(T.G7,{"className":"hero-timer".concat(l?" hero-timer--danger":""),"data-danger":l?"true":"false","children":[(0,N.jsx)(T.G7,{"className":"hero-timer__bar","style":{"width":"".concat(100*o,"%")}}),(0,N.jsxs)(T.xv,{"className":"hero-timer__text","children":[a,"s"]})]})},P=function cloneGrid(t){return t.map(function(t){return(0,l.Z)(t)})},q=function collectErrors(t,a){for(var r=[],o=0;o<t.length;o+=1)for(var l=0;l<t[o].length;l+=1)null!==t[o][l]&&t[o][l]!==a[o][l]&&r.push({"row":o,"col":l});return r},H=function isInBounds(t,a,r){return a>=0&&r>=0&&a<t.puzzle.size&&r<t.puzzle.size},B=function evaluateSudokuState(t){if("hero"===t.mode&&t.remainingSeconds<=0)return(0,i.Z)((0,i.Z)({},t),{},{"status":"failed","endedAt":Date.now(),"remainingSeconds":0});if(!function allFilled(t){return t.every(function(t){return t.every(function(t){return null!==t})})}(t.grid))return(0,i.Z)((0,i.Z)({},t),{},{"errorCells":[]});var a=q(t.grid,t.puzzle.solution);return 0===a.length?(0,i.Z)((0,i.Z)({},t),{},{"status":"cleared","endedAt":Date.now(),"errorCells":[]}):(0,i.Z)((0,i.Z)({},t),{},{"errorCells":a,"uiMessage":"There are incorrect cells. Fix the highlighted cells."})},V=function createSudokuState(t){var a=A({"mode":t.mode,"seed":t.seed});return{"gameId":"sudoku","mode":t.mode,"status":"playing","startedAt":Date.now(),"attempts":1,"toolsUsed":0,"puzzle":a,"grid":P(a.givens),"selectedCell":null,"errorCells":[],"hintUsed":0,"checkUsed":0,"remainingSeconds":"hero"===t.mode?180:0,"maxHint":1,"maxCheck":0,"lastUnavailableAction":null,"uiMessage":null}},J=function canEditCell(t,a,r){return!!H(t,a,r)&&null===t.puzzle.givens[a][r]},Y=function setCellValue(t,a){if(!t.selectedCell)return(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Select an editable cell first."});var r=t.selectedCell,o=r.row,l=r.col;if(!J(t,o,l))return(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"This cell is fixed and cannot be changed."});var c=P(t.grid);return c[o][l]=a,B((0,i.Z)((0,i.Z)({},t),{},{"grid":c,"uiMessage":null}))},K=function getDurationSeconds(t){var a,r=null!==(a=t.endedAt)&&void 0!==a?a:Date.now();return Math.max(1,Math.floor((r-t.startedAt)/1e3))},W=function getEfficiencyScore(t){var a=K(t),r=30;a<=120?r=95:a<=240?r=75:a<=480&&(r=50);var o=8*t.toolsUsed;return Math.max(0,r-o)},X={"id":"sudoku","meta":{"id":"sudoku","narrativeName":"Star Chart Decode","narrativeDesc":"Decode ancient coordinates by solving icon Sudoku.","icon":"üîÆ","thumbnailComponent":function SudokuThumbnail(){return(0,N.jsx)(T.G7,{"children":(0,N.jsx)(T.xv,{"children":"üîÆ Sudoku"})})},"energyReward":120},"ratingConfig":{"diamond":{"minEfficiencyScore":90,"maxToolsUsed":0},"gold":{"minEfficiencyScore":70,"maxToolsUsed":1},"silver":{"minEfficiencyScore":40,"maxToolsUsed":2}},"initGame":V,"handleAction":function handleAction(t,a){if("playing"!==t.status&&"retry"!==a.type)return t;switch(a.type){case"select_cell":var r,o,l=null===(r=a.payload)||void 0===r?void 0:r.row,c=null===(o=a.payload)||void 0===o?void 0:o.col;return"number"!=typeof l||"number"!=typeof c?(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid cell selection."}):H(t,l,c)?J(t,l,c)?(0,i.Z)((0,i.Z)({},t),{},{"selectedCell":{"row":l,"col":c},"uiMessage":null}):(0,i.Z)((0,i.Z)({},t),{},{"selectedCell":{"row":l,"col":c},"uiMessage":"This cell is fixed and cannot be changed."}):(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid cell selection."});case"input_symbol":var u,d=null===(u=a.payload)||void 0===u?void 0:u.symbol;return"string"!=typeof d?(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid symbol selection."}):t.puzzle.symbols.includes(d)?Y(t,d):(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid symbol selection."});case"clear_cell":return Y(t,null);case"tick":var m;if("hero"!==t.mode)return t;var h=null===(m=a.payload)||void 0===m?void 0:m.deltaSeconds,v="number"==typeof h&&h>0?h:1;return B((0,i.Z)((0,i.Z)({},t),{},{"remainingSeconds":Math.max(0,t.remainingSeconds-v)}));case"retry":return(0,i.Z)((0,i.Z)({},V({"mode":t.mode,"date":"","seed":Date.now()})),{},{"attempts":t.attempts+1});case"quit":return(0,i.Z)((0,i.Z)({},t),{},{"status":"quit","endedAt":Date.now(),"uiMessage":null});default:return t}},"getStatus":function getStatus(t){return t.status},"getPerformance":function getPerformance(t){return{"efficiencyScore":W(t),"toolsUsed":t.toolsUsed,"rawData":{"attempts":t.attempts,"durationSeconds":K(t),"mode":t.mode,"remainingSeconds":t.remainingSeconds}}},"getTools":function getTools(){return[{"id":"hint","name":"Hint","description":"Fill one cell with a correct symbol.","freeUses":1},{"id":"check","name":"Check","description":"Unavailable in MVP. Paid flow will be added later.","freeUses":0}]},"useTool":function useTool(t,a){if("playing"!==t.status)return t;if("hint"===a){if(t.hintUsed>=t.maxHint)return(0,i.Z)((0,i.Z)({},t),{},{"lastUnavailableAction":"hint","uiMessage":"Hint has already been used."});var r=function findHintCell(t){for(var a=0;a<t.grid.length;a+=1)for(var r=0;r<t.grid[a].length;r+=1)if(J(t,a,r)&&t.grid[a][r]!==t.puzzle.solution[a][r])return{"row":a,"col":r};return null}(t);if(!r)return(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"No available cell for hint."});var o=P(t.grid);return o[r.row][r.col]=t.puzzle.solution[r.row][r.col],B((0,i.Z)((0,i.Z)({},t),{},{"grid":o,"hintUsed":t.hintUsed+1,"toolsUsed":t.toolsUsed+1,"lastUnavailableAction":null,"uiMessage":"Hint filled one cell."}))}return"check"===a?t.maxCheck<=t.checkUsed?(0,i.Z)((0,i.Z)({},t),{},{"lastUnavailableAction":"check","uiMessage":"Check is unavailable in MVP."}):(0,i.Z)((0,i.Z)({},t),{},{"checkUsed":t.checkUsed+1,"toolsUsed":t.toolsUsed+1,"errorCells":q(t.grid,t.puzzle.solution),"uiMessage":null}):(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Unknown tool action."})},"getHeroConfig":function getHeroConfig(){return{"enabled":!0,"mode":"hero","timeLimitSeconds":180,"description":"6x6 Sudoku with a 3-minute countdown."}},"GameComponent":function SudokuGameComponent(t){var a=t.state,r=t.onAction,o=t.onUseTool,l=t.mode,i=function getSelectorDisabledReason(t){if(!t.selectedCell)return"Select an editable cell first.";var a=t.selectedCell,r=a.row,o=a.col;return J(t,r,o)?null:"This cell is fixed and cannot be changed."}(a),c=null!==i,u=Math.max(0,a.maxHint-a.hintUsed),d=Math.max(0,a.maxCheck-a.checkUsed),m=d<=0;return(0,N.jsxs)(T.G7,{"className":"sudoku-game","children":[(0,N.jsx)(T.xv,{"className":"sudoku-game__title","children":"Sudoku"}),"hero"===l&&(0,N.jsx)(O,{"remainingSeconds":a.remainingSeconds,"totalSeconds":180}),(0,N.jsx)(L,{"size":a.puzzle.size,"boxRows":a.puzzle.boxRows,"boxCols":a.puzzle.boxCols,"grid":a.grid,"givens":a.puzzle.givens,"selectedCell":a.selectedCell,"errorCells":a.errorCells,"onSelect":function onSelect(t,a){return r({"type":"select_cell","payload":{"row":t,"col":a}})}}),(0,N.jsx)(E,{"symbols":a.puzzle.symbols,"onPick":function onPick(t){return r({"type":"input_symbol","payload":{"symbol":t}})},"onClear":function onClear(){return r({"type":"clear_cell"})},"disabled":c,"disabledReason":i}),(0,N.jsxs)(T.G7,{"className":"sudoku-tools","children":[(0,N.jsx)(T.G7,{"className":"sudoku-tools__item".concat(u<=0?" sudoku-tools__item--disabled":""),"onClick":function onClick(){return o("hint")},"children":(0,N.jsxs)(T.xv,{"children":["üí° Hint ",u,"/",a.maxHint]})}),(0,N.jsx)(T.G7,{"className":"sudoku-tools__item".concat(m?" sudoku-tools__item--disabled":""),"onClick":function onClick(){return o("check")},"children":(0,N.jsxs)(T.xv,{"children":["‚úÖ Check ",d,"/",a.maxCheck]})})]}),a.uiMessage&&(0,N.jsx)(T.xv,{"className":"sudoku-message","children":a.uiMessage})]})}},$=!1,Q=function registerBuiltInGames(){$||(o.O.register(_),o.O.register(X),$=!0)}},"4004":function(t,a,r){r.r(a),r.d(a,{"default":function(){return T}});var o=r(1413),l=r(885),i=r(7294),c=r(3970),u=r(4536),d=r(7853),m=r(7477),h=r(5893),v=function TodayGameCard(t){var a=t.meta,r=t.cardState,o=t.bestLabel,l=t.chestLabel,i=t.onStart,u=t.onHero,d=t.onExit,m=t.feedbackSlot,v=a.thumbnailComponent;return(0,h.jsxs)(c.G7,{"className":"today-game-card","children":[(0,h.jsx)(c.xv,{"className":"today-game-card__title","children":"completed"===r||"done"===r?"‚úÖ Today Completed":"‚ú® Today Game"}),(0,h.jsx)(c.xv,{"className":"today-game-card__name","children":a.narrativeName}),(0,h.jsx)(c.xv,{"className":"today-game-card__desc","children":a.narrativeDesc}),(0,h.jsx)(c.G7,{"className":"today-game-card__thumb","children":(0,h.jsx)(v,{})}),(0,h.jsxs)(c.xv,{"className":"today-game-card__meta","children":["‚ö° +",a.energyReward," ¬∑ üèÜ ",o]}),l&&(0,h.jsxs)(c.xv,{"className":"today-game-card__chest","children":["üì¶ ",l]}),m,("idle"===r||"playing"===r)&&(0,h.jsx)(c.G7,{"className":"today-game-card__button","onClick":i,"children":(0,h.jsx)(c.xv,{"children":"Start"})}),"completed"===r&&(0,h.jsxs)(h.Fragment,{"children":[(0,h.jsx)(c.G7,{"className":"today-game-card__button","onClick":u,"children":(0,h.jsx)(c.xv,{"children":"Challenge Hero"})}),(0,h.jsx)(c.G7,{"className":"today-game-card__link","onClick":d,"children":(0,h.jsx)(c.xv,{"children":"Done for today"})})]}),("hero"===r||"done"===r)&&(0,h.jsx)(c.G7,{"className":"today-game-card__link","onClick":d,"children":(0,h.jsx)(c.xv,{"children":"Close"})})]})},p=function PreferenceFeedback(t){var a=t.value,r=t.onChange;return(0,h.jsxs)(c.G7,{"className":"preference-feedback","children":[(0,h.jsx)(c.xv,{"className":"preference-feedback__title","children":"How do you like this game mode?"}),(0,h.jsxs)(c.G7,{"className":"preference-feedback__actions","children":[(0,h.jsx)(c.G7,{"className":"preference-feedback__button ".concat("liked"===a?"is-active":""),"onClick":function onClick(){return r("liked")},"children":(0,h.jsx)(c.xv,{"children":"üíô Like"})}),(0,h.jsx)(c.G7,{"className":"preference-feedback__button ".concat("disliked"===a?"is-active":""),"onClick":function onClick(){return r("disliked")},"children":(0,h.jsx)(c.xv,{"children":"üíî Dislike"})})]}),"skipped"!==a&&(0,h.jsx)(c.xv,{"className":"preference-feedback__saved","children":"Preference saved."})]})},g=function StreakMilestones(t){var a=t.currentDays,r=t.milestones,o=r.find(function(t){return a<t.days})||null;return(0,h.jsxs)(c.G7,{"className":"streak-milestones","children":[(0,h.jsxs)(c.xv,{"className":"streak-milestones__title","children":["üî• Streak ",a," days"]}),(0,h.jsx)(c.pf,{"scrollX":!0,"className":"streak-milestones__scroll","children":(0,h.jsx)(c.G7,{"className":"streak-milestones__items","children":r.map(function(t){var r=a>=t.days,l=(null==o?void 0:o.days)===t.days,i=Math.max(0,t.days-a);return(0,h.jsxs)(c.G7,{"className":"streak-milestones__item","children":[(0,h.jsx)(c.xv,{"className":"streak-milestones__dot".concat(r?" is-completed":"").concat(l?" is-next":""),"children":r?"‚úÖ":"‚óã"}),(0,h.jsx)(c.xv,{"className":"streak-milestones__label","children":t.label}),l&&(0,h.jsxs)(c.xv,{"className":"streak-milestones__hint","children":[i," days left"]})]},t.days)})})})]})},x=r(2937),y=r(3311),k=r(9874),b=r(4568),S=r(5589),C=r(6891),j=r(3499),T=function Starlight(){var t=(0,i.useState)(null),a=(0,l.Z)(t,2),r=a[0],T=a[1],N=(0,i.useState)(67.3),_=(0,l.Z)(N,2),Z=_[0],w=_[1],G=(0,i.useState)((0,S.zo)()),U=(0,l.Z)(G,2),M=U[0],D=U[1],I=(0,i.useState)(""),R=(0,l.Z)(I,2),z=R[0],A=R[1],L=(0,i.useState)(null),E=(0,l.Z)(L,2),O=E[0],P=E[1],q=(0,i.useState)("idle"),H=(0,l.Z)(q,2),B=H[0],V=H[1],J=(0,i.useState)("--:--"),Y=(0,l.Z)(J,2),K=Y[0],W=Y[1],X=(0,i.useState)("skipped"),$=(0,l.Z)(X,2),Q=$[0],ee=$[1],te=(0,i.useState)((0,S._G)()),ne=(0,l.Z)(te,2),ae=ne[0],re=ne[1],se=(0,i.useMemo)(function(){return(0,b.b)(),new x.d},[]),oe=(0,i.useMemo)(function(){return se.getTodayGame("local-user",ae)},[se,ae]),le=function refreshProgress(){var t=(0,S._G)(),a=se.getTodayGame("local-user",t);re(t);var r=(0,S.yu)();T(r),D((0,S.zo)()),V(function deriveCardState(t){return t.todayCompleted?t.heroAttempted?t.heroAttempted&&!t.heroCompleted?"hero":"done":"completed":"idle"}(r));var o=y.J.listByUser("local-user").filter(function(t){return t.gameType===a.id&&"cleared"===t.result}).reduce(function(t,a){return null===t||a.durationSeconds<t?a.durationSeconds:t},null);W(function formatBestTime(t){if(!t||t<=0)return"--:--";var a=String(Math.floor(t/60)).padStart(2,"0"),r=String(t%60).padStart(2,"0");return"".concat(a,":").concat(r)}(o));var l=k.u.listByUser("local-user").filter(function(r){return r.date===t&&r.gameType===a.id}),i=l[l.length-1];ee((null==i?void 0:i.feedback)||"skipped"),(0,j.cL)().then(function(t){w(t.progress)}).catch(function(t){console.error("Failed to sync planet progress:",t)})};(0,i.useEffect)(function(){le()},[]),u.ZP.useDidShow(function(){le()}),(0,i.useEffect)(function(){var t=function updateCountdown(){var t=(0,S.zo)();D(t),t.remainingTime>0&&A((0,S.dH)(t.remainingTime))};t();var a=setInterval(t,1e3);return function(){return clearInterval(a)}},[]);var ie=function handleChestClick(){if(null!=r&&r.pendingChest){var t=(0,S.zo)();if("locked"!==t.status){if("expired"===t.status){alert("Chest expired. Come back tomorrow.");var a=(0,o.Z)((0,o.Z)({},r),{},{"pendingChest":null});return(0,S.Uv)(a),void le()}if("unlocked"===t.status){var l=(0,S.lj)();if(!l)return;var i=l.levels.map(function(t){return(0,C.PR)(t)}),c=l.levels.length>1?"Received ".concat(i.map(function(t){return t.emoji}).join(" + ")):"Received ".concat(i[0].emoji," ").concat(i[0].name);alert("".concat(c)),le()}}else alert("Chest unlock in: ".concat(z))}},ce=function renderTooltip(t){var a=(0,C.Ge)(t)[0],r=(0,C.PR)(t);return(0,h.jsxs)(c.G7,{"className":"chest-tooltip","onClick":function onClick(t){return t.stopPropagation()},"children":[(0,h.jsxs)(c.xv,{"className":"tooltip-title","children":[r.emoji," ",r.name,":"]}),(0,h.jsxs)(c.G7,{"className":"tooltip-rewards","children":[(0,h.jsxs)(c.xv,{"className":"tooltip-item","children":["üí∞ ",a.coins]}),(0,h.jsxs)(c.xv,{"className":"tooltip-item","children":["üß∞ ",a.props]}),a.lottery&&(0,h.jsxs)(c.xv,{"className":"tooltip-item","children":["üé´ ",a.lottery]}),a.physical&&(0,h.jsxs)(c.xv,{"className":"tooltip-item","children":["üéÅ ",a.physical]})]})]})};if(!r)return null;var ue=M.chest?M.chest.levels.map(function(t){return(0,C.PR)(t)}):null,de=M.chest?M.chest.levels:[],me="completed"===B||"done"===B;return(0,h.jsxs)(c.G7,{"className":"starlight","children":[(0,h.jsxs)(c.G7,{"className":"starlight__header","children":[(0,h.jsxs)(c.G7,{"className":"streak-badge","children":[(0,h.jsx)(c.xv,{"className":"streak-badge__icon","children":"üî•"}),(0,h.jsx)(c.xv,{"className":"streak-badge__count","children":r.consecutiveDays})]}),(0,h.jsxs)(c.G7,{"className":"debug-buttons","children":[(0,h.jsx)(c.xv,{"className":"debug-btn","onClick":function handleReset(){confirm("Clear all local data?")&&((0,d.wk)(),le(),alert("Data reset completed."))},"children":"üîÑ"}),(0,h.jsx)(c.xv,{"className":"debug-btn","onClick":function handleTestWin(){u.ZP.navigateTo({"url":"/pages/game/index?mode=normal&autowin=true&gameType=".concat(oe.id)})},"children":"üéØ"}),(0,h.jsx)(c.xv,{"className":"debug-btn","onClick":function handleSkipCountdown(){if(null!=r&&r.pendingChest){var t=new Date,a=(0,o.Z)((0,o.Z)({},r),{},{"pendingChest":(0,o.Z)((0,o.Z)({},r.pendingChest),{},{"unlockAt":new Date(t.getTime()-1e3).toISOString(),"expiresAt":new Date(t.getTime()+864e5).toISOString()})});(0,S.Uv)(a),le(),alert("Chest countdown skipped.")}else alert("No pending chest.")},"children":"‚è≠Ô∏è"}),(0,h.jsx)(c.xv,{"className":"debug-btn","onClick":function handleNextDay(){confirm("Move to next day simulation?")&&((0,S.F0)(1),le(),alert("Moved to next day: ".concat((0,S._G)())))},"children":"üìÖ"}),(0,h.jsx)(c.xv,{"className":"debug-btn","onClick":function handleShowStatus(){var t;alert("Today Date: ".concat(ae,"\n")+"Today Game: ".concat(oe.id,"\n")+"Today Completed: ".concat(null!=r&&r.todayCompleted?"Yes":"No","\n")+"Hero Completed: ".concat(null!=r&&r.heroCompleted?"Yes":"No","\n")+"Consecutive Days: ".concat(null!==(t=null==r?void 0:r.consecutiveDays)&&void 0!==t?t:0,"\n")+"Pending Chest: ".concat(null!=r&&r.pendingChest?r.pendingChest.levels.join(", "):"None"))},"children":"üìä"})]})]}),(0,h.jsxs)(c.G7,{"className":"starlight__planet","children":[(0,h.jsx)(m.Z,{"progress":Z,"size":"large","onClick":function handlePlanetClick(){u.ZP.navigateTo({"url":"/pages/world/index"})}}),(0,h.jsx)(c.xv,{"className":"explore-hint","children":"Tap planet to explore"})]}),(0,h.jsx)(v,{"meta":oe.meta,"cardState":B,"bestLabel":K,"chestLabel":r.todayChestLevel||void 0,"onStart":function handleStart(){V("playing"),u.ZP.navigateTo({"url":"/pages/game/index?mode=normal&gameType=".concat(oe.id)})},"onHero":function handleHero(){V("hero"),u.ZP.navigateTo({"url":"/pages/game/index?mode=hero&gameType=".concat(oe.id)})},"onExit":function handleCardDone(){V("done")},"feedbackSlot":me?(0,h.jsx)(p,{"value":Q,"onChange":function handleFeedbackChange(t){ee(t),k.u.save({"userId":"local-user","date":ae,"gameType":oe.id,"feedback":t})}}):null}),(0,h.jsxs)(c.G7,{"className":"starlight__chest","children":["none"===M.status&&(0,h.jsx)(c.G7,{"className":"chest-empty","children":(0,h.jsx)(c.xv,{"className":"empty-text","children":"No chest available today"})}),("locked"===M.status||"unlocked"===M.status)&&ue&&(0,h.jsxs)(c.G7,{"className":"chest-card ".concat("locked"===M.status?"chest-locked":"chest-unlocked"),"onClick":ie,"children":[(0,h.jsx)(c.xv,{"className":"chest-card__label","children":"Star reward chest"}),(0,h.jsx)(c.G7,{"className":"chest-card__icons","children":ue.map(function(t,a){return(0,h.jsxs)(c.G7,{"className":"chest-icon-wrapper","onClick":function onClick(t){return function handleChestTooltip(t,a){a.stopPropagation(),P(O===t?null:t)}(a,t)},"children":[(0,h.jsx)(c.xv,{"className":"chest-icon","children":t.emoji}),O===a&&ce(de[a])]},a)})}),(0,h.jsx)(c.xv,{"className":"chest-name","children":ue.length>1?ue.map(function(t){return t.name}).join(" + "):ue[0].name}),(0,h.jsxs)(c.xv,{"className":"expire-hint","children":["‚è∞ ",z]}),"unlocked"===M.status&&(0,h.jsx)(c.zx,{"className":"claim-btn","onClick":ie,"children":"Claim"})]})]}),(0,h.jsx)(c.G7,{"className":"starlight__milestones","children":(0,h.jsx)(g,{"currentDays":r.consecutiveDays,"milestones":[{"days":7,"label":"7d reward"},{"days":14,"label":"14d sticker"},{"days":30,"label":"30d charm"},{"days":60,"label":"60d gift box"}]})})]})}},"3311":function(t,a,r){r.d(a,{"J":function(){return c}});var o=r(7853),l="amio_game_session_logs_v1",i=function loadLogs(){try{var t=(0,o.qu)(l);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load game logs:",t),[]}},c={"append":function append(t){var a=i();a.push(t),function saveLogs(t){try{(0,o.Fj)(l,JSON.stringify(t))}catch(t){console.error("Failed to save game logs:",t)}}(a)},"listByUser":function listByUser(t){return i().filter(function(a){return a.userId===t})},"clear":function clear(){try{(0,o.hq)(l)}catch(t){console.error("Failed to clear game logs:",t)}},"storageKey":l}},"9874":function(t,a,r){r.d(a,{"u":function(){return c}});var o=r(7853),l="amio_preference_records_v1",i=function loadRecords(){try{var t=(0,o.qu)(l);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load preference records:",t),[]}},c={"save":function save(t){var a=i().filter(function(a){return!(a.userId===t.userId&&a.date===t.date&&a.gameType===t.gameType)});a.push(t),function saveRecords(t){try{(0,o.Fj)(l,JSON.stringify(t))}catch(t){console.error("Failed to save preference records:",t)}}(a)},"listByUser":function listByUser(t){return i().filter(function(a){return a.userId===t})},"clear":function clear(){try{(0,o.hq)(l)}catch(t){console.error("Failed to clear preference records:",t)}},"storageKey":l}},"6891":function(t,a,r){r.d(a,{"Ge":function(){return getChestRewardDetails},"HS":function(){return calculateChestLevel},"PR":function(){return getChestLevelInfo},"bV":function(){return upgradeChestForHero},"ns":function(){return createInitialStats}});var o=r(5961);function calculateChestLevel(t){var a=t.attempts,r=t.toolsUsed;return 1===a?0===r?o.q2.DIAMOND:1===r?o.q2.GOLD:o.q2.SILVER:2===a?r<=1?o.q2.GOLD:o.q2.SILVER:3===a?r<=2?o.q2.SILVER:o.q2.BRONZE:a>=4&&a<=5&&r<=1?o.q2.SILVER:o.q2.BRONZE}function getChestLevelInfo(t){switch(t){case o.q2.DIAMOND:return{"emoji":"üíé","name":"ÈíªÁü≥ÂÆùÁÆ±","color":"#00D4FF"};case o.q2.GOLD:return{"emoji":"ü•á","name":"ÈªÑÈáëÂÆùÁÆ±","color":"#FFD700"};case o.q2.SILVER:return{"emoji":"ü•à","name":"ÁôΩÈì∂ÂÆùÁÆ±","color":"#C0C0C0"};case o.q2.BRONZE:return{"emoji":"ü•â","name":"ÈùíÈìúÂÆùÁÆ±","color":"#CD7F32"}}}function getChestRewardDetails(t){switch(t){case o.q2.DIAMOND:return[{"coins":"ÈáëÂ∏Å√ó500","props":"ÈÅìÂÖ∑√ó3","lottery":"ÊäΩÂ•ñÂà∏√ó2","physical":"10%ÂÆû‰ΩìÂë®Ëæπ"}];case o.q2.GOLD:return[{"coins":"ÈáëÂ∏Å√ó300","props":"ÈÅìÂÖ∑√ó2","lottery":"ÊäΩÂ•ñÂà∏√ó1","physical":"3%ÂÆû‰ΩìÂë®Ëæπ"}];case o.q2.SILVER:return[{"coins":"ÈáëÂ∏Å√ó150","props":"ÈÅìÂÖ∑√ó1","lottery":"5%ÊäΩÂ•ñÂà∏","physical":""}];case o.q2.BRONZE:return[{"coins":"ÈáëÂ∏Å√ó50","props":"ÈÅìÂÖ∑Á¢éÁâá","lottery":"","physical":""}]}}function upgradeChestForHero(t){switch(t){case o.q2.BRONZE:return[o.q2.GOLD];case o.q2.SILVER:return[o.q2.DIAMOND];case o.q2.GOLD:return[o.q2.DIAMOND,o.q2.GOLD];case o.q2.DIAMOND:return[o.q2.DIAMOND,o.q2.DIAMOND]}}function createInitialStats(){return{"attempts":1,"toolsUsed":0,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1}}}}]);