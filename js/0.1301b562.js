"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[0],{"2937":function(t,o,r){r.d(o,{"d":function(){return p}});var a=r(5671),l=r(3144),i=r(4942),c=r(5961),u=new(function(){return(0,l.Z)(function ChestRatingEngine(){(0,a.Z)(this,ChestRatingEngine)},[{"key":"rate","value":function rate(t,o){return t.efficiencyScore>=o.diamond.minEfficiencyScore&&t.toolsUsed<=o.diamond.maxToolsUsed?"diamond":t.efficiencyScore>=o.gold.minEfficiencyScore&&t.toolsUsed<=o.gold.maxToolsUsed?"gold":t.efficiencyScore>=o.silver.minEfficiencyScore&&t.toolsUsed<=o.silver.maxToolsUsed?"silver":"bronze"}}])}()),d=r(9366),h=new(function(){return(0,l.Z)(function GameScheduler(){(0,a.Z)(this,GameScheduler)},[{"key":"getTodayGameType","value":function getTodayGameType(t,o){return Math.floor(new Date("".concat(o,"T00:00:00")).getTime()/864e5)%2==0?"3tiles":"sudoku"}},{"key":"getStorageKey","value":function getStorageKey(){return"amio_game_scheduler_v1"}}])}()),m=r(3311),v=r(9874),p=function(){return(0,l.Z)(function GameEngine(){(0,a.Z)(this,GameEngine),(0,i.Z)(this,"activePlugin",null),(0,i.Z)(this,"activeState",null),(0,i.Z)(this,"mode","normal"),(0,i.Z)(this,"userId","local-user"),(0,i.Z)(this,"date","")},[{"key":"getTodayGame","value":function getTodayGame(t,o){var r=h.getTodayGameType(t,o);return d.O.get(r)}},{"key":"setGame","value":function setGame(t){this.activePlugin=d.O.get(t)}},{"key":"startGame","value":function startGame(t){if(!this.activePlugin){var o=this.getTodayGame(t.userId||"local-user",t.date);this.activePlugin=o}return this.mode=t.mode,this.userId=t.userId||"local-user",this.date=t.date,this.activeState=this.activePlugin.initGame(t),this.activeState}},{"key":"dispatch","value":function dispatch(t){if(!this.activePlugin||!this.activeState)throw new Error("Game is not started");return this.activeState=this.activePlugin.handleAction(this.activeState,t),this.activeState}},{"key":"useTool","value":function useTool(t){if(!this.activePlugin||!this.activeState)throw new Error("Game is not started");return this.activeState=this.activePlugin.useTool(this.activeState,t),this.activeState}},{"key":"getStatus","value":function getStatus(){return this.activePlugin&&this.activeState?this.activePlugin.getStatus(this.activeState):"idle"}},{"key":"getState","value":function getState(){return this.activeState}},{"key":"enterSettlement","value":function enterSettlement(t){if(!this.activePlugin||!this.activeState)throw new Error("Game is not started");var o=this.activePlugin.getPerformance(this.activeState);return{"result":t,"chestLevel":u.rate(o,this.activePlugin.ratingConfig),"performance":o}}},{"key":"onGameEnd","value":function onGameEnd(t){var o=this.enterSettlement(t);return m.J.append({"userId":this.userId,"date":this.date,"gameType":t.gameId,"mode":this.mode,"result":t.status,"attempts":t.attempts,"durationSeconds":t.durationSeconds,"toolsUsed":t.toolsUsed,"chestLevel":o.chestLevel,"heroAttempted":t.heroAttempted,"heroResult":t.heroResult,"feedback":t.feedback}),t.feedback&&v.u.save({"userId":this.userId,"date":this.date,"gameType":t.gameId,"feedback":t.feedback}),o}},{"key":"getChestLevelAsEnum","value":function getChestLevelAsEnum(t){return function mapChestLevel(t){switch(t){case"diamond":return c.q2.DIAMOND;case"gold":return c.q2.GOLD;case"silver":return c.q2.SILVER;default:return c.q2.BRONZE}}(t)}}])}();new p},"9366":function(t,o,r){r.d(o,{"O":function(){return c}});var a=r(5671),l=r(3144),i=r(4942),c=new(function(){return(0,l.Z)(function GameRegistry(){(0,a.Z)(this,GameRegistry),(0,i.Z)(this,"plugins",new Map)},[{"key":"register","value":function register(t){this.plugins.set(t.id,t)}},{"key":"get","value":function get(t){var o=this.plugins.get(t);if(!o)throw new Error("Game plugin not found: ".concat(t));return o}},{"key":"list","value":function list(){return Array.from(this.plugins.values())}}])}())},"1024":function(t,o,r){r.d(o,{"Z":function(){return g}});r(7294);var a=r(3970),l=r(6107),i=r(5893),c=function Tile(t){var o=t.data,r=t.onClick,c=t.width,u=void 0===c?60:c,d=t.height,h=void 0===d?66:d,m=o.type,v=o.isClickable,p=(0,l.a2)(m);return(0,i.jsx)(a.G7,{"className":"tile ".concat(v?"":"disabled"),"style":{"width":"".concat(u,"px"),"height":"".concat(h,"px")},"onClick":function handleClick(){v&&r(o)},"children":p?(0,i.jsx)(a.G7,{"className":"icon-container","dangerouslySetInnerHTML":{"__html":p}}):(0,i.jsx)(a.xv,{"className":"content","children":m})})},u=function Board(t){var o=t.tiles,r=t.onTileClick;return(0,i.jsx)(a.G7,{"className":"board","children":(0,i.jsx)(a.G7,{"className":"board-container","children":(0,i.jsx)(a.G7,{"className":"tiles-area","children":o.map(function(t){return(0,i.jsx)(a.G7,{"className":"tile-wrapper","style":{"left":"".concat(36*t.x,"px"),"top":"".concat(32*t.y,"px"),"zIndex":t.layer},"children":(0,i.jsx)(c,{"data":t,"onClick":r,"width":40,"height":44})},t.id)})})})})},d=r(1413),h=r(5961),m=function Slot(t){var o=t.tiles,r=Array(h.j$).fill(null).map(function(t,r){return o[r]||null});return(0,i.jsx)(a.G7,{"className":"slot-bar","children":r.map(function(t,o){return(0,i.jsx)(a.G7,{"className":"slot-cell","children":t&&(0,i.jsx)(c,{"data":(0,d.Z)((0,d.Z)({},t),{},{"isClickable":!1}),"onClick":function onClick(){},"width":32,"height":36})},"slot-".concat(o))})})},v=function TempSlot(t){var o=t.stacks,r=t.onStackClick;return o.some(function(t){return t.length>0})?(0,i.jsx)(a.G7,{"className":"temp-slot","children":o.map(function(t,o){return(0,i.jsxs)(a.G7,{"className":"temp-position","onClick":function onClick(){return t.length>0&&r(o)},"children":[t.map(function(o,r){return(0,i.jsx)(a.G7,{"className":"stacked-tile","style":{"zIndex":r,"transform":"translate(-50%, calc(-50% - ".concat(4*r,"px))")},"children":(0,i.jsx)(c,{"data":(0,d.Z)((0,d.Z)({},o),{},{"isClickable":r===t.length-1}),"onClick":function onClick(){},"width":32,"height":36})},o.id)}),0===t.length&&(0,i.jsx)(a.G7,{"className":"empty-slot"})]},o)})}):null},p=function ToolBar(t){var o=t.onUndo,r=t.onShuffle,c=t.onRemove,u=t.undoDisabled,d=void 0!==u&&u,h=t.shuffleDisabled,m=void 0!==h&&h,v=t.removeDisabled,p=void 0!==v&&v,g=(0,l.Hi)();return(0,i.jsxs)(a.G7,{"className":"tool-bar","children":[(0,i.jsxs)(a.G7,{"className":"tool-btn ".concat(d?"disabled":""),"onClick":d?void 0:o,"children":[(0,i.jsx)(a.G7,{"className":"tool-icon","dangerouslySetInnerHTML":{"__html":g.undo}}),(0,i.jsx)(a.xv,{"className":"tool-name","children":"æ’¤å›"}),(0,i.jsx)(a.xv,{"className":"tool-count","children":d?"0/1":"1/1"})]}),(0,i.jsxs)(a.G7,{"className":"tool-btn ".concat(p?"disabled":""),"onClick":p?void 0:c,"children":[(0,i.jsx)(a.G7,{"className":"tool-icon","dangerouslySetInnerHTML":{"__html":g.pop}}),(0,i.jsx)(a.xv,{"className":"tool-name","children":"ç§»å‡º"}),(0,i.jsx)(a.xv,{"className":"tool-count","children":p?"0/1":"1/1"})]}),(0,i.jsxs)(a.G7,{"className":"tool-btn ".concat(m?"disabled":""),"onClick":m?void 0:r,"children":[(0,i.jsx)(a.G7,{"className":"tool-icon","dangerouslySetInnerHTML":{"__html":g.shuffle}}),(0,i.jsx)(a.xv,{"className":"tool-name","children":"æ´—ç‰Œ"}),(0,i.jsx)(a.xv,{"className":"tool-count","children":m?"0/1":"1/1"})]})]})},g=function ThreeTilesGameComponent(t){var o=t.state,r=t.onAction,a=t.onUseTool;return(0,i.jsxs)(i.Fragment,{"children":[(0,i.jsx)(u,{"tiles":o.boardTiles,"onTileClick":function onTileClick(t){return r({"type":"tile_click","payload":{"tileId":t.id}})}}),(0,i.jsx)(v,{"stacks":o.tempStacks,"onStackClick":function onStackClick(t){return r({"type":"return_temp","payload":{"positionIndex":t}})}}),(0,i.jsx)(m,{"tiles":o.slotTiles}),(0,i.jsx)(p,{"onUndo":function onUndo(){return a("undo")},"onShuffle":function onShuffle(){return a("shuffle")},"onRemove":function onRemove(){return a("pop")},"undoDisabled":o.undoUsed,"shuffleDisabled":o.shuffleUsed,"removeDisabled":o.popUsed})]})}},"4568":function(t,o,r){r.d(o,{"b":function(){return X}});var a=r(9366),l=r(2982),i=r(1413),c=r(5961),u=function isTileBlocked(t,o){return o.some(function(o){if(o.id===t.id)return!1;if(o.layer<=t.layer)return!1;var r=Math.abs(o.x-t.x)<2,a=Math.abs(o.y-t.y)<2;return r&&a})},d=function updateClickableStatus(t){return t.map(function(o){return(0,i.Z)((0,i.Z)({},o),{},{"isClickable":!u(o,t)})})},h=function checkMatch(t){var o={};t.forEach(function(t){o[t.type]=(o[t.type]||0)+1});var r=Object.keys(o).find(function(t){return o[t]>=3});if(r){var a=0;return{"newSlots":t.filter(function(t){return!(t.type===r&&a<3)||(a++,!1)}),"matched":!0}}return{"newSlots":t,"matched":!1}},m=function getDailyLayoutSeed(){var t=new Date;return function hashString(t){for(var o=0,r=0;r<t.length;r++)o=(o<<5)-o+t.charCodeAt(r),o&=o;return Math.abs(o)}("".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")))},v=function generateDailyLayout(t){for(var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:75,r=function createSeededRandom(t){var o=t;return function(){return(o=1103515245*o+12345&2147483647)/2147483647}}(t),a=[],l=0;l<o;l++)a.push({"x":Math.floor(9*r()),"y":Math.floor(12*r()),"layer":Math.floor(6*r())});return a.sort(function(t,o){return t.layer-o.layer}),a},p=function assignRandomTileTypes(t){for(var o=Object.values(c.YU),r=Math.floor(t.length/3),a=[],l=0;l<r;l++){var i=o[Math.floor(Math.random()*o.length)];a.push(i,i,i)}for(var u=a.length-1;u>0;u--){var h=Math.floor(Math.random()*(u+1)),m=[a[h],a[u]];a[u]=m[0],a[h]=m[1]}var v=t.map(function(t,o){return{"id":"tile-".concat(o),"type":a[o]||c.YU.STAR,"x":t.x,"y":t.y,"layer":t.layer,"isClickable":!0}});return d(v)},g=function generateHeroLevel(t){var o=function generateHeroLayout(t){for(var o=function createSeededRandom(t){var o=t;return function(){return(o=1103515245*o+12345&2147483647)/2147483647}}(t+1e3),r=[],a=0;a<150;a++)r.push({"x":Math.floor(9*o()),"y":Math.floor(12*o()),"layer":Math.floor(8*o())});return r.sort(function(t,o){return t.layer-o.layer}),r}(t);return function assignHeroTileTypes(t){for(var o=Object.values(c.YU),r=[].concat(o),a=Math.floor(t.length/3),l=[],i=0;i<a;i++){var u=r[Math.floor(Math.random()*r.length)];l.push(u,u,u)}for(var h=l.length-1;h>0;h--){var m=Math.floor(Math.random()*(h+1)),v=[l[m],l[h]];l[h]=v[0],l[m]=v[1]}var p=t.map(function(t,o){return{"id":"hero-tile-".concat(o),"type":l[o]||c.YU.STAR,"x":t.x,"y":t.y,"layer":t.layer,"isClickable":!0}});return d(p)}(o)},y=function shuffleBoard(t){for(var o=t.map(function(t){return{"x":t.x,"y":t.y,"layer":t.layer}}),r=(0,l.Z)(o),a=r.length-1;a>0;a--){var c=Math.floor(Math.random()*(a+1)),u=[r[c],r[a]];r[a]=u[0],r[c]=u[1]}var h=t.map(function(t,o){return(0,i.Z)((0,i.Z)({},t),{},{"x":r[o].x,"y":r[o].y,"layer":r[o].layer})});return d(h)},x=r(6891),b=function applyWinOrLossState(t){return function isCleared(t){var o=t.tempStacks.reduce(function(t,o){return t+o.length},0);return 0===t.boardTiles.length&&0===t.slotTiles.length&&0===o}(t)?(0,i.Z)((0,i.Z)({},t),{},{"status":"cleared","endedAt":Date.now()}):t.slotTiles.length>=7?(0,i.Z)((0,i.Z)({},t),{},{"status":"failed","endedAt":Date.now()}):t},k=function handleReturnFromTemp(t,o){var r=function returnTileFromTempStack(t,o,r,a){if(o.length>=a)return{"newSlot":o,"newTempStacks":r,"success":!1};if(t<0||t>=r.length)return{"newSlot":o,"newTempStacks":r,"success":!1};if(0===r[t].length)return{"newSlot":o,"newTempStacks":r,"success":!1};var i=r.map(function(t){return(0,l.Z)(t)}),c=i[t].pop();return{"newSlot":[].concat((0,l.Z)(o),[c]),"newTempStacks":i,"success":!0}}(o,t.slotTiles,t.tempStacks,7),a=r.newSlot,c=r.newTempStacks;if(!r.success)return t;var u=h(a).newSlots;return b((0,i.Z)((0,i.Z)({},t),{},{"slotTiles":u,"tempStacks":c}))},S=function addToolUsage(t){return(0,i.Z)((0,i.Z)({},t),{},{"toolsUsed":t.toolsUsed+1})},C=function mapChestToScore(t){switch(t){case c.q2.DIAMOND:return 100;case c.q2.GOLD:return 80;case c.q2.SILVER:return 60;default:return 30}},T={"enabled":!0,"mode":"hero","description":"Hard mode with denser stacks and one chance to maximize chest upgrade."},j=(r(7294),r(3970)),Z=r(5893),N={"id":"3tiles","meta":{"id":"3tiles","narrativeName":"Three Tiles","narrativeDesc":"Match three tiles and clear all stacks.","icon":"ğŸ€„ï¸","thumbnailComponent":function ThreeTilesThumbnail(){return(0,Z.jsx)(j.G7,{"children":(0,Z.jsx)(j.xv,{"children":"ğŸ€„ï¸ 3-Tiles"})})},"energyReward":120},"ratingConfig":{"diamond":{"minEfficiencyScore":95,"maxToolsUsed":0},"gold":{"minEfficiencyScore":75,"maxToolsUsed":1},"silver":{"minEfficiencyScore":50,"maxToolsUsed":3}},"initGame":function initThreeTilesState(t){var o,r=Date.now(),a=null!==(o=t.seed)&&void 0!==o?o:m();if("hero"===t.mode)return{"gameId":"3tiles","mode":"hero","status":"playing","startedAt":r,"attempts":1,"toolsUsed":0,"boardTiles":g(a),"slotTiles":[],"tempStacks":[[],[],[]],"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"dailySeed":a,"dailyLayout":[]};var l=function createNormalTiles(t){var o=v(t,75);return{"layout":o,"tiles":p(o)}}(a),i=l.layout;return{"gameId":"3tiles","mode":"normal","status":"playing","startedAt":r,"attempts":1,"toolsUsed":0,"boardTiles":l.tiles,"slotTiles":[],"tempStacks":[[],[],[]],"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"dailySeed":a,"dailyLayout":i}},"handleAction":function handleThreeTilesAction(t,o){switch(o.type){case"tile_click":var r,a=null===(r=o.payload)||void 0===r?void 0:r.tileId;return"string"!=typeof a?t:function handleTileClick(t,o){if("playing"!==t.status)return t;var r=function findTileById(t,o){return t.find(function(t){return t.id===o})}(t.boardTiles,o);if(!r||!r.isClickable)return t;var a=d(t.boardTiles.filter(function(t){return t.id!==o})),c=h([].concat((0,l.Z)(t.slotTiles),[r])),u=c.newSlots,m=(c.matched,(0,i.Z)((0,i.Z)({},t),{},{"boardTiles":a,"slotTiles":u}));return b(m)}(t,a);case"retry":return function handleRetry(t){if("hero"===t.mode)return(0,i.Z)((0,i.Z)({},t),{},{"status":"playing","attempts":t.attempts+1,"toolsUsed":0,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"endedAt":void 0,"boardTiles":g(t.dailySeed),"slotTiles":[],"tempStacks":[[],[],[]]});var o=p(t.dailyLayout);return(0,i.Z)((0,i.Z)({},t),{},{"status":"playing","attempts":t.attempts+1,"toolsUsed":0,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1,"endedAt":void 0,"boardTiles":o,"slotTiles":[],"tempStacks":[[],[],[]]})}(t);case"return_temp":var c,u=null===(c=o.payload)||void 0===c?void 0:c.positionIndex;return"number"!=typeof u?t:k(t,u);case"quit":return(0,i.Z)((0,i.Z)({},t),{},{"status":"quit","endedAt":Date.now()});default:return t}},"getStatus":function getThreeTilesStatus(t){return t.status},"getPerformance":function getThreeTilesPerformance(t){var o=(0,x.ns)();o.attempts=t.attempts,o.toolsUsed=t.toolsUsed;var r=(0,x.HS)(o);return{"efficiencyScore":C(r),"toolsUsed":t.toolsUsed,"rawData":{"attempts":t.attempts,"mode":t.mode,"status":t.status,"chestLevel":r}}},"getTools":function getTools(){return[{"id":"undo","name":"Undo","description":"Move last slot tile back to board.","freeUses":1},{"id":"pop","name":"Pop","description":"Move front slot tiles to temp stacks.","freeUses":1},{"id":"shuffle","name":"Shuffle","description":"Shuffle board positions.","freeUses":1}]},"useTool":function useThreeTilesTool(t,o){if("playing"!==t.status)return t;if("undo"===o){if(t.undoUsed)return t;var r=function undoLastTile(t,o){if(0===o.length)return{"newBoard":t,"newSlot":o,"success":!1};var r=o[o.length-1],a=o.slice(0,-1),i=[].concat((0,l.Z)(t),[r]);return{"newBoard":d(i),"newSlot":a,"success":!0}}(t.boardTiles,t.slotTiles),a=r.newBoard,c=r.newSlot;return r.success?S((0,i.Z)((0,i.Z)({},t),{},{"boardTiles":a,"slotTiles":c,"undoUsed":!0})):t}if("shuffle"===o)return t.shuffleUsed?t:S((0,i.Z)((0,i.Z)({},t),{},{"boardTiles":y(t.boardTiles),"shuffleUsed":!0}));if("pop"===o){if(t.popUsed)return t;var u=function popTilesToTemp(t,o){if(0===t.length)return{"remainSlot":t,"newTempStacks":o,"success":!1};var r=Math.min(t.length,3),a=t.slice(0,r),i=t.slice(r),c=3===o.length?o.map(function(t){return(0,l.Z)(t)}):[[],[],[]];return a.forEach(function(t,o){c[o].push(t)}),{"remainSlot":i,"newTempStacks":c,"success":!0}}(t.slotTiles,t.tempStacks),h=u.remainSlot,m=u.newTempStacks;return u.success?S((0,i.Z)((0,i.Z)({},t),{},{"slotTiles":h,"tempStacks":m,"popUsed":!0})):t}return t},"getHeroConfig":function getHeroConfig(){return T},"GameComponent":function getThreeTilesGameComponent(){return r(1024).Z}()},w=r(885),U=r(181);function createForOfIteratorHelper_createForOfIteratorHelper(t,o){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=(0,U.Z)(t))||o&&t&&"number"==typeof t.length){r&&(t=r);var a=0,l=function F(){};return{"s":l,"n":function n(){return a>=t.length?{"done":!0}:{"done":!1,"value":t[a++]}},"e":function e(t){throw t},"f":l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{"s":function s(){r=r.call(t)},"n":function n(){var t=r.next();return c=t.done,t},"e":function e(t){u=!0,i=t},"f":function f(){try{c||null==r.return||r.return()}finally{if(u)throw i}}}}var G=function cloneGrid(t){return t.map(function(t){return(0,l.Z)(t)})},M=function findEmpty(t){for(var o=0;o<t.length;o+=1)for(var r=0;r<t[o].length;r+=1)if(null===t[o][r])return[o,r];return null},D=function isValidPlacement(t,o,r,a,l){for(var i=0;i<l.size;i+=1){if(t[o][i]===a&&i!==r)return!1;if(t[i][r]===a&&i!==o)return!1}for(var c=Math.floor(o/l.boxRows)*l.boxRows,u=Math.floor(r/l.boxCols)*l.boxCols,d=c;d<c+l.boxRows;d+=1)for(var h=u;h<u+l.boxCols;h+=1)if((d!==o||h!==r)&&t[d][h]===a)return!1;return!0},I=function countBacktracking(t,o,r){var a=M(t);if(!a)return 1;var l,i=(0,w.Z)(a,2),c=i[0],u=i[1],d=0,h=createForOfIteratorHelper_createForOfIteratorHelper(o.symbols);try{for(h.s();!(l=h.n()).done;){var m=l.value;if(D(t,c,u,m,o)){if(t[c][u]=m,(d+=I(t,o,r))>=r)return t[c][u]=null,d;t[c][u]=null}}}catch(t){h.e(t)}finally{h.f()}return d},R=function countSudokuSolutions(t,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=G(t);return I(a,o,r)},A=function shuffle(t,o){for(var r=(0,l.Z)(t),a=r.length-1;a>0;a-=1){var i=Math.floor(o()*(a+1)),c=[r[i],r[a]];r[a]=c[0],r[i]=c[1]}return r},z=function clone(t){return t.map(function(t){return(0,l.Z)(t)})},E=function generateSudokuPuzzle(t){var o,r=function getSudokuRules(t){return"hero"===t?{"size":6,"boxRows":2,"boxCols":3,"symbols":["ğŸ“","â­","ğŸ¦ˆ","ğŸ’™","ğŸ…","ğŸ‘‘"]}:{"size":4,"boxRows":2,"boxCols":2,"symbols":["ğŸ“","â­","ğŸ¦ˆ","ğŸ’™"]}}(t.mode),a=function createSeededRandom(t){var o=t;return function(){return(o=1664525*o+1013904223>>>0)/4294967295}}(null!==(o=t.seed)&&void 0!==o?o:Date.now()),i=function createSolvedGrid(t,o){var r=(0,l.Z)(Array(t.size).keys()),a=(0,l.Z)(Array(t.size).keys()),i=(0,l.Z)(Array(t.size/t.boxRows).keys()),c=(0,l.Z)(Array(t.size/t.boxCols).keys()),u=A(i,o).flatMap(function(a){return A(r.slice(a*t.boxRows,(a+1)*t.boxRows),o)}),d=A(c,o).flatMap(function(r){return A(a.slice(r*t.boxCols,(r+1)*t.boxCols),o)}),h=A(t.symbols,o);return u.map(function(o){return d.map(function(r){var a=(o*t.boxCols+Math.floor(o/t.boxRows)+r)%t.size;return h[a]})})}(r,a),c="hero"===t.mode?12:6,u="hero"===t.mode?16:8,d=function removeCellsWithUniqueSolution(t,o,r,a){for(var i=t.map(function(t){return(0,l.Z)(t)}),c=[],u=0;u<o.size;u+=1)for(var d=0;d<o.size;d+=1)c.push([u,d]);var h,m=A(c,a),v=o.size*o.size,p=createForOfIteratorHelper_createForOfIteratorHelper(m);try{for(p.s();!(h=p.n()).done;){var g=(0,w.Z)(h.value,2),y=g[0],x=g[1];if(v<=r)break;var b=i[y][x];i[y][x]=null,1===R(z(i),o,2)?v-=1:i[y][x]=b}}catch(t){p.e(t)}finally{p.f()}return i}(i,r,c+Math.floor(a()*(u-c+1)),a);return{"size":r.size,"boxRows":r.boxRows,"boxCols":r.boxCols,"symbols":r.symbols,"givens":d,"solution":i}},L=function SudokuBoard(t){var o=t.size,r=t.boxRows,a=t.boxCols,l=t.grid,i=t.givens,c=t.selectedCell,u=t.errorCells,d=t.onSelect;return(0,Z.jsx)(j.G7,{"className":"sudoku-board","data-board-size":String(o),"children":l.map(function(t,l){return(0,Z.jsx)(j.G7,{"className":"sudoku-row","children":t.map(function(t,h){var m=null!==i[l][h],v=(null==c?void 0:c.row)===l&&(null==c?void 0:c.col)===h,p=u.some(function(t){return t.row===l&&t.col===h}),g=["sudoku-cell",m?"sudoku-cell--given":"",v?"sudoku-cell--selected":"",p?"sudoku-cell--error":"",l%r===0?"sudoku-cell--box-top":"",h%a===0?"sudoku-cell--box-left":"",l===o-1?"sudoku-cell--box-bottom":"",h===o-1?"sudoku-cell--box-right":""].filter(Boolean).join(" ");return(0,Z.jsx)(j.G7,{"className":g,"data-cell-row":String(l),"data-cell-col":String(h),"data-cell-given":m?"true":"false","data-cell-selected":v?"true":"false","data-cell-error":p?"true":"false","onClick":function onClick(){return d(l,h)},"children":(0,Z.jsx)(j.xv,{"children":null!=t?t:""})},"cell-".concat(l,"-").concat(h))})},"row-".concat(l))})})},O=function IconSelector(t){var o=t.symbols,r=t.onPick,a=t.onClear,l=t.disabled,i=void 0!==l&&l,c=t.disabledReason,u=void 0===c?null:c;return(0,Z.jsxs)(j.G7,{"className":"icon-selector".concat(i?" icon-selector--disabled":""),"children":[o.map(function(t,o){return(0,Z.jsx)(j.G7,{"className":"icon-selector__item".concat(i?" icon-selector__item--disabled":""),"data-selector-symbol":t,"onClick":function onClick(){i||r(t)},"children":(0,Z.jsx)(j.xv,{"children":t})},"".concat(t,"-").concat(o))}),(0,Z.jsx)(j.G7,{"className":"icon-selector__item".concat(i?" icon-selector__item--disabled":""),"data-selector-symbol":"clear","onClick":function onClick(){i||a()},"children":(0,Z.jsx)(j.xv,{"children":"âœ•"})}),i&&u&&(0,Z.jsx)(j.xv,{"className":"icon-selector__reason","children":u})]})},_=function HeroTimer(t){var o=t.remainingSeconds,r=t.totalSeconds,a=Math.max(0,Math.min(1,o/r)),l=o<=30;return(0,Z.jsxs)(j.G7,{"className":"hero-timer".concat(l?" hero-timer--danger":""),"data-danger":l?"true":"false","children":[(0,Z.jsx)(j.G7,{"className":"hero-timer__bar","style":{"width":"".concat(100*a,"%")}}),(0,Z.jsxs)(j.xv,{"className":"hero-timer__text","children":[o,"s"]})]})},H=function cloneGrid(t){return t.map(function(t){return(0,l.Z)(t)})},q=function collectErrors(t,o){for(var r=[],a=0;a<t.length;a+=1)for(var l=0;l<t[a].length;l+=1)null!==t[a][l]&&t[a][l]!==o[a][l]&&r.push({"row":a,"col":l});return r},P=function isInBounds(t,o,r){return o>=0&&r>=0&&o<t.puzzle.size&&r<t.puzzle.size},B=function evaluateSudokuState(t){if("hero"===t.mode&&t.remainingSeconds<=0)return(0,i.Z)((0,i.Z)({},t),{},{"status":"failed","endedAt":Date.now(),"remainingSeconds":0});if(!function allFilled(t){return t.every(function(t){return t.every(function(t){return null!==t})})}(t.grid))return(0,i.Z)((0,i.Z)({},t),{},{"errorCells":[]});var o=q(t.grid,t.puzzle.solution);return 0===o.length?(0,i.Z)((0,i.Z)({},t),{},{"status":"cleared","endedAt":Date.now(),"errorCells":[]}):(0,i.Z)((0,i.Z)({},t),{},{"errorCells":o,"uiMessage":"There are incorrect cells. Fix the highlighted cells."})},V=function createSudokuState(t){var o=E({"mode":t.mode,"seed":t.seed});return{"gameId":"sudoku","mode":t.mode,"status":"playing","startedAt":Date.now(),"attempts":1,"toolsUsed":0,"puzzle":o,"grid":H(o.givens),"selectedCell":null,"errorCells":[],"hintUsed":0,"checkUsed":0,"remainingSeconds":"hero"===t.mode?180:0,"maxHint":1,"maxCheck":0,"lastUnavailableAction":null,"uiMessage":null}},J=function canEditCell(t,o,r){return!!P(t,o,r)&&null===t.puzzle.givens[o][r]},W=function setCellValue(t,o){if(!t.selectedCell)return(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Select an editable cell first."});var r=t.selectedCell,a=r.row,l=r.col;if(!J(t,a,l))return(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"This cell is fixed and cannot be changed."});var c=H(t.grid);return c[a][l]=o,B((0,i.Z)((0,i.Z)({},t),{},{"grid":c,"uiMessage":null}))},Y=function getDurationSeconds(t){var o,r=null!==(o=t.endedAt)&&void 0!==o?o:Date.now();return Math.max(1,Math.floor((r-t.startedAt)/1e3))},K=function getEfficiencyScore(t){var o=Y(t),r=30;o<=120?r=95:o<=240?r=75:o<=480&&(r=50);var a=8*t.toolsUsed;return Math.max(0,r-a)},$={"id":"sudoku","meta":{"id":"sudoku","narrativeName":"Star Chart Decode","narrativeDesc":"Decode ancient coordinates by solving icon Sudoku.","icon":"ğŸ”®","thumbnailComponent":function SudokuThumbnail(){return(0,Z.jsx)(j.G7,{"children":(0,Z.jsx)(j.xv,{"children":"ğŸ”® Sudoku"})})},"energyReward":120},"ratingConfig":{"diamond":{"minEfficiencyScore":90,"maxToolsUsed":0},"gold":{"minEfficiencyScore":70,"maxToolsUsed":1},"silver":{"minEfficiencyScore":40,"maxToolsUsed":2}},"initGame":V,"handleAction":function handleAction(t,o){if("playing"!==t.status&&"retry"!==o.type)return t;switch(o.type){case"select_cell":var r,a,l=null===(r=o.payload)||void 0===r?void 0:r.row,c=null===(a=o.payload)||void 0===a?void 0:a.col;return"number"!=typeof l||"number"!=typeof c?(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid cell selection."}):P(t,l,c)?J(t,l,c)?(0,i.Z)((0,i.Z)({},t),{},{"selectedCell":{"row":l,"col":c},"uiMessage":null}):(0,i.Z)((0,i.Z)({},t),{},{"selectedCell":{"row":l,"col":c},"uiMessage":"This cell is fixed and cannot be changed."}):(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid cell selection."});case"input_symbol":var u,d=null===(u=o.payload)||void 0===u?void 0:u.symbol;return"string"!=typeof d?(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid symbol selection."}):t.puzzle.symbols.includes(d)?W(t,d):(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Invalid symbol selection."});case"clear_cell":return W(t,null);case"tick":var h;if("hero"!==t.mode)return t;var m=null===(h=o.payload)||void 0===h?void 0:h.deltaSeconds,v="number"==typeof m&&m>0?m:1;return B((0,i.Z)((0,i.Z)({},t),{},{"remainingSeconds":Math.max(0,t.remainingSeconds-v)}));case"retry":return(0,i.Z)((0,i.Z)({},V({"mode":t.mode,"date":"","seed":Date.now()})),{},{"attempts":t.attempts+1});case"quit":return(0,i.Z)((0,i.Z)({},t),{},{"status":"quit","endedAt":Date.now(),"uiMessage":null});default:return t}},"getStatus":function getStatus(t){return t.status},"getPerformance":function getPerformance(t){return{"efficiencyScore":K(t),"toolsUsed":t.toolsUsed,"rawData":{"attempts":t.attempts,"durationSeconds":Y(t),"mode":t.mode,"remainingSeconds":t.remainingSeconds}}},"getTools":function getTools(){return[{"id":"hint","name":"Hint","description":"Fill one cell with a correct symbol.","freeUses":1},{"id":"check","name":"Check","description":"Unavailable in MVP. Paid flow will be added later.","freeUses":0}]},"useTool":function useTool(t,o){if("playing"!==t.status)return t;if("hint"===o){if(t.hintUsed>=t.maxHint)return(0,i.Z)((0,i.Z)({},t),{},{"lastUnavailableAction":"hint","uiMessage":"Hint has already been used."});var r=function findHintCell(t){for(var o=0;o<t.grid.length;o+=1)for(var r=0;r<t.grid[o].length;r+=1)if(J(t,o,r)&&t.grid[o][r]!==t.puzzle.solution[o][r])return{"row":o,"col":r};return null}(t);if(!r)return(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"No available cell for hint."});var a=H(t.grid);return a[r.row][r.col]=t.puzzle.solution[r.row][r.col],B((0,i.Z)((0,i.Z)({},t),{},{"grid":a,"hintUsed":t.hintUsed+1,"toolsUsed":t.toolsUsed+1,"lastUnavailableAction":null,"uiMessage":"Hint filled one cell."}))}return"check"===o?t.maxCheck<=t.checkUsed?(0,i.Z)((0,i.Z)({},t),{},{"lastUnavailableAction":"check","uiMessage":"Check is unavailable in MVP."}):(0,i.Z)((0,i.Z)({},t),{},{"checkUsed":t.checkUsed+1,"toolsUsed":t.toolsUsed+1,"errorCells":q(t.grid,t.puzzle.solution),"uiMessage":null}):(0,i.Z)((0,i.Z)({},t),{},{"uiMessage":"Unknown tool action."})},"getHeroConfig":function getHeroConfig(){return{"enabled":!0,"mode":"hero","timeLimitSeconds":180,"description":"6x6 Sudoku with a 3-minute countdown."}},"GameComponent":function SudokuGameComponent(t){var o=t.state,r=t.onAction,a=t.onUseTool,l=t.mode,i=function getSelectorDisabledReason(t){if(!t.selectedCell)return"Select an editable cell first.";var o=t.selectedCell,r=o.row,a=o.col;return J(t,r,a)?null:"This cell is fixed and cannot be changed."}(o),c=null!==i,u=Math.max(0,o.maxHint-o.hintUsed),d=Math.max(0,o.maxCheck-o.checkUsed),h=d<=0;return(0,Z.jsxs)(j.G7,{"className":"sudoku-game","children":[(0,Z.jsx)(j.xv,{"className":"sudoku-game__title","children":"Sudoku"}),"hero"===l&&(0,Z.jsx)(_,{"remainingSeconds":o.remainingSeconds,"totalSeconds":180}),(0,Z.jsx)(L,{"size":o.puzzle.size,"boxRows":o.puzzle.boxRows,"boxCols":o.puzzle.boxCols,"grid":o.grid,"givens":o.puzzle.givens,"selectedCell":o.selectedCell,"errorCells":o.errorCells,"onSelect":function onSelect(t,o){return r({"type":"select_cell","payload":{"row":t,"col":o}})}}),(0,Z.jsx)(O,{"symbols":o.puzzle.symbols,"onPick":function onPick(t){return r({"type":"input_symbol","payload":{"symbol":t}})},"onClear":function onClear(){return r({"type":"clear_cell"})},"disabled":c,"disabledReason":i}),(0,Z.jsxs)(j.G7,{"className":"sudoku-tools","children":[(0,Z.jsx)(j.G7,{"className":"sudoku-tools__item".concat(u<=0?" sudoku-tools__item--disabled":""),"onClick":function onClick(){return a("hint")},"children":(0,Z.jsxs)(j.xv,{"children":["ğŸ’¡ Hint ",u,"/",o.maxHint]})}),(0,Z.jsx)(j.G7,{"className":"sudoku-tools__item".concat(h?" sudoku-tools__item--disabled":""),"onClick":function onClick(){return a("check")},"children":(0,Z.jsxs)(j.xv,{"children":["âœ… Check ",d,"/",o.maxCheck]})})]}),o.uiMessage&&(0,Z.jsx)(j.xv,{"className":"sudoku-message","children":o.uiMessage})]})}},Q=!1,X=function registerBuiltInGames(){Q||(a.O.register(N),a.O.register($),Q=!0)}},"6000":function(t,o,r){r.r(o),r.d(o,{"default":function(){return j}});var a=r(1413),l=r(885),i=r(7294),c=r(3970),u=r(4536),d=r(2937),h=r(9366),m=r(4568),v=r(5961),p=r(6891),g=r(5893),y=function ChestModal(t){var o=t.chestLevels,r=t.stats,a=t.gameMode,l=t.canChallengeHero,i=t.feedback,u=void 0===i?"skipped":i,d=t.onFeedbackChange,h=t.onClaim,m=t.onHeroChallenge,y=a===v.GF.HERO,x=o.map(function(t){return(0,p.PR)(t)}),b=(0,p.bV)(o[0]).map(function(t){return(0,p.PR)(t)});return(0,g.jsx)(c.G7,{"className":"chest-modal-overlay","children":(0,g.jsxs)(c.G7,{"className":"chest-modal","children":[(0,g.jsx)(c.xv,{"className":"victory-text","children":y?"ğŸ† Heroé€šå…³ï¼":"ğŸ‰ æ­å–œé€šå…³ï¼"}),(0,g.jsxs)(c.G7,{"className":"chest-container","children":[(0,g.jsx)(c.G7,{"className":"chest-row","children":x.map(function(t,r){return(0,g.jsx)(c.G7,{"className":"chest-display chest-".concat(o[r]),"style":{"borderColor":t.color},"children":(0,g.jsx)(c.xv,{"className":"chest-emoji","children":t.emoji})},r)})}),(0,g.jsx)(c.xv,{"className":"chest-name","style":{"color":x[0].color},"children":o.length>1?"".concat(x.map(function(t){return t.name}).join(" + ")):x[0].name}),y&&(0,g.jsx)(c.xv,{"className":"hero-bonus","children":"ğŸ”¥ HeroåŠ æˆç”Ÿæ•ˆï¼"})]}),(0,g.jsxs)(c.G7,{"className":"stats-container","children":[(0,g.jsxs)(c.G7,{"className":"stat-item","children":[(0,g.jsx)(c.xv,{"className":"stat-label","children":"æŒ‘æˆ˜æ¬¡æ•°"}),(0,g.jsxs)(c.xv,{"className":"stat-value","children":[r.attempts,"æ¬¡"]})]}),(0,g.jsxs)(c.G7,{"className":"stat-item","children":[(0,g.jsx)(c.xv,{"className":"stat-label","children":"é“å…·ä½¿ç”¨"}),(0,g.jsxs)(c.xv,{"className":"stat-value","children":[r.toolsUsed,"ä¸ª"]})]})]}),(0,g.jsxs)(c.G7,{"className":"feedback-section","children":[(0,g.jsx)(c.xv,{"className":"feedback-title","children":"How did this run feel?"}),(0,g.jsxs)(c.G7,{"className":"feedback-options","children":[(0,g.jsx)(c.G7,{"className":"feedback-option".concat("liked"===u?" feedback-option--active":""),"onClick":function onClick(){return null==d?void 0:d("liked")},"children":(0,g.jsx)(c.xv,{"children":"ğŸ‘ Like"})}),(0,g.jsx)(c.G7,{"className":"feedback-option".concat("disliked"===u?" feedback-option--active":""),"onClick":function onClick(){return null==d?void 0:d("disliked")},"children":(0,g.jsx)(c.xv,{"children":"ğŸ‘ Dislike"})})]})]}),l&&(0,g.jsxs)(c.G7,{"className":"hero-section","children":[(0,g.jsx)(c.xv,{"className":"hero-title","children":"ğŸ”¥ æŒ‘æˆ˜Heroæ¨¡å¼ï¼Ÿ"}),(0,g.jsxs)(c.xv,{"className":"hero-desc","children":["é€šå…³å¯å‡çº§ä¸º ",b.map(function(t){return"".concat(t.emoji," ").concat(t.name)}).join(" + ")]}),(0,g.jsx)(c.xv,{"className":"hero-warning","children":"âš ï¸ ä»…æœ‰1æ¬¡æœºä¼šï¼Œå¤±è´¥ä¸æ‰£å®ç®±"})]}),(0,g.jsx)(c.G7,{"className":"button-group","children":l?(0,g.jsxs)(g.Fragment,{"children":[(0,g.jsx)(c.zx,{"className":"btn-secondary","onClick":h,"children":"é¢†å–å®ç®±"}),(0,g.jsx)(c.zx,{"className":"btn-primary","onClick":m,"children":"æŒ‘æˆ˜Heroï¼"})]}):(0,g.jsx)(c.zx,{"className":"btn-primary full-width","onClick":h,"children":"é¢†å–å®ç®±"})})]})})},x=[{"day":1,"title":"æ¢¦æƒ³å¯èˆª","subtitle":"The Dream Begins","content":"äº”å²é‚£å¹´çš„å¤å¤©ï¼Œå°é¢–èç¬¬ä¸€æ¬¡èµ°è¿›äº†ä¹’ä¹“çƒé¦†ã€‚çœ‹ç€å¤§å­©å­ä»¬æŒ¥æ‹å‡»çƒçš„æ ·å­ï¼Œå¥¹çš„çœ¼ç›é‡Œé—ªçƒç€å¥½å¥‡çš„å…‰èŠ’ã€‚è¿™ä¸€å¤©ï¼Œä¸€é¢—å…³äºä¹’ä¹“çƒçš„ç§å­ï¼Œåœ¨å¥¹å¿ƒä¸­æ‚„ç„¶ç§ä¸‹ã€‚"},{"day":2,"title":"ç¬¬ä¸€æ¬¡æ¯”èµ›","subtitle":"First Competition","content":"çœé˜Ÿé€‰æ‹”èµ›ä¸Šï¼Œåä¸€å²çš„é¢–èç´§æ¡çƒæ‹ï¼Œæ‰‹å¿ƒå¾®å¾®å‡ºæ±—ã€‚å¯¹é¢æ˜¯æ¯”å¥¹å¤§ä¸¤å²çš„é€‰æ‰‹ï¼Œä½†å¥¹æ²¡æœ‰é€€ç¼©ã€‚ä¸€æ¿åˆä¸€æ¿ï¼Œæ¯ä¸€ä¸ªå›çƒéƒ½å‡èšç€å¥¹è‹¦ç»ƒçš„æ±—æ°´ã€‚æœ€ç»ˆï¼Œå¥¹èµ¢äº†ã€‚"},{"day":3,"title":"å›½å®¶é˜Ÿçš„é—¨","subtitle":"National Team Calling","content":"2015å¹´çš„é‚£ä¸ªç§‹å¤©ï¼Œåäº”å²çš„é¢–èæ”¶åˆ°äº†å›½å®¶é˜Ÿçš„é‚€è¯·ã€‚å½“å¥¹èµ°è¿›é‚£æ‰‡é—¨çš„æ—¶å€™ï¼Œå¥¹çŸ¥é“ï¼ŒçœŸæ­£çš„æŒ‘æˆ˜æ‰åˆšåˆšå¼€å§‹ã€‚è¿™é‡Œæœ‰æœ€å¼ºçš„å¯¹æ‰‹ï¼Œä¹Ÿæœ‰æœ€å¥½çš„è€å¸ˆã€‚"},{"day":4,"title":"ä½è°·ä¸æˆé•¿","subtitle":"Through the Valley","content":"è¿›å…¥å›½å®¶é˜Ÿçš„ç¬¬ä¸€å¹´å¹¶ä¸é¡ºåˆ©ã€‚è¾“çƒã€ä¼¤ç—…ã€æ€å¿µå®¶äºº...ä½†æ¯ä¸€æ¬¡è·Œå€’ï¼Œå¥¹éƒ½é€‰æ‹©çˆ¬èµ·æ¥ç»§ç»­ç»ƒä¹ ã€‚æ·±å¤œçš„è®­ç»ƒé¦†é‡Œï¼Œåªæœ‰å¥¹å’Œçƒåœ¨å¯¹è¯ã€‚"},{"day":5,"title":"ä¸–ç•Œèˆå°","subtitle":"World Stage","content":"2019å¹´ä¸–é”¦èµ›å¥³åŒå†³èµ›ï¼Œé¢–èå’Œæ­æ¡£é…åˆé»˜å¥‘ï¼Œä¸€è·¯è¿‡å…³æ–©å°†ã€‚å½“é‡‘ç‰ŒæŒ‚åœ¨èƒ¸å‰çš„é‚£ä¸€åˆ»ï¼Œå¥¹ç»ˆäºå¯ä»¥éª„å‚²åœ°è¯´ï¼šæˆ‘åšåˆ°äº†ã€‚"},{"day":6,"title":"å¥¥è¿æ¢¦åœ†","subtitle":"Olympic Dream","content":"ä¸œäº¬å¥¥è¿ä¼šçš„èµ›åœºä¸Šï¼Œé¢–èä»£è¡¨ä¸­å›½é˜Ÿç«™åœ¨äº†æœ€é«˜çš„èˆå°ã€‚è™½ç„¶å•æ‰“å†³èµ›æƒœè´¥ï¼Œä½†å¥¹ç”¨å®åŠ›è¯æ˜äº†è‡ªå·±çš„ä¸–ç•Œçº§æ°´å‡†ã€‚é“¶ç‰Œçš„é‡é‡ï¼Œæ˜¯æœªæ¥æ›´å¤§æ¢¦æƒ³çš„èµ·ç‚¹ã€‚"},{"day":7,"title":"ç‹è€…ä¹‹è·¯","subtitle":"Path of Champions","content":"2023å¹´ï¼Œé¢–èç™»é¡¶ä¸–ç•Œç¬¬ä¸€ã€‚ä»äº”å²çš„å°å¥³å­©åˆ°ä¸–ç•Œå† å†›ï¼Œå¥¹ç”¨åå…«å¹´çš„åšæŒè¯ é‡Šäº†ä»€ä¹ˆæ˜¯æ¢¦æƒ³çš„åŠ›é‡ã€‚è€Œè¿™ï¼Œåªæ˜¯å¼€å§‹..."}],b=function StoryModal(t){var o=t.storyDay,r=t.onComplete,a=(0,i.useState)(""),u=(0,l.Z)(a,2),d=u[0],h=u[1],m=(0,i.useState)(!1),v=(0,l.Z)(m,2),p=v[0],y=v[1],b=(0,i.useState)(!1),k=(0,l.Z)(b,2),S=k[0],C=k[1],T=function getStoryByDay(t){return x.find(function(o){return o.day===t})||null}(o);(0,i.useEffect)(function(){if(T){var t=setTimeout(function(){C(!0)},1e3),o=T.content,a=0,l=setInterval(function(){a<o.length?(h(o.slice(0,a+1)),a++):(clearInterval(l),y(!0))},50);return function(){clearTimeout(t),clearInterval(l)}}r()},[T,r]);return T?(0,g.jsx)(c.G7,{"className":"story-modal-overlay","children":(0,g.jsxs)(c.G7,{"className":"story-modal","children":[(0,g.jsxs)(c.G7,{"className":"story-header","children":[(0,g.jsxs)(c.xv,{"className":"story-day","children":["Day ",o]}),(0,g.jsx)(c.xv,{"className":"story-title","children":T.title}),(0,g.jsx)(c.xv,{"className":"story-subtitle","children":T.subtitle})]}),(0,g.jsxs)(c.G7,{"className":"story-content","children":[(0,g.jsx)(c.xv,{"className":"story-text","children":d}),!p&&(0,g.jsx)(c.xv,{"className":"typing-cursor","children":"|"})]}),(0,g.jsxs)(c.G7,{"className":"story-actions","children":[S&&!p&&(0,g.jsx)(c.zx,{"className":"skip-btn","onClick":function handleSkip(){T&&(h(T.content),y(!0))},"children":"è·³è¿‡"}),p&&(0,g.jsx)(c.zx,{"className":"continue-btn","onClick":function handleContinue(){r()},"children":"ç»§ç»­ â†’"})]})]})}):null},k=r(5589),S=function navigateToStarlight(){u.ZP.switchTab({"url":"/pages/starlight/index","fail":function fail(t){console.error("Navigation to starlight failed:",t),u.ZP.reLaunch({"url":"/pages/starlight/index"})}})},C=function toChestEnum(t){switch(t){case"diamond":return v.q2.DIAMOND;case"gold":return v.q2.GOLD;case"silver":return v.q2.SILVER;default:return v.q2.BRONZE}},T=function isThreeTilesState(t){return"boolean"==typeof t.undoUsed&&"boolean"==typeof t.shuffleUsed&&"boolean"==typeof t.popUsed},j=function GamePage(){var t,o,r=u.ZP.useRouter(),x="hero"===r.params.mode?"hero":"normal",j=r.params.gameType,Z=(0,i.useRef)(new d.d),N=(0,i.useState)(null),w=(0,l.Z)(N,2),U=w[0],G=w[1],M=(0,i.useState)(null),D=(0,l.Z)(M,2),I=D[0],R=D[1],A=(0,i.useState)("skipped"),z=(0,l.Z)(A,2),E=z[0],L=z[1],O=(0,i.useState)(null),_=(0,l.Z)(O,2),H=_[0],q=_[1],P=(0,i.useState)(!1),B=(0,l.Z)(P,2),V=B[0],J=B[1],W=(0,i.useState)(!1),Y=(0,l.Z)(W,2),K=Y[0],$=Y[1],Q=(0,i.useState)(0),X=(0,l.Z)(Q,2),ee=X[0],te=X[1],ne=(0,i.useState)(!1),oe=(0,l.Z)(ne,2),re=oe[0],se=oe[1],ae=(0,i.useState)(!1),le=(0,l.Z)(ae,2),ie=le[0],ce=le[1],ue=(0,i.useRef)(!1),de=(0,i.useMemo)(function(){return(0,k._G)()},[]),fe="local-user";(0,i.useEffect)(function(){(0,m.b)();var t=Z.current,o=j||t.getTodayGame(fe,de).id;try{var r=h.O.get(o);t.setGame(o),G(r);var a=t.startGame({"mode":x,"date":de,"userId":fe});R(a),$(!1),q(null),J(!1),L("skipped"),te(0),se(!1),ce(!1)}catch(t){console.error("Failed to start game:",t)}},[de,x,j]),(0,i.useEffect)(function(){if(I&&U&&"cleared"===I.status&&!ie)if("normal"===x){var t=(0,k.cn)();t>0&&(te(t),se(!0)),ce(!0)}else ce(!0)},[x,U,I,ie]),(0,i.useEffect)(function(){if("true"===r.params.autowin&&!ue.current&&I){ue.current=!0;var t=setTimeout(function(){R(function(t){return t&&"playing"===t.status?(0,a.Z)((0,a.Z)({},t),{},{"status":"cleared","endedAt":Date.now()}):t})},400);return function(){return clearTimeout(t)}}},[r.params.autowin,I]),(0,i.useEffect)(function(){if(I&&U&&"playing"===I.status&&"hero"===x&&"sudoku"===U.id){var t=setInterval(function(){var t=Z.current.dispatch({"type":"tick","payload":{"deltaSeconds":1}});R(t)},1e3);return function(){return clearInterval(t)}}},[x,U,I]),(0,i.useEffect)(function(){var t;if(I&&U&&"cleared"===I.status&&!H){var o={"gameId":U.id,"mode":x,"status":"cleared","attempts":I.attempts,"durationSeconds":Math.max(1,Math.floor(((null!==(t=I.endedAt)&&void 0!==t?t:Date.now())-I.startedAt)/1e3)),"toolsUsed":I.toolsUsed,"heroAttempted":"hero"===x,"heroResult":"hero"===x?"cleared":void 0,"feedback":E},r=Z.current.enterSettlement(o);q(r),J(!0)}},[E,x,U,H,I]);var he=function handleAction(t,o){if(I)try{var r=Z.current.dispatch({"type":t,"payload":o});"retry"===t&&(te(0),se(!1),ce(!1)),R(r)}catch(t){console.error("Failed to dispatch action:",t)}},me=function persistCompletion(t,o){var r=Z.current.getChestLevelAsEnum(t.chestLevel),a=(0,k.yu)();if("hero"===o.mode){var l,i=(null===(l=a.pendingChest)||void 0===l||null===(l=l.levels)||void 0===l?void 0:l[0])||r,c=(0,p.bV)(i);return(0,k.Z9)(c,!0),(0,k.gv)(o.attempts,!0,c[0],!0,"cleared"===o.status),void(0,k.EG)(v.GF.HERO,c[0],a.consecutiveDays)}(0,k.Z9)([r],!1),(0,k.gv)(o.attempts,!0,r,!1,!1),(0,k.EG)(function mapMode(t){return"hero"===t?v.GF.HERO:v.GF.NORMAL}(o.mode),r,a.consecutiveDays)},ve=function finalizeAndExit(t){var o;if(I&&U&&!K&&H){var r={"gameId":U.id,"mode":x,"status":"failed"===I.status?"failed":"quit"===I.status?"quit":"cleared","attempts":I.attempts,"durationSeconds":Math.max(1,Math.floor(((null!==(o=I.endedAt)&&void 0!==o?o:Date.now())-I.startedAt)/1e3)),"toolsUsed":I.toolsUsed,"heroAttempted":"hero"===x||"hero"===t,"heroResult":"hero"===x?"cleared"===I.status?"cleared":"failed":void 0,"feedback":E},a=Z.current.onGameEnd(r);me(a,r),$(!0),J(!1),"hero"!==t?S():u.ZP.redirectTo({"url":"/pages/game/index?mode=hero&gameType=".concat(U.id)})}};if(!U||!I)return(0,g.jsx)(c.G7,{"className":"game-page"});var pe=U.GameComponent,ge=["game-page","hero"===x?"hero-mode":"","sudoku"===U.id?"game-page--sudoku":""].filter(Boolean).join(" ");return(0,g.jsxs)(c.G7,{"className":ge,"children":[(0,g.jsxs)(c.G7,{"className":"header","children":[(0,g.jsxs)(c.G7,{"className":"stats-row","children":[(0,g.jsx)(c.xv,{"className":"day-text","children":U.meta.narrativeName}),(0,g.jsxs)(c.xv,{"className":"attempt-text","children":["Attempt ",I.attempts]})]}),(0,g.jsxs)(c.G7,{"className":"header-right","children":[(0,g.jsx)(c.zx,{"className":"test-win-btn","onClick":function handleTestWin(){I&&"playing"===I.status&&R((0,a.Z)((0,a.Z)({},I),{},{"status":"cleared","endedAt":Date.now()}))},"children":"ğŸ¯ One-Click Win"}),(0,g.jsx)(c.G7,{"className":"tools-status","children":(0,g.jsxs)(c.xv,{"children":["Tools: ",I.toolsUsed]})})]})]}),(0,g.jsx)(pe,{"state":I,"onAction":function onAction(t){return he(t.type,t.payload)},"onUseTool":function handleUseTool(t){if(I)try{var o=Z.current.useTool(t);R(o)}catch(t){console.error("Failed to use tool:",t)}},"mode":x}),re&&"normal"===x&&(0,g.jsx)(b,{"storyDay":ee,"onComplete":function handleStoryComplete(){ee>0&&(0,k.OO)(ee),se(!1)}}),"failed"===I.status&&(0,g.jsx)(c.G7,{"className":"overlay","children":(0,g.jsxs)(c.G7,{"className":"lost-modal","children":[(0,g.jsx)(c.xv,{"className":"lost-title","children":"Challenge failed"}),(0,g.jsx)(c.zx,{"className":"retry-btn","onClick":function onClick(){return he("retry")},"children":"Retry"}),"hero"===x&&(0,g.jsx)(c.zx,{"className":"claim-btn-secondary","onClick":function onClick(){return S()},"children":"Claim Current Chest"}),(0,g.jsx)(c.zx,{"className":"claim-btn-secondary","onClick":function onClick(){return S()},"children":"Exit"})]})}),V&&H&&"3tiles"===U.id&&!re&&(0,g.jsx)(y,{"chestLevels":"hero"===x?(0,p.bV)((null===(t=(0,k.yu)().pendingChest)||void 0===t||null===(t=t.levels)||void 0===t?void 0:t[0])||C(H.chestLevel)):[C(H.chestLevel)],"stats":T(I)?{"attempts":I.attempts,"toolsUsed":I.toolsUsed,"undoUsed":I.undoUsed,"shuffleUsed":I.shuffleUsed,"popUsed":I.popUsed}:{"attempts":I.attempts,"toolsUsed":I.toolsUsed,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1},"gameMode":"hero"===x?v.GF.HERO:v.GF.NORMAL,"canChallengeHero":"normal"===x&&U.getHeroConfig().enabled,"onClaim":function onClaim(){return ve("exit")},"onHeroChallenge":function onHeroChallenge(){return ve("hero")},"onClose":function onClose(){return ve("exit")},"feedback":E,"onFeedbackChange":L}),V&&H&&"3tiles"!==U.id&&!re&&(0,g.jsx)(y,{"chestLevels":"hero"===x?(0,p.bV)((null===(o=(0,k.yu)().pendingChest)||void 0===o||null===(o=o.levels)||void 0===o?void 0:o[0])||C(H.chestLevel)):[C(H.chestLevel)],"stats":{"attempts":I.attempts,"toolsUsed":I.toolsUsed,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1},"gameMode":"hero"===x?v.GF.HERO:v.GF.NORMAL,"canChallengeHero":"normal"===x&&U.getHeroConfig().enabled,"onClaim":function onClaim(){return ve("exit")},"onHeroChallenge":function onHeroChallenge(){return ve("hero")},"onClose":function onClose(){return ve("exit")},"feedback":E,"onFeedbackChange":L})]})}},"3311":function(t,o,r){r.d(o,{"J":function(){return c}});var a=r(7853),l="amio_game_session_logs_v1",i=function loadLogs(){try{var t=(0,a.qu)(l);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load game logs:",t),[]}},c={"append":function append(t){var o=i();o.push(t),function saveLogs(t){try{(0,a.Fj)(l,JSON.stringify(t))}catch(t){console.error("Failed to save game logs:",t)}}(o)},"listByUser":function listByUser(t){return i().filter(function(o){return o.userId===t})},"clear":function clear(){try{(0,a.hq)(l)}catch(t){console.error("Failed to clear game logs:",t)}},"storageKey":l}},"9874":function(t,o,r){r.d(o,{"u":function(){return c}});var a=r(7853),l="amio_preference_records_v1",i=function loadRecords(){try{var t=(0,a.qu)(l);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load preference records:",t),[]}},c={"save":function save(t){var o=i().filter(function(o){return!(o.userId===t.userId&&o.date===t.date&&o.gameType===t.gameType)});o.push(t),function saveRecords(t){try{(0,a.Fj)(l,JSON.stringify(t))}catch(t){console.error("Failed to save preference records:",t)}}(o)},"listByUser":function listByUser(t){return i().filter(function(o){return o.userId===t})},"clear":function clear(){try{(0,a.hq)(l)}catch(t){console.error("Failed to clear preference records:",t)}},"storageKey":l}},"6891":function(t,o,r){r.d(o,{"Ge":function(){return getChestRewardDetails},"HS":function(){return calculateChestLevel},"PR":function(){return getChestLevelInfo},"bV":function(){return upgradeChestForHero},"ns":function(){return createInitialStats}});var a=r(5961);function calculateChestLevel(t){var o=t.attempts,r=t.toolsUsed;return 1===o?0===r?a.q2.DIAMOND:1===r?a.q2.GOLD:a.q2.SILVER:2===o?r<=1?a.q2.GOLD:a.q2.SILVER:3===o?r<=2?a.q2.SILVER:a.q2.BRONZE:o>=4&&o<=5&&r<=1?a.q2.SILVER:a.q2.BRONZE}function getChestLevelInfo(t){switch(t){case a.q2.DIAMOND:return{"emoji":"ğŸ’","name":"é’»çŸ³å®ç®±","color":"#00D4FF"};case a.q2.GOLD:return{"emoji":"ğŸ¥‡","name":"é»„é‡‘å®ç®±","color":"#FFD700"};case a.q2.SILVER:return{"emoji":"ğŸ¥ˆ","name":"ç™½é“¶å®ç®±","color":"#C0C0C0"};case a.q2.BRONZE:return{"emoji":"ğŸ¥‰","name":"é’é“œå®ç®±","color":"#CD7F32"}}}function getChestRewardDetails(t){switch(t){case a.q2.DIAMOND:return[{"coins":"é‡‘å¸Ã—500","props":"é“å…·Ã—3","lottery":"æŠ½å¥–åˆ¸Ã—2","physical":"10%å®ä½“å‘¨è¾¹"}];case a.q2.GOLD:return[{"coins":"é‡‘å¸Ã—300","props":"é“å…·Ã—2","lottery":"æŠ½å¥–åˆ¸Ã—1","physical":"3%å®ä½“å‘¨è¾¹"}];case a.q2.SILVER:return[{"coins":"é‡‘å¸Ã—150","props":"é“å…·Ã—1","lottery":"5%æŠ½å¥–åˆ¸","physical":""}];case a.q2.BRONZE:return[{"coins":"é‡‘å¸Ã—50","props":"é“å…·ç¢ç‰‡","lottery":"","physical":""}]}}function upgradeChestForHero(t){switch(t){case a.q2.BRONZE:return[a.q2.GOLD];case a.q2.SILVER:return[a.q2.DIAMOND];case a.q2.GOLD:return[a.q2.DIAMOND,a.q2.GOLD];case a.q2.DIAMOND:return[a.q2.DIAMOND,a.q2.DIAMOND]}}function createInitialStats(){return{"attempts":1,"toolsUsed":0,"undoUsed":!1,"shuffleUsed":!1,"popUsed":!1}}}}]);