"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[677],{"5677":function(e,n,a){a.r(n),a.d(n,{"Dispose":function(){return Dispose},"DumpData":function(){return DumpData},"DumpDataAsync":function(){return DumpDataAsync},"DumpFramebuffer":function(){return DumpFramebuffer},"DumpTools":function(){return o}});var r=a(6522),t=a(8658),s=a(7143),p=a(5953);let i,u=null;async function DumpFramebuffer(e,n,a,r,t="image/png",s,p){const i=await a.readPixels(0,0,e,n);DumpData(e,n,new Uint8Array(i.buffer),r,t,s,!0,void 0,p)}function DumpDataAsync(e,n,a,r="image/png",t,s=!1,p=!1,i){return new Promise(u=>{DumpData(e,n,a,e=>u(e),r,t,s,p,i)})}function DumpData(e,n,o,c,D="image/png",l,m=!1,f=!1,d){(async function _CreateDumpRenderer(){return u||(u=new Promise((e,n)=>{let t,s=null;const u={"preserveDrawingBuffer":!0,"depth":!1,"stencil":!1,"alpha":!0,"premultipliedAlpha":!1,"antialias":!1,"failIfMajorPerformanceCaveat":!1};Promise.resolve().then(a.bind(a,5459)).then(({"ThinEngine":o})=>{const c=p.l.Instances.length;try{t=new OffscreenCanvas(100,100),s=new o(t,!1,u)}catch(e){c<p.l.Instances.length&&p.l.Instances.pop()?.dispose(),t=document.createElement("canvas"),s=new o(t,!1,u)}p.l.Instances.pop(),p.l.OnEnginesDisposedObservable.add(e=>{s&&e!==s&&!s.isDisposed&&0===p.l.Instances.length&&Dispose()}),s.getCaps().parallelShaderCompile=void 0;const D=new r.I(s);a.e(360).then(a.bind(a,1360)).then(({"passPixelShader":a})=>{if(!s)return void n("Engine is not defined");const p=new r.H({"engine":s,"name":a.name,"fragmentShader":a.shader,"samplerNames":["textureSampler"]});i={"canvas":t,"engine":s,"renderer":D,"wrapper":p},e(i)})}).catch(n)})),await u})().then(a=>{if(a.engine.setSize(e,n,!0),o instanceof Float32Array){const e=new Uint8Array(o.length);let n=o.length;for(;n--;){const a=o[n];e[n]=Math.round(255*(0,s.Lh)(a))}o=e}const r=a.engine.createRawTexture(o,e,n,5,!1,!m,1);a.renderer.setViewport(),a.renderer.applyEffectWrapper(a.wrapper),a.wrapper.effect._bindTexture("textureSampler",r),a.renderer.draw(),f?t.w1.ToBlob(a.canvas,e=>{const n=new FileReader;n.onload=e=>{const n=e.target.result;c&&c(n)},n.readAsArrayBuffer(e)},D,d):t.w1.EncodeScreenshotCanvasData(a.canvas,c,D,l,d),r.dispose()})}function Dispose(){i?(i.wrapper.dispose(),i.renderer.dispose(),i.engine.dispose()):u?.then(e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()}),u=null,i=null}const o={"DumpData":DumpData,"DumpDataAsync":DumpDataAsync,"DumpFramebuffer":DumpFramebuffer,"Dispose":Dispose};t.w1.DumpData=DumpData,t.w1.DumpDataAsync=DumpDataAsync,t.w1.DumpFramebuffer=DumpFramebuffer}}]);